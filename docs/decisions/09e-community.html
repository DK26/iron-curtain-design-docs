<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Community &amp; Platform - Iron Curtain â€” Design Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Design docs for a Rust-native Red Alert RTS engine">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-1e683dcc.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-a0d63c9c.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Iron Curtain â€” Design Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/DK26/iron-curtain-design-docs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/DK26/iron-curtain-design-docs/edit/main/src/decisions/09e-community.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="decision-log--community--platform"><a class="header" href="#decision-log--community--platform">Decision Log â€” Community &amp; Platform</a></h1>
<p>Workshop, telemetry, storage, achievements, governance, premium content, player profiles, and data portability.</p>
<hr>
<h2 id="d030-workshop-resource-registry--dependency-system"><a class="header" href="#d030-workshop-resource-registry--dependency-system">D030: Workshop Resource Registry &amp; Dependency System</a></h2>
<h3 id="decision-capsule-llmrag-summary"><a class="header" href="#decision-capsule-llmrag-summary">Decision Capsule (LLM/RAG Summary)</a></h3>
<ul>
<li><strong>Status:</strong> Accepted</li>
<li><strong>Phase:</strong> Phase 0â€“3 (Git index MVP), Phase 3â€“4 (P2P added), Phase 4â€“5 (minimal viable Workshop), Phase 6a (full federation), Phase 7+ (advanced discovery)</li>
<li><strong>Canonical for:</strong> Workshop resource registry model, dependency semantics, resource granularity, and federated package ecosystem strategy</li>
<li><strong>Scope:</strong> Workshop package identities/manifests, dependency resolution, registry/index architecture, publish/install flows, resource licensing/AI-usage metadata</li>
<li><strong>Decision:</strong> ICâ€™s Workshop is a <strong>crates.io-style resource registry</strong> where assets and mods are publishable as independent versioned resources with semver dependencies, license metadata, and optional AI-usage permissions.</li>
<li><strong>Why:</strong> Enables reuse instead of copy-paste, preserves attribution, supports automation/CI publishing, and gives both humans and LLM agents a structured way to discover and compose community content.</li>
<li><strong>Non-goals:</strong> A monolithic â€œmods onlyâ€ Workshop with no reusable resource granularity; forcing a single centralized infrastructure from day one.</li>
<li><strong>Invariants preserved:</strong> Federation-first architecture (aligned with D050), compatibility with existing mod packaging flows, and community ownership/self-hosting principles.</li>
<li><strong>Defaults / UX behavior:</strong> Workshop packages are versioned resources; dependencies can be required or optional; auto-download/install resolves dependency trees for players/lobbies.</li>
<li><strong>Compatibility / Export impact:</strong> Resource registry supports both IC-native and compatibility-oriented content; D049 defines canonical format recommendations and P2P delivery details.</li>
<li><strong>Security / Trust impact:</strong> License metadata and <code>ai_usage</code> permissions are first-class; supports automated policy checks and creator consent for agentic tooling.</li>
<li><strong>Performance / Ops impact:</strong> Phased rollout starts with a low-cost Git index and grows toward full infrastructure only as needed.</li>
<li><strong>Public interfaces / types / commands:</strong> <code>publisher/name@version</code> IDs, semver dependency ranges in <code>mod.yaml</code>, <code>.icpkg</code> packages, <code>ic mod publish/install/init</code></li>
<li><strong>Affected docs:</strong> <code>src/04-MODDING.md</code>, <code>src/decisions/09e-community.md</code> (D049/D050/D061), <code>src/decisions/09c-modding.md</code>, <code>src/17-PLAYER-FLOW.md</code></li>
<li><strong>Revision note summary:</strong> None</li>
<li><strong>Keywords:</strong> workshop registry, dependencies, semver, icpkg, federated workshop, reusable resources, ai_usage permissions, mod publish</li>
</ul>
<p><strong>Decision:</strong> The Workshop operates as a crates.io-style resource registry where any game asset â€” music, sprites, textures, cutscenes, maps, sound effects, palettes, voice lines, UI themes, templates â€” is publishable as an independent, versioned, licensable resource that others (including LLM agents, with author consent) can discover, depend on, and pull automatically. Authors control AI access to their resources separately from the license via <code>ai_usage</code> permissions.</p>
<p><strong>Rationale:</strong></p>
<ul>
<li>OpenRA has no resource sharing infrastructure â€” modders copy-paste files, share on forums, lose attribution</li>
<li>Individual resources (a single music track, one sprite sheet) should be as easy to publish and consume as full mods</li>
<li>A dependency system eliminates duplication: five mods that need the same HD sprite pack declare it as a dependency instead of each bundling 200MB of sprites</li>
<li>License metadata protects community creators and enables automated compatibility checking</li>
<li>LLM agents generating missions need a way to discover and pull community assets without human intervention</li>
<li>The mod ecosystem grows faster when building blocks are reusable â€” this is why npm/crates.io/pip changed their respective ecosystems</li>
<li>CI/CD-friendly publishing (headless CLI, scoped API tokens) lets serious mod teams automate their release pipeline â€” no manual uploads</li>
</ul>
<p><strong>Key Design Elements:</strong></p>
<h3 id="phased-delivery-strategy"><a class="header" href="#phased-delivery-strategy">Phased Delivery Strategy</a></h3>
<p>The Workshop design below is comprehensive, but it ships incrementally:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Phase</th><th>Scope</th><th>Complexity</th></tr>
</thead>
<tbody>
<tr><td>Phase 0â€“3</td><td><strong>Git-hosted index:</strong> <code>workshop-index</code> GitHub repo as package registry (<code>index.yaml</code> + per-package manifests). <code>.icpkg</code> files stored on GitHub Releases (free CDN). Community contributes via PR. <code>git-index</code> source type in Workshop client. Zero infrastructure cost</td><td>Minimal</td></tr>
<tr><td>Phase 3â€“4</td><td><strong>Add P2P:</strong> BitTorrent tracker ($5-10/month VPS). Package manifests gain <code>torrent</code> source entries. P2P delivery for large packages. Git index remains discovery layer. Format recommendations published</td><td>Lowâ€“Medium</td></tr>
<tr><td>Phase 4â€“5</td><td><strong>Minimal viable Workshop:</strong> Full Workshop server (search, ratings, deps) + integrated P2P tracker + <code>ic mod publish</code> + <code>ic mod install</code> + in-game browser + auto-download on lobby join</td><td>Medium</td></tr>
<tr><td>Phase 6a</td><td><strong>Full Workshop:</strong> Federation, community servers join P2P swarm, replication, promotion channels, CI/CD token scoping, creator reputation, DMCA process, Steam Workshop as optional source</td><td>High</td></tr>
<tr><td>Phase 7+</td><td><strong>Advanced:</strong> LLM-driven discovery, premium hosting tiers</td><td>Low priority</td></tr>
</tbody>
</table>
</div>
<p>The Artifactory-level federation design is the end state, not the MVP. Ship simple, iterate toward complex. P2P delivery (D049) is integrated from Phase 3â€“4 because centralized hosting costs are a sustainability risk â€” better to solve early than retrofit. Workshop packages use the <code>.icpkg</code> format (ZIP with <code>manifest.yaml</code>) â€” see D049 for full specification.</p>
<p><strong>Cross-engine validation:</strong> O3DEâ€™s <strong>Gem system</strong> uses a declarative <code>gem.json</code> manifest with explicit dependency declarations, version constraints, and categorized tags â€” the same structure IC targets for Workshop packages. O3DEâ€™s template system (<code>o3de register --template-path</code>) scaffolds new projects from standard templates, validating ICâ€™s planned <code>ic mod init --template=...</code> CLI command. Factorioâ€™s mod portal uses semver dependency ranges (e.g., <code>&gt;= 1.1.0</code>) with automatic resolution â€” the same model IC should use for Workshop package dependencies. See <code>research/godot-o3de-engine-analysis.md</code> Â§ O3DE and <code>research/mojang-wube-modding-analysis.md</code> Â§ Factorio.</p>
<h3 id="resource-identity--versioning"><a class="header" href="#resource-identity--versioning">Resource Identity &amp; Versioning</a></h3>
<p>Every Workshop resource gets a globally unique identifier: <code>publisher/name@version</code>.</p>
<ul>
<li><strong>Publisher</strong> = author username or organization (e.g., <code>alice</code>, <code>community-hd-project</code>)</li>
<li><strong>Name</strong> = resource name, lowercase with hyphens (e.g., <code>soviet-march-music</code>, <code>allied-infantry-hd</code>)</li>
<li><strong>Version</strong> = semver (e.g., <code>1.2.0</code>)</li>
<li>Full ID example: <code>alice/soviet-march-music@1.2.0</code></li>
</ul>
<h3 id="resource-categories-expanded"><a class="header" href="#resource-categories-expanded">Resource Categories (Expanded)</a></h3>
<p>Resources arenâ€™t limited to mod-sized packages. Granularity is flexible:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Category</th><th>Granularity Examples</th></tr>
</thead>
<tbody>
<tr><td>Music</td><td>Single track, album, soundtrack</td></tr>
<tr><td>Sound Effects</td><td>Weapon sound pack, ambient loops, UI sounds</td></tr>
<tr><td>Voice Lines</td><td>EVA pack, unit response set, faction voice pack</td></tr>
<tr><td>Sprites</td><td>Single unit sheet, building sprites, effects pack</td></tr>
<tr><td>Textures</td><td>Terrain tileset, UI skin, palette-indexed sprites</td></tr>
<tr><td>Palettes</td><td>Theater palette, faction palette, seasonal palette</td></tr>
<tr><td>Maps</td><td>Single map, map pack, tournament map pool</td></tr>
<tr><td>Missions</td><td>Single mission, mission chain</td></tr>
<tr><td>Campaign Chapters</td><td>Story arc with persistent state</td></tr>
<tr><td>Scene Templates</td><td>Tera scene template for LLM composition</td></tr>
<tr><td>Mission Templates</td><td>Tera mission template for LLM composition</td></tr>
<tr><td>Cutscenes / Video</td><td>Briefing video, in-game cinematic, tutorial clip</td></tr>
<tr><td>UI Themes</td><td>Sidebar layout, font pack, cursor set</td></tr>
<tr><td>Balance Presets</td><td>Tuned unit/weapon stats as a selectable preset</td></tr>
<tr><td>QoL Presets</td><td>Gameplay behavior toggle set (D033) â€” sim-affecting + client-only toggles</td></tr>
<tr><td>Experience Profile</td><td>Combined balance + theme + QoL + AI + pathfinding + render mode (D019+D032+D033+D043+D045+D048)</td></tr>
<tr><td>Resource Packs</td><td>Switchable asset layer for any category â€” see <code>04-MODDING.md</code> Â§ â€œResource Packsâ€</td></tr>
<tr><td>Script Libraries</td><td>Reusable Lua modules, utility functions, AI behavior scripts, trigger templates, console automation scripts (<code>.iccmd</code>) â€” see D058 Â§ â€œCompetitive Integrityâ€</td></tr>
<tr><td>Full Mods</td><td>Traditional mod (may depend on individual resources)</td></tr>
</tbody>
</table>
</div>
<p>A published resource is just a <code>ResourcePackage</code> with the appropriate <code>ResourceCategory</code>. The existing <code>asset-pack</code> template and <code>ic mod publish</code> flow handle this natively â€” no separate command needed.</p>
<h3 id="dependency-declaration"><a class="header" href="#dependency-declaration">Dependency Declaration</a></h3>
<p><code>mod.yaml</code> already has a <code>dependencies:</code> section. D030 formalizes the resolution semantics:</p>
<pre><code class="language-yaml"># mod.yaml
dependencies:
  - id: "community-project/hd-infantry-sprites"
    version: "^2.0"                    # semver range (cargo-style)
    source: workshop                   # workshop | local | url
  - id: "alice/soviet-march-music"
    version: "&gt;=1.0, &lt;3.0"
    source: workshop
    optional: true                     # soft dependency â€” mod works without it
  - id: "bob/desert-terrain-textures"
    version: "~1.4"                    # compatible with 1.4.x
    source: workshop
</code></pre>
<p>Resource packages can also declare dependencies on other resources (transitive):</p>
<pre><code class="language-yaml"># A mission pack depends on a sprite pack and a music track
dependencies:
  - id: "community-project/hd-sprites"
    version: "^2.0"
    source: workshop
  - id: "alice/briefing-videos"
    version: "^1.0"
    source: workshop
</code></pre>
<h3 id="repository-types"><a class="header" href="#repository-types">Repository Types</a></h3>
<p>The Workshop uses three repository types (architecture inspired by Artifactoryâ€™s local/remote/virtual model):</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Source Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>Local</strong></td><td>A directory on disk following Workshop structure. Stores resources you create. Used for development, LAN parties, offline play, pre-publish testing.</td></tr>
<tr><td><strong>Remote</strong></td><td>A Workshop server (official or community-hosted). Resources are downloaded and cached locally on first access. Cache is used for subsequent requests â€” works offline after first pull.</td></tr>
<tr><td><strong>Virtual</strong></td><td>The aggregated view across all configured sources. The <code>ic</code> CLI and in-game browser query the virtual view â€” it merges listings from all local + remote + git-index sources, deduplicates by resource ID, and resolves version conflicts using priority ordering.</td></tr>
</tbody>
</table>
</div>
<p>The <code>settings.toml</code> <code>sources</code> list defines which local and remote sources compose the virtual view. This is the federation model â€” the client never queries raw servers directly, it queries the merged Workshop view.</p>
<h3 id="package-integrity"><a class="header" href="#package-integrity">Package Integrity</a></h3>
<p>Every published resource includes cryptographic checksums for integrity verification:</p>
<ul>
<li><strong>SHA-256 checksum</strong> stored in the package manifest and on the Workshop server</li>
<li><code>ic mod install</code> verifies checksums after download â€” mismatch â†’ abort + warning</li>
<li><code>ic.lock</code> records both version AND checksum for each dependency â€” guarantees byte-identical installs across machines</li>
<li>Protects against: corrupted downloads, CDN tampering, mirror drift</li>
<li>Workshop server computes checksums on upload; clients verify on download. Trust but verify.</li>
</ul>
<h3 id="manifest-integrity--confusion-prevention"><a class="header" href="#manifest-integrity--confusion-prevention">Manifest Integrity &amp; Confusion Prevention</a></h3>
<p>The canonical package manifest is <strong>inside the <code>.icpkg</code> archive</strong> (<code>manifest.yaml</code>). The git-index entry and Workshop server metadata are derived summaries â€” never independent sources of truth. See <code>06-SECURITY.md</code> Â§ Vulnerability 20 for the full threat analysis (inspired by the 2023 npm manifest confusion affecting 800+ packages).</p>
<ul>
<li><strong><code>manifest_hash</code> field:</strong> Every index entry includes <code>manifest_hash: SHA-256(manifest.yaml)</code> â€” the hash of the manifest file itself, separate from the full-package hash. Clients verify this independently.</li>
<li><strong>CI validation (git-index phase):</strong> PR validation CI downloads the <code>.icpkg</code>, extracts <code>manifest.yaml</code>, computes its hash, and verifies against the declared <code>manifest_hash</code>. Mismatch â†’ PR rejected.</li>
<li><strong>Client verification:</strong> <code>ic mod install</code> verifies the extracted <code>manifest.yaml</code> matches the indexâ€™s <code>manifest_hash</code> before processing mod content. Mismatch â†’ abort.</li>
</ul>
<h3 id="version-immutability"><a class="header" href="#version-immutability">Version Immutability</a></h3>
<p>Once version X.Y.Z is published, its content <strong>cannot</strong> be modified or overwritten. The SHA-256 hash recorded at publish time is permanent.</p>
<ul>
<li><strong>Yanking â‰  deletion:</strong> Yanked versions are hidden from new <code>ic mod install</code> searches but remain downloadable for existing <code>ic.lock</code> files that reference them.</li>
<li><strong>Git-index enforcement:</strong> CI rejects PRs that modify fields in existing version manifest files. Only additions of new version files are accepted.</li>
<li><strong>Registry enforcement (Phase 4+):</strong> Workshop server API rejects publish requests for existing version numbers with HTTP 409 Conflict. No override flag.</li>
</ul>
<h3 id="typosquat--name-confusion-prevention"><a class="header" href="#typosquat--name-confusion-prevention">Typosquat &amp; Name Confusion Prevention</a></h3>
<p>Publisher-scoped naming (<code>publisher/package</code>) is the structural defense â€” see <code>06-SECURITY.md</code> Â§ Vulnerability 19. Additional measures:</p>
<ul>
<li><strong>Name similarity checking at publish time:</strong> Levenshtein distance + common substitution patterns checked against existing packages. Edit distance â‰¤ 2 from an existing popular package â†’ flagged for manual review.</li>
<li><strong>Disambiguation in mod manager:</strong> When multiple similar names exist, the search UI shows a notice with download counts and publisher reputation.</li>
</ul>
<h3 id="reputation-system-integrity"><a class="header" href="#reputation-system-integrity">Reputation System Integrity</a></h3>
<p>The Workshop reputation system (download count, average rating, dependency count, publish consistency, community reports) includes anti-gaming measures:</p>
<ul>
<li><strong>Rate-limited reviews:</strong> One review per account per package. Accounts must be &gt;7 days old with at least one game session to leave reviews.</li>
<li><strong>Download deduplication:</strong> Counts unique authenticated users, not raw download events. Anonymous downloads deduplicated by IP with a time window.</li>
<li><strong>Sockpuppet detection:</strong> Burst of positive reviews from newly created accounts â†’ flagged for moderator review. Review weight is proportional to reviewer account age and activity.</li>
<li><strong>Source repo verification (optional):</strong> If a package links to a source repository, the publisher can verify push access to earn a â€œverified sourceâ€ badge.</li>
</ul>
<h3 id="abandoned-package-policy"><a class="header" href="#abandoned-package-policy">Abandoned Package Policy</a></h3>
<p>A published package is considered <strong>abandoned</strong> after 18+ months of inactivity AND no response to 3 maintainer contact attempts over 90 days.</p>
<ul>
<li><strong>Archive-first default:</strong> Abandoned packages are archived (still installable, marked â€œunmaintainedâ€ with a banner) rather than transferred.</li>
<li><strong>Transfer process:</strong> Community can nominate a new maintainer. Requires moderator approval + 30-day public notice period. Original author can reclaim within 6 months.</li>
<li><strong>Published version immutability survives transfer.</strong> New maintainer can publish new versions but cannot modify existing ones.</li>
</ul>
<h3 id="promotion--maturity-channels"><a class="header" href="#promotion--maturity-channels">Promotion &amp; Maturity Channels</a></h3>
<p>Resources can be published to maturity channels, allowing staged releases:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Channel</th><th>Purpose</th><th>Visibility</th></tr>
</thead>
<tbody>
<tr><td><code>dev</code></td><td>Work-in-progress, local testing</td><td>Author only (local repos only)</td></tr>
<tr><td><code>beta</code></td><td>Pre-release, community testing</td><td>Opt-in (users enable beta flag)</td></tr>
<tr><td><code>release</code></td><td>Stable, production-ready</td><td>Default (everyone sees these)</td></tr>
</tbody>
</table>
</div>
<pre><code class="language-yaml"># mod.yaml
mod:
  version: "1.3.0-beta.1"            # semver pre-release tag
  channel: beta                       # publish to beta channel
</code></pre>
<ul>
<li><code>ic mod publish --channel beta</code> â†’ visible only to users who opt in to beta resources</li>
<li><code>ic mod publish</code> (no flag) â†’ release channel by default</li>
<li><code>ic mod install</code> pulls from release channel unless <code>--include-beta</code> is specified</li>
<li>Promotion: <code>ic mod promote 1.3.0-beta.1 release</code> â†’ moves resource to release channel without re-upload</li>
</ul>
<h3 id="replication--mirroring"><a class="header" href="#replication--mirroring">Replication &amp; Mirroring</a></h3>
<p>Community Workshop servers can replicate from the official server (pull replication, Artifactory-style):</p>
<ul>
<li><strong>Pull replication:</strong> Community server periodically syncs popular resources from official. Reduces latency for regional players, provides redundancy.</li>
<li><strong>Selective sync:</strong> Community servers choose which categories/publishers to replicate (e.g., replicate all Maps but not Mods)</li>
<li><strong>Offline bundles:</strong> <code>ic workshop export-bundle</code> creates a portable archive of selected resources for LAN parties or airgapped environments. <code>ic workshop import-bundle</code> loads them into a local repository.</li>
</ul>
<h3 id="dependency-resolution"><a class="header" href="#dependency-resolution">Dependency Resolution</a></h3>
<p>Cargo-inspired version solving:</p>
<ul>
<li><strong>Semver ranges:</strong> <code>^1.2</code> (&gt;=1.2.0, &lt;2.0.0), <code>~1.2</code> (&gt;=1.2.0, &lt;1.3.0), <code>&gt;=1.0, &lt;3.0</code>, exact <code>=1.2.3</code></li>
<li><strong>Lockfile:</strong> <code>ic.lock</code> records exact resolved versions + SHA-256 checksums for reproducible installs. In multi-source configurations, also records the <strong>source identifier</strong> per dependency (<code>source:publisher/package@version</code>) to prevent dependency confusion across federated sources (see <code>06-SECURITY.md</code> Â§ Vulnerability 22).</li>
<li><strong>Transitive resolution:</strong> If mod A depends on resource B which depends on resource C, all three are resolved</li>
<li><strong>Conflict detection:</strong> Two dependencies requiring incompatible versions of the same resource â†’ error with resolution suggestions</li>
<li><strong>Deduplication:</strong> Same resource pulled by multiple dependents is stored once in local cache</li>
<li><strong>Offline resolution:</strong> Once cached, all dependencies resolve from local cache â€” no network required</li>
</ul>
<h3 id="cli-extensions"><a class="header" href="#cli-extensions">CLI Extensions</a></h3>
<pre><code>ic mod resolve         # compute dependency graph, report conflicts
ic mod install         # download all dependencies to local cache
ic mod update          # update deps to latest compatible versions (respects semver)
ic mod tree            # display dependency tree (like `cargo tree`)
ic mod lock            # regenerate ic.lock from current mod.yaml
ic mod audit           # check dependency licenses for compatibility + source confusion detection
ic mod list             # list all local resources (state, size, last used, source)
ic mod remove &lt;pkg&gt;     # remove resource from disk (dependency-aware, prompts for cascade)
ic mod deactivate &lt;pkg&gt; # keep on disk but don't load (quick toggle without re-download)
ic mod activate &lt;pkg&gt;   # re-enable a deactivated resource
ic mod pin &lt;pkg&gt;        # mark as "keep" â€” exempt from auto-cleanup
ic mod unpin &lt;pkg&gt;      # allow auto-cleanup (returns to transient state)
ic mod clean            # remove all expired transient resources
ic mod clean --dry-run  # show what would be cleaned without removing anything
ic mod status           # disk usage summary: total, by category, by state, largest resources
</code></pre>
<p>These extend the existing <code>ic</code> CLI (D020), not replace it. <code>ic mod publish</code> already exists â€” it now also uploads dependency metadata and validates license presence.</p>
<h3 id="local-resource-management"><a class="header" href="#local-resource-management">Local Resource Management</a></h3>
<p>Without active management, a playerâ€™s disk fills with resources from lobby auto-downloads, one-off map packs, and abandoned mods. IC treats this as a first-class design problem â€” not an afterthought.</p>
<p><strong>Resource lifecycle states:</strong></p>
<p>Every local resource is in exactly one of these states:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>State</th><th>On disk?</th><th>Loaded by game?</th><th>Auto-cleanup eligible?</th><th>How to enter</th></tr>
</thead>
<tbody>
<tr><td><strong>Pinned</strong></td><td>Yes</td><td>Yes</td><td>No â€” stays until explicitly removed</td><td><code>ic mod install</code>, â€œInstallâ€ in Workshop UI, <code>ic mod pin</code>, or auto-promotion</td></tr>
<tr><td><strong>Transient</strong></td><td>Yes</td><td>Yes</td><td>Yes â€” after TTL expires</td><td>Lobby auto-download, transitive dependency of a transient resource</td></tr>
<tr><td><strong>Deactivated</strong></td><td>Yes</td><td>No</td><td>No â€” explicit state, player decides</td><td><code>ic mod deactivate</code> or toggle in UI</td></tr>
<tr><td><strong>Expiring</strong></td><td>Yes</td><td>Yes</td><td>Yes â€” in grace period, deletion pending</td><td>Transient resource unused for <code>transient_ttl_days</code></td></tr>
<tr><td><strong>Removed</strong></td><td>No</td><td>No</td><td>N/A</td><td><code>ic mod remove</code>, auto-cleanup, or player confirmation</td></tr>
</tbody>
</table>
</div>
<p><strong>Pinned vs. Transient â€” the core distinction:</strong></p>
<ul>
<li><strong>Pinned</strong> resources are things the player explicitly chose: they clicked â€œInstall,â€ ran <code>ic mod install</code>, or marked a resource as â€œKeep.â€ Pinned resources stay on disk forever until the player explicitly removes them. This is the default state for deliberate installations.</li>
<li><strong>Transient</strong> resources arrived automatically â€” lobby auto-downloads, dependencies pulled transitively by other transient resources. Theyâ€™re fully functional (loaded, playable, seedable) but have a time-to-live. After <code>transient_ttl_days</code> without being used in a game session (default: 30 days), they enter the <strong>Expiring</strong> state.</li>
</ul>
<p>This distinction means a player who joins a modded lobby once doesnâ€™t accumulate permanent disk debt. The resources work for that session and stick around for a month in case the player returns to similar lobbies â€” then quietly clean up.</p>
<p><strong>Auto-promotion:</strong> If a transient resource is used in 3+ separate game sessions, itâ€™s automatically promoted to Pinned. A non-intrusive notification tells the player: â€œKept alice/hd-sprites â€” youâ€™ve used it in 5 matches.â€ This preserves content the player clearly enjoys without requiring manual action.</p>
<p><strong>Deactivation:</strong></p>
<p>Deactivated resources stay on disk but arenâ€™t loaded by the game. Use cases:</p>
<ul>
<li>Temporarily disable a heavy mod without losing it (and having to re-download 500 MB later)</li>
<li>Keep content available for quick re-activation (one click, no network)</li>
<li>Deactivated resources are still available as P2P seeds (configurable via <code>seed_deactivated</code> setting) since theyâ€™re already integrity-verified</li>
</ul>
<p>Dependency-aware: deactivating a resource that others depend on offers: â€œbob/tank-skins depends on this. Deactivate both? [Both / Just this one / Cancel]â€. Deactivating â€œjust this oneâ€ means dependents that reference it will show a missing-dependency warning in the mod manager.</p>
<p><strong>Dependency-aware removal:</strong></p>
<p><code>ic mod remove alice/hd-sprites</code> checks the reverse dependency graph:</p>
<ul>
<li>If nothing depends on it â†’ remove immediately.</li>
<li>If bob/tank-skins depends on it â†’ prompt: â€œbob/tank-skins depends on alice/hd-sprites. Remove both? [Yes / No / Remove only alice/hd-sprites and deactivate bob/tank-skins]â€</li>
<li><code>ic mod remove alice/hd-sprites --cascade</code> â†’ removes the resource and all resources that become orphaned as a result (no explicit dependents left).</li>
<li>Orphan detection: after any removal, scan for resources with zero dependents and zero explicit install (not pinned by the player). These are cleanup candidates.</li>
</ul>
<p><strong>Storage budget and auto-cleanup:</strong></p>
<pre><code class="language-toml"># settings.toml
[workshop]
cache_dir = "~/.ic/cache"

[workshop.storage]
budget_gb = 10                    # max transient cache before auto-cleanup (0 = unlimited)
transient_ttl_days = 30           # days of non-use before transient resources expire
cleanup_prompt = "weekly"         # never | after-session | weekly | monthly
low_disk_warning_gb = 5           # warn when OS free space drops below this
seed_deactivated = false          # P2P seed deactivated (but verified) resources
</code></pre>
<ul>
<li><code>budget_gb</code> applies to <strong>transient</strong> resources only. Pinned and deactivated resources donâ€™t count against the auto-cleanup budget (but are shown in disk usage summaries).</li>
<li>When transient cache exceeds <code>budget_gb</code>, the oldest (by last-used timestamp) transient resources are cleaned first â€” LRU eviction.</li>
<li>At 80% of budget, the content manager shows a gentle notice: â€œWorkshop cache is 8.1 / 10 GB. [Clean up now] [Adjust budget]â€</li>
<li>On low system disk space (below <code>low_disk_warning_gb</code>), cleanup suggestions become more prominent and include deactivated resources as candidates.</li>
</ul>
<p><strong>Post-session cleanup prompt:</strong></p>
<p>After a game session that auto-downloaded resources, a non-intrusive toast appears:</p>
<pre><code> Downloaded 2 new resources for this match (47 MB).
  alice/hd-sprites@2.0    38 MB
  bob/desert-map@1.1       9 MB
 [Pin (keep forever)]  [They'll auto-clean in 30 days]  [Remove now]
</code></pre>
<p>The default (clicking away or ignoring the toast) is â€œtransientâ€ â€” resources stay for 30 days then auto-clean. The player only needs to act if they want to explicitly keep or immediately remove. This is the low-friction path: do nothing = reasonable default.</p>
<p><strong>Periodic cleanup prompt (configurable):</strong></p>
<p>Based on <code>cleanup_prompt</code> setting:</p>
<ul>
<li><code>after-session</code>: prompt after every session that used transient resources</li>
<li><code>weekly</code> (default): once per week if there are expiring transient resources</li>
<li><code>monthly</code>: once per month</li>
<li><code>never</code>: fully manual â€” player uses <code>ic mod clean</code> or the content manager</li>
</ul>
<p>The prompt shows total reclaimable space and a one-click â€œClean all expiredâ€ button:</p>
<pre><code> Workshop cleanup: 3 resources unused for 30+ days (1.2 GB)
  [Clean all]  [Review individually]  [Remind me later]
</code></pre>
<p><strong>In-game Local Content Manager:</strong></p>
<p>Accessible from the Workshop tab â†’ â€œMy Contentâ€ (or a dedicated top-level menu item). This is the playerâ€™s disk management dashboard:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  My Content                                        Storage: 6.2 GB â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Pinned: 4.1 GB (12 resources)                               â”‚ â”‚
â”‚  â”‚ Transient: 1.8 GB (23 resources, 5 expiring soon)           â”‚ â”‚
â”‚  â”‚ Deactivated: 0.3 GB (2 resources)                           â”‚ â”‚
â”‚  â”‚ Budget: 1.8 / 10 GB transient    [Clean expired: 340 MB]    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Filter: [All â–¾]  [Any category â–¾]  Sort: [Size â–¾]  [Searchâ€¦]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Resource           â”‚ Size â”‚ State â”‚ Last Used â”‚ Source â”‚ Action â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ alice/hd-sprites   â”‚ 38MB â”‚ ğŸ“Œ    â”‚ 2 days agoâ”‚ Manual â”‚ [Â·Â·Â·]  â”‚
â”‚ bob/desert-map     â”‚  9MB â”‚ â³    â”‚ 28 days   â”‚ Lobby  â”‚ [Â·Â·Â·]  â”‚
â”‚ core/ra-balance    â”‚  1MB â”‚ ğŸ“Œ    â”‚ today     â”‚ Manual â”‚ [Â·Â·Â·]  â”‚
â”‚ dave/retro-sounds  â”‚ 52MB â”‚ ğŸ’¤    â”‚ 3 months  â”‚ Manual â”‚ [Â·Â·Â·]  â”‚
â”‚ eve/snow-map       â”‚  4MB â”‚ â³âš    â”‚ 32 days   â”‚ Lobby  â”‚ [Â·Â·Â·]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  ğŸ“Œ = Pinned  â³ = Transient  ğŸ’¤ = Deactivated  âš  = Expiring    â”‚
â”‚  [Select all]  [Bulk: Pin | Deactivate | Remove]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>The <code>[Â·Â·Â·]</code> action menu per resource:</p>
<ul>
<li><strong>Pin / Unpin</strong> â€” toggle between pinned and transient</li>
<li><strong>Deactivate / Activate</strong> â€” toggle loading without removing</li>
<li><strong>Remove</strong> â€” delete from disk (dependency-aware prompt)</li>
<li><strong>View in Workshop</strong> â€” open the Workshop page for this resource</li>
<li><strong>Show dependents</strong> â€” what local resources depend on this one</li>
<li><strong>Show dependencies</strong> â€” what this resource requires</li>
<li><strong>Open folder</strong> â€” reveal the resourceâ€™s cache directory in the file manager</li>
</ul>
<p><strong>Bulk operations:</strong> Select multiple resources â†’ Pin all, Deactivate all, Remove all. â€œSelect all transientâ€ and â€œSelect all expiringâ€ shortcuts for quick cleanup.</p>
<p><strong>â€œWhatâ€™s using my disk?â€ view:</strong> A treemap or bar chart showing disk usage by category (Maps, Mods, Resource Packs, Script Libraries) with the largest individual resources highlighted. Helps players identify space hogs quickly. Accessible from the storage summary at the top of the content manager.</p>
<p><strong>Group operations:</strong></p>
<ul>
<li><strong>Pin with dependencies:</strong> <code>ic mod pin alice/total-conversion --with-deps</code> pins the resource AND all its transitive dependencies. Ensures the entire dependency tree is protected from auto-cleanup.</li>
<li><strong>Remove with orphans:</strong> <code>ic mod remove alice/total-conversion --cascade</code> removes the resource and any dependencies that become orphaned (no other pinned or transient resource needs them).</li>
<li><strong>Modpack-aware:</strong> Pinning a modpack (D030 Â§ Modpacks) pins all resources in the modpack. Removing a modpack removes all resources that were only needed by that modpack.</li>
</ul>
<p><strong>How resources from different sources interact:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Source</th><th>Default state</th><th>Auto-cleanup?</th></tr>
</thead>
<tbody>
<tr><td><code>ic mod install</code> (explicit)</td><td>Pinned</td><td>No</td></tr>
<tr><td>Workshop UI â€œInstallâ€ button</td><td>Pinned</td><td>No</td></tr>
<tr><td>Lobby auto-download</td><td>Transient</td><td>Yes (after TTL)</td></tr>
<tr><td>Dependency of a pinned resource</td><td>Pinned (inherited)</td><td>No</td></tr>
<tr><td>Dependency of a transient resource</td><td>Transient (inherited)</td><td>Yes</td></tr>
<tr><td><code>ic workshop import-bundle</code></td><td>Pinned</td><td>No</td></tr>
<tr><td>Steam Workshop subscription</td><td>Pinned (managed by Steam)</td><td>Steam handles</td></tr>
</tbody>
</table>
</div>
<p><strong>Edge case â€” mixed dependency state:</strong> If resource C is a dependency of both pinned resource A and transient resource B: C is treated as pinned (strongest state wins). If A is later removed, C reverts to transient (inheriting from B). The state is always computed from the dependency graph, not stored independently for shared deps.</p>
<p><strong>Phase:</strong> Resource states (pinned/transient) and <code>ic mod remove/deactivate/clean/status</code> ship in Phase 4â€“5 with the Workshop. Storage budget and auto-cleanup prompts in Phase 5. In-game content manager UI in Phase 5â€“6a.</p>
<h3 id="continuous-deployment"><a class="header" href="#continuous-deployment">Continuous Deployment</a></h3>
<p>The <code>ic</code> CLI is designed for CI/CD pipelines â€” every command works headless (no interactive prompts). Authors authenticate via scoped API tokens (<code>IC_WORKSHOP_TOKEN</code> environment variable or <code>--token</code> flag). Tokens are scoped to specific operations (<code>publish</code>, <code>promote</code>, <code>admin</code>) and expire after a configurable duration. This enables:</p>
<ul>
<li><strong>Tag-triggered publish:</strong> Push a <code>v1.2.0</code> git tag â†’ CI validates, tests headless, publishes to Workshop automatically</li>
<li><strong>Beta channel CI:</strong> Every merge to <code>main</code> publishes to <code>beta</code>; explicit tag promotes to <code>release</code></li>
<li><strong>Multi-resource monorepos:</strong> Matrix builds publish multiple resource packs from a single repo</li>
<li><strong>Automated quality gates:</strong> <code>ic mod check</code> + <code>ic mod test</code> + <code>ic mod audit</code> run before every publish</li>
<li><strong>Scheduled compatibility checks:</strong> Cron-triggered CI re-publishes against latest engine version to catch regressions</li>
</ul>
<p>Works with GitHub Actions, GitLab CI, Gitea Actions, or any CI system â€” the CLI is a single static binary. See <code>04-MODDING.md</code> Â§ â€œContinuous Deployment for Workshop Authorsâ€ for the full workflow including a GitHub Actions example.</p>
<h3 id="script-libraries--sharing"><a class="header" href="#script-libraries--sharing">Script Libraries &amp; Sharing</a></h3>
<p><strong>Lesson from ArmA/OFP:</strong> ArmAâ€™s modding ecosystem thrives partly because the community developed shared script libraries (CBA â€” Community Base Addons, ACE3â€™s interaction framework, ACRE radio system) that became foundational infrastructure. Mods built on shared libraries instead of reimplementing common patterns. IC makes this a first-class Workshop category.</p>
<p>A Script Library is a Workshop resource containing reusable Lua modules that other mods can depend on:</p>
<pre><code class="language-yaml"># mod.yaml for a script library resource
mod:
  name: "rts-ai-behaviors"
  category: script-library
  version: "1.0.0"
  license: "MIT"
  description: "Reusable AI behavior patterns for mission scripting"
  exports:
    - "patrol_routes"        # Lua module names available to dependents
    - "guard_behaviors"
    - "retreat_logic"
</code></pre>
<p>Dependent mods declare the library as a dependency and import its modules:</p>
<pre><code class="language-lua">-- In a mission script that depends on rts-ai-behaviors
local patrol = require("rts-ai-behaviors.patrol_routes")
local guard  = require("rts-ai-behaviors.guard_behaviors")

patrol.create_route(unit, waypoints, { loop = true, pause_time = 30 })
guard.assign_area(squad, Region.Get("base_perimeter"))
</code></pre>
<p><strong>Key design points:</strong></p>
<ul>
<li>Script libraries are Workshop resources with the <code>script-library</code> category â€” they use the same dependency, versioning (semver), and resolution system as any other resource (see Dependency Declaration above)</li>
<li><code>require()</code> in the Lua sandbox resolves to installed Workshop dependencies, not filesystem paths â€” maintaining sandbox security</li>
<li>Libraries are versioned independently â€” a library author can release 2.0 without breaking mods pinned to <code>^1.0</code></li>
<li><code>ic mod check</code> validates that all <code>require()</code> calls in a mod resolve to declared dependencies</li>
<li>Script libraries encourage specialization: AI behavior experts publish behavior libraries, UI specialists publish UI helper libraries, campaign designers share narrative utilities</li>
</ul>
<p>This turns the Lua tier from â€œevery mod reimplements common patternsâ€ into a composable ecosystem â€” the same shift that made npm/crates.io transformative for their respective communities.</p>
<h3 id="license-system"><a class="header" href="#license-system">License System</a></h3>
<p><strong>Every published Workshop resource MUST have a <code>license</code> field.</strong> Publishing without one is rejected.</p>
<pre><code class="language-yaml"># In mod.yaml or resource manifest
mod:
  license: "CC-BY-SA-4.0"             # SPDX identifier (required for publishing)
</code></pre>
<ul>
<li>Uses <a href="https://spdx.org/licenses/">SPDX identifiers</a> for machine-readable license classification</li>
<li>Workshop UI displays license prominently on every resource listing</li>
<li><code>ic mod audit</code> checks the full dependency tree for license compatibility (e.g., CC-BY-NC dep in a CC-BY mod â†’ warning)</li>
<li>Common licenses for game assets: <code>CC-BY-4.0</code>, <code>CC-BY-SA-4.0</code>, <code>CC-BY-NC-4.0</code>, <code>CC0-1.0</code>, <code>MIT</code>, <code>GPL-3.0-only</code>, <code>LicenseRef-Custom</code> (with link to full text)</li>
<li>Resources with incompatible licenses can coexist in the Workshop but <code>ic mod audit</code> warns when combining them</li>
<li><strong>Optional EULA</strong> for authors who need additional terms beyond SPDX (e.g., â€œno use in commercial products without written permissionâ€). EULA cannot contradict the SPDX license. See <code>04-MODDING.md</code> Â§ â€œOptional EULAâ€</li>
<li><strong>Workshop Terms of Service (platform license):</strong> By publishing, authors grant the platform minimum rights to host, cache, replicate, index, generate previews, serve as dependency, and auto-download in multiplayer â€” regardless of the resourceâ€™s declared license. Same model as GitHub/npm/Steam Workshop. The ToS does not expand what <em>recipients</em> can do (thatâ€™s the license) â€” it ensures the platform can mechanically operate. See <code>04-MODDING.md</code> Â§ â€œWorkshop Terms of Serviceâ€</li>
<li><strong>Minimum age (COPPA):</strong> Workshop accounts require users to be 13+. See <code>04-MODDING.md</code> Â§ â€œMinimum Age Requirementâ€</li>
<li><strong>Third-party content disclaimer:</strong> IC is not liable for Workshop content. See <code>04-MODDING.md</code> Â§ â€œThird-Party Content Disclaimerâ€</li>
<li><strong>Privacy Policy:</strong> Required before Workshop server deployment. Covers data collection, retention, GDPR rights. See <code>04-MODDING.md</code> Â§ â€œPrivacy Policy Requirementsâ€</li>
</ul>
<h3 id="llm-driven-resource-discovery"><a class="header" href="#llm-driven-resource-discovery">LLM-Driven Resource Discovery</a></h3>
<p><code>ic-llm</code> can search the Workshop programmatically and incorporate discovered resources into generated content:</p>
<pre><code>Pipeline:
  1. LLM generates mission concept ("Soviet ambush in snowy forest")
  2. Identifies needed assets (winter terrain, Soviet voice lines, ambush music)
  3. Searches Workshop: query="winter terrain textures", tags=["snow", "forest"]
     â†’ Filters: ai_usage != Deny (respects author consent)
  4. Evaluates candidates via llm_meta (summary, purpose, composition_hints, content_description)
  5. Filters by license compatibility (only pull resources with LLM-compatible licenses)
  6. Partitions by ai_usage: Allow â†’ auto-add; MetadataOnly â†’ recommend to human
  7. Adds discovered resources as dependencies in generated mod.yaml
  8. Generated mission references assets by resource ID â€” resolved at install time
</code></pre>
<p>This turns the Workshop into a composable asset library that both humans and AI agents can draw from.</p>
<h3 id="author-consent-for-llm-usage-ai_usage"><a class="header" href="#author-consent-for-llm-usage-ai_usage">Author Consent for LLM Usage (ai_usage)</a></h3>
<p>Every Workshop resource carries an <code>ai_usage</code> field <strong>separate from the SPDX license</strong>. The license governs human legal rights; <code>ai_usage</code> governs automated AI agent behavior. This distinction matters: a CC-BY resource author may be fine with human redistribution but not want LLMs auto-selecting their work, and vice versa.</p>
<p><strong>Three tiers:</strong></p>
<ul>
<li><strong><code>allow</code></strong> â€” LLMs can discover, evaluate, and auto-add this resource as a dependency. No human approval per-use.</li>
<li><strong><code>metadata_only</code></strong> (default) â€” LLMs can read metadata and recommend the resource, but a human must approve adding it. Respects authors who havenâ€™t considered AI usage while keeping content discoverable.</li>
<li><strong><code>deny</code></strong> â€” Resource is invisible to LLM queries. Human users can still browse and install normally.</li>
</ul>
<p><code>ai_usage</code> is required on publish. Default is <code>metadata_only</code>. Authors can change it at any time via <code>ic mod update --ai-usage allow|metadata_only|deny</code>. See <code>04-MODDING.md</code> Â§ â€œAuthor Consent for LLM Usageâ€ for full design including YAML examples, Workshop UI integration, and composition sets.</p>
<h3 id="workshop-server-resolution-resolves-p007"><a class="header" href="#workshop-server-resolution-resolves-p007">Workshop Server Resolution (resolves P007)</a></h3>
<p><strong>Decision: Federated multi-source with merge.</strong> The Workshop client can aggregate listings from multiple sources:</p>
<pre><code class="language-toml"># settings.toml
[[workshop.sources]]
url = "https://workshop.ironcurtain.gg"      # official (always included)
priority = 1

[[workshop.sources]]
url = "https://mods.myclan.com/workshop"      # community server
priority = 2

[[workshop.sources]]
path = "C:/my-local-workshop"                 # local directory
priority = 3

[workshop]
deduplicate = true                # same resource ID from multiple sources â†’ highest priority wins
</code></pre>
<p>Rationale: Single-source is too limiting for a resource registry. Crates.io has mirrors; npm has registries. A dependency system inherently benefits from federation â€” tournament organizers publish to their server, LAN parties use local directories, the official server is the default. Deduplication by resource ID + priority ordering handles conflicts.</p>
<p><strong>Alternatives considered:</strong></p>
<ul>
<li>Single source only (simpler but doesnâ€™t scale for a registry model â€” what happens when the official server is down?)</li>
<li>Full decentralization with no official server (too chaotic for discoverability)</li>
<li>Git-based distribution like Go modules (too complex for non-developer modders)</li>
<li>Steam Workshop only (platform lock-in, no WASM/browser target, no self-hosting)</li>
</ul>
<h3 id="steam-workshop-integration"><a class="header" href="#steam-workshop-integration">Steam Workshop Integration</a></h3>
<p>The federated model includes <strong>Steam Workshop as a source type</strong> alongside IC-native Workshop servers and local directories. For Steam builds, the Workshop browser can query Steam Workshop in addition to IC sources:</p>
<pre><code class="language-toml"># settings.toml (Steam build)
[[workshop.sources]]
url = "https://workshop.ironcurtain.gg"      # IC official
priority = 1

[[workshop.sources]]
type = "steam-workshop"                      # Steam Workshop (Steam builds only)
app_id = "&lt;steam_app_id&gt;"
priority = 2

[[workshop.sources]]
path = "C:/my-local-workshop"
priority = 3
</code></pre>
<ul>
<li><strong>Publish to both:</strong> <code>ic mod publish</code> uploads to IC Workshop; Steam builds additionally push to Steam Workshop via Steamworks API. One command, dual publish.</li>
<li><strong>Subscribe from either:</strong> IC resources and Steam Workshop items appear in the same in-game browser (virtual view merges them).</li>
<li><strong>Non-Steam builds are not disadvantaged.</strong> ICâ€™s own Workshop is the primary registry. Steam Workshop is an optional distribution channel that broadens reach for creators on Steam.</li>
<li><strong>Maps are the primary Steam Workshop content type</strong> (matching Remasteredâ€™s pattern). Full mods are better served by the IC Workshop due to richer metadata, dependency resolution, and federation.</li>
</ul>
<h3 id="in-game-workshop-browser"><a class="header" href="#in-game-workshop-browser">In-Game Workshop Browser</a></h3>
<p>The Workshop is accessible from the main menu, not only via the <code>ic</code> CLI. The in-game browser provides:</p>
<ul>
<li><strong>Search</strong> with full-text search (FTS5 via D034), category filters, tag filters, and sorting (popular, recent, trending, most-depended-on)</li>
<li><strong>Resource detail pages</strong> with description, screenshots/preview, license, author, download count, rating, dependency tree, changelog</li>
<li><strong>One-click install</strong> with automatic dependency resolution â€” same as <code>ic mod install</code> but from the game UI</li>
<li><strong>Ratings and reviews</strong> â€” 1-5 star rating plus optional text review per user per resource</li>
<li><strong>Creator profiles</strong> â€” browse all resources by a specific author, see their total downloads, reputation badges</li>
<li><strong>Collections</strong> â€” user-curated lists of resources (â€œMy Competitive Setupâ€, â€œBest Soviet Musicâ€), shareable via link</li>
<li><strong>Trending and featured</strong> â€” algorithmically surfaced (time-weighted download velocity) plus editorially curated featured lists</li>
</ul>
<h3 id="auto-download-on-lobby-join"><a class="header" href="#auto-download-on-lobby-join">Auto-Download on Lobby Join</a></h3>
<p>When a player joins a multiplayer lobby, the game automatically resolves and downloads any required mods, maps, or resource packs that the player doesnâ€™t have locally:</p>
<ol>
<li><strong>Lobby advertises requirements:</strong> The <code>GameListing</code> (see <code>03-NETCODE.md</code>) includes mod ID, version, and Workshop source for all required resources</li>
<li><strong>Client checks local cache:</strong> Already have the exact version? Skip download.</li>
<li><strong>Missing resources auto-resolve:</strong> Client queries the virtual Workshop repository, downloads missing resources via P2P (BitTorrent/WebTorrent â€” D049) with HTTP fallback. Lobby peers are prioritized as download sources (they already have the required content).</li>
<li><strong>Progress UI:</strong> Download progress bar shown in lobby with source indicator (P2P/HTTP). Game start blocked until all players have all required resources.</li>
<li><strong>Rejection option:</strong> Player can decline to download and leave the lobby instead.</li>
<li><strong>Size warning:</strong> Downloads exceeding a configurable threshold (default 100MB) prompt confirmation before proceeding.</li>
</ol>
<p>This matches CS:GO/CS2â€™s pattern where community maps download automatically when joining a server â€” zero friction for players. It also solves ArmA Reforgerâ€™s most-cited community complaint about mod management friction. P2P delivery means lobby auto-download is fast (peers in the same lobby are direct seeds) and free (no CDN cost per join). See D052 Â§ â€œIn-Lobby P2P Resource Sharingâ€ for the full lobby protocol: room discovery, host-as-tracker, security model, and verification flow.</p>
<p><strong>Local resource lifecycle:</strong> Resources downloaded this way are tagged as <strong>transient</strong> (not pinned). They remain fully functional but are subject to auto-cleanup after <code>transient_ttl_days</code> (default 30 days) of non-use. After the session, a non-intrusive toast offers: â€œ[Pin (keep forever)] [Theyâ€™ll auto-clean in 30 days] [Remove now]â€. Frequently-used transient resources (3+ sessions) are automatically promoted to pinned. See D030 Â§ â€œLocal Resource Managementâ€ for the full lifecycle, storage budget, and cleanup UX.</p>
<h3 id="creator-reputation-system"><a class="header" href="#creator-reputation-system">Creator Reputation System</a></h3>
<p>Creators accumulate reputation through their Workshop activity. Reputation is displayed on resource listings and creator profiles:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Signal</th><th>Weight</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>Total downloads</td><td>Medium</td><td>Cumulative downloads across all published resources</td></tr>
<tr><td>Average rating</td><td>High</td><td>Mean star rating across published resources (minimum 10 ratings to display)</td></tr>
<tr><td>Dependency count</td><td>High</td><td>How many other resources/mods depend on this creatorâ€™s work</td></tr>
<tr><td>Publish consistency</td><td>Low</td><td>Regular updates and new content over time</td></tr>
<tr><td>Community reports</td><td>Negative</td><td>DMCA strikes, policy violations reduce reputation</td></tr>
</tbody>
</table>
</div>
<p><strong>Badges:</strong></p>
<ul>
<li><strong>Verified</strong> â€” identity confirmed (e.g., linked GitHub account)</li>
<li><strong>Prolific</strong> â€” 10+ published resources with â‰¥4.0 average rating</li>
<li><strong>Foundation</strong> â€” resources depended on by 50+ other resources</li>
<li><strong>Curator</strong> â€” maintains high-quality curated collections</li>
</ul>
<p>Reputation is displayed but not gatekeeping â€” any registered user can publish. Reputation helps players discover trustworthy content in a growing registry.</p>
<h3 id="content-moderation--dmcatakedown-policy"><a class="header" href="#content-moderation--dmcatakedown-policy">Content Moderation &amp; DMCA/Takedown Policy</a></h3>
<p>The Workshop requires a clear content policy and takedown process:</p>
<p><strong>Prohibited content:</strong></p>
<ul>
<li>Assets ripped from commercial games without permission (the ArmA communityâ€™s perennial problem)</li>
<li>Malicious content (WASM modules with harmful behavior â€” mitigated by capability sandbox)</li>
<li>Content violating the license declared in its manifest</li>
<li>Hate speech, illegal content (standard platform policy)</li>
</ul>
<p><strong>Takedown process:</strong></p>
<ol>
<li><strong>Reporter files takedown request</strong> via Workshop UI or email, specifying the resource and the claim (DMCA, license violation, policy violation)</li>
<li><strong>Resource is flagged</strong> â€” not immediately removed â€” and the author is notified with a 72-hour response window</li>
<li><strong>Author can counter-claim</strong> (e.g., they hold the rights, the reporter is mistaken)</li>
<li><strong>Workshop moderators review</strong> â€” if the claim is valid, the resource is delisted (not deleted â€” remains in local caches of existing users)</li>
<li><strong>Repeat offenders</strong> accumulate strikes. Three strikes â†’ account publishing privileges suspended. Appeals process available.</li>
<li><strong>DMCA safe harbor:</strong> The Workshop server operator (official or community-hosted) follows standard DMCA safe harbor procedures. Community-hosted servers set their own moderation policies.</li>
</ol>
<p><strong>License enforcement integration:</strong></p>
<ul>
<li><code>ic mod audit</code> already checks dependency tree license compatibility</li>
<li>Workshop server rejects publish if declared license conflicts with dependency licenses</li>
<li>Resources with <code>LicenseRef-Custom</code> must provide a URL to full license text</li>
</ul>
<p><strong>Rationale (from ArmA research):</strong> ArmAâ€™s private mod ecosystem exists specifically because the Workshop canâ€™t protect creators or manage IP claims. Disney, EA, and others actively DMCA ArmA Workshop content. Bohemia established an IP ban list but the community found it heavy-handed. ICâ€™s approach: clear rules, due process, creator notification first â€” not immediate removal.</p>
<p><strong>Phase:</strong> Minimal Workshop in Phase 4â€“5 (central server + publish + browse + auto-download); full Workshop (federation, Steam source, reputation, DMCA) in Phase 6a; preparatory work in Phase 3 (manifest format finalized).</p>
<hr>
<hr>
<h2 id="d031-observability--telemetry--otel-across-engine-servers-and-ai-pipeline"><a class="header" href="#d031-observability--telemetry--otel-across-engine-servers-and-ai-pipeline">D031: Observability &amp; Telemetry â€” OTEL Across Engine, Servers, and AI Pipeline</a></h2>
<h3 id="decision-capsule-llmrag-summary-1"><a class="header" href="#decision-capsule-llmrag-summary-1">Decision Capsule (LLM/RAG Summary)</a></h3>
<ul>
<li><strong>Status:</strong> Accepted</li>
<li><strong>Phase:</strong> Multi-phase (instrumentation foundation + server ops + advanced analytics/AI training pipelines)</li>
<li><strong>Canonical for:</strong> Unified telemetry/observability architecture, local-first telemetry storage, and optional OTEL export policy</li>
<li><strong>Scope:</strong> game client, relay/tracking/workshop servers, telemetry schema/storage, tracing/export pipeline, debugging and analytics tooling</li>
<li><strong>Decision:</strong> All components record structured telemetry to <strong>local SQLite</strong> as the primary sink using a shared schema; <strong>OpenTelemetry is optional</strong> export infrastructure for operators who want dashboards/traces.</li>
<li><strong>Why:</strong> Works offline, supports both players and operators, enables cross-component debugging (including desync analysis), and unifies gameplay/debug/ops/AI data collection under one instrumentation model.</li>
<li><strong>Non-goals:</strong> Requiring external collectors (Prometheus/OTEL backends) for normal operation; separate incompatible telemetry formats per component.</li>
<li><strong>Invariants preserved:</strong> Local-first data philosophy (D034/D061), offline-capable components, and mod/game agnosticism at the schema level.</li>
<li><strong>Defaults / UX behavior:</strong> Telemetry is recorded locally with retention/rotation; operators may optionally enable OTEL export for live dashboards.</li>
<li><strong>Security / Trust impact:</strong> Structured telemetry is designed for analysis without making external infrastructure mandatory; privacy-sensitive usage depends on the telemetry policy and field discipline in event payloads.</li>
<li><strong>Performance / Ops impact:</strong> Unified schema simplifies tooling and reduces operational complexity; tracing/puffin stack is chosen for low disabled overhead and production viability.</li>
<li><strong>Public interfaces / types / commands:</strong> shared <code>telemetry.db</code> schema, <code>tracing</code> instrumentation, optional OTEL exporters, analytics export/query tooling (see body)</li>
<li><strong>Affected docs:</strong> <code>src/06-SECURITY.md</code>, <code>src/03-NETCODE.md</code>, <code>src/decisions/09e-community.md</code> (D034/D061), <code>src/15-SERVER-GUIDE.md</code></li>
<li><strong>Revision note summary:</strong> None</li>
<li><strong>Keywords:</strong> telemetry, observability, OTEL, OpenTelemetry, SQLite telemetry.db, tracing, puffin, local-first analytics, desync debugging</li>
</ul>
<p><strong>Decision:</strong> All components â€” game client, relay server, tracking server, workshop server â€” record structured telemetry to local SQLite as the primary sink. Every component runs fully offline; no telemetry depends on external infrastructure. OTEL (OpenTelemetry) is an optional export layer for server operators who want Grafana dashboards â€” it is never a requirement. The instrumentation layer is unified across all components, enabling operational monitoring, gameplay debugging, GUI usage analysis, pattern discovery, and AI/LLM training data collection.</p>
<p><strong>Rationale:</strong></p>
<ul>
<li>Backend servers (relay, tracking, workshop) are production infrastructure â€” they need health metrics, latency histograms, error rates, and distributed traces, just like any microservice</li>
<li>The game engine already has rich internal state (per-tick <code>state_hash()</code>, snapshots, system execution times) but no structured way to export it for analysis</li>
<li>Replay files capture <em>what happened</em> but not <em>why</em> â€” telemetry captures the engineâ€™s decision-making process (pathfinding time, order validation outcomes, combat resolution details) that replays miss</li>
<li>Behavioral analysis (V12 anti-cheat) already collects APM, reaction times, and input entropy on the relay â€” OTEL is the natural export format for this data</li>
<li>AI/LLM development needs training data: game telemetry (unit movements, build orders, engagement outcomes) is exactly the training corpus for <code>ic-ai</code> and <code>ic-llm</code></li>
<li>Bevy already integrates with Rustâ€™s <code>tracing</code> crate â€” OTEL export is a natural extension, not a foreign addition</li>
<li><strong>Stack validated by production Rust game infrastructure:</strong> Embark Studiosâ€™ Quilkin (production game relay) uses the exact <code>tracing</code> + <code>prometheus</code> + OTEL stack IC targets, confirming it handles real game traffic at scale. Puffin (Embarkâ€™s frame-based profiler) complements OTEL for per-tick instrumentation with ~1ns disabled overhead. ICâ€™s â€œzero cost when disabledâ€ requirement is satisfied by puffinâ€™s <code>AtomicBool</code> guard and tracingâ€™s compile-time level filtering. See <code>research/embark-studios-rust-gamedev-analysis.md</code></li>
<li>Desync debugging needs cross-client correlation â€” distributed tracing (trace IDs) lets you follow an order from input â†’ network â†’ sim â†’ render across multiple clients and the relay server</li>
<li>A single instrumentation approach (OTEL) avoids the mess of ad-hoc logging, custom metrics files, separate debug protocols, and incompatible formats</li>
</ul>
<p><strong>Key Design Elements:</strong></p>
<h3 id="unified-local-first-storage"><a class="header" href="#unified-local-first-storage">Unified Local-First Storage</a></h3>
<p><strong>Every component records telemetry to a local SQLite file. No exceptions.</strong> This is the same principle as D034 (SQLite as embedded storage) and D061 (local-first data) applied to telemetry. The game client, relay server, tracking server, and workshop server all write to their own <code>telemetry.db</code> using an identical schema. No component depends on an external collector, dashboard, or aggregation service to function.</p>
<pre><code class="language-sql">-- Identical schema on every component (client, relay, tracking, workshop)
CREATE TABLE telemetry_events (
    id            INTEGER PRIMARY KEY,
    timestamp     TEXT    NOT NULL,        -- ISO 8601 with microsecond precision
    session_id    TEXT    NOT NULL,        -- random per-process-lifetime
    component     TEXT    NOT NULL,        -- 'client', 'relay', 'tracking', 'workshop'
    game_module   TEXT,                    -- 'ra1', 'td', 'ra2', custom â€” set once per session (NULL on servers)
    mod_fingerprint TEXT,                  -- D062 SHA-256 mod profile fingerprint â€” updated on profile switch
    category      TEXT    NOT NULL,        -- event domain (see taxonomy below)
    event         TEXT    NOT NULL,        -- specific event name
    severity      TEXT    NOT NULL DEFAULT 'info',  -- 'trace','debug','info','warn','error'
    data          TEXT,                    -- JSON payload (structured, no PII)
    duration_us   INTEGER,                -- for events with measurable duration
    tick          INTEGER,                -- sim tick (gameplay/sim events only)
    correlation   TEXT                     -- trace ID for cross-component correlation
);

CREATE INDEX idx_telemetry_ts          ON telemetry_events(timestamp);
CREATE INDEX idx_telemetry_cat_event   ON telemetry_events(category, event);
CREATE INDEX idx_telemetry_session     ON telemetry_events(session_id);
CREATE INDEX idx_telemetry_game_module ON telemetry_events(game_module) WHERE game_module IS NOT NULL;
CREATE INDEX idx_telemetry_mod_fp      ON telemetry_events(mod_fingerprint) WHERE mod_fingerprint IS NOT NULL;
CREATE INDEX idx_telemetry_severity    ON telemetry_events(severity) WHERE severity IN ('warn', 'error');
CREATE INDEX idx_telemetry_correlation ON telemetry_events(correlation) WHERE correlation IS NOT NULL;
</code></pre>
<p><strong>Why one schema everywhere?</strong> Aggregation scripts, debugging tools, and community analysis all work identically regardless of source. A relay operator can run the same <code>/analytics export</code> command as a player. Exported files from different components can be imported into a single SQLite database for cross-component analysis (desync debugging across client + relay). The aggregation tooling is a handful of SQL queries, not a specialized backend.</p>
<p><strong>Mod-agnostic by design, mod-aware by context.</strong> The telemetry schema contains zero game-specific or mod-specific columns. Unit types, weapon names, building names, and resource types flow through as opaque strings â€” whatever the active modâ€™s YAML defines. A total conversion modâ€™s custom vocabulary (e.g., <code>unit_type: "Mammoth Mk.III"</code>) passes through unchanged without schema modification. The two denormalized context columns â€” <code>game_module</code> and <code>mod_fingerprint</code> â€” are set once per session on the client (updated on <code>ic profile activate</code> if the player switches mod profiles mid-session). On servers, these columns are populated per-game from lobby metadata. This means <strong>every analytical query can be trivially filtered by game module or mod combination</strong> without JOINing through <code>session.start</code>â€™s JSON payload:</p>
<pre><code class="language-sql">-- Direct mod filtering â€” no JOINs needed
SELECT event, COUNT(*) FROM telemetry_events
WHERE game_module = 'ra1' AND category = 'input'
GROUP BY event ORDER BY COUNT(*) DESC;

-- Compare behavior across mod profiles
SELECT mod_fingerprint, AVG(json_extract(data, '$.apm')) AS avg_apm
FROM telemetry_events WHERE event = 'match.pace'
GROUP BY mod_fingerprint;
</code></pre>
<p><strong>Relay servers</strong> set <code>game_module</code> and <code>mod_fingerprint</code> per-game from the lobbyâ€™s negotiated settings â€” all events for that game inherit the context. When the relay hosts multiple concurrent games with different mods, each gameâ€™s events carry the correct mod context independently.</p>
<p><strong>OTEL is an optional export layer, not the primary sink.</strong> Server operators who want real-time dashboards (Grafana, Prometheus, Jaeger) can enable OTEL export â€” but itâ€™s a â€œnice-to-haveâ€ for sophisticated deployments, not a dependency. A community member running a relay server on a spare machine doesnâ€™t need to set up Prometheus. They get full telemetry in a SQLite file they can query with any SQL tool.</p>
<p><strong>Retention and rotation:</strong> Each componentâ€™s <code>telemetry.db</code> has a configurable max size (default: 100 MB for client, 500 MB for servers). When the limit is reached, the oldest events are pruned. <code>/analytics export</code> exports a date range to a separate file before pruning. Servers can also configure time-based retention (e.g., <code>telemetry.retention_days = 30</code>).</p>
<h3 id="three-telemetry-signals-otel-standard"><a class="header" href="#three-telemetry-signals-otel-standard">Three Telemetry Signals (OTEL Standard)</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Signal</th><th>What It Captures</th><th>Export Format</th></tr>
</thead>
<tbody>
<tr><td>Metrics</td><td>Counters, histograms, gauges â€” numeric time series</td><td>OTLP â†’ Prometheus</td></tr>
<tr><td>Traces</td><td>Distributed request flows â€” an orderâ€™s journey through the system</td><td>OTLP â†’ Jaeger/Zipkin</td></tr>
<tr><td>Logs</td><td>Structured events with severity, context, correlation IDs</td><td>OTLP â†’ Loki/stdout</td></tr>
</tbody>
</table>
</div>
<h3 id="backend-server-telemetry-relay-tracking-workshop"><a class="header" href="#backend-server-telemetry-relay-tracking-workshop">Backend Server Telemetry (Relay, Tracking, Workshop)</a></h3>
<p>Standard operational observability â€” same patterns used by any production Rust service. <strong>All servers record to local SQLite</strong> (<code>telemetry.db</code>) using the unified schema above. The OTEL metric names below double as the <code>event</code> field in the SQLite table â€” operators can query locally via SQL or optionally export to Prometheus/Grafana.</p>
<p><strong>Relay server metrics:</strong></p>
<pre><code>relay.games.active                    # gauge: concurrent games
relay.games.total                     # counter: total games hosted
relay.orders.received                 # counter: orders received per tick
relay.orders.forwarded                # counter: orders broadcast
relay.orders.dropped                  # counter: orders missed (lag switch)
relay.tick.latency_ms                 # histogram: tick processing time
relay.player.rtt_ms                   # histogram: per-player round-trip time
relay.player.suspicion_score          # gauge: behavioral analysis score (V12)
relay.desync.detected                 # counter: desync events
relay.match.completed                 # counter: matches finished
relay.match.duration_s                # histogram: match duration
</code></pre>
<p><strong>Tracking server metrics:</strong></p>
<pre><code>tracking.listings.active              # gauge: current game listings
tracking.heartbeats.received          # counter: heartbeats processed
tracking.heartbeats.expired           # counter: listings expired (TTL)
tracking.queries.total                # counter: browse/search requests
tracking.queries.latency_ms           # histogram: query latency
</code></pre>
<p><strong>Workshop server metrics:</strong></p>
<pre><code>workshop.resources.total              # gauge: total published resources
workshop.resources.downloads          # counter: download events
workshop.resources.publishes          # counter: publish events
workshop.resolve.latency_ms           # histogram: dependency resolution time
workshop.resolve.conflicts            # counter: version conflicts detected
workshop.search.latency_ms            # histogram: search query time
</code></pre>
<h4 id="server-side-structured-events-sqlite"><a class="header" href="#server-side-structured-events-sqlite">Server-Side Structured Events (SQLite)</a></h4>
<p>Beyond counters and gauges, each server records detailed structured events to <code>telemetry.db</code>. These are the events that actually enable troubleshooting and pattern analysis:</p>
<p><strong>Relay server events:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>Troubleshooting Value</th></tr>
</thead>
<tbody>
<tr><td><code>relay.game.start</code></td><td><code>game_id</code>, <code>map</code>, <code>player_count</code>, <code>settings_hash</code>, <code>balance_preset</code>, <code>game_module</code>, <code>mod_profile_fingerprint</code></td><td>Which maps/settings/mods are popular?</td></tr>
<tr><td><code>relay.game.end</code></td><td><code>game_id</code>, <code>duration_s</code>, <code>ticks</code>, <code>outcome</code>, <code>player_count</code></td><td>Match length distribution, completion vs. abandonment rates</td></tr>
<tr><td><code>relay.player.join</code></td><td><code>game_id</code>, <code>slot</code>, <code>rtt_ms</code>, <code>mod_profile_fingerprint</code></td><td>Connection quality at join time, mod compatibility</td></tr>
<tr><td><code>relay.player.leave</code></td><td><code>game_id</code>, <code>slot</code>, <code>reason</code> (quit/disconnect/kicked/timeout), <code>match_time_s</code></td><td>Why and when players leave â€” early ragequit vs. end-of-game</td></tr>
<tr><td><code>relay.tick.process</code></td><td><code>game_id</code>, <code>tick</code>, <code>order_count</code>, <code>process_us</code>, <code>stall_detected</code></td><td>Per-tick performance, stall diagnosis</td></tr>
<tr><td><code>relay.order.forward</code></td><td><code>game_id</code>, <code>player</code>, <code>tick</code>, <code>order_type</code>, <code>sub_tick_us</code>, <code>size_bytes</code></td><td>Order volume, sub-tick fairness verification</td></tr>
<tr><td><code>relay.desync</code></td><td><code>game_id</code>, <code>tick</code>, <code>diverged_players[]</code>, <code>hash_expected</code>, <code>hash_actual</code></td><td>Desync diagnosis â€” which tick, which players</td></tr>
<tr><td><code>relay.lag_switch</code></td><td><code>game_id</code>, <code>player</code>, <code>gap_ms</code>, <code>orders_during_gap</code></td><td>Cheating detection audit trail</td></tr>
<tr><td><code>relay.suspicion</code></td><td><code>game_id</code>, <code>player</code>, <code>score</code>, <code>contributing_factors{}</code></td><td>Behavioral analysis transparency</td></tr>
</tbody>
</table>
</div>
<p><strong>Tracking server events:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>Troubleshooting Value</th></tr>
</thead>
<tbody>
<tr><td><code>tracking.listing.create</code></td><td><code>game_id</code>, <code>map</code>, <code>host_hash</code>, <code>settings_summary</code></td><td>Game creation patterns</td></tr>
<tr><td><code>tracking.listing.expire</code></td><td><code>game_id</code>, <code>age_s</code>, <code>reason</code> (TTL/host_departed)</td><td>Why games disappear from the browser</td></tr>
<tr><td><code>tracking.query</code></td><td><code>query_type</code> (browse/search/filter), <code>params</code>, <code>results_count</code>, <code>latency_ms</code></td><td>Search effectiveness, popular filters</td></tr>
</tbody>
</table>
</div>
<p><strong>Workshop server events:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>Troubleshooting Value</th></tr>
</thead>
<tbody>
<tr><td><code>workshop.publish</code></td><td><code>resource_id</code>, <code>type</code>, <code>version</code>, <code>size_bytes</code>, <code>dep_count</code></td><td>Publishing patterns, resource sizes</td></tr>
<tr><td><code>workshop.download</code></td><td><code>resource_id</code>, <code>version</code>, <code>requester_hash</code>, <code>latency_ms</code></td><td>Download volume, popular resources</td></tr>
<tr><td><code>workshop.resolve</code></td><td><code>root_resource</code>, <code>dep_count</code>, <code>conflicts</code>, <code>latency_ms</code></td><td>Dependency hell frequency, resolution performance</td></tr>
<tr><td><code>workshop.search</code></td><td><code>query</code>, <code>filters</code>, <code>results_count</code>, <code>latency_ms</code></td><td>What people are looking for, search quality</td></tr>
</tbody>
</table>
</div>
<p><strong>Server export and analysis:</strong> Every server supports the same commands as the client â€” <code>ic-server analytics export</code>, <code>ic-server analytics inspect</code>, <code>ic-server analytics clear</code>. A relay operator troubleshooting laggy matches runs a SQL query against their local <code>telemetry.db</code> â€” no Grafana required. The exported SQLite file can be attached to a bug report or shared with the project team, identical workflow to the client.</p>
<p><strong>Distributed traces:</strong> A multiplayer game session gets a trace ID (the <code>correlation</code> field). Every order, tick, and desync event references this trace ID. Debug a desync by searching for the gameâ€™s trace ID across the relayâ€™s <code>telemetry.db</code> and the affected clientsâ€™ exported <code>telemetry.db</code> files â€” correlate events that crossed component boundaries. For operators with OTEL enabled, the same trace ID routes to Jaeger for visual timeline inspection.</p>
<p><strong>Health endpoints:</strong> Every server exposes <code>/healthz</code> (already designed) and <code>/readyz</code>. Prometheus scrape endpoint at <code>/metrics</code> (when OTEL export is enabled). These are standard and compose with existing k8s deployment (Helm charts already designed in <code>03-NETCODE.md</code>).</p>
<h3 id="game-engine-telemetry-client-side"><a class="header" href="#game-engine-telemetry-client-side">Game Engine Telemetry (Client-Side)</a></h3>
<p>The engine emits structured telemetry for debugging, profiling, and AI training â€” but only when enabled. <strong>Hot paths remain zero-cost when telemetry is disabled</strong> (compile-time feature flag <code>telemetry</code>).</p>
<h4 id="performance-instrumentation"><a class="header" href="#performance-instrumentation">Performance Instrumentation</a></h4>
<p>Per-tick system timing, already needed for the benchmark suite (<code>10-PERFORMANCE.md</code>), exported as OTEL metrics when enabled:</p>
<pre><code>sim.tick.duration_us                  # histogram: total tick time
sim.system.apply_orders_us            # histogram: per-system time
sim.system.production_us
sim.system.harvesting_us
sim.system.movement_us
sim.system.combat_us
sim.system.death_us
sim.system.triggers_us
sim.system.fog_us
sim.entities.total                    # gauge: entity count
sim.entities.by_type                  # gauge: per-component-type count
sim.memory.scratch_bytes              # gauge: TickScratch buffer usage
sim.pathfinding.requests              # counter: pathfinding queries per tick
sim.pathfinding.cache_hits            # counter: flowfield cache reuse
sim.pathfinding.duration_us           # histogram: pathfinding computation time
</code></pre>
<h4 id="gameplay-event-stream"><a class="header" href="#gameplay-event-stream">Gameplay Event Stream</a></h4>
<p>Structured events emitted during simulation â€” the raw material for AI training and replay enrichment:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Gameplay events emitted by the sim when telemetry is enabled.
/// These are structured, not printf-style â€” each field is queryable.
pub enum GameplayEvent {
    UnitCreated { tick: u64, entity: EntityId, unit_type: String, owner: PlayerId },
    UnitDestroyed { tick: u64, entity: EntityId, killer: Option&lt;EntityId&gt;, cause: DeathCause },
    CombatEngagement { tick: u64, attacker: EntityId, target: EntityId, weapon: String, damage: i32, remaining_hp: i32 },
    BuildingPlaced { tick: u64, entity: EntityId, structure_type: String, owner: PlayerId, position: WorldPos },
    HarvestDelivered { tick: u64, harvester: EntityId, resource_type: String, amount: i32, total_credits: i32 },
    OrderIssued { tick: u64, player: PlayerId, order: PlayerOrder, validated: bool, rejection_reason: Option&lt;String&gt; },
    PathfindingCompleted { tick: u64, entity: EntityId, from: WorldPos, to: WorldPos, path_length: u32, compute_time_us: u32 },
    DesyncDetected { tick: u64, expected_hash: u64, actual_hash: u64, player: PlayerId },
    StateSnapshot { tick: u64, state_hash: u64, entity_count: u32 },
}
<span class="boring">}</span></code></pre>
<p>These events are:</p>
<ul>
<li><strong>Emitted as OTEL log records</strong> with structured attributes (not free-text â€” every field is filterable)</li>
<li><strong>Collected locally</strong> into a SQLite gameplay event log alongside replays (D034) â€” queryable with ad-hoc SQL without an OTEL stack</li>
<li><strong>Optionally exported</strong> to a collector for batch analysis (tournament servers, AI training pipelines)</li>
</ul>
<h4 id="state-inspection-development--debugging"><a class="header" href="#state-inspection-development--debugging">State Inspection (Development &amp; Debugging)</a></h4>
<p>A debug overlay (via <code>bevy_egui</code>, already in the architecture) that reads live telemetry:</p>
<ul>
<li>Per-system tick time breakdown (bar chart)</li>
<li>Entity count by type</li>
<li>Network: RTT, order latency, jitter</li>
<li>Memory: scratch buffer usage, component storage</li>
<li>Pathfinding: active flowfields, cache hit rate</li>
<li>Fog: cells updated this tick, stagger bucket</li>
<li>Sim state hash (for manual desync comparison)</li>
</ul>
<p>This is the â€œgame engine equivalent of a Kubernetes dashboardâ€ â€” operators of tournament servers or mod developers can inspect the engineâ€™s internal state in real-time.</p>
<h3 id="ai--llm-training-data-pipeline"><a class="header" href="#ai--llm-training-data-pipeline">AI / LLM Training Data Pipeline</a></h3>
<p>The gameplay event stream is the foundation for AI development:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Consumer</th><th>Data Source</th><th>Purpose</th></tr>
</thead>
<tbody>
<tr><td><code>ic-ai</code> (skirmish AI)</td><td>Gameplay events from human games</td><td>Learn build orders, engagement timing, micro patterns</td></tr>
<tr><td><code>ic-llm</code> (missions)</td><td>Gameplay events + enriched replays</td><td>Learn what makes missions fun (engagement density, pacing, flow)</td></tr>
<tr><td><code>ic-editor</code> (replayâ†’scenario)</td><td>Replay event log (SQLite)</td><td>Direct extraction of waypoints, combat zones, build timelines into editor</td></tr>
<tr><td><code>ic-llm</code> (replayâ†’scenario)</td><td>Replay event log + context</td><td>Generate narrative, briefings, dialogue for replay-to-scenario pipeline</td></tr>
<tr><td>Behavioral analysis</td><td>Relay-side player profiles</td><td>APM, reaction time, input entropy â†’ suspicion scoring (V12)</td></tr>
<tr><td>Balance analysis</td><td>Aggregated match outcomes</td><td>Win rates by faction/map/preset â†’ balance tuning</td></tr>
<tr><td>Adaptive difficulty</td><td>Per-player gameplay patterns</td><td>Build speed, APM, unit composition â†’ difficulty calibration</td></tr>
<tr><td>Community analytics</td><td>Workshop + match metadata</td><td>Popular resources, play patterns, mod adoption â†’ recommendations</td></tr>
</tbody>
</table>
</div>
<p><strong>Privacy:</strong> Gameplay events are associated with anonymized player IDs (hashed). No PII in telemetry. Players opt in to telemetry export (default: local-only for debugging). Tournament/ranked play may require telemetry for anti-cheat and certified results. See <code>06-SECURITY.md</code>.</p>
<p><strong>Data format:</strong> Gameplay events export as structured OTEL log records â†’ can be collected into Parquet/Arrow columnar format for batch ML training. The LLM training pipeline reads events, not raw replay bytes.</p>
<h3 id="product-analytics--comprehensive-client-event-taxonomy"><a class="header" href="#product-analytics--comprehensive-client-event-taxonomy">Product Analytics â€” Comprehensive Client Event Taxonomy</a></h3>
<p>The telemetry categories above capture what happens <em>in the simulation</em> (gameplay events, system timing) and on the <em>servers</em> (relay metrics, game lifecycle). A third domain is equally critical: <strong>how players interact with the game itself</strong> â€” which features are used, which are ignored, how people navigate the UI, how they play matches, and where they get confused or drop off.</p>
<p>This is the data that turns guessing into knowing: â€œ42% of players never opened the career stats page,â€ â€œplayers who use control groups average 60% higher APM,â€ â€œthe recovery phrase screen has a 60% skip rate â€” we should redesign the prompt,â€ â€œright-click ordering outnumbers sidebar ordering 8:1 â€” invest in right-click UX, not sidebar polish.â€</p>
<p><strong>Core principle: the game client never phones home.</strong> IC is an independent project â€” the client has zero dependency on any IC-hosted backend, analytics service, or telemetry endpoint. Product analytics are recorded to the local <code>telemetry.db</code> (same unified schema as every other component), stored locally, and stay local unless the player deliberately exports them. This matches the projectâ€™s local-first philosophy (D034, D061) and ensures IC remains fully functional with no internet connectivity whatsoever.</p>
<p><strong>Design principles:</strong></p>
<ol>
<li><strong>Offline-only by design.</strong> The client contains no transmission code, no HTTP endpoints, no phone-home logic. There is no analytics backend to depend on, no infrastructure to maintain, no service to go offline.</li>
<li><strong>Player-owned data.</strong> The <code>telemetry.db</code> file lives on the playerâ€™s machine â€” the same open SQLite format they can query themselves (D034). Itâ€™s their data. They can inspect it, export it, or delete it anytime.</li>
<li><strong>Voluntary export for bug reports.</strong> <code>/analytics export</code> produces a self-contained file (JSON or SQLite extract) the player can review and attach to bug reports, forum posts, GitHub issues, or community surveys. The player decides when, where, and to whom they send it.</li>
<li><strong>Transparent and inspectable.</strong> <code>/analytics inspect</code> shows exactly whatâ€™s recorded. No hidden fields, no device fingerprinting. Players can query the SQLite table directly.</li>
<li><strong>Zero impact.</strong> The game is fully functional with analytics recording on or off. No nag screens. Recording can be disabled via <code>telemetry.product_analytics</code> cvar (default: on for local recording).</li>
</ol>
<p><strong>What product analytics explicitly does NOT capture:</strong></p>
<ul>
<li>Chat messages, player names, opponent names (no PII)</li>
<li>Keystroke logging, raw mouse coordinates, screen captures</li>
<li>Hardware identifiers, MAC addresses, IP addresses</li>
<li>Filesystem contents, installed software, browser history</li>
</ul>
<h4 id="gui-interaction-events"><a class="header" href="#gui-interaction-events">GUI Interaction Events</a></h4>
<p>These events capture how the player navigates the interface â€” which screens they visit, which buttons they click, which features they discover, and where they spend their time. This is the primary source for UX insights.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>gui.screen.open</code></td><td><code>screen_id</code>, <code>from_screen</code>, <code>method</code> (button/hotkey/back/auto)</td><td>Navigation patterns â€” which screens do players visit? In what order?</td></tr>
<tr><td><code>gui.screen.close</code></td><td><code>screen_id</code>, <code>duration_ms</code>, <code>next_screen</code></td><td>Time on screen â€” do players read the settings page for 2 seconds or 30?</td></tr>
<tr><td><code>gui.click</code></td><td><code>widget_id</code>, <code>widget_type</code> (button/tab/toggle/slider/list_item), <code>screen</code></td><td>Which widgets get used? Which are dead space?</td></tr>
<tr><td><code>gui.hotkey</code></td><td><code>key_combo</code>, <code>action</code>, <code>context_screen</code></td><td>Hotkey adoption â€” are players discovering keyboard shortcuts?</td></tr>
<tr><td><code>gui.tooltip.shown</code></td><td><code>widget_id</code>, <code>duration_ms</code></td><td>Which UI elements confuse players enough to hover for a tooltip?</td></tr>
<tr><td><code>gui.sidebar.interact</code></td><td><code>tab</code>, <code>item_id</code>, <code>action</code> (select/scroll/queue/cancel), <code>method</code> (click/hotkey)</td><td>Sidebar usage patterns â€” build queue behavior, tab switching</td></tr>
<tr><td><code>gui.minimap.interact</code></td><td><code>action</code> (camera_move/ping/attack_move/rally_point), <code>position_normalized</code></td><td>Minimap as input device â€” how often, for what?</td></tr>
<tr><td><code>gui.build_placement</code></td><td><code>structure_type</code>, <code>outcome</code> (placed/cancelled/invalid_position), <code>time_to_place_ms</code></td><td>Build placement UX â€” how long does it take? How often do players cancel?</td></tr>
<tr><td><code>gui.context_menu</code></td><td><code>items_shown</code>, <code>item_selected</code>, <code>screen</code></td><td>Right-click menu usage and discoverability</td></tr>
<tr><td><code>gui.scroll</code></td><td><code>container_id</code>, <code>direction</code>, <code>distance</code>, <code>screen</code></td><td>Scroll depth â€” do players scroll through long lists?</td></tr>
<tr><td><code>gui.panel.resize</code></td><td><code>panel_id</code>, <code>old_size</code>, <code>new_size</code></td><td>UI layout preferences</td></tr>
<tr><td><code>gui.search</code></td><td><code>context</code> (workshop/map_browser/settings/console), <code>query_length</code>, <code>results_count</code></td><td>Search usage patterns â€” what are players looking for?</td></tr>
</tbody>
</table>
</div>
<h4 id="rts-input-events"><a class="header" href="#rts-input-events">RTS Input Events</a></h4>
<p>These events capture how the player actually plays the game â€” selection patterns, ordering habits, control group usage, camera behavior. This is the primary source for gameplay pattern analysis and understanding how players interact with the core RTS mechanics.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>input.select</code></td><td><code>unit_count</code>, <code>method</code> (box_drag/click/ctrl_group/double_click/tab_cycle/select_all), <code>unit_types[]</code></td><td>Selection habits â€” do players use box select or control groups?</td></tr>
<tr><td><code>input.ctrl_group</code></td><td><code>group_number</code>, <code>action</code> (assign/recall/append/steal), <code>unit_count</code>, <code>unit_types[]</code></td><td>Control group adoption â€” which groups, how many units, reassignment frequency</td></tr>
<tr><td><code>input.order</code></td><td><code>order_type</code> (move/attack/attack_move/guard/patrol/stop/force_fire/deploy), <code>target_type</code> (ground/unit/building/none), <code>unit_count</code>, <code>method</code> (right_click/hotkey/minimap/sidebar)</td><td>How players issue orders â€” right-click vs. hotkey vs. sidebar? What order types dominate?</td></tr>
<tr><td><code>input.build_queue</code></td><td><code>item_type</code>, <code>action</code> (queue/cancel/hold/repeat), <code>method</code> (click/hotkey), <code>queue_depth</code>, <code>queue_position</code></td><td>Build queue management â€” do players queue in advance or build-on-demand?</td></tr>
<tr><td><code>input.camera</code></td><td><code>method</code> (edge_scroll/keyboard/minimap_click/ctrl_group_recall/base_hotkey/zoom_scroll/zoom_keyboard/zoom_pinch), <code>distance</code>, <code>duration_ms</code>, <code>zoom_level</code></td><td>Camera control habits â€” which method dominates? How far do players scroll? What zoom levels are preferred?</td></tr>
<tr><td><code>input.rally_point</code></td><td><code>building_type</code>, <code>position_type</code> (ground/unit/building), <code>distance_from_building</code></td><td>Rally point usage and placement patterns</td></tr>
<tr><td><code>input.waypoint</code></td><td><code>waypoint_count</code>, <code>order_type</code>, <code>total_distance</code></td><td>Shift-queue / waypoint usage frequency and complexity</td></tr>
</tbody>
</table>
</div>
<h4 id="match-flow-events"><a class="header" href="#match-flow-events">Match Flow Events</a></h4>
<p>These capture the lifecycle and pacing of matches â€” when they start, how they progress, why they end. The <code>match.pace</code> snapshot emitted periodically is particularly powerful: it creates a time-series of the playerâ€™s economic and military state, enabling pace analysis, build order reconstruction, and difficulty curve assessment.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>match.start</code></td><td><code>mode</code>, <code>map</code>, <code>player_count</code>, <code>ai_count</code>, <code>ai_difficulty</code>, <code>balance_preset</code>, <code>render_mode</code>, <code>game_module</code>, <code>mod_profile_fingerprint</code></td><td>What people play â€” which modes, maps, mods, settings</td></tr>
<tr><td><code>match.pace</code></td><td>Emitted every 60s: <code>tick</code>, <code>apm</code>, <code>credits</code>, <code>power_balance</code>, <code>unit_count</code>, <code>army_value</code>, <code>tech_tier</code>, <code>buildings_count</code>, <code>harvesters_active</code></td><td>Economic/military time-series â€” pacing, build order tendencies, when players peak</td></tr>
<tr><td><code>match.end</code></td><td><code>duration_s</code>, <code>outcome</code> (win/loss/draw/disconnect/surrender), <code>units_built</code>, <code>units_lost</code>, <code>credits_harvested</code>, <code>credits_spent</code>, <code>peak_army_value</code>, <code>peak_unit_count</code></td><td>Win/loss context, game length, economic efficiency</td></tr>
<tr><td><code>match.first_build</code></td><td><code>structure_type</code>, <code>time_s</code></td><td>Build order opening â€” first building timing (balance indicator)</td></tr>
<tr><td><code>match.first_combat</code></td><td><code>time_s</code>, <code>attacker_units</code>, <code>defender_units</code>, <code>outcome</code></td><td>When does first blood happen? (game pacing metric)</td></tr>
<tr><td><code>match.surrender_point</code></td><td><code>time_s</code>, <code>army_value_ratio</code>, <code>tech_tier_diff</code>, <code>credits_diff</code></td><td>At what resource/army deficit do players give up?</td></tr>
<tr><td><code>match.pause</code></td><td><code>reason</code> (player/desync/lag_stall), <code>duration_s</code></td><td>Pause frequency â€” desync vs. deliberate pauses</td></tr>
</tbody>
</table>
</div>
<h4 id="session--lifecycle-events"><a class="header" href="#session--lifecycle-events">Session &amp; Lifecycle Events</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>session.start</code></td><td><code>engine_version</code>, <code>os</code>, <code>display_resolution</code>, <code>game_module</code>, <code>mod_profile_fingerprint</code>, <code>session_number</code> (incrementing per install)</td><td>Environment context â€” OS distribution, screen sizes, how many times theyâ€™ve launched</td></tr>
<tr><td><code>session.mod_manifest</code></td><td><code>game_module</code>, <code>mod_profile_fingerprint</code>, <code>unit_types[]</code>, <code>building_types[]</code>, <code>weapon_types[]</code>, <code>resource_types[]</code>, <code>faction_names[]</code>, <code>mod_sources[]</code></td><td>Self-describing type vocabulary â€” makes exported telemetry interpretable without the modâ€™s YAML files</td></tr>
<tr><td><code>session.profile_switch</code></td><td><code>old_fingerprint</code>, <code>new_fingerprint</code>, <code>old_game_module</code>, <code>new_game_module</code>, <code>profile_name</code></td><td>Mid-session mod profile changes â€” boundary marker for analytics segmentation</td></tr>
<tr><td><code>session.end</code></td><td><code>duration_s</code>, <code>reason</code> (quit/crash/update/system_sleep), <code>screens_visited[]</code>, <code>matches_played</code>, <code>features_used[]</code></td><td>Session shape â€” how long, what did they do, clean exit or crash?</td></tr>
<tr><td><code>session.idle</code></td><td><code>screen_id</code>, <code>duration_s</code></td><td>Idle detection â€” was the player AFK on the main menu for 20 minutes?</td></tr>
</tbody>
</table>
</div>
<p><strong><code>session.mod_manifest</code> rationale:</strong> When telemetry records <code>unit_type: "HARV"</code> or <code>weapon: "Vulcan"</code>, these strings are meaningful only if you know the modâ€™s type catalog. Without context, exported <code>telemetry.db</code> files require the original modâ€™s YAML files to interpret event payloads. The <code>session.mod_manifest</code> event, emitted once per session (and again on <code>session.profile_switch</code>), captures the active modâ€™s full type vocabulary â€” every unit, building, weapon, resource, and faction name defined in the loaded YAML rules. This makes exported telemetry <strong>self-describing</strong>: an analyst receiving a community-submitted <code>telemetry.db</code> can identify what <code>"HARV"</code> means without installing the mod. The manifest is typically 2â€“10 KB of JSON â€” negligible overhead for one event per session.</p>
<h4 id="settings--configuration-events"><a class="header" href="#settings--configuration-events">Settings &amp; Configuration Events</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>settings.changed</code></td><td><code>setting_path</code>, <code>old_value</code>, <code>new_value</code>, <code>screen</code></td><td>Which defaults are wrong? What do players immediately change?</td></tr>
<tr><td><code>settings.preset</code></td><td><code>preset_type</code> (balance/theme/qol/render/experience), <code>preset_name</code></td><td>Preset popularity â€” Classic vs. Remastered vs. Modern</td></tr>
<tr><td><code>settings.mod_profile</code></td><td><code>action</code> (activate/create/delete/import/export), <code>profile_name</code>, <code>mod_count</code></td><td>Mod profile adoption and management patterns</td></tr>
<tr><td><code>settings.keybind</code></td><td><code>action</code>, <code>old_key</code>, <code>new_key</code></td><td>Which keybinds do players remap? (ergonomics insight)</td></tr>
</tbody>
</table>
</div>
<h4 id="onboarding-events"><a class="header" href="#onboarding-events">Onboarding Events</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>onboarding.step</code></td><td><code>step_id</code>, <code>step_name</code>, <code>action</code> (completed/skipped/abandoned), <code>time_on_step_s</code></td><td>Where do new players drop off? Is the flow too long?</td></tr>
<tr><td><code>onboarding.tutorial</code></td><td><code>tutorial_id</code>, <code>progress_pct</code>, <code>completed</code>, <code>time_spent_s</code>, <code>deaths</code></td><td>Tutorial completion and difficulty</td></tr>
<tr><td><code>onboarding.first_use</code></td><td><code>feature_id</code>, <code>session_number</code>, <code>time_since_install_s</code></td><td>Feature discovery timeline â€” when do players first find the console? Career stats? Workshop?</td></tr>
<tr><td><code>onboarding.recovery_phrase</code></td><td><code>action</code> (shown/written_confirmed/skipped), <code>time_on_screen_s</code></td><td>Recovery phrase adoption â€” critical for D061 backup design</td></tr>
</tbody>
</table>
</div>
<h4 id="error--diagnostic-events"><a class="header" href="#error--diagnostic-events">Error &amp; Diagnostic Events</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>error.crash</code></td><td><code>panic_message_hash</code>, <code>backtrace_hash</code>, <code>context</code> (screen/system/tick)</td><td>Crash frequency, clustering by context</td></tr>
<tr><td><code>error.mod_load</code></td><td><code>mod_id</code>, <code>error_type</code>, <code>file_path_hash</code></td><td>Which mods break? Which errors?</td></tr>
<tr><td><code>error.asset</code></td><td><code>asset_path_hash</code>, <code>format</code>, <code>error_type</code></td><td>Asset loading failures in the wild</td></tr>
<tr><td><code>error.desync</code></td><td><code>tick</code>, <code>expected_hash</code>, <code>actual_hash</code>, <code>divergent_system_hint</code></td><td>Client-side desync evidence (correlates with relay <code>relay.desync</code>)</td></tr>
<tr><td><code>error.network</code></td><td><code>error_type</code>, <code>context</code> (connect/relay/workshop/tracking)</td><td>Network failures by category</td></tr>
<tr><td><code>error.ui</code></td><td><code>widget_id</code>, <code>error_type</code>, <code>screen</code></td><td>UI rendering/interaction bugs</td></tr>
</tbody>
</table>
</div>
<h4 id="performance-sampling-events"><a class="header" href="#performance-sampling-events">Performance Sampling Events</a></h4>
<p>Emitted periodically (not every frame â€” sampled to avoid overhead). These answer: â€œAre players hitting performance problems we donâ€™t see in development?â€</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event</th><th>JSON <code>data</code> Fields</th><th>Sampling Rate</th><th>What It Reveals</th></tr>
</thead>
<tbody>
<tr><td><code>perf.frame</code></td><td><code>p50_ms</code>, <code>p95_ms</code>, <code>p99_ms</code>, <code>max_ms</code>, <code>entity_count</code>, <code>draw_calls</code>, <code>gpu_time_ms</code></td><td>Every 10s</td><td>Frame time distribution â€” whoâ€™s struggling?</td></tr>
<tr><td><code>perf.sim</code></td><td><code>p50_us</code>, <code>p95_us</code>, <code>p99_us</code>, per-system <code>{system: us}</code> breakdown</td><td>Every 30s</td><td>Sim tick budget â€” which systems are expensive for which players?</td></tr>
<tr><td><code>perf.load</code></td><td><code>what</code> (map/mod/assets/game_launch/screen), <code>duration_ms</code>, <code>size_bytes</code></td><td>On event</td><td>Load times â€” how long does game startup take on real hardware?</td></tr>
<tr><td><code>perf.memory</code></td><td><code>heap_bytes</code>, <code>component_storage_bytes</code>, <code>scratch_buffer_bytes</code>, <code>asset_cache_bytes</code></td><td>Every 60s</td><td>Memory pressure on real machines</td></tr>
<tr><td><code>perf.pathfinding</code></td><td><code>requests</code>, <code>cache_hits</code>, <code>cache_hit_rate</code>, <code>p95_compute_us</code></td><td>Every 30s</td><td>Pathfinding load in real matches</td></tr>
</tbody>
</table>
</div>
<h3 id="analytical-power-what-questions-the-data-answers"><a class="header" href="#analytical-power-what-questions-the-data-answers">Analytical Power: What Questions the Data Answers</a></h3>
<p>The telemetry design above is intentionally structured for SQL queryability. Here are representative queries against the unified <code>telemetry_events</code> table that demonstrate the kind of insights this data enables â€” these queries work identically on client exports, server <code>telemetry.db</code> files, or aggregated community datasets:</p>
<p><strong>GUI &amp; UX Insights:</strong></p>
<pre><code class="language-sql">-- Which screens do players never visit?
SELECT json_extract(data, '$.screen_id') AS screen, COUNT(*) AS visits
FROM telemetry_events WHERE event = 'gui.screen.open'
GROUP BY screen ORDER BY visits ASC LIMIT 20;

-- How do players issue orders: right-click, hotkey, or sidebar?
SELECT json_extract(data, '$.method') AS method, COUNT(*) AS orders
FROM telemetry_events WHERE event = 'input.order'
GROUP BY method ORDER BY orders DESC;

-- Which settings do players change within the first session?
SELECT json_extract(data, '$.setting_path') AS setting,
       json_extract(data, '$.old_value') AS default_val,
       json_extract(data, '$.new_value') AS changed_to,
       COUNT(*) AS changes
FROM telemetry_events e
JOIN (SELECT DISTINCT session_id FROM telemetry_events
      WHERE event = 'session.start'
      AND json_extract(data, '$.session_number') = 1) first
  ON e.session_id = first.session_id
WHERE e.event = 'settings.changed'
GROUP BY setting ORDER BY changes DESC;

-- Control group adoption: what percentage of matches use ctrl groups?
SELECT
  COUNT(DISTINCT CASE WHEN event = 'input.ctrl_group' THEN session_id END) * 100.0 /
  COUNT(DISTINCT CASE WHEN event = 'match.start' THEN session_id END) AS pct_matches_with_ctrl_groups
FROM telemetry_events WHERE event IN ('input.ctrl_group', 'match.start');
</code></pre>
<p><strong>Gameplay Pattern Insights:</strong></p>
<pre><code class="language-sql">-- Average match duration by mode and map
SELECT json_extract(data, '$.mode') AS mode,
       json_extract(data, '$.map') AS map,
       AVG(json_extract(data, '$.duration_s')) AS avg_duration_s,
       COUNT(*) AS matches
FROM telemetry_events WHERE event = 'match.end'
GROUP BY mode, map ORDER BY matches DESC;

-- Build order openings: what do players build first?
SELECT json_extract(data, '$.structure_type') AS first_building,
       COUNT(*) AS frequency,
       AVG(json_extract(data, '$.time_s')) AS avg_time_s
FROM telemetry_events WHERE event = 'match.first_build'
GROUP BY first_building ORDER BY frequency DESC;

-- APM distribution across the player base
SELECT
  CASE WHEN apm &lt; 30 THEN 'casual (&lt;30)'
       WHEN apm &lt; 80 THEN 'intermediate (30-80)'
       WHEN apm &lt; 150 THEN 'advanced (80-150)'
       ELSE 'expert (150+)' END AS skill_bucket,
  COUNT(*) AS snapshots
FROM (SELECT CAST(json_extract(data, '$.apm') AS INTEGER) AS apm
      FROM telemetry_events WHERE event = 'match.pace')
GROUP BY skill_bucket;

-- At what deficit do players surrender?
SELECT AVG(json_extract(data, '$.army_value_ratio')) AS avg_army_ratio,
       AVG(json_extract(data, '$.credits_diff')) AS avg_credit_diff,
       COUNT(*) AS surrenders
FROM telemetry_events WHERE event = 'match.surrender_point';
</code></pre>
<p><strong>Troubleshooting Insights:</strong></p>
<pre><code class="language-sql">-- Crash frequency by context (which screen/system crashes most?)
SELECT json_extract(data, '$.context') AS context,
       json_extract(data, '$.backtrace_hash') AS stack,
       COUNT(*) AS occurrences
FROM telemetry_events WHERE event = 'error.crash'
GROUP BY context, stack ORDER BY occurrences DESC LIMIT 20;

-- Desync correlation: which maps/mods trigger desyncs?
-- (run across aggregated relay + client exports)
SELECT json_extract(data, '$.map') AS map,
       COUNT(CASE WHEN event = 'relay.desync' THEN 1 END) AS desyncs,
       COUNT(CASE WHEN event = 'relay.game.end' THEN 1 END) AS total_games,
       ROUND(COUNT(CASE WHEN event = 'relay.desync' THEN 1 END) * 100.0 /
             NULLIF(COUNT(CASE WHEN event = 'relay.game.end' THEN 1 END), 0), 1) AS desync_pct
FROM telemetry_events
WHERE event IN ('relay.desync', 'relay.game.end')
GROUP BY map ORDER BY desync_pct DESC;

-- Performance: which players have sustained frame drops?
SELECT session_id,
       AVG(json_extract(data, '$.p95_ms')) AS avg_p95_frame_ms,
       MAX(json_extract(data, '$.entity_count')) AS peak_entities
FROM telemetry_events WHERE event = 'perf.frame'
GROUP BY session_id
HAVING avg_p95_frame_ms &gt; 33.3  -- below 30 FPS sustained
ORDER BY avg_p95_frame_ms DESC;
</code></pre>
<p><strong>Aggregation happens in the open, not in a backend.</strong> If the project team wants to analyze telemetry across many players (e.g., for a usability study, balance patch, or release retrospective), they ask the community to voluntarily submit exports â€” the same model as open-source projects collecting crash dumps on GitHub. Community members run <code>/analytics export</code>, review the file, and attach it. Aggregation scripts live in the repository and run locally â€” anyone can reproduce the analysis.</p>
<p><strong>Console commands (D058) â€” identical on client and server:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Command</th><th>Action</th></tr>
</thead>
<tbody>
<tr><td><code>/analytics status</code></td><td>Show recording status, event count, <code>telemetry.db</code> size, retention settings</td></tr>
<tr><td><code>/analytics inspect [category] [--last N]</code></td><td>Display recent events, optionally filtered by category</td></tr>
<tr><td><code>/analytics export [--from DATE] [--to DATE] [--category CAT]</code></td><td>Export to JSON/SQLite in <code>&lt;data_dir&gt;/exports/</code> with optional date/category filter</td></tr>
<tr><td><code>/analytics clear [--before DATE]</code></td><td>Delete events, optionally only before a date</td></tr>
<tr><td><code>/analytics on/off</code></td><td>Toggle local recording (<code>telemetry.product_analytics</code> cvar)</td></tr>
<tr><td><code>/analytics query SQL</code></td><td>Run ad-hoc SQL against <code>telemetry.db</code> (dev console only, <code>DEV_ONLY</code> flag)</td></tr>
</tbody>
</table>
</div>
<h3 id="architecture-where-telemetry-lives"><a class="header" href="#architecture-where-telemetry-lives">Architecture: Where Telemetry Lives</a></h3>
<p><strong>Primary path (always-on): local SQLite.</strong> Every component writes to its own <code>telemetry.db</code>. This is the ground truth. No network, no infrastructure, no dependencies.</p>
<pre><code>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Every component (client, relay, tracking, workshop)             â”‚
  â”‚                                                                 â”‚
  â”‚  Instrumentation    â”€â”€â–º  telemetry.db (local SQLite)            â”‚
  â”‚  (tracing + events)      â”œâ”€â”€ always written                     â”‚
  â”‚                          â”œâ”€â”€ /analytics inspect                 â”‚
  â”‚                          â”œâ”€â”€ /analytics export â”€â”€â–º .json file   â”‚
  â”‚                          â”‚   (voluntary: bug report, feedback)  â”‚
  â”‚                          â””â”€â”€ retention: max size / max age      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Optional path (server operators only): OTEL export.</strong> Server operators who want real-time dashboards can enable OTEL export alongside the SQLite sink. This is a deployment choice for sophisticated operators â€” never a requirement.</p>
<pre><code>  Servers with OTEL enabled:

  telemetry.db â—„â”€â”€ Instrumentation â”€â”€â–º OTEL Collector (optional)
  (always)         (tracing + events)       â”‚
                                     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚          â”‚              â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
                              â”‚Prometheusâ”‚ â”‚ Jaeger  â”‚ â”‚   Loki    â”‚
                              â”‚(metrics) â”‚ â”‚(traces) â”‚ â”‚(logs)     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                                      â”‚ AI Training  â”‚
                                                      â”‚ (Parquetâ†’ML) â”‚
                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>The dual-write approach means:</p>
<ul>
<li><strong>Every deployment</strong> gets full telemetry in SQLite â€” zero setup required</li>
<li><strong>Sophisticated deployments</strong> can additionally route to Grafana/Prometheus/Jaeger for real-time dashboards</li>
<li>Self-hosters can route OTEL to whatever they want (Grafana Cloud, Datadog, or just stdout)</li>
<li>If the OTEL collector goes down, telemetry continues in SQLite uninterrupted â€” no data loss</li>
</ul>
<h3 id="implementation-approach"><a class="header" href="#implementation-approach">Implementation Approach</a></h3>
<p><strong>Rust ecosystem:</strong></p>
<ul>
<li><code>tracing</code> crate â€” Bevy already uses this; add structured fields and span instrumentation</li>
<li><code>opentelemetry</code> + <code>opentelemetry-otlp</code> crates â€” OTEL SDK for Rust</li>
<li><code>tracing-opentelemetry</code> â€” bridges <code>tracing</code> spans to OTEL traces</li>
<li><code>metrics</code> crate â€” lightweight counters/histograms, exported via OTEL</li>
</ul>
<p><strong>Zero-cost engine instrumentation when disabled:</strong> The <code>telemetry</code> feature flag gates <strong>engine-level</strong> instrumentation (per-system tick timing, <code>GameplayEvent</code> stream, OTEL export) behind <code>#[cfg(feature = "telemetry")]</code>. When disabled, all engine telemetry calls compile to no-ops. No runtime cost, no allocations, no branches. This respects invariant #5 (efficiency-first performance).</p>
<p><strong>Product analytics (GUI interaction, session, settings, onboarding, errors, perf sampling) always record to SQLite</strong> â€” they are lightweight structured event inserts, not per-tick instrumentation. The overhead is negligible (one SQLite INSERT per user action, batched in WAL mode). Players who want to disable even this can set <code>telemetry.product_analytics false</code>.</p>
<p><strong>Transaction batching:</strong> All SQLite INSERTs â€” both telemetry events and gameplay events â€” are explicitly batched in transactions to avoid per-INSERT fsync overhead:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Event source</th><th>Batch strategy</th></tr>
</thead>
<tbody>
<tr><td>Product analytics</td><td>Buffered in memory; flushed in a single <code>BEGIN</code>/<code>COMMIT</code> every 1 second or 50 events, whichever first</td></tr>
<tr><td>Gameplay events</td><td>Buffered per tick; flushed in a single <code>BEGIN</code>/<code>COMMIT</code> at end of tick (typically 1-20 events per tick)</td></tr>
<tr><td>Server telemetry</td><td>Ring buffer; flushed in a single <code>BEGIN</code>/<code>COMMIT</code> every 100 ms or 200 events, whichever first</td></tr>
</tbody>
</table>
</div>
<p>All writes happen on a dedicated I/O thread (or <code>spawn_blocking</code> task) â€” never on the game loop thread. The game loop thread only appends to a lock-free ring buffer; the I/O thread drains and commits. This guarantees that SQLite contention (including <code>busy_timeout</code> waits and WAL checkpoints) cannot cause frame drops.</p>
<p><strong>Ring buffer sizing:</strong> The ring buffer must absorb all events generated during the worst-case I/O thread stall (WAL checkpoint on HDD: 200â€“500 ms). At peak event rates (~600 events/s during intense combat â€” gameplay events + telemetry + product analytics combined), a 500 ms stall generates ~300 events. <strong>Minimum ring buffer capacity: 1024 entries</strong> (3.4Ã— headroom over worst-case). Each entry is a lightweight enum (~64â€“128 bytes), so the buffer occupies ~64â€“128 KB â€” negligible. If the buffer fills despite this sizing, events are dropped with a counter increment (same pattern as the replay writerâ€™s <code>frames_lost</code> tracking in V45). The I/O thread logs a warning on drain if drops occurred. This is a last-resort safety net, not an expected operating condition.</p>
<p><strong>Build configurations:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Build</th><th>Engine Telemetry</th><th>Product Analytics (SQLite)</th><th>OTEL Export</th><th>Use case</th></tr>
</thead>
<tbody>
<tr><td><code>release</code></td><td>Off</td><td>On (local SQLite)</td><td>Off</td><td>Player-facing builds â€” minimal overhead</td></tr>
<tr><td><code>release-telemetry</code></td><td>On</td><td>On (local SQLite)</td><td>Optional</td><td>Tournament servers, AI training, debugging</td></tr>
<tr><td><code>debug</code></td><td>On</td><td>On (local SQLite)</td><td>Optional</td><td>Development â€” full instrumentation</td></tr>
</tbody>
</table>
</div>
<h3 id="self-hosting-observability"><a class="header" href="#self-hosting-observability">Self-Hosting Observability</a></h3>
<p>Community server operators get observability for free. The docker-compose.yaml (already designed in <code>03-NETCODE.md</code>) can optionally include a Grafana + Prometheus + Loki stack:</p>
<pre><code class="language-yaml"># docker-compose.observability.yaml (optional overlay)
services:
  otel-collector:
    image: otel/opentelemetry-collector:latest
    ports:
      - "4317:4317"    # OTLP gRPC
  prometheus:
    image: prom/prometheus:latest
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"    # dashboards
  loki:
    image: grafana/loki:latest
</code></pre>
<p>Pre-built Grafana dashboards ship with the project:</p>
<ul>
<li><strong>Relay Dashboard:</strong> active games, player RTT, orders/sec, desync events, suspicion scores</li>
<li><strong>Tracking Dashboard:</strong> listings, heartbeats, query rates</li>
<li><strong>Workshop Dashboard:</strong> downloads, publishes, dependency resolution times</li>
<li><strong>Engine Dashboard:</strong> tick times, entity counts, system breakdown, pathfinding stats</li>
</ul>
<p><strong>Alternatives considered:</strong></p>
<ul>
<li>Custom metrics format (less work initially, but no ecosystem â€” no Grafana, no alerting, no community tooling)</li>
<li>StatsD (simpler but metrics-only â€” no traces, no structured logs, no distributed correlation)</li>
<li>No telemetry (leaves operators blind and AI training without data)</li>
<li>Always-on telemetry (violates performance invariant â€” must be zero-cost when disabled)</li>
</ul>
<p><strong>Phase:</strong> Unified <code>telemetry_events</code> SQLite schema + <code>/analytics</code> console commands in Phase 2 (shared across all components from day one). Engine telemetry (per-system timing, <code>GameplayEvent</code> stream) in Phase 2 (sim). Product analytics (GUI interaction, session, settings, onboarding, errors, performance sampling) in Phase 3 (alongside UI chrome). Server-side SQLite telemetry recording (relay, tracking, workshop) in Phase 5 (multiplayer). Optional OTEL export layer for server operators in Phase 5. Pre-built Grafana dashboards in Phase 5. AI training pipeline in Phase 7 (LLM).</p>
<hr>
<hr>
<h2 id="d034-sqlite-as-embedded-storage-for-services-and-client"><a class="header" href="#d034-sqlite-as-embedded-storage-for-services-and-client">D034: SQLite as Embedded Storage for Services and Client</a></h2>
<p><strong>Decision:</strong> Use SQLite (via <code>rusqlite</code>) as the embedded database for all backend services that need persistent state and for the game clientâ€™s local metadata indices. No external database dependency required for any deployment.</p>
<p><strong>What this means:</strong> Every service that persists data beyond a single process lifetime uses an embedded SQLite database file. The â€œjust a binaryâ€ philosophy (see <code>03-NETCODE.md</code> Â§ Backend Infrastructure) is preserved â€” an operator downloads a binary, runs it, and persistence is a <code>.db</code> file next to the executable. No PostgreSQL, no MySQL, no managed database service.</p>
<p><strong>Where SQLite is used:</strong></p>
<h3 id="backend-services"><a class="header" href="#backend-services">Backend Services</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Service</th><th>What it stores</th><th>Why not in-memory</th></tr>
</thead>
<tbody>
<tr><td><strong>Relay server</strong></td><td><code>CertifiedMatchResult</code> records, <code>DesyncReport</code> events, <code>PlayerBehaviorProfile</code> history, replay archive metadata</td><td>Match results and behavioral data are valuable beyond the game session â€” operators need to query desync patterns, review suspicion scores, link replays to match records. A relay restart shouldnâ€™t erase match history.</td></tr>
<tr><td><strong>Workshop server</strong></td><td>Resource metadata, versions, dependencies, download counts, ratings, search index (FTS5), license data, replication cursors</td><td>This is a package registry â€” functionally equivalent to crates.ioâ€™s data layer. Search, dependency resolution, and version queries are relational workloads.</td></tr>
<tr><td><strong>Matchmaking server</strong></td><td>Player ratings (Glicko-2), match history, seasonal league data, leaderboards</td><td>Ratings and match history must survive restarts. Leaderboard queries (<code>top N</code>, per-faction, per-map) are natural SQL.</td></tr>
<tr><td><strong>Tournament server</strong></td><td>Brackets, match results, map pool votes, community reports</td><td>Tournament state spans hours/days; must survive restarts. Bracket queries and result reporting are relational.</td></tr>
</tbody>
</table>
</div>
<h3 id="game-client-local"><a class="header" href="#game-client-local">Game Client (local)</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Data</th><th>What it stores</th><th>Benefit</th></tr>
</thead>
<tbody>
<tr><td><strong>Replay catalog</strong></td><td>Player names, map, factions, date, duration, result, file path, signature status</td><td>Browse and search local replays without scanning files on disk. Filter by map, opponent, date range.</td></tr>
<tr><td><strong>Save game index</strong></td><td>Save name, campaign, mission, timestamp, playtime, thumbnail path</td><td>Fast save browser without deserializing every save file on launch.</td></tr>
<tr><td><strong>Workshop cache</strong></td><td>Downloaded resource metadata, versions, checksums, dependency graph</td><td>Offline dependency resolution. Know whatâ€™s installed without scanning the filesystem.</td></tr>
<tr><td><strong>Map catalog</strong></td><td>Map name, player count, size, author, source (local/workshop/OpenRA), tags</td><td>Browse local maps from all sources with a single query.</td></tr>
<tr><td><strong>Gameplay event log</strong></td><td>Structured <code>GameplayEvent</code> records (D031) per game session</td><td>Queryable post-game analysis without an OTEL stack. Frequently-aggregated fields (<code>event_type</code>, <code>unit_type_id</code>, <code>target_type_id</code>) are denormalized as indexed columns for fast <code>PlayerStyleProfile</code> building (D042). Full payloads remain in <code>data_json</code> for ad-hoc SQL: <code>SELECT json_extract(data_json, '$.weapon'), AVG(json_extract(data_json, '$.damage')) FROM gameplay_events WHERE event_type = 'combat' AND session_id = ?</code>.</td></tr>
<tr><td><strong>Asset index</strong></td><td><code>.mix</code> archive contents, MiniYAML conversion cache (keyed by file hash)</td><td>Skip re-parsing on startup. Know which <code>.mix</code> contains which file without opening every archive.</td></tr>
</tbody>
</table>
</div>
<h3 id="where-sqlite-is-not-used"><a class="header" href="#where-sqlite-is-not-used">Where SQLite is NOT used</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Area</th><th>Why not</th></tr>
</thead>
<tbody>
<tr><td><strong><code>ic-sim</code></strong></td><td>No I/O in the sim. Ever. Invariant #1.</td></tr>
<tr><td><strong>Tracking server</strong></td><td>Truly ephemeral data â€” game listings with TTL. In-memory is correct.</td></tr>
<tr><td><strong>Hot paths</strong></td><td>No DB queries per tick. All SQLite access is at load time, between games, or on UI/background threads.</td></tr>
<tr><td><strong>Save game data</strong></td><td>Save files are serde-serialized sim snapshots loaded as a whole unit. No partial queries needed. SQLite indexes their <em>metadata</em>, not their <em>content</em>.</td></tr>
<tr><td><strong>Campaign state</strong></td><td>Loaded/saved as a unit inside save games. Fits in memory. No relational queries.</td></tr>
</tbody>
</table>
</div>
<h3 id="why-sqlite-specifically"><a class="header" href="#why-sqlite-specifically">Why SQLite specifically</a></h3>
<p><strong>The strategic argument: SQLite is the worldâ€™s most widely deployed database format.</strong> Choosing SQLite means ICâ€™s player data isnâ€™t locked behind a proprietary format that only IC can read â€” itâ€™s stored in an open, standardized, universally-supported container that anything can query. Python scripts, R notebooks, Jupyter, Grafana, Excel (via ODBC), DB Browser for SQLite, the <code>sqlite3</code> CLI, Datasette, LLM agents, custom analytics tools, research projects, community stat trackers, third-party companion apps â€” all of them can open an IC <code>.db</code> file and run SQL against it with zero IC-specific tooling. This is a deliberate architectural choice: <strong>player data is a platform, not a product feature.</strong> The community can build things on top of ICâ€™s data that we never imagined, using tools weâ€™ve never heard of, because the interface is SQL â€” not a custom binary format, not a REST API that requires our servers to be running, not a proprietary export.</p>
<p>Every use case the community might invent â€” balance analysis, AI training datasets, tournament statistics, replay research, performance benchmarking, meta-game tracking, coach feedback tools, stream overlays reading live stat data â€” is a SQL query away. No SDK required. No reverse engineering. No waiting for us to build an export feature. The <code>.db</code> file IS the export.</p>
<p>This is also why SQLite is chosen over flat files (JSON, CSV): structured data in a relational schema with SQL query support enables questions that flat files canâ€™t answer efficiently. â€œWhatâ€™s my win rate with Soviet on maps larger than 128Ã—128 against players Iâ€™ve faced more than 3 times?â€ is a single SQL query against <code>matches</code> + <code>match_players</code>. With JSON files, itâ€™s a custom script.</p>
<p><strong>The practical arguments:</strong></p>
<ul>
<li><strong><code>rusqlite</code></strong> is a mature, well-maintained Rust crate with no unsafe surprises</li>
<li><strong>Single-file database</strong> â€” fits the â€œjust a binaryâ€ deployment model. No connection strings, no separate database process, no credentials to manage</li>
<li><strong>Self-hosting alignment</strong> â€” a community relay operator on a â‚¬5 VPS gets persistent match history without installing or operating a database server</li>
<li><strong>FTS5 full-text search</strong> â€” covers workshop resource search and replay text search without Elasticsearch or a separate search service</li>
<li><strong>WAL mode</strong> â€” handles concurrent reads from web endpoints while a single writer persists new records. Sufficient for community-scale deployments (hundreds of concurrent users, not millions)</li>
<li><strong>WASM-compatible</strong> â€” <code>sql.js</code> (Emscripten build of SQLite) or <code>sqlite-wasm</code> for the browser target. The client-side replay catalog and gameplay event log work in the browser build</li>
<li><strong>Ad-hoc investigation</strong> â€” any operator can open the <code>.db</code> file in DB Browser for SQLite, DBeaver, or the <code>sqlite3</code> CLI and run queries immediately. No Grafana dashboards required. This fills the gap between â€œjust stdout logsâ€ and â€œfull OTEL stackâ€ for community self-hosters</li>
<li><strong>Backup-friendly</strong> â€” <code>VACUUM INTO</code> produces a self-contained, compacted copy safe to take while the database is in use (D061). A backup is just a file copy. No dump/restore ceremony</li>
<li><strong>Immune to bitrot</strong> â€” The Library of Congress recommends SQLite as a storage format for datasets. IC player data from 2027 will still be readable in 2047 â€” the format is that stable</li>
<li><strong>Deterministic and testable</strong> â€” in CI, gameplay event assertions are SQL queries against a test fixture database. No mock infrastructure needed</li>
</ul>
<h3 id="relationship-to-d031-otel-telemetry"><a class="header" href="#relationship-to-d031-otel-telemetry">Relationship to D031 (OTEL Telemetry)</a></h3>
<p>D031 (OTEL) and D034 (SQLite) are complementary, not competing:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Concern</th><th>D031 (OTEL)</th><th>D034 (SQLite)</th></tr>
</thead>
<tbody>
<tr><td><strong>Real-time monitoring</strong></td><td>Yes â€” Prometheus metrics, Grafana dashboards</td><td>No</td></tr>
<tr><td><strong>Distributed tracing</strong></td><td>Yes â€” Jaeger traces across clients and relay</td><td>No</td></tr>
<tr><td><strong>Persistent records</strong></td><td>No â€” metrics are time-windowed, logs rotate</td><td>Yes â€” match history, ratings, replays are permanent</td></tr>
<tr><td><strong>Ad-hoc investigation</strong></td><td>Requires OTEL stack running</td><td>Just open the <code>.db</code> file</td></tr>
<tr><td><strong>Offline operation</strong></td><td>No â€” needs collector + backends</td><td>Yes â€” works standalone</td></tr>
<tr><td><strong>Client-side debugging</strong></td><td>Requires exporting to a collector</td><td>Local <code>.db</code> file, queryable immediately</td></tr>
<tr><td><strong>AI training pipeline</strong></td><td>Yes â€” Parquet/Arrow export for ML</td><td>Source data â€” gameplay events could be exported from SQLite to Parquet</td></tr>
</tbody>
</table>
</div>
<p>OTEL is for operational monitoring and distributed debugging. SQLite is for persistent records, metadata indices, and standalone investigation. Tournament servers and relay servers use both â€” OTEL for dashboards, SQLite for match history.</p>
<h3 id="consumers-of-player-data"><a class="header" href="#consumers-of-player-data">Consumers of Player Data</a></h3>
<p>SQLite isnâ€™t just infrastructure â€” itâ€™s a UX pillar. Multiple crates read the client-side database to deliver features no other RTS offers:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Consumer</th><th>Crate</th><th>What it reads</th><th>What it produces</th><th>Required?</th></tr>
</thead>
<tbody>
<tr><td><strong>Player-facing analytics</strong></td><td><code>ic-ui</code></td><td><code>gameplay_events</code>, <code>matches</code>, <code>match_players</code>, <code>campaign_missions</code>, <code>roster_snapshots</code></td><td>Post-game stats screen, career stats page, campaign dashboard with roster/veterancy graphs, mod balance dashboard</td><td>Always on</td></tr>
<tr><td><strong>Adaptive AI</strong></td><td><code>ic-ai</code></td><td><code>matches</code>, <code>match_players</code>, <code>gameplay_events</code></td><td>Difficulty adjustment, build order variety, counter-strategy selection based on player tendencies</td><td>Always on</td></tr>
<tr><td><strong>LLM personalization</strong></td><td><code>ic-llm</code></td><td><code>matches</code>, <code>gameplay_events</code>, <code>campaign_missions</code>, <code>roster_snapshots</code></td><td>Personalized missions, adaptive briefings, post-match commentary, coaching suggestions, rivalry narratives</td><td><strong>Optional</strong> â€” requires BYOLLM provider configured (D016)</td></tr>
<tr><td><strong>Player style profiles</strong> (D042)</td><td><code>ic-ai</code></td><td><code>gameplay_events</code>, <code>match_players</code>, <code>matches</code></td><td><code>player_profiles</code> table â€” aggregated behavioral models for local player + opponents</td><td>Always on (profile building)</td></tr>
<tr><td><strong>Training system</strong> (D042)</td><td><code>ic-ai</code> + <code>ic-ui</code></td><td><code>player_profiles</code>, <code>training_sessions</code>, <code>gameplay_events</code></td><td>Quick training scenarios, weakness analysis, progress tracking</td><td>Always on (training UI)</td></tr>
</tbody>
</table>
</div>
<p>Player analytics, adaptive AI, player style profiles, and the training system are always available. LLM personalization and coaching activate only when the player has configured an LLM provider â€” the game is fully functional without it.</p>
<p>All consumers are read-only. The sim writes nothing (invariant #1) â€” <code>gameplay_events</code> are recorded by a Bevy observer system outside <code>ic-sim</code>, and <code>matches</code>/<code>campaign_missions</code> are written at session boundaries.</p>
<h3 id="player-facing-analytics-ic-ui"><a class="header" href="#player-facing-analytics-ic-ui">Player-Facing Analytics (<code>ic-ui</code>)</a></h3>
<p>No other RTS surfaces your own match data this way. SQLite makes it trivial â€” queries run on a background thread, results drive a lightweight chart component in <code>ic-ui</code> (Bevy 2D: line, bar, pie, heatmap, stacked area).</p>
<p><strong>Post-game stats screen</strong> (after every match):</p>
<ul>
<li>Unit production timeline (stacked area: units built per minute by type)</li>
<li>Resource income/expenditure curves</li>
<li>Combat engagement heatmap (where fights happened on the map)</li>
<li>APM over time, army value graph, tech tree timing</li>
<li>Head-to-head comparison table vs opponent</li>
<li>All data: <code>SELECT ... FROM gameplay_events WHERE session_id = ?</code></li>
</ul>
<p><strong>Career stats page</strong> (main menu):</p>
<ul>
<li>Win rate by faction, map, opponent, game mode â€” over time and lifetime</li>
<li>Rating history graph (Glicko-2 from matchmaking, synced to local DB)</li>
<li>Most-used units, highest kill-count units, signature strategies</li>
<li>Session history: date, map, opponent, result, duration â€” clickable â†’ replay</li>
<li>All data: <code>SELECT ... FROM matches JOIN match_players ...</code></li>
</ul>
<p><strong>Campaign dashboard</strong> (D021 integration):</p>
<ul>
<li>Roster composition graph per mission (how your army evolves across the campaign)</li>
<li>Veterancy progression: track named units across missions (the tank that survived from mission 1)</li>
<li>Campaign path visualization: which branches you took, which missions you replayed</li>
<li>Performance trends: completion time, casualties, resource efficiency per mission</li>
<li>All data: <code>SELECT ... FROM campaign_missions JOIN roster_snapshots ...</code></li>
</ul>
<p><strong>Mod balance dashboard</strong> (Phase 7, for mod developers):</p>
<ul>
<li>Unit win-rate contribution, cost-efficiency scatter plots, engagement outcome distributions</li>
<li>Compare across balance presets (D019) or mod versions</li>
<li><code>ic mod stats</code> CLI command reads the same SQLite database</li>
<li>All data: <code>SELECT ... FROM gameplay_events WHERE mod_id = ?</code></li>
</ul>
<h3 id="llm-personalization-ic-llm--optional-byollm"><a class="header" href="#llm-personalization-ic-llm--optional-byollm">LLM Personalization (<code>ic-llm</code>) â€” Optional, BYOLLM</a></h3>
<p>When a player has configured an LLM provider (see BYOLLM in D016), <code>ic-llm</code> reads the local SQLite database (read-only) and injects player context into generation prompts. This is entirely optional â€” every game feature works without it. No data leaves the device unless the userâ€™s chosen LLM provider is cloud-based.</p>
<p><strong>Personalized mission generation:</strong></p>
<ul>
<li>â€œYouâ€™ve been playing Soviet heavy armor for 12 games. Hereâ€™s a mission that forces infantry-first tactics.â€</li>
<li>â€œYour win rate drops against Allied naval. This coastal defense mission trains that weakness.â€</li>
<li>Prompt includes: faction preferences, unit usage patterns, win/loss streaks, map size preferences â€” all from SQLite aggregates.</li>
</ul>
<p><strong>Adaptive briefings:</strong></p>
<ul>
<li>Campaign briefings reference your actual roster: â€œCommander, your veteran Tesla Tank squad from Vladivostok is available for this operation.â€</li>
<li>Difficulty framing adapts to performance: struggling player gets â€œintel reports suggest light resistanceâ€; dominant player gets â€œexpect fierce opposition.â€</li>
<li>Queries <code>roster_snapshots</code> and <code>campaign_missions</code> tables.</li>
</ul>
<p><strong>Post-match commentary:</strong></p>
<ul>
<li>LLM generates a narrative summary of the match from <code>gameplay_events</code>: â€œThe turning point was at 8:42 when your MiG strike destroyed the Allied War Factory, halting tank production for 3 minutes.â€</li>
<li>Highlights unusual events: first-ever use of a unit type, personal records, close calls.</li>
<li>Optional â€” disabled by default, requires LLM provider configured.</li>
</ul>
<p><strong>Coaching suggestions:</strong></p>
<ul>
<li>â€œYou built 40 Rifle Infantry across 5 games but they had a 12% survival rate. Consider mixing in APCs for transport.â€</li>
<li>â€œYour average expansion timing is 6:30. Top players expand at 4:00-5:00.â€</li>
<li>Queries aggregate statistics from <code>gameplay_events</code> across multiple sessions.</li>
</ul>
<p><strong>Rivalry narratives:</strong></p>
<ul>
<li>Track frequent opponents from <code>matches</code> table: â€œYouâ€™re 3-7 against PlayerX. They favor Allied air rushes â€” hereâ€™s a counter-strategy mission.â€</li>
<li>Generate rivalry-themed campaign missions featuring opponent tendencies.</li>
</ul>
<h3 id="adaptive-ai-ic-ai"><a class="header" href="#adaptive-ai-ic-ai">Adaptive AI (<code>ic-ai</code>)</a></h3>
<p><code>ic-ai</code> reads the playerâ€™s match history to calibrate skirmish and campaign AI behavior. No learning during the match â€” all adaptation happens between games by querying SQLite.</p>
<ul>
<li><strong>Difficulty scaling:</strong> AI selects from difficulty presets based on player win rate over recent N games. Avoids both stomps and frustration.</li>
<li><strong>Build order variety:</strong> AI avoids repeating the same strategy the player has already beaten. Queries <code>gameplay_events</code> for AI build patterns the player countered successfully.</li>
<li><strong>Counter-strategy selection:</strong> If the playerâ€™s last 5 games show heavy tank play, AI is more likely to choose anti-armor compositions.</li>
<li><strong>Campaign-specific:</strong> In branching campaigns (D021), AI reads the playerâ€™s roster strength from <code>roster_snapshots</code> and adjusts reinforcement timing accordingly.</li>
</ul>
<p>This is designer-authored adaptation (the AI author sets the rules for how history influences behavior), not machine learning. The SQLite queries are simple aggregates run at mission load time.</p>
<p><strong>Fallback:</strong> When no match history is available (first launch, empty database, WASM/headless builds without SQLite), <code>ic-ai</code> falls back to default difficulty presets and random strategy selection. All SQLite reads are behind an <code>Option&lt;impl AiHistorySource&gt;</code> â€” the AI is fully functional without it, just not personalized.</p>
<h3 id="client-side-schema-key-tables"><a class="header" href="#client-side-schema-key-tables">Client-Side Schema (Key Tables)</a></h3>
<pre><code class="language-sql">-- Match history (synced from matchmaking server when online, always written locally)
CREATE TABLE matches (
    id              INTEGER PRIMARY KEY,
    session_id      TEXT NOT NULL UNIQUE,
    map_name        TEXT NOT NULL,
    game_mode       TEXT NOT NULL,
    balance_preset  TEXT NOT NULL,
    mod_id          TEXT,
    duration_ticks  INTEGER NOT NULL,
    started_at      TEXT NOT NULL,
    replay_path     TEXT,
    replay_hash     BLOB
);

CREATE TABLE match_players (
    match_id    INTEGER REFERENCES matches(id),
    player_name TEXT NOT NULL,
    faction     TEXT NOT NULL,
    team        INTEGER,
    result      TEXT NOT NULL,  -- 'victory', 'defeat', 'disconnect', 'draw'
    is_local    INTEGER NOT NULL DEFAULT 0,
    PRIMARY KEY (match_id, player_name)
);

-- Gameplay events (D031 structured events, written per session)
-- Top fields denormalized as indexed columns to avoid json_extract() scans
-- during PlayerStyleProfile aggregation (D042). The full payload remains in
-- data_json for ad-hoc SQL queries and mod developer analytics.
CREATE TABLE gameplay_events (
    id              INTEGER PRIMARY KEY,
    session_id      TEXT NOT NULL,
    tick            INTEGER NOT NULL,
    event_type      TEXT NOT NULL,       -- 'unit_built', 'unit_killed', 'building_placed', ...
    player          TEXT,
    game_module     TEXT,                -- denormalized: 'ra1', 'td', 'ra2', custom (set once per session)
    mod_fingerprint TEXT,                -- denormalized: D062 SHA-256 (updated on profile switch)
    unit_type_id    INTEGER,             -- denormalized: interned unit type (nullable for non-unit events)
    target_type_id  INTEGER,             -- denormalized: interned target type (nullable)
    data_json       TEXT NOT NULL        -- event-specific payload (full detail)
);
CREATE INDEX idx_ge_session_event ON gameplay_events(session_id, event_type);
CREATE INDEX idx_ge_game_module ON gameplay_events(game_module) WHERE game_module IS NOT NULL;
CREATE INDEX idx_ge_unit_type ON gameplay_events(unit_type_id) WHERE unit_type_id IS NOT NULL;

-- Campaign state (D021 branching campaigns)
CREATE TABLE campaign_missions (
    id              INTEGER PRIMARY KEY,
    campaign_id     TEXT NOT NULL,
    mission_id      TEXT NOT NULL,
    outcome         TEXT NOT NULL,
    duration_ticks  INTEGER NOT NULL,
    completed_at    TEXT NOT NULL,
    casualties      INTEGER,
    resources_spent INTEGER
);

CREATE TABLE roster_snapshots (
    id          INTEGER PRIMARY KEY,
    mission_id  INTEGER REFERENCES campaign_missions(id),
    snapshot_at TEXT NOT NULL,   -- 'mission_start' or 'mission_end'
    roster_json TEXT NOT NULL    -- serialized unit list with veterancy, equipment
);

-- FTS5 for replay and map search (contentless â€” populated via triggers on matches + match_players)
CREATE VIRTUAL TABLE replay_search USING fts5(
    player_names, map_name, factions, content=''
);
-- Triggers on INSERT into matches/match_players aggregate player_names and factions
-- into the FTS index. Contentless means FTS stores its own copy â€” no content= source mismatch.
</code></pre>
<h3 id="schema-migration"><a class="header" href="#schema-migration">Schema Migration</a></h3>
<p>Each service manages its own schema using embedded SQL migrations (numbered, applied on startup). The <code>rusqlite</code> <code>user_version</code> pragma tracks the current schema version. Forward-only migrations â€” the binary upgrades the database file automatically on first launch after an update.</p>
<h3 id="per-database-pragma-configuration"><a class="header" href="#per-database-pragma-configuration">Per-Database PRAGMA Configuration</a></h3>
<p>Every SQLite database in IC gets a purpose-tuned PRAGMA configuration applied at connection open time. The correct settings depend on the databaseâ€™s access pattern (write-heavy vs. read-heavy), data criticality (irreplaceable credentials vs. recreatable cache), expected size, and concurrency requirements. A single â€œone size fits allâ€ configuration would either sacrifice durability for databases that need it (credentials, achievements) or sacrifice throughput for databases that need speed (telemetry, gameplay events).</p>
<p><strong>All databases share these baseline PRAGMAs:</strong></p>
<pre><code class="language-sql">PRAGMA journal_mode = WAL;          -- all databases use WAL (concurrent readers, non-blocking writes)
PRAGMA foreign_keys = ON;           -- enforced everywhere (except single-table telemetry)
PRAGMA encoding = 'UTF-8';         -- consistent text encoding
PRAGMA trusted_schema = OFF;        -- defense-in-depth: disable untrusted SQL functions in schema
</code></pre>
<p><code>page_size</code> must be set <strong>before</strong> the first write to a new database (it cannot be changed after creation without <code>VACUUM</code>). All other PRAGMAs are applied on every connection open.</p>
<p><strong>Connection initialization pattern (Rust):</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Apply purpose-specific PRAGMAs to a freshly opened rusqlite::Connection.
/// Called immediately after Connection::open(), before any application queries.
fn configure_connection(conn: &amp;Connection, config: &amp;DbConfig) -&gt; rusqlite::Result&lt;()&gt; {
    // page_size only effective on new databases (before first table creation)
    conn.pragma_update(None, "page_size", config.page_size)?;
    conn.pragma_update(None, "journal_mode", "wal")?;
    conn.pragma_update(None, "synchronous", config.synchronous)?;
    conn.pragma_update(None, "cache_size", config.cache_size)?;
    conn.pragma_update(None, "foreign_keys", config.foreign_keys)?;
    conn.pragma_update(None, "busy_timeout", config.busy_timeout_ms)?;
    conn.pragma_update(None, "temp_store", config.temp_store)?;
    conn.pragma_update(None, "wal_autocheckpoint", config.wal_autocheckpoint)?;
    conn.pragma_update(None, "trusted_schema", "off")?;
    if config.mmap_size &gt; 0 {
        conn.pragma_update(None, "mmap_size", config.mmap_size)?;
    }
    if config.auto_vacuum != AutoVacuum::None {
        conn.pragma_update(None, "auto_vacuum", config.auto_vacuum.as_str())?;
    }
    Ok(())
}
<span class="boring">}</span></code></pre>
<h4 id="client-side-databases"><a class="header" href="#client-side-databases">Client-Side Databases</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>PRAGMA / Database</th><th><code>gameplay.db</code></th><th><code>telemetry.db</code></th><th><code>profile.db</code></th><th><code>achievements.db</code></th><th><code>communities/*.db</code></th><th><code>workshop/cache.db</code></th></tr>
</thead>
<tbody>
<tr><td><strong>Purpose</strong></td><td>Match history, events, campaigns, replays, profiles, training</td><td>Telemetry event stream</td><td>Identity, friends, images</td><td>Achievement defs &amp; progress</td><td>Signed credentials</td><td>Workshop metadata cache</td></tr>
<tr><td><strong>synchronous</strong></td><td><code>NORMAL</code></td><td><code>NORMAL</code></td><td><code>FULL</code></td><td><code>FULL</code></td><td><code>FULL</code></td><td><code>NORMAL</code></td></tr>
<tr><td><strong>cache_size</strong></td><td><code>-16384</code> (16 MB)</td><td><code>-4096</code> (4 MB)</td><td><code>-2048</code> (2 MB)</td><td><code>-1024</code> (1 MB)</td><td><code>-512</code> (512 KB)</td><td><code>-4096</code> (4 MB)</td></tr>
<tr><td><strong>page_size</strong></td><td><code>4096</code></td><td><code>4096</code></td><td><code>4096</code></td><td><code>4096</code></td><td><code>4096</code></td><td><code>4096</code></td></tr>
<tr><td><strong>mmap_size</strong></td><td><code>67108864</code> (64 MB)</td><td><code>0</code></td><td><code>0</code></td><td><code>0</code></td><td><code>0</code></td><td><code>0</code></td></tr>
<tr><td><strong>busy_timeout</strong></td><td><code>2000</code> (2 s)</td><td><code>1000</code> (1 s)</td><td><code>3000</code> (3 s)</td><td><code>3000</code> (3 s)</td><td><code>3000</code> (3 s)</td><td><code>3000</code> (3 s)</td></tr>
<tr><td><strong>temp_store</strong></td><td><code>MEMORY</code></td><td><code>MEMORY</code></td><td><code>DEFAULT</code></td><td><code>DEFAULT</code></td><td><code>DEFAULT</code></td><td><code>MEMORY</code></td></tr>
<tr><td><strong>auto_vacuum</strong></td><td><code>NONE</code></td><td><code>NONE</code></td><td><code>INCREMENTAL</code></td><td><code>NONE</code></td><td><code>NONE</code></td><td><code>INCREMENTAL</code></td></tr>
<tr><td><strong>wal_autocheckpoint</strong></td><td><code>2000</code> (â‰ˆ8 MB WAL)</td><td><code>4000</code> (â‰ˆ16 MB WAL)</td><td><code>500</code> (â‰ˆ2 MB WAL)</td><td><code>100</code></td><td><code>100</code></td><td><code>1000</code></td></tr>
<tr><td><strong>foreign_keys</strong></td><td><code>ON</code></td><td><code>OFF</code></td><td><code>ON</code></td><td><code>ON</code></td><td><code>ON</code></td><td><code>ON</code></td></tr>
<tr><td><strong>Expected size</strong></td><td>10â€“500 MB</td><td>â‰¤100 MB (pruned)</td><td>1â€“10 MB</td><td>&lt;1 MB</td><td>&lt;1 MB each</td><td>1â€“50 MB</td></tr>
<tr><td><strong>Data criticality</strong></td><td>Valuable (history)</td><td>Low (recreatable)</td><td><strong>Critical</strong> (identity)</td><td>High (player investment)</td><td><strong>Critical</strong> (signed)</td><td>Low (recreatable)</td></tr>
</tbody>
</table>
</div>
<h4 id="server-side-databases"><a class="header" href="#server-side-databases">Server-Side Databases</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>PRAGMA / Database</th><th>Server <code>telemetry.db</code></th><th>Relay data</th><th>Workshop server</th><th>Matchmaking server</th></tr>
</thead>
<tbody>
<tr><td><strong>Purpose</strong></td><td>High-throughput event stream</td><td>Match results, desync, behavior profiles</td><td>Resource registry, FTS5 search</td><td>Ratings, leaderboards, history</td></tr>
<tr><td><strong>synchronous</strong></td><td><code>NORMAL</code></td><td><code>FULL</code></td><td><code>NORMAL</code></td><td><code>FULL</code></td></tr>
<tr><td><strong>cache_size</strong></td><td><code>-8192</code> (8 MB)</td><td><code>-8192</code> (8 MB)</td><td><code>-16384</code> (16 MB)</td><td><code>-8192</code> (8 MB)</td></tr>
<tr><td><strong>page_size</strong></td><td><code>4096</code></td><td><code>4096</code></td><td><code>4096</code></td><td><code>4096</code></td></tr>
<tr><td><strong>mmap_size</strong></td><td><code>0</code></td><td><code>0</code></td><td><code>268435456</code> (256 MB)</td><td><code>134217728</code> (128 MB)</td></tr>
<tr><td><strong>busy_timeout</strong></td><td><code>5000</code> (5 s)</td><td><code>5000</code> (5 s)</td><td><code>10000</code> (10 s)</td><td><code>10000</code> (10 s)</td></tr>
<tr><td><strong>temp_store</strong></td><td><code>MEMORY</code></td><td><code>MEMORY</code></td><td><code>MEMORY</code></td><td><code>MEMORY</code></td></tr>
<tr><td><strong>auto_vacuum</strong></td><td><code>NONE</code></td><td><code>NONE</code></td><td><code>INCREMENTAL</code></td><td><code>NONE</code></td></tr>
<tr><td><strong>wal_autocheckpoint</strong></td><td><code>8000</code> (â‰ˆ32 MB WAL)</td><td><code>1000</code> (â‰ˆ4 MB WAL)</td><td><code>1000</code> (â‰ˆ4 MB WAL)</td><td><code>1000</code> (â‰ˆ4 MB WAL)</td></tr>
<tr><td><strong>foreign_keys</strong></td><td><code>OFF</code></td><td><code>ON</code></td><td><code>ON</code></td><td><code>ON</code></td></tr>
<tr><td><strong>Expected size</strong></td><td>â‰¤500 MB (pruned)</td><td>10 MBâ€“10 GB</td><td>10 MBâ€“10 GB</td><td>1 MBâ€“1 GB</td></tr>
<tr><td><strong>Data criticality</strong></td><td>Low (operational)</td><td><strong>Critical</strong> (signed records)</td><td>Moderate (rebuildable from packages)</td><td><strong>Critical</strong> (player ratings)</td></tr>
</tbody>
</table>
</div>
<p><strong>Tournament server</strong> uses the same configuration as relay data â€” brackets, match results, and map pool votes are signed records with identical durability requirements (<code>synchronous=FULL</code>, 8 MB cache, append-only growth).</p>
<h4 id="table-to-file-assignments-for-d047-and-d057"><a class="header" href="#table-to-file-assignments-for-d047-and-d057">Table-to-File Assignments for D047 and D057</a></h4>
<p>Not every table set warrants its own <code>.db</code> file. Two decision areas have SQLite tables that live inside existing databases:</p>
<ul>
<li><strong>D047 LLM provider config</strong> (<code>llm_providers</code>, <code>llm_task_routing</code>) â†’ stored in <strong><code>profile.db</code></strong>. These are small config tables (~dozen rows) containing encrypted API keys â€” they inherit <code>profile.db</code>â€™s <code>synchronous=FULL</code> durability, which is appropriate for data that includes secrets. Co-locating with identity data keeps all â€œwho am I and what are my settingsâ€ data in one backup-critical file.</li>
<li><strong>D057 Skill Library</strong> (<code>skills</code>, <code>skills_fts</code>, <code>skill_embeddings</code>, <code>skill_compositions</code>) â†’ stored in <strong><code>gameplay.db</code></strong>. Skills are analytical data produced from gameplay â€” they benefit from <code>gameplay.db</code>â€™s 16 MB cache and 64 MB mmap (FTS5 keyword search and embedding similarity scans over potentially thousands of skills). A mature skill library with embeddings may reach 10â€“50 MB, well within <code>gameplay.db</code>â€™s 10â€“500 MB expected range. Co-locating with <code>gameplay_events</code> and <code>player_profiles</code> keeps all AI/LLM-consumed data queryable in one file.</li>
</ul>
<h4 id="configuration-rationale"><a class="header" href="#configuration-rationale">Configuration Rationale</a></h4>
<p><strong><code>synchronous</code> â€” the most impactful setting:</strong></p>
<ul>
<li><strong><code>FULL</code></strong> for databases storing irreplaceable data: <code>profile.db</code> (player identity), <code>achievements.db</code> (player investment), <code>communities/*.db</code> (signed credentials that require server contact to re-obtain), relay match data (signed <code>CertifiedMatchResult</code> records), and matchmaking ratings (player ELO/Glicko-2 history). <code>FULL</code> guarantees that a committed transaction survives even an OS crash or power failure â€” the fsync penalty is acceptable because these databases have low write frequency.</li>
<li><strong><code>NORMAL</code></strong> for everything else. In WAL mode, <code>NORMAL</code> still guarantees durability against application crashes (the WAL is synced before committing). Only an OS-level crash during a checkpoint could theoretically lose a transaction â€” an acceptable risk for telemetry events, gameplay analytics, and recreatable caches.</li>
</ul>
<p><strong><code>cache_size</code> â€” scaled to query complexity:</strong></p>
<ul>
<li><code>gameplay.db</code> gets 16 MB because it runs the most complex queries: multi-table JOINs for career stats, aggregate functions over thousands of gameplay_events, FTS5 replay search. The large cache keeps hot index pages in memory across analytical queries.</li>
<li>Server Workshop gets 16 MB for the same reason â€” FTS5 search over the entire resource registry benefits from a large page cache.</li>
<li><code>telemetry.db</code> (client and server) gets a moderate cache because writes dominate reads. The write path doesnâ€™t benefit from large caches â€” itâ€™s all sequential inserts.</li>
<li>Small databases (<code>achievements.db</code>, <code>communities/*.db</code>) need minimal cache because their entire content fits in a few hundred pages.</li>
</ul>
<p><strong><code>mmap_size</code> â€” for read-heavy databases that grow large:</strong></p>
<ul>
<li><code>gameplay.db</code> at 64 MB: after months of play, this database may contain hundreds of thousands of gameplay_events rows. Memory-mapping avoids repeated read syscalls during analytical queries like <code>PlayerStyleProfile</code> aggregation (D042). The 64 MB limit keeps memory pressure manageable on the minimum-spec 4 GB machine â€” just 1.6% of total RAM. If the database exceeds 64 MB, the remainder uses standard reads. On systems with â‰¥8 GB RAM, this could be scaled up at runtime.</li>
<li>Server Workshop and Matchmaking at 128â€“256 MB: large registries and leaderboard scans benefit from mmap. Workshop search scans FTS5 index pages; matchmaking scans rating tables for top-N queries. Server hardware typically has â‰¥16 GB RAM.</li>
<li>Write-dominated databases (<code>telemetry.db</code>) skip mmap entirely â€” the write path doesnâ€™t benefit, and mmap can actually hinder WAL performance by creating contention between mapped reads and WAL writes.</li>
</ul>
<p><strong><code>wal_autocheckpoint</code> â€” tuned to write cadence, with gameplay override:</strong></p>
<ul>
<li>Client <code>telemetry.db</code> at 4000 pages (â‰ˆ16 MB WAL): telemetry writes are bursty during gameplay (potentially hundreds of events per second during intense combat). A large autocheckpoint threshold batches writes and defers the expensive checkpoint operation, preventing frame drops. The WAL file may grow to 16 MB during a match and get checkpointed during the post-game transition.</li>
<li>Server <code>telemetry.db</code> at 8000 pages (â‰ˆ32 MB WAL): relay servers handling multiple concurrent games need even larger write batches. The 32 MB WAL absorbs write bursts without checkpoint contention blocking game event recording.</li>
<li><code>gameplay.db</code> at 2000 pages (â‰ˆ8 MB WAL): moderate â€” gameplay_events arrive faster than profile updates but slower than telemetry. The 8 MB buffer handles end-of-match write bursts.</li>
<li>Small databases at 100â€“500 pages: writes are rare; keep the WAL file small and tidy.</li>
</ul>
<p><strong>HDD-safe WAL checkpoint strategy:</strong> The <code>wal_autocheckpoint</code> thresholds above are tuned for SSDs. On a 5400 RPM HDD (common on the 2012 min-spec laptop), a WAL checkpoint transfers dirty pages back to the main database file at scattered offsets â€” <strong>random I/O</strong>. A 16 MB checkpoint can produce 4000 random 4 KB writes, taking 200â€“500+ ms on a spinning disk. If this triggers during gameplay, the I/O thread stalls, the ring buffer fills, and events are silently lost.</p>
<p><strong>Mitigation: disable autocheckpoint during active gameplay, checkpoint at safe points.</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// During match load, disable automatic checkpointing on gameplay-active databases.
/// The I/O thread calls this after opening connections.
fn enter_gameplay_mode(conn: &amp;Connection) -&gt; rusqlite::Result&lt;()&gt; {
    conn.pragma_update(None, "wal_autocheckpoint", 0)?; // 0 = disable auto
    Ok(())
}

/// At safe points (loading screen, post-game stats, main menu, single-player pause),
/// trigger a passive checkpoint that yields if it encounters contention.
fn checkpoint_at_safe_point(conn: &amp;Connection) -&gt; rusqlite::Result&lt;()&gt; {
    // PASSIVE: checkpoint pages that don't require blocking readers.
    // Does not block, does not stall. May leave some pages un-checkpointed.
    conn.pragma_update(None, "wal_checkpoint", "PASSIVE")?;
    Ok(())
}

/// On match end or app exit, restore normal autocheckpoint thresholds.
fn leave_gameplay_mode(conn: &amp;Connection, normal_threshold: u32) -&gt; rusqlite::Result&lt;()&gt; {
    conn.pragma_update(None, "wal_autocheckpoint", normal_threshold)?;
    // Full checkpoint now â€” we're in a loading/menu screen, stall is acceptable.
    conn.pragma_update(None, "wal_checkpoint", "TRUNCATE")?;
    Ok(())
}
<span class="boring">}</span></code></pre>
<p><strong>Safe checkpoint points</strong> (I/O thread triggers these, never the game thread):</p>
<ul>
<li>Match loading screen (before gameplay starts)</li>
<li>Post-game stats screen (results displayed, no sim running)</li>
<li>Main menu / lobby (no active sim)</li>
<li>Single-player pause menu (sim is frozen â€” user is already waiting)</li>
<li>App exit / minimize / suspend</li>
</ul>
<p><strong>WAL file growth during gameplay:</strong> With autocheckpoint disabled, the WAL grows unbounded during a match. Worst case for a 60-minute match at peak event rates: telemetry.db WAL may reach ~50â€“100 MB, gameplay.db WAL ~20â€“40 MB. On a 4 GB min-spec machine, this is ~2â€“3% of RAM â€” acceptable. The WAL is truncated on the post-game <code>TRUNCATE</code> checkpoint. Players on SSDs experience no difference â€” checkpoint takes &lt;50 ms regardless of timing.</p>
<p><strong>Detection:</strong> The I/O thread queries storage type at startup via Bevyâ€™s platform detection (or heuristic: sequential read bandwidth vs. random IOPS ratio). If HDD is detected (or cannot be determined â€” conservative default), gameplay WAL checkpoint suppression activates automatically. SSD users keep the normal <code>wal_autocheckpoint</code> thresholds. The <code>storage.assume_ssd</code> cvar overrides detection.</p>
<p><strong><code>auto_vacuum</code> â€” only where deletions create waste:</strong></p>
<ul>
<li><code>INCREMENTAL</code> for <code>profile.db</code> (avatar/banner image replacements leave pages of dead BLOB data), <code>workshop/cache.db</code> (mod uninstalls remove metadata rows), and server Workshop (resource unpublish). Incremental mode marks freed pages for reuse without the full-table rewrite cost of <code>FULL</code> auto_vacuum. Reclamation happens via periodic <code>PRAGMA incremental_vacuum(N)</code> calls on background threads.</li>
<li><code>NONE</code> everywhere else. Telemetry uses DELETE-based pruning but full VACUUM is only warranted on export (compaction). Achievements, community credentials, and match history grow monotonically â€” no deletions means no wasted space. Relay match data is append-only.</li>
</ul>
<p><strong><code>busy_timeout</code> â€” preventing SQLITE_BUSY errors:</strong></p>
<ul>
<li>1 second for client <code>telemetry.db</code>: telemetry writes must never cause visible gameplay lag. If the database is locked for over 1 second, something is seriously wrong â€” better to drop the event than stall the game loop.</li>
<li>2 seconds for <code>gameplay.db</code>: UI queries (career stats page) occasionally overlap with background event writes. All <code>gameplay.db</code> writes happen on a dedicated I/O thread (see â€œTransaction batchingâ€ above), so <code>busy_timeout</code> waits occur on the I/O thread â€” never on the game loop thread. 2 seconds is sufficient for typical contention.</li>
<li>5 seconds for server telemetry: high-throughput event recording on servers can create brief WAL contention during checkpoints. Server hardware and dedicated I/O threads make a 5-second timeout acceptable.</li>
<li>10 seconds for server Workshop and Matchmaking: web API requests may queue behind write transactions during peak load. A generous timeout prevents spurious failures.</li>
</ul>
<p><strong><code>temp_store = MEMORY</code> â€” for databases that run complex queries:</strong></p>
<ul>
<li><code>gameplay.db</code>, <code>telemetry.db</code>, Workshop, Matchmaking: complex analytical queries (GROUP BY, ORDER BY, JOIN) may create temporary tables or sort buffers. Storing these in RAM avoids disk I/O overhead for intermediate results.</li>
<li>Profile, achievements, community databases: queries are simple key lookups and small result sets â€” <code>DEFAULT</code> (disk-backed temp) is fine and avoids unnecessary memory pressure.</li>
</ul>
<p><strong><code>foreign_keys = OFF</code> for <code>telemetry.db</code> only:</strong></p>
<ul>
<li>The unified telemetry schema is a single table with no foreign keys. Disabling the pragma avoids the per-statement FK check overhead on every INSERT â€” measurable savings at high event rates.</li>
<li>All other databases have proper FK relationships and enforce them.</li>
</ul>
<h4 id="wasm-platform-adjustments"><a class="header" href="#wasm-platform-adjustments">WASM Platform Adjustments</a></h4>
<p>Browser builds (via <code>sql.js</code> or <code>sqlite-wasm</code> on OPFS) operate under different constraints:</p>
<ul>
<li><strong><code>mmap_size = 0</code></strong> always â€” mmap is not available in WASM environments</li>
<li><strong><code>cache_size</code></strong> reduced by 50% â€” browser memory budgets are tighter</li>
<li><strong><code>synchronous = NORMAL</code></strong> for all databases â€” OPFS provides its own durability guarantees and the browser may not honor fsync semantics</li>
<li><strong><code>wal_autocheckpoint</code></strong> kept at default (1000) â€” OPFS handles sequential I/O differently than native filesystems; large WAL files offer less benefit</li>
</ul>
<p>These adjustments are applied automatically by the <code>DbConfig</code> builder when it detects the WASM target at compile time (<code>#[cfg(target_arch = "wasm32")]</code>).</p>
<h3 id="scaling-path"><a class="header" href="#scaling-path">Scaling Path</a></h3>
<p>SQLite is the default and the right choice for 95% of deployments. For the official infrastructure at high scale, individual services can optionally be configured to use PostgreSQL by swapping the storage backend trait implementation. The schema is designed to be portable (standard SQL, no SQLite-specific syntax). FTS5 is used for full-text search on Workshop and replay catalogs â€” a PostgreSQL backend would substitute <code>tsvector</code>/<code>tsquery</code> for the same queries. This is a future optimization, not a launch requirement.</p>
<p>Each service defines its own storage trait â€” no god-trait mixing unrelated concerns:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Relay server storage â€” match results, desync reports, behavioral profiles.
pub trait RelayStorage: Send + Sync {
    fn store_match_result(&amp;self, result: &amp;CertifiedMatchResult) -&gt; Result&lt;()&gt;;
    fn query_matches(&amp;self, filter: &amp;MatchFilter) -&gt; Result&lt;Vec&lt;MatchRecord&gt;&gt;;
    fn store_desync_report(&amp;self, report: &amp;DesyncReport) -&gt; Result&lt;()&gt;;
    fn update_behavior_profile(&amp;self, player: PlayerId, profile: &amp;BehaviorProfile) -&gt; Result&lt;()&gt;;
}

/// Matchmaking server storage â€” ratings, match history, leaderboards.
pub trait MatchmakingStorage: Send + Sync {
    fn update_rating(&amp;self, player: PlayerId, rating: &amp;Glicko2Rating) -&gt; Result&lt;()&gt;;
    fn leaderboard(&amp;self, scope: &amp;LeaderboardScope, limit: u32) -&gt; Result&lt;Vec&lt;LeaderboardEntry&gt;&gt;;
    fn match_history(&amp;self, player: PlayerId, limit: u32) -&gt; Result&lt;Vec&lt;MatchRecord&gt;&gt;;
}

/// Workshop server storage â€” resource metadata, versions, dependencies, search.
pub trait WorkshopStorage: Send + Sync {
    fn publish_resource(&amp;self, meta: &amp;ResourceMetadata) -&gt; Result&lt;()&gt;;
    fn search(&amp;self, query: &amp;str, filter: &amp;ResourceFilter) -&gt; Result&lt;Vec&lt;ResourceListing&gt;&gt;;
    fn resolve_deps(&amp;self, root: &amp;ResourceId, range: &amp;VersionRange) -&gt; Result&lt;DependencyGraph&gt;;
}

/// SQLite implementation â€” each service gets its own SqliteXxxStorage struct
/// wrapping a rusqlite::Connection (WAL mode, foreign keys on, journal_size_limit set).
/// PostgreSQL implementations are optional, behind `#[cfg(feature = "postgres")]`.
<span class="boring">}</span></code></pre>
<h3 id="alternatives-considered"><a class="header" href="#alternatives-considered">Alternatives Considered</a></h3>
<ul>
<li><strong>JSON / TOML flat files</strong> (rejected â€” no query capability; â€œwhatâ€™s my win rate on this map?â€ requires loading every match file and filtering in code; no indexing, no FTS, no joins; scales poorly past hundreds of records; the userâ€™s data is opaque to external tools unless we also build export scripts)</li>
<li><strong>RocksDB / sled / redb</strong> (rejected â€” key-value stores require application-level query logic for everything; no SQL means no ad-hoc investigation, no external tool compatibility, no community reuse; the data is locked behind IC-specific access patterns)</li>
<li><strong>PostgreSQL as default</strong> (rejected â€” destroys the â€œjust a binaryâ€ deployment model; community relay operators shouldnâ€™t need to install and maintain a database server; adds operational complexity for zero benefit at community scale)</li>
<li><strong>Redis</strong> (rejected â€” in-memory only by default; no persistence guarantees without configuration; no SQL; wrong tool for durable structured records)</li>
<li><strong>Custom binary format</strong> (rejected â€” maximum vendor lock-in; the community canâ€™t build anything on top of it without reverse engineering; contradicts the open-standard philosophy)</li>
<li><strong>No persistent storage; compute everything from replay files</strong> (rejected â€” replays are large, parsing is expensive, and many queries span multiple sessions; pre-computed aggregates in SQLite make career stats and AI adaptation instant)</li>
</ul>
<p><strong>Phase:</strong> SQLite storage for relay and client lands in Phase 2 (replay catalog, save game index, gameplay event log). Workshop server storage lands in Phase 6a (D030). Matchmaking and tournament storage land in Phase 5 (competitive infrastructure). The <code>StorageBackend</code> trait is defined early but PostgreSQL implementation is deferred until scale requires it.</p>
<hr>
<hr>
<h2 id="d035-creator-recognition--attribution"><a class="header" href="#d035-creator-recognition--attribution">D035: Creator Recognition &amp; Attribution</a></h2>
<p><strong>Decision:</strong> The Workshop supports <strong>voluntary creator recognition</strong> through tipping/sponsorship links and reputation badges. Monetization is never mandatory â€” all Workshop resources are freely downloadable. Creators can optionally accept tips and link sponsorship profiles.</p>
<p><strong>Rationale:</strong></p>
<ul>
<li>The C&amp;C modding community has a 30-year culture of free modding. Mandatory paid content would generate massive resistance and fragment multiplayer (canâ€™t join a game if you donâ€™t own a required paid map â€” ArmA DLC demonstrated this problem).</li>
<li>Valveâ€™s Steam Workshop paid mods experiment (Skyrim, 2015) was reversed within days due to community backlash. The 75/25 revenue split (Valve/creator) was seen as exploitative.</li>
<li>Nexus Modsâ€™ Donation Points system is well-received as a voluntary model â€” creators earn money without gating access.</li>
<li>CS:GO/CS2â€™s creator economy ($57M+ paid to creators by 2015) works because itâ€™s cosmetic-only items curated by Valve â€” a fundamentally different model than gating gameplay content.</li>
<li>ArmAâ€™s commissioned mod ecosystem exists in a legal/ethical gray zone with no official framework â€” creators deserve better.</li>
<li>Backend infrastructure (relay servers, Workshop servers, tracking servers) has real hosting costs. Sustainability requires some revenue model.</li>
</ul>
<p><strong>Key Design Elements:</strong></p>
<h3 id="creator-tipping"><a class="header" href="#creator-tipping">Creator Tipping</a></h3>
<ul>
<li><strong>Tip jar on resource pages:</strong> Every Workshop resource page has an optional â€œSupport this creatorâ€ button. Clicking shows the creatorâ€™s configured payment links.</li>
<li><strong>Payment links, not payment processing.</strong> IC does not process payments directly. Creators link their own payment platforms:</li>
</ul>
<pre><code class="language-yaml"># In mod.yaml or creator profile
creator:
  name: "Alice"
  tip_links:
    - platform: "ko-fi"
      url: "https://ko-fi.com/alice"
    - platform: "github-sponsors"
      url: "https://github.com/sponsors/alice"
    - platform: "patreon"
      url: "https://patreon.com/alice"
    - platform: "paypal"
      url: "https://paypal.me/alice"
</code></pre>
<ul>
<li><strong>No IC platform fee on tips.</strong> Tips go directly to creators via their chosen platform. IC takes zero cut.</li>
<li><strong>Aggregate tip link on creator profile:</strong> Creatorâ€™s profile page shows a single â€œSupport Aliceâ€ button linking to their preferred platform.</li>
</ul>
<h3 id="infrastructure-sustainability"><a class="header" href="#infrastructure-sustainability">Infrastructure Sustainability</a></h3>
<p>The Workshop and backend servers have hosting costs. Sustainability options (not mutually exclusive):</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Model</th><th>Description</th><th>Precedent</th></tr>
</thead>
<tbody>
<tr><td><strong>Community donations</strong></td><td>Open Collective / GitHub Sponsors for the project itself</td><td>Godot, Blender, Bevy</td></tr>
<tr><td><strong>Premium hosting tier</strong></td><td>Optional paid tier: priority matchmaking queue, larger replay archive, custom clan pages</td><td>Discord Nitro, private game servers</td></tr>
<tr><td><strong>Sponsored featured slots</strong></td><td>Creators or communities pay to feature resources in the Workshopâ€™s â€œFeaturedâ€ section</td><td>App Store featured placements</td></tr>
<tr><td><strong>White-label licensing</strong></td><td>Tournament organizers or game communities license the engine+infrastructure for their own branded deployments</td><td>Many open-source projects</td></tr>
</tbody>
</table>
</div>
<p><strong>No mandatory paywalls.</strong> The free tier is fully functional â€” all gameplay features, all maps, all mods, all multiplayer. Premium tiers offer convenience and visibility, never exclusive gameplay content.</p>
<p><strong>No loot boxes, no skin gambling, no speculative economy.</strong> CS:GOâ€™s skin economy generated massive revenue but also attracted gambling sites, scams, and regulatory scrutiny. ICâ€™s creator recognition model is direct and transparent.</p>
<h3 id="future-expansion-path"><a class="header" href="#future-expansion-path">Future Expansion Path</a></h3>
<p>The Workshop schema supports monetization metadata from day one, but launches with tips-only:</p>
<pre><code class="language-yaml"># Future schema (not implemented at launch)
mod:
  pricing:
    model: "free"                    # free | tip | paid (paid = future)
    tip_links: [...]                 # voluntary compensation
    # price: "2.99"                  # future: optional price for premium content
    # revenue_split: "70/30"         # future: creator/platform split
</code></pre>
<p>If the community evolves toward wanting paid content (e.g., professional-quality campaign packs), the schema is ready. But this is a community decision, not a launch feature.</p>
<p><strong>Alternatives considered:</strong></p>
<ul>
<li>Mandatory marketplace (Skyrim paid mods disaster â€” community backlash guaranteed)</li>
<li>Revenue share on all downloads (creates perverse incentives, fragments multiplayer)</li>
<li>No monetization at all (unsustainable for infrastructure; undervalues creators)</li>
<li>EA premium content pathway (licensing conflicts with open-source, gives EA control the community should own)</li>
</ul>
<p><strong>Phase:</strong> Phase 6a (integrated with Workshop infrastructure), with creator profile schema defined in Phase 3.</p>
<hr>
<hr>
<h2 id="d036-achievement-system"><a class="header" href="#d036-achievement-system">D036: Achievement System</a></h2>
<p><strong>Decision:</strong> IC includes a <strong>per-game-module achievement system</strong> with built-in and mod-defined achievements, stored locally in SQLite (D034), with optional Workshop sync for community-created achievement packs.</p>
<p><strong>Rationale:</strong></p>
<ul>
<li>Achievements provide progression and engagement outside competitive ranking â€” important for casual players who are the majority of the C&amp;C community</li>
<li>Modern RTS players expect achievement systems (Remastered, SC2, AoE4 all have them)</li>
<li>Mod-defined achievements drive Workshop adoption: a total conversion mod can define its own achievement set, incentivizing players to explore community content</li>
<li>SQLite storage (D034) already handles all persistent client state â€” achievements are another table</li>
</ul>
<p><strong>Key Design Elements:</strong></p>
<h3 id="achievement-categories"><a class="header" href="#achievement-categories">Achievement Categories</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Category</th><th>Examples</th><th>Scope</th></tr>
</thead>
<tbody>
<tr><td><strong>Campaign</strong></td><td>â€œComplete Allied Campaign on Hardâ€, â€œZero casualties in mission 3â€</td><td>Per-game-module, per-campaign</td></tr>
<tr><td><strong>Skirmish</strong></td><td>â€œWin with only infantryâ€, â€œDefeat 3 brutal AIs simultaneouslyâ€</td><td>Per-game-module</td></tr>
<tr><td><strong>Multiplayer</strong></td><td>â€œWin 10 ranked matchesâ€, â€œAchieve 200 APM in a matchâ€</td><td>Per-game-module, per-mode</td></tr>
<tr><td><strong>Exploration</strong></td><td>â€œPlay every official mapâ€, â€œTry all factionsâ€</td><td>Per-game-module</td></tr>
<tr><td><strong>Community</strong></td><td>â€œInstall 5 Workshop modsâ€, â€œRate 10 Workshop resourcesâ€, â€œPublish a resourceâ€</td><td>Cross-module</td></tr>
<tr><td><strong>Mod-defined</strong></td><td>Defined by mod authors in YAML, registered via Workshop</td><td>Per-mod</td></tr>
</tbody>
</table>
</div>
<h3 id="storage-schema-d034"><a class="header" href="#storage-schema-d034">Storage Schema (D034)</a></h3>
<pre><code class="language-sql">CREATE TABLE achievements (
    id              TEXT PRIMARY KEY,     -- "ra1.campaign.allied_hard_complete"
    game_module     TEXT NOT NULL,        -- "ra1", "td", "ra2"
    category        TEXT NOT NULL,        -- "campaign", "skirmish", "multiplayer", "community"
    title           TEXT NOT NULL,
    description     TEXT NOT NULL,
    icon            TEXT,                 -- path to achievement icon asset
    hidden          BOOLEAN DEFAULT 0,    -- hidden until unlocked (surprise achievements)
    source          TEXT NOT NULL         -- "builtin" or workshop resource ID
);

CREATE TABLE achievement_progress (
    achievement_id  TEXT REFERENCES achievements(id),
    unlocked_at     TEXT,                 -- ISO 8601 timestamp, NULL if locked
    progress        INTEGER DEFAULT 0,    -- for multi-step achievements (e.g., "win 10 matches": progress=7)
    target          INTEGER DEFAULT 1,    -- total required for unlock
    PRIMARY KEY (achievement_id)
);
</code></pre>
<h3 id="mod-defined-achievements"><a class="header" href="#mod-defined-achievements">Mod-Defined Achievements</a></h3>
<p>Mod authors define achievements in their <code>mod.yaml</code>, which register when the mod is installed:</p>
<pre><code class="language-yaml"># mod.yaml (achievement definition in a mod)
achievements:
  - id: "my_mod.survive_the_storm"
    title: "Eye of the Storm"
    description: "Survive a blizzard event without losing any buildings"
    category: skirmish
    icon: "assets/achievements/storm.png"
    hidden: false
    trigger: "lua"                     # unlock logic in Lua script
  - id: "my_mod.build_all_units"
    title: "Full Arsenal"
    description: "Build every unit type in a single match"
    category: skirmish
    icon: "assets/achievements/arsenal.png"
    trigger: "lua"
</code></pre>
<p>Lua scripts call <code>Achievement.unlock("my_mod.survive_the_storm")</code> when conditions are met. The achievement API is part of the Lua globals (alongside <code>Actor</code>, <code>Trigger</code>, <code>Map</code>, etc.).</p>
<h3 id="design-constraints"><a class="header" href="#design-constraints">Design Constraints</a></h3>
<ul>
<li><strong>No multiplayer achievements that incentivize griefing.</strong> â€œKill 100 allied unitsâ€ â†’ no. â€œWin 10 team gamesâ€ â†’ yes.</li>
<li><strong>Campaign achievements are deterministic</strong> â€” same inputs, same achievement unlock. Replays can verify achievement legitimacy.</li>
<li><strong>Achievement packs are Workshop resources</strong> â€” community can create themed achievement collections (e.g., â€œSpeedrun Challengesâ€, â€œPacifist Runâ€).</li>
<li><strong>Mod achievements are sandboxed to their mod.</strong> Uninstalling a mod hides its achievements (progress preserved, shown as â€œmod not installedâ€).</li>
<li><strong>Steam achievements sync</strong> (Steam builds only) â€” built-in achievements map to Steam achievement API. Mod-defined achievements are IC-only.</li>
</ul>
<p><strong>Alternatives considered:</strong></p>
<ul>
<li>Steam achievements only (excludes non-Steam players, canâ€™t support mod-defined achievements)</li>
<li>No achievement system (misses engagement opportunity, feels incomplete vs modern RTS competitors)</li>
<li>Blockchain-verified achievements (needless complexity, community hostility toward crypto/blockchain in games)</li>
</ul>
<p><strong>Phase:</strong> Phase 3 (built-in achievement infrastructure + campaign achievements), Phase 6b (mod-defined achievements via Workshop).</p>
<hr>
<hr>
<h2 id="d037-community-governance--platform-stewardship"><a class="header" href="#d037-community-governance--platform-stewardship">D037: Community Governance &amp; Platform Stewardship</a></h2>
<p><strong>Decision:</strong> ICâ€™s community infrastructure (Workshop, tracking servers, competitive systems) operates under a <strong>transparent governance model</strong> with community representation, clear policies, and distributed authority.</p>
<p><strong>Rationale:</strong></p>
<ul>
<li>OpenRAâ€™s community fragmented partly because governance was opaque â€” balance changes and feature decisions were made by a small core team without structured community input, leading to the â€œOpenRA isnâ€™t RA1â€ sentiment</li>
<li>ArmAâ€™s Workshop moderation is perceived as inconsistent â€” some IP holders get mods removed, others donâ€™t, with no clear published policy</li>
<li>CNCnet succeeds partly because itâ€™s community-run with clear ownership</li>
<li>The Workshop (D030) and competitive systems create platform responsibilities: content moderation, balance curation, server uptime, dispute resolution. These need defined ownership.</li>
<li>Self-hosting is a first-class use case (D030 federation) â€” governance must work even when the official infrastructure is one of many</li>
</ul>
<p><strong>Key Design Elements:</strong></p>
<h3 id="governance-structure"><a class="header" href="#governance-structure">Governance Structure</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Role</th><th>Responsibility</th><th>Selection</th></tr>
</thead>
<tbody>
<tr><td><strong>Project maintainer(s)</strong></td><td>Engine code, architecture decisions, release schedule</td><td>Existing (repository owners)</td></tr>
<tr><td><strong>Workshop moderators</strong></td><td>Content moderation, DMCA processing, policy enforcement</td><td>Appointed by maintainers, community nominations</td></tr>
<tr><td><strong>Competitive committee</strong></td><td>Ranked map pool, balance preset curation, tournament rules</td><td>Elected by active ranked players (annual)</td></tr>
<tr><td><strong>Game module stewards</strong></td><td>Per-module balance/content decisions (RA1 steward, TD steward, etc.)</td><td>Appointed by maintainers based on community contributions</td></tr>
<tr><td><strong>Community representatives</strong></td><td>Advocate for community needs, surface pain points, vote on pending decisions</td><td>Elected by community (annual), at least one per major region</td></tr>
</tbody>
</table>
</div>
<h3 id="transparency-commitments"><a class="header" href="#transparency-commitments">Transparency Commitments</a></h3>
<ul>
<li><strong>Public decision log</strong> (this document) for all architectural and policy decisions</li>
<li><strong>Monthly community reports</strong> for Workshop statistics (uploads, downloads, moderation actions, takedowns)</li>
<li><strong>Open moderation log</strong> for Workshop takedown actions (stripped of personal details) â€” the community can see what was removed and why</li>
<li><strong>RFC process for major changes:</strong> Balance preset modifications, Workshop policy changes, and competitive rule changes go through a public comment period before adoption</li>
<li><strong>Community surveys</strong> before major decisions that affect gameplay experience (annually at minimum)</li>
</ul>
<h3 id="self-hosting-independence"><a class="header" href="#self-hosting-independence">Self-Hosting Independence</a></h3>
<p>The governance model explicitly supports community independence:</p>
<ul>
<li>Any community can host their own Workshop server, tracking server, and relay server</li>
<li>Federation (D030) means community servers are peers, not subordinates to the official infrastructure</li>
<li>If the official project becomes inactive, the community has all the tools, source code, and infrastructure to continue independently</li>
<li>Community-hosted servers set their own moderation policies (within the framework of clear minimum standards for federated discovery)</li>
</ul>
<h3 id="community-groups"><a class="header" href="#community-groups">Community Groups</a></h3>
<p><strong>Lesson from ArmA/OFP:</strong> The ArmA communityâ€™s longevity (25+ years) owes much to its clan/unit culture â€” persistent groups with shared mod lists, server configurations, and identity. IC supports this natively rather than leaving it to Discord servers and spreadsheets.</p>
<p>Community groups are lightweight persistent entities in the Workshop/tracking infrastructure:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><strong>Group identity</strong></td><td>Name, tag, icon, description â€” displayed in lobby and in-game alongside player names</td></tr>
<tr><td><strong>Shared mod list</strong></td><td>Group-curated list of Workshop resources. Members click â€œSyncâ€ to install the groupâ€™s mod configuration.</td></tr>
<tr><td><strong>Shared server list</strong></td><td>Preferred relay/tracking servers. Members auto-connect to the groupâ€™s servers.</td></tr>
<tr><td><strong>Group achievements</strong></td><td>Community achievements (D036) scoped to group activities â€” â€œPlay 50 matches with your groupâ€</td></tr>
<tr><td><strong>Private lobbies</strong></td><td>Group members can create password-free lobbies visible only to other members</td></tr>
</tbody>
</table>
</div>
<p>Groups are <strong>not</strong> competitive clans (no group rankings, no group matchmaking). They are social infrastructure â€” a way for communities of players to share configurations and find each other. Competitive team features (team ratings, team matchmaking) are separate and independent.</p>
<p><strong>Storage:</strong> Group metadata stored in SQLite (D034) on the tracking/Workshop server. Groups are federated â€” a group created on a community tracking server is visible to members who have that server in their <code>settings.toml</code> sources list. No central authority over group creation.</p>
<p><strong>Phase:</strong> Phase 5 (alongside multiplayer infrastructure). Minimal viable implementation: group identity + shared mod list + private lobbies. Group achievements and server lists in Phase 6a.</p>
<h3 id="community-knowledge-base"><a class="header" href="#community-knowledge-base">Community Knowledge Base</a></h3>
<p><strong>Lesson from ArmA/OFP:</strong> ArmAâ€™s community wiki (Community Wiki â€” formerly BI Wiki) is one of the most comprehensive game modding references ever assembled, entirely community-maintained. OpenRA has scattered documentation across GitHub wiki pages, the OpenRA book, mod docs, and third-party tutorials â€” no single authoritative reference.</p>
<p>IC ships a structured knowledge base alongside the Workshop:</p>
<ul>
<li><strong>Engine wiki</strong> â€” community-editable documentation for engine features, YAML schema reference, Lua API reference, WASM host functions. Seeded with auto-generated content from the typed schema (every YAML field and Lua global gets a stub page).</li>
<li><strong>Modding tutorials</strong> â€” structured guides from â€œfirst YAML changeâ€ through â€œWASM total conversion.â€ Community members can submit and edit tutorials.</li>
<li><strong>Map-making guides</strong> â€” scenario editor documentation with annotated examples.</li>
<li><strong>Community cookbook</strong> â€” recipe-style pages: â€œHow to add a new unit type,â€ â€œHow to create a branching campaign,â€ â€œHow to publish a resource pack.â€ Short, copy-pasteable, maintained by the community.</li>
</ul>
<p><strong>Implementation:</strong> The knowledge base is a static site (mdbook or similar) with source in a public git repository. Community contributions via pull requests â€” same workflow as code contributions. Auto-generated API reference pages are rebuilt on each engine release. The in-game help system links to knowledge base pages contextually (e.g., the scenario editorâ€™s trigger panel links to the triggers documentation).</p>
<p><strong>Not a forum.</strong> The knowledge base is reference documentation, not discussion. Community discussion happens on whatever platforms the community chooses (Discord, forums, etc.). IC provides infrastructure for shared knowledge, not social interaction beyond Community Groups.</p>
<p><strong>Phase:</strong> Phase 4 (auto-generated API reference from Lua/YAML schema). Phase 6a (community-editable tutorials, cookbook). Seeded by the project maintainer during development â€” the design docs themselves are the initial knowledge base.</p>
<h3 id="creator-content-program"><a class="header" href="#creator-content-program">Creator Content Program</a></h3>
<p><strong>Lesson from ArmA/OFP:</strong> Bohemia Interactiveâ€™s Creator DLC program (launched 2019) showed that a structured quality ladder â€” from hobbyist to featured to commercially published â€” works when the criteria are transparent and the community governs curation. The program produced professional-quality content (Global Mobilization, S.O.G. Prairie Fire, CSLA Iron Curtain) while keeping the free modding ecosystem healthy.</p>
<p>IC adapts this concept within D035â€™s voluntary framework (no mandatory paywalls, no IC platform fee):</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tier</th><th>Criteria</th><th>Recognition</th></tr>
</thead>
<tbody>
<tr><td><strong>Published</strong></td><td>Meets Workshop minimum standards (valid metadata, license declared, no malware)</td><td>Listed in Workshop, available for search and dependency</td></tr>
<tr><td><strong>Reviewed</strong></td><td>Passes community review (2+ moderator approvals for quality, completeness, documentation)</td><td>â€œReviewedâ€ badge on Workshop page, eligible for â€œStaff Picksâ€ featured section</td></tr>
<tr><td><strong>Featured</strong></td><td>Selected by Workshop moderators or competitive committee for exceptional quality</td><td>Promoted in Workshop â€œFeaturedâ€ section, highlighted in in-game browser, included in starter packs</td></tr>
<tr><td><strong>Spotlighted</strong></td><td>Seasonal showcase â€” community-voted â€œbest ofâ€ for maps, mods, campaigns, and assets</td><td>Front-page placement, social media promotion, creator interview/spotlight</td></tr>
</tbody>
</table>
</div>
<p><strong>Key differences from Bohemiaâ€™s Creator DLC:</strong></p>
<ul>
<li><strong>No paid tier at launch.</strong> All tiers are free. D035â€™s future <code>paid</code> pricing model is available if the community evolves toward it, but the quality ladder operates independently of monetization.</li>
<li><strong>Community curation, not publisher curation.</strong> Workshop moderators and the competitive committee (both community roles) make tier decisions, not the project maintainer.</li>
<li><strong>Transparent criteria.</strong> Published criteria for each tier â€” creators know exactly whatâ€™s needed to reach â€œReviewedâ€ or â€œFeaturedâ€ status.</li>
<li><strong>No exclusive distribution.</strong> Featured content is Workshop content â€” it can be forked, depended on, and mirrored. No lock-in.</li>
</ul>
<p>The Creator Content Program is a recognition and quality signal system, not a gatekeeping mechanism. The Workshop remains open to all â€” tiers help players find high-quality content, not restrict who can publish.</p>
<p><strong>Phase:</strong> Phase 6a (integrated with Workshop moderator role from D037 governance structure). â€œPublishedâ€ tier is automatic from Workshop launch (Phase 4â€“5). â€œReviewedâ€ and â€œFeaturedâ€ require active moderators.</p>
<h3 id="code-of-conduct"><a class="header" href="#code-of-conduct">Code of Conduct</a></h3>
<p>Standard open-source code of conduct (Contributor Covenant or similar) applies to:</p>
<ul>
<li>Workshop resource descriptions and reviews</li>
<li>In-game chat (client-side filtering, not server enforcement for non-ranked games)</li>
<li>Competitive play (ranked games: stricter enforcement, report system, temporary bans for verified toxicity)</li>
<li>Community forums and communication channels</li>
</ul>
<p><strong>Alternatives considered:</strong></p>
<ul>
<li>BDFL (Benevolent Dictator for Life) model with no community input (faster decisions but risks OpenRAâ€™s fate â€” community alienation)</li>
<li>Full democracy (too slow for a game project; bikeshedding on every decision)</li>
<li>Corporate governance (inappropriate for an open-source community project)</li>
<li>No formal governance (works early, creates problems at scale â€” better to define structure before itâ€™s needed)</li>
</ul>
<p><strong>Phase:</strong> Phase 0 (code of conduct, contribution guidelines), Phase 5 (competitive committee), Phase 7 (Workshop moderators, community representatives).</p>
<blockquote>
<p><strong>Phasing note:</strong> This governance model is aspirational â€” it describes where the project aims to be at scale, not what launches on day one. At project start, governance is BDFL (maintainer) + trusted contributors, which is appropriate for a project with zero users. Formal elections, committees, and community representatives should not be implemented until there is an active community of 50+ regular contributors. The governance structure documented here is a roadmap, not a launch requirement. Premature formalization risks creating bureaucracy before there are people to govern.</p>
</blockquote>
<hr>
<hr>
<h2 id="d046-community-platform--premium-content--comprehensive-platform-integration"><a class="header" href="#d046-community-platform--premium-content--comprehensive-platform-integration">D046: Community Platform â€” Premium Content &amp; Comprehensive Platform Integration</a></h2>
<p><strong>Status:</strong> Accepted
<strong>Scope:</strong> <code>ic-game</code>, <code>ic-ui</code>, Workshop infrastructure, platform SDK integration
<strong>Phase:</strong> Platform integration: Phase 5. Premium content framework: Phase 6a+.</p>
<h3 id="context"><a class="header" href="#context">Context</a></h3>
<p>D030 designs the Workshop resource registry including Steam Workshop as a source type. D035 designs voluntary creator tipping with explicit rejection of mandatory paid content. D036 designs the achievement system including Steam achievement sync. These decisions remain valid â€” D046 extends them in two directions that were previously out of scope:</p>
<ol>
<li><strong>Premium content from official publishers</strong> â€” allowing companies like EA to offer premium content (e.g., Remastered-quality art packs, soundtrack packs) through the Workshop, with proper licensing and revenue</li>
<li><strong>Comprehensive platform integration</strong> â€” going beyond â€œSteam Workshop as a sourceâ€ to full Steam platform compatibility (and other platforms: GOG, Epic, etc.)</li>
</ol>
<h3 id="decision"><a class="header" href="#decision">Decision</a></h3>
<p>Extend the Workshop and platform layer to support <em>optional paid content from verified publishers</em> alongside the existing free ecosystem, and provide comprehensive platform service integration beyond just Workshop.</p>
<h3 id="premium-content-framework"><a class="header" href="#premium-content-framework">Premium Content Framework</a></h3>
<p><strong>Who can sell:</strong> Only <strong>verified publishers</strong> â€” entities that have passed identity verification and (for copyrighted IP) provided proof of rights. This is NOT a general marketplace where any modder can charge money. The tipping model (D035) remains the primary creator recognition system.</p>
<p><strong>Use cases:</strong></p>
<ul>
<li>EA publishes Remastered Collection art assets (high-resolution sprites, remastered audio) as a premium resource pack. Players who own the Remastered Collection on Steam get it bundled; others can purchase separately.</li>
<li>Professional content studios publish high-quality campaign packs, voice acting, or soundtrack packs.</li>
<li>Tournament organizers sell premium cosmetic packs for event fundraising.</li>
</ul>
<p><strong>What premium content CANNOT be:</strong></p>
<ul>
<li><strong>Gameplay-affecting.</strong> No paid units, weapons, factions, or balance-changing content. Premium content is cosmetic or supplementary: art packs, soundtrack packs, voice packs, campaign packs (story content, not gameplay advantages).</li>
<li><strong>Required for multiplayer.</strong> No player can be excluded from a game because they donâ€™t own a premium pack. If a premium art pack is active, non-owners see the default sprites â€” never a â€œbuy to playâ€ gate.</li>
<li><strong>Exclusive to one platform.</strong> Premium content purchased through any platform is accessible from all platforms (subject to platform holder agreements).</li>
</ul>
<pre><code class="language-yaml"># Workshop resource metadata extension for premium content
resource:
  name: "Remastered Art Pack"
  publisher:
    name: "Electronic Arts"
    verified: true
    publisher_id: "ea-official"
  pricing:
    model: premium                    # free | tip | premium
    price_usd: "4.99"                # publisher sets price
    bundled_with:                     # auto-granted if player owns:
      - platform: steam
        app_id: 1213210              # C&amp;C Remastered Collection
    revenue_split:
      platform_store: 30             # Steam/GOG/Epic standard store cut (from gross)
      ic_project: 10                 # IC Workshop hosting fee (from gross)
      publisher: 60                  # remainder to publisher
  content_type: cosmetic             # cosmetic | supplementary | campaign
  requires_base_game: true
  multiplayer_fallback: default      # non-owners see default assets
</code></pre>
<h3 id="comprehensive-platform-integration"><a class="header" href="#comprehensive-platform-integration">Comprehensive Platform Integration</a></h3>
<p>Beyond Workshop, IC integrates with platform services holistically:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Platform Service</th><th>Steam</th><th>GOG Galaxy</th><th>Epic</th><th>Standalone</th></tr>
</thead>
<tbody>
<tr><td><strong>Achievements</strong></td><td>Full sync (D036)</td><td>GOG achievement sync</td><td>Epic achievement sync</td><td>IC-only achievements (SQLite)</td></tr>
<tr><td><strong>Friends &amp; Presence</strong></td><td>Steam friends list, rich presence</td><td>GOG friends, presence</td><td>Epic friends, presence</td><td>IC account friends (future)</td></tr>
<tr><td><strong>Overlay</strong></td><td>Steam overlay (shift+tab)</td><td>GOG overlay</td><td>Epic overlay</td><td>None</td></tr>
<tr><td><strong>Matchmaking invite</strong></td><td>Steam invite â†’ lobby join</td><td>GOG invite â†’ lobby join</td><td>Epic invite â†’ lobby join</td><td>Join code / direct IP</td></tr>
<tr><td><strong>Cloud saves</strong></td><td>Steam Cloud for save games</td><td>GOG Cloud for save games</td><td>Epic Cloud for save games</td><td>Local saves (export/import)</td></tr>
<tr><td><strong>Workshop</strong></td><td>Steam Workshop as source (D030)</td><td>GOG Workshop (if supported)</td><td>N/A</td><td>IC Workshop (always available)</td></tr>
<tr><td><strong>DRM</strong></td><td><strong>None.</strong> IC is DRM-free always.</td><td>DRM-free</td><td>DRM-free</td><td>DRM-free</td></tr>
<tr><td><strong>Premium purchases</strong></td><td>Steam Commerce</td><td>GOG store</td><td>Epic store</td><td>IC direct purchase (future)</td></tr>
<tr><td><strong>Leaderboards</strong></td><td>Steam leaderboards + IC leaderboards</td><td>IC leaderboards</td><td>IC leaderboards</td><td>IC leaderboards</td></tr>
<tr><td><strong>Multiplayer</strong></td><td>IC netcode (all platforms together)</td><td>IC netcode</td><td>IC netcode</td><td>IC netcode</td></tr>
</tbody>
</table>
</div>
<p><strong>Critical principle: All platforms play together.</strong> ICâ€™s multiplayer is platform-agnostic (IC relay servers, D007). A Steam player, a GOG player, and a standalone player can all join the same lobby. Platform services (friends, invites, overlay) are convenience features â€” never multiplayer gates.</p>
<h3 id="platform-abstraction-layer"><a class="header" href="#platform-abstraction-layer">Platform Abstraction Layer</a></h3>
<p>The <code>PlatformServices</code> trait is defined in <code>ic-ui</code> (where platform-aware UI â€” friends list, invite buttons, achievement popups â€” lives). Concrete implementations (<code>SteamPlatform</code>, <code>GogPlatform</code>, <code>StandalonePlatform</code>) live in <code>ic-game</code> and are injected as a Bevy resource at startup. <code>ic-ui</code> accesses the trait via <code>Res&lt;dyn PlatformServices&gt;</code>.</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Engine-side abstraction over platform services.
/// Defined in ic-ui; implementations in ic-game, injected as Bevy resource.
pub trait PlatformServices: Send + Sync {
    /// Sync an achievement unlock to the platform
    fn unlock_achievement(&amp;self, id: &amp;str) -&gt; Result&lt;(), PlatformError&gt;;

    /// Set rich presence status
    fn set_presence(&amp;self, status: &amp;str, details: &amp;PresenceDetails) -&gt; Result&lt;(), PlatformError&gt;;

    /// Get friends list (for invite UI)
    fn friends_list(&amp;self) -&gt; Result&lt;Vec&lt;PlatformFriend&gt;, PlatformError&gt;;

    /// Invite a friend to the current lobby
    fn invite_friend(&amp;self, friend: &amp;PlatformFriend) -&gt; Result&lt;(), PlatformError&gt;;

    /// Upload save to cloud storage
    fn cloud_save(&amp;self, slot: &amp;str, data: &amp;[u8]) -&gt; Result&lt;(), PlatformError&gt;;

    /// Download save from cloud storage
    fn cloud_load(&amp;self, slot: &amp;str) -&gt; Result&lt;Vec&lt;u8&gt;, PlatformError&gt;;

    /// Platform display name
    fn platform_name(&amp;self) -&gt; &amp;str;
}
<span class="boring">}</span></code></pre>
<p>Implementations: <code>SteamPlatform</code> (via Steamworks SDK), <code>GogPlatform</code> (via GOG Galaxy SDK), <code>StandalonePlatform</code> (no-op or IC-native services).</p>
<h3 id="monetization-model-for-backend-services"><a class="header" href="#monetization-model-for-backend-services">Monetization Model for Backend Services</a></h3>
<p>D035 established that IC infrastructure has real hosting costs. D046 formalizes the backend monetization model:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Revenue Source</th><th>Description</th><th>D035 Alignment</th></tr>
</thead>
<tbody>
<tr><td><strong>Community donations</strong></td><td>Open Collective, GitHub Sponsors â€” existing model</td><td>âœ“ unchanged</td></tr>
<tr><td><strong>Premium relay tier</strong></td><td>Optional paid tier: priority queue, larger replay archive, custom clan pages</td><td>âœ“ D035</td></tr>
<tr><td><strong>Verified publisher fees</strong></td><td>Publishers pay a listing fee + revenue share for premium Workshop content</td><td>NEW â€” extends D035</td></tr>
<tr><td><strong>Sponsored featured slots</strong></td><td>Workshop featured section for promoted resources</td><td>âœ“ D035</td></tr>
<tr><td><strong>Platform store revenue share</strong></td><td>Steam/GOG/Epic take their standard cut on premium purchases made through their stores</td><td>NEW â€” platform standard</td></tr>
</tbody>
</table>
</div>
<p><strong>Free tier is always fully functional.</strong> Premium content is cosmetic/supplementary. Backend monetization sustainably funds relay servers, tracking servers, and Workshop infrastructure without gating gameplay.</p>
<h3 id="relationship-to-existing-decisions"><a class="header" href="#relationship-to-existing-decisions">Relationship to Existing Decisions</a></h3>
<ul>
<li><strong>D030 (Workshop):</strong> D046 extends D030â€™s schema with <code>pricing.model: premium</code> and <code>publisher.verified: true</code>. The Workshop architecture (federated, multi-source) supports premium content as another resource type.</li>
<li><strong>D035 (Creator recognition):</strong> D046 does NOT replace tipping. Individual modders use tips (D035). Verified publishers use premium pricing (D046). Both coexist â€” a modder can publish free mods with tip links AND work for a publisher that sells premium packs.</li>
<li><strong>D036 (Achievements):</strong> D046 formalizes the multi-platform achievement sync that D036 mentioned briefly (â€œSteam achievements sync for Steam buildsâ€).</li>
<li><strong>D037 (Governance):</strong> Premium content moderation, verified publisher approval, and revenue-related disputes fall under community governance (D037).</li>
</ul>
<h3 id="alternatives-considered-1"><a class="header" href="#alternatives-considered-1">Alternatives Considered</a></h3>
<ul>
<li>No premium content ever (rejected â€” leaves money on the table for both the project and legitimate IP holders like EA; the Remastered art pack use case is too valuable)</li>
<li>Open marketplace for all creators (rejected â€” Skyrim paid mods disaster; tips-only for individual creators, premium only for verified publishers)</li>
<li>Platform-exclusive content (rejected â€” violates cross-platform play principle)</li>
<li>IC processes all payments directly (rejected â€” regulatory burden, payment processing complexity; delegate to platform stores and existing payment processors)</li>
</ul>
<hr>
<hr>
<h2 id="d049-workshop-asset-formats--distribution--bevy-native-canonical-p2p-delivery"><a class="header" href="#d049-workshop-asset-formats--distribution--bevy-native-canonical-p2p-delivery">D049: Workshop Asset Formats &amp; Distribution â€” Bevy-Native Canonical, P2P Delivery</a></h2>
<h3 id="decision-capsule-llmrag-summary-2"><a class="header" href="#decision-capsule-llmrag-summary-2">Decision Capsule (LLM/RAG Summary)</a></h3>
<ul>
<li><strong>Status:</strong> Accepted</li>
<li><strong>Phase:</strong> Multi-phase (Workshop foundation + distribution + package tooling)</li>
<li><strong>Canonical for:</strong> Workshop canonical asset format recommendations and P2P package distribution strategy</li>
<li><strong>Scope:</strong> Workshop package format/distribution, client download/install pipeline, format recommendations for IC modules, HTTP fallback behavior</li>
<li><strong>Decision:</strong> The Workshop recommends <strong>modern Bevy-native formats</strong> (OGG/PNG/WAV/WebM/KTX2/GLTF) as canonical for new content while fully supporting legacy C&amp;C formats for compatibility; package delivery uses <strong>P2P (BitTorrent/WebTorrent) with HTTP fallback</strong>.</li>
<li><strong>Why:</strong> Lower hosting cost, better Bevy integration/tooling, safer/more mature parsers for untrusted content, and lower friction for new creators using standard tools.</li>
<li><strong>Non-goals:</strong> Dropping legacy C&amp;C format support; making Workshop format choices universal for all future engines/projects consuming the Workshop core library.</li>
<li><strong>Invariants preserved:</strong> Full resource compatibility for existing C&amp;C assets remains intact; Workshop protocol/package concepts are separable from IC-specific format preferences (D050).</li>
<li><strong>Defaults / UX behavior:</strong> New content creators are guided toward modern formats; legacy assets still load and publish without forced conversion.</li>
<li><strong>Compatibility / Export impact:</strong> Legacy formats remain important for OpenRA/RA1 workflows and D040 conversion pipelines; canonical Workshop recommendations do not invalidate export targets.</li>
<li><strong>Security / Trust impact:</strong> Preference for widely audited decoders is an explicit defense-in-depth choice for untrusted Workshop content.</li>
<li><strong>Performance / Ops impact:</strong> P2P delivery reduces CDN cost and scales community distribution; modern formats integrate better with Bevy runtime loading paths.</li>
<li><strong>Public interfaces / types / commands:</strong> <code>.icpkg</code> (IC-specific package wrapper), Workshop P2P/HTTP delivery strategy, <code>ic mod build/publish</code> workflow (as referenced across modding docs)</li>
<li><strong>Affected docs:</strong> <code>src/04-MODDING.md</code>, <code>src/05-FORMATS.md</code>, <code>src/decisions/09c-modding.md</code>, <code>src/decisions/09f-tools.md</code></li>
<li><strong>Revision note summary:</strong> None</li>
<li><strong>Keywords:</strong> workshop formats, p2p delivery, bittorrent, webtorrent, bevy-native assets, png ogg webm, legacy c&amp;c compatibility, icpkg</li>
</ul>
<p><strong>Decision:</strong> The Workshopâ€™s canonical asset formats are <strong>Bevy-native modern formats</strong> (OGG, PNG, WAV, WebM, KTX2, GLTF). C&amp;C legacy formats (.aud, .shp, .pal, .vqa, .mix) are fully supported for backward compatibility but are not the recommended distribution format for new content. Workshop delivery uses <strong>peer-to-peer distribution</strong> (BitTorrent/WebTorrent protocol) with HTTP fallback, reducing hosting costs from CDN-level to a lightweight tracker.</p>
<blockquote>
<p><strong>Note (D050):</strong> The format recommendations in this section are <strong>IC-specific</strong> â€” they reflect Bevyâ€™s built-in asset pipeline. The Workshopâ€™s P2P distribution protocol and package format are engine-agnostic (see D050). Future projects consuming the Workshop core library will define their own format recommendations based on their engineâ€™s capabilities. The <code>.icpkg</code> extension, <code>ic mod</code> CLI commands, and <code>game_module</code> manifest fields are likewise IC-specific â€” the Workshop core library uses configurable equivalents.</p>
</blockquote>
<h3 id="the-format-problem"><a class="header" href="#the-format-problem">The Format Problem</a></h3>
<p>The engine serves two audiences with conflicting format needs:</p>
<ol>
<li><strong>Legacy community:</strong> Thousands of existing .shp, .aud, .mix, .pal assets. OpenRA mods. Original game files. These must load.</li>
<li><strong>New content creators:</strong> Making sprites in Aseprite/Photoshop, recording audio in Audacity/Reaper, editing video in DaVinci Resolve. These tools export PNG, OGG, WAV, WebM â€” not .shp or .aud.</li>
</ol>
<p>Forcing new creators to encode into C&amp;C formats creates unnecessary friction. Forcing legacy content through format converters before it can load breaks the â€œcommunityâ€™s existing work is sacredâ€ invariant. The answer is: <strong>accept both, recommend modern.</strong></p>
<h3 id="canonical-format-recommendations"><a class="header" href="#canonical-format-recommendations">Canonical Format Recommendations</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Asset Type</th><th>Workshop Format (new content)</th><th>Legacy Support (existing)</th><th>Runtime Decode</th><th>Rationale</th></tr>
</thead>
<tbody>
<tr><td><strong>Music</strong></td><td>OGG Vorbis (128â€“320kbps)</td><td>.aud (ra-formats decode)</td><td>PCM via rodio</td><td>Bevy default feature, excellent quality/size ratio, open/patent-free, WASM-safe. OGG at 192kbps â‰ˆ 1.4MB/min vs .aud at ~0.5MB/min but dramatically higher quality (stereo, 44.1kHz vs mono 22kHz)</td></tr>
<tr><td><strong>SFX</strong></td><td>WAV (16-bit PCM) or OGG</td><td>.aud (ra-formats decode)</td><td>PCM via rodio</td><td>WAV = zero decode latency for gameplay-critical sounds (weapon fire, explosions). OGG for larger ambient/UI sounds where decode latency is acceptable</td></tr>
<tr><td><strong>Voice</strong></td><td>OGG Vorbis (96â€“128kbps)</td><td>.aud (ra-formats decode)</td><td>PCM via rodio</td><td>Speech compresses well. OGG at 96kbps is transparent for voice. EVA packs with 200+ lines stay under 30MB</td></tr>
<tr><td><strong>Sprites</strong></td><td>PNG (RGBA, indexed, or truecolor)</td><td>.shp+.pal (ra-formats)</td><td>GPU texture via Bevy</td><td>Bevy-native via <code>image</code> crate. Lossless. Every art tool exports it. Palette-indexed PNG preserves classic aesthetic. HD packs use truecolor RGBA</td></tr>
<tr><td><strong>HD Textures</strong></td><td>KTX2 (GPU-compressed: BC7/ASTC)</td><td>N/A</td><td>Zero-cost GPU upload</td><td>Bevy-native. No decode â€” GPU reads directly. Best runtime performance. <code>ic mod build</code> can batch-convert PNGâ†’KTX2 for release builds</td></tr>
<tr><td><strong>Terrain</strong></td><td>PNG tiles (indexed or RGBA)</td><td>.tmp+.pal (ra-formats)</td><td>GPU texture</td><td>Same as sprites. Theater tilesets are sprite sheets</td></tr>
<tr><td><strong>Cutscenes</strong></td><td>WebM (VP9, 720pâ€“1080p)</td><td>.vqa (ra-formats decode)</td><td>Frameâ†’texture (custom)</td><td>Open, royalty-free, browser-compatible (WASM target). VP9 achieves ~5MB/min at 720p. Neither WebM nor VQA is Bevy-native â€” both need custom decode, so no advantage to VQA here</td></tr>
<tr><td><strong>3D Models</strong></td><td>GLTF/GLB</td><td>N/A (future: .vxl)</td><td>Bevy mesh</td><td>Bevyâ€™s native 3D format. Community 3D mods (D048) use this</td></tr>
<tr><td><strong>Palettes</strong></td><td>.pal (768 bytes) or PNG strip</td><td>.pal (ra-formats)</td><td>Palette texture</td><td>.pal is already tiny and universal in the C&amp;C community. No reason to change. PNG strip is an alternative for tools that donâ€™t understand .pal</td></tr>
<tr><td><strong>Maps</strong></td><td>IC YAML (native)</td><td>.oramap (ZIP+MiniYAML)</td><td>ECS world state</td><td>Already designed (D025, D026)</td></tr>
</tbody>
</table>
</div>
<h3 id="why-modern-formats-as-default"><a class="header" href="#why-modern-formats-as-default">Why Modern Formats as Default</a></h3>
<p><strong>Bevy integration:</strong> OGG, WAV, PNG, KTX2, and GLTF load through Bevyâ€™s built-in asset pipeline with zero custom code. Every Bevy feature â€” hot-reload, asset dependencies, async loading, platform abstraction â€” works automatically. C&amp;C formats require custom <code>AssetLoader</code> implementations in ra-formats with manual integration into Bevyâ€™s pipeline.</p>
<p><strong>Security:</strong> OGG (lewton/rodio), PNG (image crate), and WebM decoders in the Rust ecosystem have been fuzz-tested and used in production by thousands of projects. Browser vendors (Chrome, Firefox, Safari) have security-audited these formats for decades. Our .aud/.shp/.vqa parsers in ra-formats are custom code that has never been independently security-audited. For Workshop content downloaded from untrusted sources, mature parsers with established security track records are strictly safer. C&amp;C format parsers use <code>BoundedReader</code> (see <code>06-SECURITY.md</code>), but defense in depth favors formats with deeper audit history.</p>
<p><strong>Multi-game:</strong> Non-C&amp;C game modules (D039) wonâ€™t use .shp or .aud at all. A tower defense mod, a naval RTS, a Dune-inspired game â€” these ship PNG sprites and OGG audio. The Workshop serves all game modules, not just the C&amp;C family.</p>
<p><strong>Tooling:</strong> Every image editor saves PNG. Every DAW exports WAV/OGG. Every video editor exports WebM/MP4. Nobodyâ€™s toolchain outputs .aud or .shp. Requiring C&amp;C formats forces creators through a conversion step before they can publish â€” unnecessary friction.</p>
<p><strong>WASM/browser:</strong> OGG and PNG work in Bevyâ€™s WASM builds out of the box. C&amp;C formats need custom WASM decoders compiled into the browser bundle.</p>
<p><strong>Storage efficiency comparison:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Content</th><th>C&amp;C Format</th><th>Modern Format</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td>3min music track</td><td>.aud: ~1.5MB (22kHz mono ADPCM)</td><td>OGG: ~2.8MB (44.1kHz stereo 128kbps)</td><td>OGG is 2Ã— larger but dramatically higher quality. At mono 22kHz OGG: ~0.7MB</td></tr>
<tr><td>Full soundtrack (30 tracks)</td><td>.aud: ~45MB</td><td>OGG 128kbps: ~84MB</td><td>Acceptable for modern bandwidth/storage</td></tr>
<tr><td>Unit sprite sheet (200 frames)</td><td>.shp+.pal: ~50KB</td><td>PNG indexed: ~80KB</td><td>PNG slightly larger but universal tooling</td></tr>
<tr><td>HD sprite sheet (200 frames)</td><td>N/A (.shp canâ€™t do HD)</td><td>PNG RGBA: ~500KB</td><td>Only modern format option for HD content</td></tr>
<tr><td>3min cutscene (720p)</td><td>.vqa: ~15MB</td><td>WebM VP9: ~15MB</td><td>Comparable. WebM quality is higher at same bitrate</td></tr>
</tbody>
</table>
</div>
<p>Modern formats are somewhat larger for legacy-quality content but the difference is small relative to modern storage and bandwidth. For HD content, modern formats are the only option.</p>
<h3 id="the-conversion-escape-hatch"><a class="header" href="#the-conversion-escape-hatch">The Conversion Escape Hatch</a></h3>
<p>The Asset Studio (D040) converts in both directions:</p>
<ul>
<li><strong>Import:</strong> .aud/.shp/.vqa/.pal â†’ OGG/PNG/WebM/.pal (for modders working with legacy assets)</li>
<li><strong>Export:</strong> OGG/PNG/WebM â†’ .aud/.shp/.vqa (for modders targeting OpenRA compatibility or classic aesthetic)</li>
<li><strong>Batch convert:</strong> <code>ic mod convert --to-modern</code> or <code>ic mod convert --to-classic</code> converts entire mod directories</li>
</ul>
<p>The engine loads both format families at runtime. <code>ra-formats</code> decoders handle legacy formats; Bevyâ€™s built-in loaders handle modern formats. No manual conversion is ever required â€” only recommended for new Workshop publications.</p>
<h3 id="workshop-package-format-icpkg"><a class="header" href="#workshop-package-format-icpkg">Workshop Package Format (.icpkg)</a></h3>
<p>Workshop packages are <strong>ZIP archives</strong> with a standardized manifest â€” the same pattern as <code>.oramap</code> but generalized to any resource type:</p>
<pre><code>my-hd-sprites-1.2.0.icpkg          # ZIP archive
â”œâ”€â”€ manifest.yaml                    # Package metadata (required)
â”œâ”€â”€ README.md                        # Long description (optional)
â”œâ”€â”€ CHANGELOG.md                     # Version history (optional)
â”œâ”€â”€ preview.png                      # Thumbnail, max 512Ã—512 (required for Workshop listing)
â””â”€â”€ assets/                          # Actual content files
    â”œâ”€â”€ sprites/
    â”‚   â”œâ”€â”€ infantry-allied.png
    â”‚   â””â”€â”€ vehicles-soviet.png
    â””â”€â”€ palettes/
        â””â”€â”€ temperate-hd.pal
</code></pre>
<p><strong>manifest.yaml:</strong></p>
<pre><code class="language-yaml">package:
  name: "hd-allied-sprites"
  publisher: "community-hd-project"
  version: "1.2.0"
  license: "CC-BY-SA-4.0"
  description: "HD sprite replacements for Allied infantry and vehicles"
  category: sprites
  game_module: ra1
  engine_version: "^0.3.0"

  # Per-file integrity (verified on install)
  files:
    sprites/infantry-allied.png:
      sha256: "a1b2c3d4..."
      size: 524288
    sprites/vehicles-soviet.png:
      sha256: "e5f6a7b8..."
      size: 1048576

  dependencies:
    - id: "community-hd-project/base-palettes"
      version: "^1.0"

  # P2P distribution metadata (added by Workshop server on publish)
  distribution:
    sha256: "full-package-hash..."        # Hash of entire .icpkg
    size: 1572864                          # Total package size in bytes
    infohash: "btih:abc123def..."          # BitTorrent info hash (for P2P)
</code></pre>
<p>ZIP was chosen over tar.gz because: random access to individual files (no full decompression to read manifest.yaml), universal tooling, <code>.oramap</code> precedent, and Rustâ€™s <code>zip</code> crate is mature.</p>
<p><strong>VPK-style indexed manifest (from Valve Source Engine):</strong> The <code>.icpkg</code> manifest (manifest.yaml) is placed at the <strong>start</strong> of the archive, not at the end. This follows Valveâ€™s VPK (Valve Pak) format design, where the directory/index appears at the beginning of the file â€” allowing tools to read metadata, file listings, and dependencies without downloading or decompressing the entire package. For Workshop browsing, the tracker can serve just the first ~4KB of a package (the manifest) to populate search results, preview images, and dependency resolution without fetching the full archive. ZIPâ€™s central directory is at the <em>end</em> of the file, so ZIP-based <code>.icpkg</code> files include a redundant manifest at offset 0 (outside the ZIP structure, in a fixed-size header) for fast remote reads, with the canonical copy inside the ZIP for standard tooling compatibility. See <code>research/valve-github-analysis.md</code> Â§ 6.4.</p>
<p><strong>Content-addressed asset deduplication (from Valve Fossilize):</strong> Workshop asset storage uses <strong>content-addressed hashing</strong> for deduplication â€” each file is identified by <code>SHA-256(content)</code>, not by path or name. When a modder publishes a new version that changes only 2 of 50 files, only the 2 changed files are uploaded; the remaining 48 reference existing content hashes already in the Workshop. This reduces upload size, storage cost, and download time for updates. The pattern comes from Fossilizeâ€™s content hashing (FOSS_BLOB_HASH = SHA-256 of serialized data, see <code>research/valve-github-analysis.md</code> Â§ 3.2) and is also used by Git (content-addressed object store), Docker (layer deduplication), and IPFS (CID-based storage). The per-file SHA-256 hashes already present in manifest.yaml serve as content addresses â€” no additional metadata needed.</p>
<p><strong>Local cache CAS deduplication:</strong> The same content-addressed pattern extends to the playerâ€™s local <code>workshop/</code> directory. Instead of storing raw <code>.icpkg</code> ZIP files â€” where 10 mods bundling the same HD sprite pack each contain a separate copy â€” the Workshop client unpacks downloaded packages into a <strong>content-addressed blob store</strong> (<code>workshop/blobs/&lt;sha256-prefix&gt;/&lt;sha256&gt;</code>). Each installed packageâ€™s manifest maps logical file paths to blob hashes; the package directory contains only symlinks or lightweight references to the shared blob store. Benefits:</p>
<ul>
<li><strong>Disk savings:</strong> Popular shared resources (HD sprite packs, sound effect libraries, font packs) stored once regardless of how many mods depend on them. Ten mods using the same 200MB HD pack â†’ 200MB stored, not 2GB.</li>
<li><strong>Faster installs:</strong> When installing a new mod, the client checks blob hashes against the local store before downloading. Files already present (from other mods) are skipped â€” only genuinely new content is fetched.</li>
<li><strong>Atomic updates:</strong> Updating a mod replaces only changed blob references. Unchanged files (same hash) are already in the store.</li>
<li><strong>Garbage collection:</strong> <code>ic mod gc</code> removes blobs no longer referenced by any installed package. Runs automatically during Workshop cleanup prompts (D030 budget system).</li>
</ul>
<pre><code>workshop/
â”œâ”€â”€ cache.db              # Package metadata, manifests, dependency graph
â”œâ”€â”€ blobs/                # Content-addressed blob store
â”‚   â”œâ”€â”€ a1/a1b2c3...     # SHA-256 hash â†’ file content
â”‚   â”œâ”€â”€ d4/d4e5f6...
â”‚   â””â”€â”€ ...
â””â”€â”€ packages/             # Per-package manifests (references into blobs/)
    â”œâ”€â”€ alice--hd-sprites-2.0.0/
    â”‚   â””â”€â”€ manifest.yaml # Maps logical paths â†’ blob hashes
    â””â”€â”€ bob--desert-map-1.1.0/
        â””â”€â”€ manifest.yaml
</code></pre>
<p>The local CAS store is an optimization that ships alongside the full Workshop in Phase 6a. The initial Workshop (Phase 4â€“5) can use simpler <code>.icpkg</code>-on-disk storage and upgrade to CAS when the full Workshop matures â€” the manifest.yaml already contains per-file SHA-256 hashes, so the data model is forward-compatible.</p>
<h3 id="workshop-player-configuration-profiles-controls--accessibility--hud-presets"><a class="header" href="#workshop-player-configuration-profiles-controls--accessibility--hud-presets">Workshop Player Configuration Profiles (Controls / Accessibility / HUD Presets)</a></h3>
<p>Workshop packages also support an optional <strong>player configuration profile</strong> resource type for sharing non-authoritative client preferences â€” especially control layouts and accessibility presets.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><code>player-config</code> package with a <code>Modern RTS (KBM)</code> variant tuned for left-handed mouse users</li>
<li>Steam Deck control profile (trackpad cursor + gyro precision + PTT on shoulder)</li>
<li>accessibility preset bundle (larger UI targets, sticky modifiers, reduced motion, high-contrast HUD)</li>
<li>touch HUD layout preset (handedness + command rail preferences + thresholds)</li>
</ul>
<p><strong>Why this fits D049:</strong> These profiles are tiny, versioned, reviewable manifests/data files distributed through the same Workshop identity, trust, and update systems as mods and media packs. Sharing them through Workshop reduces friction for community onboarding (â€œpro caster layoutâ€, â€œtournament observer profileâ€, â€œnew-player-friendly touch controlsâ€) without introducing a separate configuration-sharing platform.</p>
<p><strong>Hard safety boundaries (non-negotiable):</strong></p>
<ul>
<li>No secrets/credentials (tokens, API keys, account auth, recovery phrases)</li>
<li>No absolute local file paths or device identifiers</li>
<li>No executable code, scripts, macros, or automation payloads</li>
<li>No hidden application on install â€” applying a config profile always requires user confirmation with a diff preview</li>
</ul>
<p><strong>Manifest guidance (IC-specific package category):</strong></p>
<ul>
<li><code>category: player-config</code></li>
<li><code>game_module</code>: optional (many profiles are game-agnostic)</li>
<li><code>config_scope[]</code>: one or more of <code>controls</code>, <code>touch_layout</code>, <code>accessibility</code>, <code>ui_layout</code>, <code>camera_qol</code></li>
<li><code>compatibility</code> metadata for controls profiles:
<ul>
<li>semantic action catalog version (D065)</li>
<li>target input class (<code>desktop_kbm</code>, <code>gamepad</code>, <code>deck</code>, <code>touch_phone</code>, <code>touch_tablet</code>)</li>
<li>optional <code>screen_class</code> hints and required features (gyro, rear buttons, command rail)</li>
</ul>
</li>
</ul>
<p><strong>Example <code>player-config</code> package (<code>manifest.yaml</code>):</strong></p>
<pre><code class="language-yaml">package:
  name: "deck-gyro-competitive-profile"
  publisher: "community-deck-lab"
  version: "1.0.0"
  license: "CC-BY-4.0"
  description: "Steam Deck control profile: right-trackpad cursor, gyro precision, L1 push-to-talk, spectator-friendly quick controls"
  category: player-config
  # game_module is optional for generic profiles; omit unless module-specific
  engine_version: "^0.6.0"

  tags:
    - controls
    - steam-deck
    - accessibility-friendly
    - spectator

  config_scope:
    - controls
    - accessibility
    - camera_qol

  compatibility:
    semantic_action_catalog_version: "d065-input-actions-v1"
    target_input_class: "deck"
    screen_class: "Desktop"
    required_features:
      - right_trackpad
      - gyro
    optional_features:
      - rear_buttons
    tested_profiles:
      - "Steam Deck Default@v1"
    notes: "Falls back cleanly if gyro is disabled; keeps all actions reachable without gyro."

  # Per-file integrity (verified on install/apply download)
  files:
    profiles/controls.deck.yaml:
      sha256: "a1b2c3d4..."
      size: 8124
    profiles/accessibility.deck.yaml:
      sha256: "b2c3d4e5..."
      size: 1240
    profiles/camera_qol.yaml:
      sha256: "c3d4e5f6..."
      size: 512

  # Server-added on publish (same as other .icpkg categories)
  distribution:
    sha256: "full-package-hash..."
    size: 15642
    infohash: "btih:abc123def..."
</code></pre>
<p><strong>Example payload file (<code>profiles/controls.deck.yaml</code>, controls-only diff):</strong></p>
<pre><code class="language-yaml">profile:
  base: "Steam Deck Default@v1"
  profile_name: "Deck Gyro Competitive"
  target_input_class: deck
  semantic_action_catalog_version: "d065-input-actions-v1"

bindings:
  voice_ptt:
    primary: { kind: gamepad_button, button: l1, mode: hold }
  controls_quick_reference:
    primary: { kind: gamepad_button, button: l5, mode: hold }
  camera_bookmark_overlay:
    primary: { kind: gamepad_button, button: r5, mode: hold }
  ping_wheel:
    primary: { kind: gamepad_button, button: r3, mode: hold }

axes:
  cursor:
    source: right_trackpad
    sensitivity: 1.1
    acceleration: 0.2
  gyro_precision:
    enabled: true
    activate_on: l2_hold
    sensitivity: 0.85

radials:
  command_radial:
    trigger: y_hold
    first_ring:
      - attack_move
      - guard
      - force_action
      - rally_point
      - stop
      - deploy
</code></pre>
<p><strong>Install/apply UX rules:</strong></p>
<ul>
<li>Installing a <code>player-config</code> package does <strong>not</strong> auto-apply it</li>
<li>Player sees an <strong>Apply Profile</strong> sheet with:
<ul>
<li>target device/profile class</li>
<li>scopes included</li>
<li>changed actions/settings summary</li>
<li>conflicts with current bindings (if any)</li>
</ul>
</li>
<li>Apply can be partial (e.g., controls only, accessibility only) to avoid clobbering unrelated preferences</li>
<li><code>Reset to previous profile</code> / rollback snapshot is created before apply</li>
</ul>
<p><strong>Competitive integrity note:</strong> Player config profiles may change bindings and client UI preferences, but they may not include automation/macro behavior. D033 and D059 competitive rules remain unchanged.</p>
<p><strong>Lobby/ranked compatibility note (D068):</strong> <code>player-config</code> packages are <strong>local preference resources</strong>, not gameplay/presentation compatibility content. They are excluded from lobby/ranked fingerprint checks and must never be treated as required room resources or auto-download prerequisites for joining a match.</p>
<p><strong>Storage / distribution note:</strong> Config profiles are typically tiny (&lt;100 KB), so HTTP delivery is sufficient; P2P remains supported by the generic <code>.icpkg</code> pipeline but is not required for good UX.</p>
<h3 id="p2p-distribution-bittorrentwebtorrent"><a class="header" href="#p2p-distribution-bittorrentwebtorrent">P2P Distribution (BitTorrent/WebTorrent)</a></h3>
<p><strong>The cost problem:</strong> A popular 500MB mod downloaded 10,000 times generates 5TB of egress. At CDN rates ($0.01â€“0.09/GB), thatâ€™s $50â€“450/month â€” per mod. For a community project sustained by donations, centralized hosting is financially unsustainable at scale. A BitTorrent tracker VPS costs $5â€“20/month regardless of popularity.</p>
<p><strong>The solution:</strong> Workshop distribution uses the <strong>BitTorrent protocol</strong> for large packages, with HTTP direct download as fallback. The Workshop server acts as both metadata registry (SQLite, lightweight) and BitTorrent tracker (peer coordination, lightweight). Actual content transfer happens peer-to-peer between players who have the package.</p>
<p><strong>How it works:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     1. Search/browse     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ic CLI /    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Workshop Server â”‚
â”‚  In-Game     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  (metadata +     â”‚
â”‚  Browser     â”‚  2. manifest.yaml +      â”‚   tracker)       â”‚
â”‚              â”‚     torrent info         â”‚                  â”‚
â”‚              â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚     3. P2P download
â”‚              â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Other players (peers/seeds)
â”‚              â”‚     (BitTorrent protocol)
â”‚              â”‚
â”‚              â”‚     4. Fallback: HTTP direct download
â”‚              â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Workshop server / mirrors / seed box
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     5. Verify SHA-256
</code></pre>
<ol>
<li><strong>Publish:</strong> <code>ic mod publish</code> uploads .icpkg to Workshop server. Server computes SHA-256, generates torrent metadata (info hash), starts seeding the package alongside any initial seed infrastructure.</li>
<li><strong>Browse/Search:</strong> Workshop server handles all metadata queries (search, dependency resolution, ratings) via the existing SQLite + FTS5 design. Lightweight.</li>
<li><strong>Install:</strong> <code>ic mod install</code> fetches the manifest from the server, then downloads the .icpkg via BitTorrent from other players who have it. Falls back to HTTP direct download if no peers are available or if P2P is too slow.</li>
<li><strong>Seed:</strong> Players who have downloaded a package automatically seed it to others (opt-out in settings). The more popular a resource, the faster it downloads â€” the opposite of CDN economics where popularity means higher cost.</li>
<li><strong>Verify:</strong> SHA-256 checksum validation on the complete package, regardless of download method. BitTorrentâ€™s built-in piece-level hashing provides additional integrity during transfer.</li>
</ol>
<p><strong>WebTorrent for browser builds (WASM):</strong> Standard BitTorrent uses TCP/UDP, which browsers canâ€™t access. <a href="https://webtorrent.io/">WebTorrent</a> extends the BitTorrent protocol over WebRTC, enabling browser-to-browser P2P. The Workshop server includes a WebTorrent tracker endpoint. Desktop clients and browser clients can interoperate â€” desktop seeds serve browser peers and vice versa through hybrid WebSocket/WebRTC bridges. <strong>HTTP fallback is mandatory:</strong> if WebTorrent signaling fails (signaling server down, WebRTC blocked), the client must fall back to direct HTTP download without user intervention. Multiple signaling servers are maintained for redundancy. Signaling servers only facilitate WebRTC negotiation â€” they never see package content, so even a compromised signaling server cannot serve tampered data (SHA-256 verification catches that).</p>
<p><strong>Tracker authentication &amp; token rotation:</strong> P2P tracker access uses per-session tokens tied to client authentication (Workshop credentials or anonymous session token), not static URL secrets. Tokens rotate every release cycle. Even unauthorized peers joining a swarm cannot serve corrupt data (SHA-256 + piece hashing), but token rotation limits unauthorized swarm observation and bandwidth waste. See <code>06-SECURITY.md</code> for the broader security model.</p>
<p><strong>Transport strategy by package size:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Package Size</th><th>Strategy</th><th>Rationale</th></tr>
</thead>
<tbody>
<tr><td>&lt; 5MB</td><td>HTTP direct only</td><td>P2P overhead exceeds benefit for small files. Maps, balance presets, palettes.</td></tr>
<tr><td>5â€“50MB</td><td>P2P preferred, HTTP fallback</td><td>Small sprite packs, sound effect packs, script libraries. P2P helps but HTTP is acceptable.</td></tr>
<tr><td>&gt; 50MB</td><td>P2P strongly preferred</td><td>HD resource packs, cutscene packs, full mods. P2Pâ€™s cost advantage is decisive.</td></tr>
</tbody>
</table>
</div>
<p>Thresholds are configurable in <code>settings.toml</code>. Players on connections where BitTorrent is throttled or blocked can force HTTP-only mode.</p>
<p><strong>Auto-download on lobby join (D030 interaction):</strong> When joining a lobby with missing resources, the client first attempts P2P download (likely fast, since other players in the lobby are already seeding). If the lobby timer is short or P2P is slow, falls back to HTTP. The lobby UI shows download progress with source indicators (P2P/HTTP). See D052 Â§ â€œIn-Lobby P2P Resource Sharingâ€ for the detailed lobby protocol, including host-as-tracker, verification against Workshop index, and security constraints.</p>
<p><strong>Gaming industry precedent:</strong></p>
<ul>
<li><strong>Blizzard (WoW, StarCraft 2, Diablo 3):</strong> Used a custom P2P downloader (â€œBlizzard Downloaderâ€, later integrated into Battle.net) for game patches and updates from 2004â€“2016. Saved millions in CDN costs for multi-GB patches distributed to millions of players.</li>
<li><strong>Wargaming (World of Tanks):</strong> Used P2P distribution for game updates.</li>
<li><strong>Linux distributions:</strong> Ubuntu, Fedora, Arch all offer torrent downloads for ISOs â€” the standard solution for distributing large files from community infrastructure.</li>
<li><strong>Steam Workshop:</strong> Steam subsidizes centralized hosting from game sales revenue. We donâ€™t have that luxury â€” P2P is the community-sustainable alternative.</li>
</ul>
<p><strong>Competitive landscape â€” game mod platforms:</strong></p>
<p>ICâ€™s Workshop exists in a space with several established modding platforms. None offer the combination of P2P distribution, federation, self-hosting, and in-engine integration that IC targets.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Platform</th><th>Model</th><th>Scale</th><th>In-game integration</th><th>P2P</th><th>Federation / Self-host</th><th>Dependencies</th><th>Open source</th></tr>
</thead>
<tbody>
<tr><td><strong><a href="https://www.nexusmods.com">Nexus Mods</a></strong></td><td>Centralized web portal + Vortex mod manager. CDN distribution, throttled for free users. Revenue: premium membership + ads.</td><td>70.7M users, 4,297 games, 21B downloads. Largest modding platform.</td><td>None â€” external app (Vortex).</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>Vortex client (GPL-3.0). Backend proprietary.</td></tr>
<tr><td><strong><a href="https://mod.io">mod.io</a></strong></td><td>UGC middleware â€” embeddable SDKs (Unreal/Unity/C++), REST API, white-label UI. Revenue: B2B SaaS (free tier + enterprise).</td><td>2.5B downloads, 38M MAU, 332 live games. Backed by Tencent ($26M Series A).</td><td>Yes â€” SDK provides in-game browsing, download, moderation. Console-certified (PS/Xbox/Switch).</td><td>âŒ</td><td>âŒ</td><td>partial</td><td>SDKs open (MIT/Apache). Backend/service proprietary.</td></tr>
<tr><td><strong><a href="https://modrinth.com">Modrinth</a></strong></td><td>Open-source mod registry. Centralized CDN. Revenue: ads + donations.</td><td>~100K projects, millions of monthly downloads. Growing fast.</td><td>Through third-party launchers (Prism, etc).</td><td>âŒ</td><td>âŒ</td><td>âœ…</td><td>Server (AGPL), API open.</td></tr>
<tr><td><strong><a href="https://www.curseforge.com">CurseForge</a></strong> (Overwolf)</td><td>Centralized mod registry + CurseForge app. Revenue: Overwolf overlay ads.</td><td>Dominant for Minecraft, WoW, other Blizzard games.</td><td>CurseForge app, some launcher integrations.</td><td>âŒ</td><td>âŒ</td><td>âœ…</td><td>âŒ</td></tr>
<tr><td><strong><a href="https://thunderstore.io">Thunderstore</a></strong></td><td>Open-source mod registry. Centralized CDN.</td><td>Popular for Risk of Rain 2, Lethal Company, Valheim.</td><td>Through r2modman manager.</td><td>âŒ</td><td>âŒ</td><td>âœ…</td><td>Server (AGPL-3.0).</td></tr>
<tr><td><strong>Steam Workshop</strong></td><td>Integrated into Steam. Free hosting (subsidized by game sales revenue).</td><td>Thousands of games, billions of downloads.</td><td>Deep Steam integration.</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr>
<tr><td><strong><a href="https://moddb.com">ModDB</a> / <a href="https://gamebanana.com">GameBanana</a></strong></td><td>Web portals â€” manual upload/download, community features, editorial content. Legacy platforms (2001â€“2002).</td><td>ModDB: 12.5K+ mods, 108M+ downloads. GameBanana: strong in Source Engine games.</td><td>None.</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr>
</tbody>
</table>
</div>
<p><strong>Competitive landscape â€” P2P + Registry infrastructure:</strong></p>
<p>The game mod platforms above are all centralized. A separate set of projects tackle P2P distribution at the infrastructure level, but none target game modding specifically. See <code>research/p2p-federated-registry-analysis.md</code> for a comprehensive standalone analysis of this space and its applicability beyond IC.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Project</th><th>Architecture</th><th>Domain</th><th>How it relates to IC Workshop</th></tr>
</thead>
<tbody>
<tr><td><strong><a href="https://github.com/uber/kraken">Uber Kraken</a></strong> (6.6kâ˜…)</td><td>P2P Docker registry â€” custom BitTorrent-like protocol, Agent/Origin/Tracker/Build-Index. Pluggable storage (S3/GCS/HDFS).</td><td>Container images (datacenter)</td><td>Closest architectural match. Krakenâ€™s Agent/Origin/Tracker/Build-Index maps to ICâ€™s Peer/Seed-box/Tracker/Workshop-Index. ICâ€™s P2P protocol design (peer selection policy, piece request strategy, connection state machine, announce cycle, bandwidth limiting) is directly informed by Krakenâ€™s production experience â€” see protocol details above and <code>research/p2p-federated-registry-analysis.md</code> Â§ â€œUber Kraken â€” Deep Diveâ€ for the full analysis. Key difference: Kraken is intra-datacenter (3s announce, 10Gbps links), IC is internet-scale (30s announce, residential connections).</td></tr>
<tr><td><strong><a href="https://github.com/dragonflyoss/dragonfly">Dragonfly</a></strong> (3kâ˜…, CNCF Graduated)</td><td>P2P content distribution â€” Manager/Scheduler/Seed-Peer/Peer. Centralized evaluator-based scheduling with 4-dimensional peer scoring (<code>LoadQualityÃ—0.6 + IDCAffinityÃ—0.2 + LocationAffinityÃ—0.1 + HostTypeÃ—0.1</code>). DAG-based peer graph, back-to-source fallback. Persistent cache with replica management. Client rewritten in Rust (v2). Trail of Bits audited (2023).</td><td>Container images, AI models, artifacts</td><td>Same P2P-with-fallback pattern. Dragonflyâ€™s hierarchical location affinity (<code>country|province|city|zone</code>), statistical bad-peer detection (three-sigma rule), capacity-aware scoring, persistent replica count, and download priority tiers are all patterns IC adapts. Key differences: Dragonfly uses centralized scheduling (IC uses BitTorrent swarm â€” simpler, more resilient to churn), Dragonfly is single-cluster with no cross-cluster P2P (IC is federated), Dragonfly requires K8s+Redis+MySQL (IC requires only SQLite). Dragonflyâ€™s own RFC #3713 acknowledges piece-level selection is FCFS â€” BitTorrentâ€™s rarest-first is already better. See <code>research/p2p-federated-registry-analysis.md</code> Â§ â€œDragonfly â€” CNCF P2P Distribution (Deep Dive)â€ for full analysis.</td></tr>
<tr><td><strong>JFrog Artifactory P2P</strong> (proprietary)</td><td>Enterprise P2P distribution â€” mesh of nodes sharing cached binary artifacts within corporate networks.</td><td>Enterprise build artifacts</td><td>The direct inspiration for ICâ€™s repository model. JFrog added P2P because CDN costs for large binaries at scale are unsustainable â€” same motivation as IC.</td></tr>
<tr><td><strong>Blizzard NGDP/Agent</strong> (proprietary)</td><td>Custom P2P game patching â€” BitTorrent-based, CDN+P2P hybrid, integrated into Battle.net launcher.</td><td>Game patches (WoW, SC2, Diablo)</td><td>Closest gaming precedent. Proved P2P game content distribution works at massive scale. Proprietary, not a registry (no search/ratings/deps), not federated.</td></tr>
<tr><td><strong>Homebrew / crates.io-index</strong></td><td>Git-backed package indexes. CDN for actual downloads.</td><td>Software packages</td><td>ICâ€™s Phase 0â€“3 git-index is directly inspired by these. No P2P distribution.</td></tr>
<tr><td><strong>IPFS</strong></td><td>Content-addressed P2P storage â€” any content gets a CID, any node can pin and serve it. DHT-based discovery. Bitswap protocol for block exchange with Decision Engine and Score Ledger.</td><td>General-purpose decentralized storage</td><td>Rejected as primary distribution protocol (too general, slow cold-content discovery, complex setup, poor game-quality UX). However, IPFSâ€™s Bitswap protocol contributes significant patterns IC adopts: EWMA peer scoring with time-decaying reputation (Score Ledger), per-peer fairness caps (<code>MaxOutstandingBytesPerPeer</code>), want-have/want-block two-phase discovery, broadcast control (target proven-useful peers), dual WAN/LAN discovery (validates ICâ€™s LAN party mode), delegated HTTP routing (validates ICâ€™s registry-as-router), server/client mode separation, and batch provider announcements (Sweep Provider). IPFSâ€™s 9-year-unresolved bandwidth limiting issue (#3065, 73 ğŸ‘) proves bandwidth caps must ship day one. See <code>research/p2p-federated-registry-analysis.md</code> Â§ â€œIPFS â€” Content-Addressed P2P Storage (Deep Dive)â€ for full analysis.</td></tr>
<tr><td><strong>Microsoft Delivery Optimization</strong></td><td>Windows Update P2P â€” peers on the same network share update packages.</td><td>OS updates</td><td>Proves P2P works for verified package distribution at billions-of-devices scale. Proprietary, no registry model.</td></tr>
</tbody>
</table>
</div>
<p><strong>Whatâ€™s novel about ICâ€™s combination:</strong> No existing system â€” modding platform or infrastructure â€” combines (1) federated registry with repository types, (2) P2P distribution via BitTorrent/WebTorrent, (3) zero-infrastructure git-hosted bootstrap, (4) browser-compatible P2P via WebTorrent, (5) in-engine integration with lobby auto-download, and (6) fully open-source with self-hosting as a first-class use case. The closest architectural comparison is mod.io (embeddable SDK approach, in-game integration) but mod.io is a proprietary centralized SaaS â€” no P2P, no federation, no self-hosting. The closest distribution comparison is Uber Kraken (P2P registry) but it has no modding features. Each piece has strong precedent; the combination is new. The Workshop architecture is game-agnostic and could serve as a standalone platform â€” see the research analysis for exploration of this possibility.</p>
<p><strong>Seeding infrastructure:</strong></p>
<p>The Workshop doesnâ€™t rely solely on player altruism for seeding:</p>
<ul>
<li><strong>Workshop seed server:</strong> A dedicated seed box (modest: a VPS with good upload bandwidth) that permanently seeds all Workshop content. This ensures new/unpopular packages are always downloadable even with zero player peers. Cost: ~$20-50/month for a VPS with 1TB+ storage and unmetered bandwidth.</li>
<li><strong>Community seed volunteers:</strong> Players who opt in to extended seeding (beyond just while the game is running). Similar to how Linux mirror operators volunteer bandwidth. Could be incentivized with Workshop badges/reputation (D036/D037).</li>
<li><strong>Mirror servers (federation):</strong> Community-hosted Workshop servers (D030 federation) also seed the content they host. Regional community servers naturally become regional seeds.</li>
<li><strong>Lobby-optimized seeding:</strong> When a lobby host has required mods, the game client prioritizes seeding to joining players who are downloading. The â€œauto-download on lobby joinâ€ flow becomes: download from lobby peers first â†’ swarm â†’ HTTP fallback.</li>
</ul>
<p><strong>Privacy and security:</strong></p>
<ul>
<li><strong>IP visibility:</strong> Standard BitTorrent exposes peer IP addresses. This is the same exposure as any multiplayer game (players already see each otherâ€™s IPs or relay IPs). For privacy-sensitive users, HTTP-only mode avoids P2P IP exposure.</li>
<li><strong>Content integrity:</strong> SHA-256 verification on complete packages catches any tampering. BitTorrentâ€™s piece-level hashing catches corruption during transfer. Double-verified.</li>
<li><strong>No metadata leakage:</strong> The tracker only knows which peers have which packages (by info hash). It doesnâ€™t inspect content. Package contents are just game assets â€” sprites, audio, maps.</li>
<li><strong>ISP throttling mitigation:</strong> BitTorrent traffic can be throttled by ISPs. Mitigations: protocol encryption (standard in modern BT clients), WebSocket transport (looks like web traffic), and HTTP fallback as ultimate escape. Settings allow forcing HTTP-only mode.</li>
<li><strong>Resource exhaustion:</strong> Rate-limited seeding (configurable upload cap in settings). Players control how much bandwidth they donate. Default: 1MB/s upload, adjustable to 0 (leech-only, no seeding â€” discouraged but available).</li>
</ul>
<p><strong>P2P protocol design details:</strong></p>
<p>The Workshopâ€™s P2P engine is informed by production experience from Uber Kraken (Apache 2.0, 6.6kâ˜…) and Dragonfly (Apache 2.0, CNCF Graduated). Kraken distributes 1M+ container images/day across 15K+ hosts using a custom BitTorrent-inspired protocol; Dragonfly uses centralized evaluator-based scheduling at Alibaba scale. IC adapts Krakenâ€™s connection management and Dragonflyâ€™s scoring insights for internet-scale game mod distribution. See <code>research/p2p-federated-registry-analysis.md</code> for full architectural analyses of both systems.</p>
<blockquote>
<p><strong>Cross-pollination with IC netcode and community infrastructure.</strong> The Workshop P2P engine and ICâ€™s netcode infrastructure (relay server, tracking server â€” <code>03-NETCODE.md</code>) share deep structural parallels: federation, heartbeat/TTL, rate control, connection state machines, observability, deployment model. Patterns flow both directions â€” netcodeâ€™s three-layer rate control and token-based liveness improve Workshop; Workshopâ€™s EWMA scoring and multi-dimensional peer evaluation improve relay server quality tracking. A full cross-pollination analysis (including shared infrastructure opportunities: unified server binary, federation library, auth/identity layer) is in <code>research/p2p-federated-registry-analysis.md</code> Â§ â€œNetcode â†” Workshop Cross-Pollination.â€ Additional cross-pollination with D052/D053 (community servers, player profiles, trust-based filtering) is catalogued in D052 Â§ â€œCross-Pollinationâ€ â€” highlights include: two-key architecture for index signing and publisher identity, trust-based source filtering, server-side validation as a shared invariant, and trust-verified peer selection scoring.</p>
</blockquote>
<p><em>Peer selection policy (tracker-side):</em> The tracker returns a sorted peer list on each announce response. The sorting policy is <strong>pluggable</strong> â€” inspired by Krakenâ€™s <code>assignmentPolicy</code> interface pattern. ICâ€™s default policy prioritizes:</p>
<ol>
<li><strong>Seeders</strong> (completed packages â€” highest priority, like Krakenâ€™s <code>completeness</code> policy)</li>
<li><strong>Lobby peers</strong> (peers in the same multiplayer lobby â€” guaranteed to have the content, lowest latency)</li>
<li><strong>Geographically close peers</strong> (same region/ASN â€” reduces cross-continent transfers)</li>
<li><strong>High-completion peers</strong> (more pieces available â€” better utilization of each connection)</li>
<li><strong>Random</strong> (fallback for ties â€” prevents herding)</li>
</ol>
<p>Peer handout limit: 30 peers per announce response (Kraken uses 50, but IC has fewer total peers per package). Community-hosted trackers can implement custom policies via the server config.</p>
<p><em>Planned evolution â€” weighted multi-dimensional scoring (Phase 5+):</em> Dragonflyâ€™s evaluator demonstrates that combining capacity, locality, and node type into a weighted score produces better peer selection than linear priority tiers. ICâ€™s Phase 5+ peer selection evolves to a weighted scoring model informed by Dragonflyâ€™s approach:</p>
<pre><code>PeerScore = Capacity(0.4) + Locality(0.3) + SeedStatus(0.2) + LobbyContext(0.1)
</code></pre>
<ul>
<li><strong>Capacity (weight 0.4):</strong> Spare bandwidth reported in announce (<code>1 - upload_bw_used / upload_bw_max</code>). Peers with more headroom score higher. Inspired by Dragonflyâ€™s <code>LoadQuality</code> metric (which sub-decomposes into peak bandwidth, sustained load, and concurrency). IC uses a single utilization ratio â€” simpler, captures the same core insight.</li>
<li><strong>Locality (weight 0.3):</strong> Hierarchical location matching. Clients self-report location as <code>continent|country|region|city</code> (4-level, pipe-delimited â€” adapted from Dragonflyâ€™s 5-level <code>country|province|city|zone|cluster</code>). Score = <code>matched_prefix_elements / 4</code>. Two peers in the same city score 0.75; same country but different region: 0.5; same continent: 0.25.</li>
<li><strong>SeedStatus (weight 0.2):</strong> Seed box = 1.0, completed seeder = 0.7, uploading leecher = 0.3. Inspired by Dragonflyâ€™s <code>HostType</code> score (seed peers = 1.0, normal = 0.5).</li>
<li><strong>LobbyContext (weight 0.1):</strong> Same lobby = 1.0, same game session = 0.5, no context = 0. IC-specific â€” Dragonfly has no equivalent (no lobby concept).</li>
</ul>
<p>The initial 5-tier priority system (above) ships first and is adequate for community scale. Weighted scoring is additive â€” the same pluggable policy interface supports both approaches. Community servers can configure their own weights or contribute custom scoring policies.</p>
<p><em>Piece request strategy (client-side):</em> The engine uses <strong>rarest-first</strong> piece selection by default â€” a priority queue sorted by fewest peers having each piece. This is standard BitTorrent behavior, well-validated for internet conditions. Kraken also implements this as <code>rarestFirstPolicy</code>.</p>
<ul>
<li><strong>Pipeline limit:</strong> 3 concurrent piece requests per peer (matches Krakenâ€™s default). Prevents overwhelming slow peers.</li>
<li><strong>Piece request timeout:</strong> 8s base + 6s per MB of piece size (more generous than Krakenâ€™s 4s+4s/MB, compensating for residential internet variance).</li>
<li><strong>Endgame mode:</strong> When remaining pieces â‰¤ 5, the engine sends duplicate piece requests to multiple peers. This prevents the â€œlast piece stallâ€ â€” a well-known BitTorrent problem where the final pieceâ€™s sole holder is slow. Kraken implements this as <code>EndgameThreshold</code> â€” itâ€™s essential.</li>
</ul>
<p><em>Connection state machine (client-side):</em></p>
<pre><code>pending â”€â”€connectâ”€â”€â–º active â”€â”€timeout/errorâ”€â”€â–º blacklisted
   â–²                    â”‚                          â”‚
   â”‚                    â”‚                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ cooldown (5min) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ul>
<li><code>MaxConnectionsPerPackage: 8</code> (lower than Krakenâ€™s 10 â€” residential connections have less bandwidth to share)</li>
<li>Blacklisting: peers that produce zero useful throughput over 30 seconds are temporarily blacklisted (5-minute cooldown). Catches both dead peers and ISP-throttled connections.</li>
<li><em>Sybil resistance:</em> Maximum 3 peers per /24 subnet in a single swarm. Prefer peers from diverse autonomous systems (ASNs) when possible. Sybil attacks can waste bandwidth but cannot serve corrupt data (SHA-256 integrity), so the risk ceiling is low.</li>
<li><em>Statistical degradation detection (Phase 5+):</em> Inspired by Dragonflyâ€™s <code>IsBadParent</code> algorithm â€” track per-peer piece transfer times. Peers whose last transfer exceeds <code>max(3 Ã— mean, 2 Ã— p95)</code> of observed transfer times are demoted in scoring (not hard-blacklisted â€” they may recover). For sparse data (&lt; 50 samples per peer), fall back to the simpler â€œ20Ã— meanâ€ ratio check. Hard blacklist remains only for zero-throughput (complete failure). This catches degrading peers before they fail completely.</li>
<li>Connections have TTL â€” idle connections are closed after 60 seconds to free resources.</li>
</ul>
<p><em>Announce cycle (client â†’ tracker):</em> Clients announce to the tracker every <strong>30 seconds</strong> (Kraken uses 3s for datacenter â€” far too aggressive for internet). The tracker can dynamically adjust: faster intervals (10s) during active downloads, slower (60s) when seeding idle content. Max interval cap (120s) prevents unbounded growth. Announce payload includes: PeerID, package info hash, bitfield (what pieces the client has), upload/download speed.</p>
<p><em>Size-based piece length:</em> Different package sizes use different piece lengths to balance metadata overhead against download granularity (inspired by Krakenâ€™s <code>PieceLengths</code> config):</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Package Size</th><th>Piece Length</th><th>Rationale</th></tr>
</thead>
<tbody>
<tr><td>&lt; 5MB</td><td>N/A â€” HTTP only</td><td>P2P overhead exceeds benefit</td></tr>
<tr><td>5â€“50MB</td><td>256KB</td><td>Fine-grained. Good for partial recovery and slow connections.</td></tr>
<tr><td>50â€“500MB</td><td>1MB</td><td>Balanced. Reasonable metadata overhead.</td></tr>
<tr><td>&gt; 500MB</td><td>4MB</td><td>Reduced metadata overhead for large packages.</td></tr>
</tbody>
</table>
</div>
<p><em>Bandwidth limiting:</em> Configurable per-client in <code>settings.toml</code>. Residential users cannot have their connection saturated by mod seeding â€” this is a hard requirement that Kraken solves with <code>egress_bits_per_sec</code>/<code>ingress_bits_per_sec</code> and IC must match.</p>
<pre><code class="language-toml"># settings.toml â€” P2P bandwidth configuration
[workshop.p2p]
max_upload_speed = "1 MB/s"          # Default. 0 = unlimited, "0 B/s" = no seeding
max_download_speed = "unlimited"      # Default. Most users won't limit.
seed_after_download = true            # Keep seeding while game is running
seed_duration_after_exit = "30m"      # Background seeding after game closes (0 = none)
cache_size_limit = "2 GB"             # LRU eviction when exceeded
prefer_p2p = true                     # false = always use HTTP direct
</code></pre>
<p><em>Health checks:</em> Seed boxes implement heartbeat health checks (30s interval, 3 failures â†’ unhealthy, 2 passes â†’ healthy again â€” matching Krakenâ€™s active health check parameters). The tracker marks peers as offline after 2Ã— announce interval without contact. Unhealthy seed boxes are removed from the announce response until they recover.</p>
<p><em>Content lifecycle:</em> Downloaded packages stay in the seeding pool for 30 minutes after the game exits (configurable via <code>seed_duration_after_exit</code>). This is longer than Krakenâ€™s 5-minute <code>seeder_tti</code> because IC has fewer peers per package â€” each seeder is more valuable. Disk cache uses LRU eviction when over <code>cache_size_limit</code>. Packages currently in use or being seeded are never evicted.</p>
<p><em>Download priority tiers:</em> Inspired by Dragonflyâ€™s 7-level priority system (Level0â€“Level6), IC uses 3 priority tiers to enable QoS differentiation. Higher-priority downloads preempt lower-priority ones (pause background downloads, reallocate bandwidth and connection slots):</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Priority</th><th>Name</th><th>When Used</th><th>Behavior</th></tr>
</thead>
<tbody>
<tr><td>1 (high)</td><td><code>lobby-urgent</code></td><td>Player joining a lobby that requires missing mods</td><td>Preempts all other downloads. Uses all available bandwidth</td></tr>
<tr><td>2 (mid)</td><td><code>user-requested</code></td><td>Player manually downloads from Workshop browser</td><td>Normal bandwidth. Runs alongside background.</td></tr>
<tr><td>3 (low)</td><td><code>background</code></td><td>Cache warming, auto-updates, subscribed mod pre-download</td><td>Bandwidth-limited. Paused when higher-priority active.</td></tr>
</tbody>
</table>
</div>
<p><em>Preheat / prefetch:</em> Adapted from Dragonflyâ€™s preheat jobs (which pre-warm content on seed peers before demand). IC uses two prefetch patterns:</p>
<ul>
<li><strong>Lobby prefetch:</strong> When a lobby host sets required mods, the Workshop server (Phase 5+) can pre-seed those mods to seed boxes before players join. The lobby creation event is the prefetch signal. This ensures seed infrastructure is warm when players start downloading.</li>
<li><strong>Subscription prefetch:</strong> Players can subscribe to Workshop publishers or resources. Subscribed content auto-downloads in the background at <code>background</code> priority. When a subscribed mod updates, the new version downloads automatically before the player next launches the game.</li>
</ul>
<p><em>Persistent replica count (Phase 5+):</em> Inspired by Dragonflyâ€™s <code>PersistentReplicaCount</code>, the Workshop server tracks how many seed boxes hold each resource. If the count drops below a configurable threshold (default: 2 for popular resources, 1 for all others), the server triggers automatic re-seeding from HTTP origin. This ensures the â€œalways availableâ€ guarantee â€” even if all player peers are offline, seed infrastructure maintains minimum replica coverage.</p>
<p><strong>Early-phase bootstrap â€” Git-hosted package index:</strong></p>
<p>Before the full Workshop server is built (Phase 4-5), a <strong>GitHub-hosted package index repository</strong> serves as the Workshopâ€™s discovery and coordination layer. This is a well-proven pattern â€” Homebrew (<code>homebrew-core</code>), Rust (<code>crates.io-index</code>), Winget (<code>winget-pkgs</code>), and Nixpkgs all use a git repository as their canonical package index.</p>
<p><strong>How it works:</strong></p>
<p>A public GitHub repository (e.g., <code>iron-curtain/workshop-index</code>) contains YAML manifest files â€” one per package â€” that describe available resources, their versions, checksums, download locations, and dependencies. The repo itself contains NO asset files â€” only lightweight metadata.</p>
<pre><code>workshop-index/                      # The git-hosted package index
â”œâ”€â”€ index.yaml                       # Consolidated index (single-fetch for game client)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ alice/
â”‚   â”‚   â””â”€â”€ soviet-march-music/
â”‚   â”‚       â”œâ”€â”€ 1.0.0.yaml           # Per-version manifests
â”‚   â”‚       â””â”€â”€ 1.1.0.yaml
â”‚   â”œâ”€â”€ community-hd-project/
â”‚   â”‚   â””â”€â”€ allied-infantry-hd/
â”‚   â”‚       â””â”€â”€ 2.0.0.yaml
â”‚   â””â”€â”€ ...
â”œâ”€â”€ sources.yaml                     # List of storage servers, mirrors, seed boxes
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â””â”€â”€ validate.yml             # CI: validates manifest format, checks SHA-256
</code></pre>
<p><strong>Per-package manifest (<code>packages/alice/soviet-march-music/1.1.0.yaml</code>):</strong></p>
<pre><code class="language-yaml">name: soviet-march-music
publisher: alice
version: 1.1.0
license: CC-BY-4.0
description: "Soviet faction battle music pack"
size: 48_000_000  # 48MB
sha256: "a1b2c3d4..."

sources:
  - type: http
    url: "https://github.com/iron-curtain/workshop-packages/releases/download/alice-soviet-march-music-1.1.0/soviet-march-music-1.1.0.icpkg"
  - type: torrent
    info_hash: "e5f6a7b8..."
    trackers:
      - "wss://tracker.ironcurtain.gg/announce"   # WebTorrent tracker
      - "udp://tracker.ironcurtain.gg:6969/announce"

dependencies:
  community-hd-project/base-audio-lib: "^1.0"

game_modules: [ra]
tags: [music, soviet, battle]
</code></pre>
<p><strong><code>sources.yaml</code> â€” storage server and tracker registry:</strong></p>
<pre><code class="language-yaml"># Where to find actual .icpkg files and BitTorrent peers.
# The engine reads this to discover available download sources.
# Adding an official server later = adding a line here.
storage_servers:
  - url: "https://github.com/iron-curtain/workshop-packages/releases"  # GitHub Releases (Phase 0-3)
    type: github-releases
    priority: 1
  # - url: "https://cdn.ironcurtain.gg"   # Future: official CDN (Phase 5+)
  #   type: http
  #   priority: 1

torrent_trackers:
  - "wss://tracker.ironcurtain.gg/announce"      # WebTorrent (browser + desktop)
  - "udp://tracker.ironcurtain.gg:6969/announce"  # UDP (desktop only)

seed_boxes:
  - "https://seed1.ironcurtain.gg"  # Permanent seeder for all packages
</code></pre>
<p><strong>Two client access patterns:</strong></p>
<ol>
<li><strong>HTTP fetch</strong> (game client default): The engine fetches <code>index.yaml</code> via <code>raw.githubusercontent.com</code> â€” a single GET request returns the full package listing. Fast, no git dependency, CDN-backed globally by GitHub. Cached locally with ETag/Last-Modified for incremental updates.</li>
<li><strong>Git clone/pull</strong> (SDK, power users, offline): <code>git clone</code> the entire index repo. <code>git pull</code> for incremental atomic updates. Full offline browsing. Better for the SDK/editor and users who want to script against the index.</li>
</ol>
<p>The engineâ€™s Workshop source configuration (D030) treats this as a new source type:</p>
<pre><code class="language-toml"># settings.toml â€” Phase 0-3 configuration
[[workshop.sources]]
url = "https://github.com/iron-curtain/workshop-index"   # git-index source
type = "git-index"
priority = 1

[[workshop.sources]]
path = "C:/my-local-workshop"    # local development
type = "local"
priority = 2
</code></pre>
<p><strong>Community contribution workflow (manual):</strong></p>
<ol>
<li>Modder creates a <code>.icpkg</code> package and uploads it to GitHub Releases (or any HTTP host)</li>
<li>Modder submits a PR to <code>workshop-index</code> adding a manifest YAML with SHA-256 and download URL</li>
<li>GitHub Actions validates manifest format, checks SHA-256 against the download URL, verifies metadata</li>
<li>Maintainers review and merge â†’ package is discoverable to all players on next index fetch</li>
<li>When the full Workshop server ships (Phase 4-5), published packages migrate automatically â€” the manifest format is the same</li>
</ol>
<p><strong>Git-index security hardening</strong> (see <code>06-SECURITY.md</code> Â§ Vulnerabilities 20â€“21 and <code>research/workshop-registry-vulnerability-analysis.md</code> for full threat analysis):</p>
<ul>
<li><strong>Path-scoped PR validation:</strong> CI rejects PRs that modify files outside the submitterâ€™s package directory. A PR adding <code>packages/alice/tanks/1.0.0.yaml</code> may ONLY modify files under <code>packages/alice/</code>. Modification of other paths â†’ automatic CI failure.</li>
<li><strong>CODEOWNERS:</strong> Maps <code>packages/alice/** @alice-github</code>. GitHub enforces that only the package owner can approve changes to their manifests.</li>
<li><strong><code>manifest_hash</code> verification:</strong> CI downloads the <code>.icpkg</code>, extracts <code>manifest.yaml</code>, computes its SHA-256, and verifies it matches the <code>manifest_hash</code> field in the index entry. Prevents manifest confusion (registry entry diverging from package contents).</li>
<li><strong>Consolidated <code>index.yaml</code> is CI-generated:</strong> Deterministically rebuilt from per-package manifests â€” never hand-edited. Any contributor can reproduce locally to verify integrity.</li>
<li><strong>Index signing (Phase 3â€“4):</strong> CI signs the consolidated <code>index.yaml</code> with an Ed25519 key stored outside GitHub. Clients verify the signature. Repository compromise without the signing key produces unsigned (rejected) indexes. Uses the <strong>two-key architecture</strong> from D052 (Â§ Key Lifecycle): the CI-held key is the Signing Key (SK); a Recovery Key (RK), held offline by â‰¥2 maintainers, enables key rotation on compromise without breaking client trust chains. See D052 Â§ â€œCross-Pollinationâ€ for the full rationale.</li>
<li><strong>Actions pinned to commit SHAs:</strong> All GitHub Actions referenced by SHA, not by mutable tag. Minimal <code>GITHUB_TOKEN</code> permissions. No secrets in the PR validation pipeline.</li>
<li><strong>Branch protection on main:</strong> Require signed commits, no force-push, require PR reviews, no single-person merge. Repository must have â‰¥3 maintainers.</li>
</ul>
<p><strong>Automated publish via <code>ic</code> CLI (same UX as Phase 5+):</strong></p>
<p>The <code>ic mod publish</code> command works against the git-index backend in Phase 0â€“3:</p>
<ol>
<li><code>ic mod publish</code> packages content into <code>.icpkg</code>, computes SHA-256</li>
<li>Uploads <code>.icpkg</code> to GitHub Releases (via GitHub API, using a personal access token configured in <code>ic auth</code>)</li>
<li>Generates the index manifest YAML from <code>mod.yaml</code> metadata</li>
<li>Opens a PR to <code>workshop-index</code> with the manifest file</li>
<li>Modder reviews the PR and confirms; GitHub Actions validates; maintainers merge</li>
</ol>
<p>The command is identical to Phase 5+ publishing (<code>ic mod publish</code>) â€” the only difference is the backend. When the Workshop server ships, <code>ic mod publish</code> targets the server instead. Modders donâ€™t change their workflow.</p>
<p><strong>Adding official storage servers later:</strong></p>
<p>When official infrastructure is ready (Phase 5+), adding it is a one-line change to <code>sources.yaml</code> â€” no architecture change, no client update. The <code>sources.yaml</code> in the index repo is the single place that lists where packages can be downloaded from. Community mirrors and CDN endpoints are added the same way.</p>
<p><strong>Phased progression:</strong></p>
<ol>
<li><strong>Phase 0â€“3 â€” Git-hosted index + GitHub Releases:</strong> The index repo is the Workshop. Players fetch <code>index.yaml</code> for discovery, download <code>.icpkg</code> files from GitHub Releases (2GB per file, free, CDN-backed). Community contributes via PR. Zero custom server code. Zero hosting cost.</li>
<li><strong>Phase 3â€“4 â€” Add BitTorrent tracker:</strong> A minimal tracker binary goes live ($5-10/month VPS). Package manifests gain <code>torrent</code> source entries. P2P delivery begins for large packages. The index repo remains the discovery layer.</li>
<li><strong>Phase 4â€“5 â€” Full Workshop server:</strong> Search, ratings, dependency resolution, FTS5, integrated P2P tracker. The Workshop server can either replace the git index or coexist alongside it (both are valid D030 sources). The git index remains available as a fallback and for community-hosted Workshop servers.</li>
</ol>
<p>The progression is smooth because the federated source model (D030) already supports multiple source types â€” <code>git-index</code>, <code>local</code>, <code>remote</code> (Workshop server), and <code>steam</code> all coexist in <code>settings.toml</code>.</p>
<p><strong>Industry precedent:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Project</th><th>Index Mechanism</th><th>Scale</th></tr>
</thead>
<tbody>
<tr><td><strong>Homebrew</strong> (<code>homebrew-core</code>)</td><td>Git repo of Ruby formulae; <code>brew update</code> = <code>git pull</code></td><td>~7K packages</td></tr>
<tr><td><strong>Rust crates.io</strong> (<code>crates.io-index</code>)</td><td>Git repo of JSON metadata; sparse HTTP fetch added later</td><td>~150K crates</td></tr>
<tr><td><strong>Winget</strong> (<code>winget-pkgs</code>)</td><td>Git repo of YAML manifests; community PRs</td><td>~5K packages</td></tr>
<tr><td><strong>Nixpkgs</strong></td><td>Git repo of Nix expressions</td><td>~100K packages</td></tr>
<tr><td><strong>Scoop</strong> (Windows)</td><td>Git repo (â€œbucketsâ€) of JSON manifests</td><td>~5K packages</td></tr>
</tbody>
</table>
</div>
<p>All of these started with git-as-index and some (crates.io) later augmented with sparse HTTP fetching for performance at scale. The same progression applies here â€” git index works perfectly for a community of hundreds to low thousands, and can be complemented (not replaced) by a Workshop API when scale demands it.</p>
<p><strong>Workshop server architecture with P2P:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Workshop Server                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Metadata    â”‚  â”‚ Tracker  â”‚  â”‚  HTTP Fallback â”‚ â”‚
â”‚  â”‚  (SQLite +   â”‚  â”‚ (BT/WT   â”‚  â”‚  (S3/R2 or     â”‚ â”‚
â”‚  â”‚   FTS5)      â”‚  â”‚  peer     â”‚  â”‚   local disk)  â”‚ â”‚
â”‚  â”‚             â”‚  â”‚  coord)   â”‚  â”‚               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â–²               â–²               â–²            â”‚
â”‚        â”‚ search/browse â”‚ announce/     â”‚ GET .icpkg  â”‚
â”‚        â”‚ deps/ratings  â”‚ scrape        â”‚ (fallback)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ ic CLI  â”‚    â”‚  Players  â”‚   â”‚ Seed Box  â”‚
    â”‚ Browser â”‚    â”‚  (seeds)  â”‚   â”‚ (always   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  seeds)   â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>All three components (metadata, tracker, HTTP fallback) run in the same binary â€” â€œjust a Rust binaryâ€ deployment philosophy. Community self-hosters get the full stack with one executable.</p>
<h3 id="rust-implementation"><a class="header" href="#rust-implementation">Rust Implementation</a></h3>
<p><strong>BitTorrent client library:</strong> The <code>ic</code> CLI and game client embed a BitTorrent client. Rust options:</p>
<ul>
<li><a href="https://github.com/ikatson/rqbit"><code>librqbit</code></a> â€” pure Rust, async (tokio), actively maintained, supports WebTorrent</li>
<li><a href="https://github.com/mandreyel/cratetorrent"><code>cratetorrent</code></a> â€” pure Rust, educational focus</li>
<li>Custom minimal client â€” only needs download + seed + tracker announce; no DHT, no PEX needed for a controlled Workshop ecosystem</li>
</ul>
<p><strong>BitTorrent tracker:</strong> Embeddable in the Workshop server binary. Rust options:</p>
<ul>
<li><a href="https://github.com/greatest-ape/aquatic"><code>aquatic</code></a> â€” high-performance Rust tracker</li>
<li>Custom minimal tracker â€” HTTP announce/scrape endpoints, peer list management. The Workshop server already has SQLite; peer lists are another table.</li>
</ul>
<p><strong>WebTorrent:</strong> <code>librqbit</code> has WebTorrent support. The WASM build would use the WebRTC transport.</p>
<h3 id="rationale"><a class="header" href="#rationale">Rationale</a></h3>
<ul>
<li><strong>Cost sustainability:</strong> P2P reduces Workshop hosting costs by 90%+. A community project cannot afford CDN bills that scale with popularity. A tracker + seed box for $30-50/month serves unlimited download volume.</li>
<li><strong>Fits federation (D030):</strong> P2P is another source in the federated model. The virtual repository queries metadata from remote servers, then downloads content from the swarm â€” same user experience, different transport.</li>
<li><strong>Fits â€œno single point of failureâ€ (D037):</strong> P2P is inherently resilient. If the Workshop server goes down, peers keep sharing. Content already downloaded is always available.</li>
<li><strong>Fits SHA-256 integrity (D030):</strong> P2P needs exactly the integrity verification already designed. Same <code>manifest.yaml</code> checksums, same <code>ic.lock</code> pinning, same verification on install.</li>
<li><strong>Fits WASM target (invariant #10):</strong> WebTorrent enables browser-to-browser P2P. Desktop and browser clients interoperate. No second-class platform.</li>
<li><strong>Popular resources get faster:</strong> More downloads â†’ more seeders â†’ faster downloads for everyone. The opposite of CDN economics where popularity increases cost.</li>
<li><strong>Self-hosting scales:</strong> Community Workshop servers (D030 federation) benefit from the same P2P economics. A small community server needs only a $5 VPS â€” the communityâ€™s players provide the bandwidth.</li>
<li><strong>Privacy-responsible:</strong> IP exposure is equivalent to any multiplayer game. HTTP-only mode available for privacy-sensitive users. No additional surveillance beyond standard BitTorrent protocol.</li>
<li><strong>Proven technology:</strong> BitTorrent has been distributing large files reliably for 20+ years. Blizzard used it for WoW patches. The protocol is well-understood, well-documented, and well-implemented.</li>
</ul>
<h3 id="alternatives-considered-2"><a class="header" href="#alternatives-considered-2">Alternatives Considered</a></h3>
<ul>
<li><strong>Centralized CDN only</strong> (rejected â€” financially unsustainable for a donation-funded community project. A popular 500MB mod downloaded 10K times = 5TB = $50-450/month. P2P reduces this to near-zero marginal cost)</li>
<li><strong>IPFS</strong> (rejected as primary distribution protocol â€” slow cold-content discovery, complex setup, ecosystem declining, content pinning is expensive, poor game-quality UX. However, multiple Bitswap protocol design patterns adopted: EWMA peer scoring, per-peer fairness caps, want-have/want-block two-phase discovery, broadcast control, dual WAN/LAN discovery, delegated HTTP routing, batch provider announcements. See competitive landscape table above and research deep dive)</li>
<li><strong>Custom P2P protocol</strong> (rejected â€” massive engineering effort with no advantage over BitTorrentâ€™s 20-year-proven protocol)</li>
<li><strong>Git LFS</strong> (rejected â€” 1GB free then paid; designed for source code, not binary asset distribution; no P2P)</li>
<li><strong>Steam Workshop only</strong> (rejected â€” platform lock-in, Steam subsidizes hosting from game sales revenue we donâ€™t have, excludes non-Steam/WASM builds)</li>
<li><strong>GitHub Releases only</strong> (rejected â€” works for bootstrap but no search, ratings, dependency resolution, P2P, or lobby auto-download. Adequate interim solution, not long-term architecture)</li>
<li><strong>HTTP-only with community mirrors</strong> (rejected â€” still fragile. Mirrors are one operator away from going offline. P2P is inherently more resilient than any number of mirrors)</li>
<li><strong>No git index / custom server from day one</strong> (rejected â€” premature complexity. A git-hosted index costs $0 and ships with the first playable build. Custom server code can wait until Phase 4-5 when the community is large enough to need search/ratings)</li>
</ul>
<h3 id="phase"><a class="header" href="#phase">Phase</a></h3>
<ul>
<li><strong>Phase 0â€“3:</strong> Git-hosted package index (<code>workshop-index</code> repo) + GitHub Releases for <code>.icpkg</code> storage. Zero infrastructure cost. Community contributes via PR. Game client fetches <code>index.yaml</code> for discovery.</li>
<li><strong>Phase 3â€“4:</strong> Add BitTorrent tracker ($5-10/month VPS). Package manifests gain <code>torrent</code> source entries. P2P delivery begins for large packages. Git index remains the discovery layer.</li>
<li><strong>Phase 4â€“5:</strong> Full Workshop server with integrated BitTorrent/WebTorrent tracker, search, ratings, dependency resolution, P2P delivery, HTTP fallback via S3-compatible storage. Git index can coexist or be subsumed.</li>
<li><strong>Phase 6a:</strong> Federation (community servers join the P2P swarm), Steam Workshop as additional source, Publisher workflows</li>
<li><strong>Format recommendations</strong> apply from Phase 0 â€” all first-party content uses the recommended canonical formats</li>
</ul>
<hr>
<hr>
<h2 id="d053--player-profile-system"><a class="header" href="#d053--player-profile-system">D053 â€” Player Profile System</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th></th></tr>
</thead>
<tbody>
<tr><td><strong>Status</strong></td><td>Accepted</td></tr>
<tr><td><strong>Driver</strong></td><td>Players need a persistent identity, social presence, and reputation display across lobbies, game browser, and community participation</td></tr>
<tr><td><strong>Depends on</strong></td><td>D034 (SQLite), D036 (Achievements), D042 (Behavioral Profiles), D046 (Premium Content), D050 (Workshop), D052 (Community Servers &amp; SCR)</td></tr>
</tbody>
</table>
</div>
<h3 id="problem"><a class="header" href="#problem">Problem</a></h3>
<p>Players in multiplayer games are more than a text name. They need to express their identity, showcase achievements, verify reputation, and build social connections. Without a proper profile system, lobbies feel anonymous and impersonal â€” players canâ€™t distinguish veterans from newcomers, canâ€™t build persistent friendships, and canâ€™t verify who theyâ€™re playing against. Every major gaming platform (Steam, Xbox Live, PlayStation Network, Battle.net, Riot Games, Discord) has learned this: <strong>profiles are the social foundation of a gaming community.</strong></p>
<p>IC has a unique advantage: the Signed Credential Record (SCR) system from D052 means player reputation data (ratings, match counts, achievements) is <strong>cryptographically verified and portable</strong>. No other game has unforgeable, cross-community reputation badges. D053 builds the user-facing system that displays and manages this identity.</p>
<h3 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h3>
<p>Drawn from analysis of Steam, Xbox Live, PSN, Riot Games, Blizzard Battle.net, Discord, and OpenRA:</p>
<ol>
<li><strong>Identity expression without vanity bloat.</strong> Players should personalize their presence (avatar, name, bio) but the system shouldnâ€™t become a cosmetic storefront that distracts from gameplay. Keep it clean and functional.</li>
<li><strong>Reputation is earned, not claimed.</strong> Ratings, achievements, and match counts come from signed SCRs â€” not self-reported. If a player claims to be 1800-rated, their profile proves (or disproves) it.</li>
<li><strong>Privacy by default.</strong> Every profile field has visibility controls. Players choose exactly what they share and with whom. Local behavioral data (D042) is never exposed in profiles.</li>
<li><strong>Portable across communities.</strong> A playerâ€™s profile works on any community server they join. Community-specific data (ratings, achievements) is signed by that community. Cross-community viewing shows aggregated identity with per-community verification badges.</li>
<li><strong>Offline-first.</strong> The profile is stored locally in SQLite (D034). Community-signed data is cached in the local credential store (D052). No server connection needed to view your own profile. Othersâ€™ profiles are fetched and cached on first encounter.</li>
<li><strong>Platform-integrated where possible.</strong> On Steam, friends lists and presence come from Steamâ€™s API via <code>PlatformServices</code>. On standalone builds, IC provides its own social graph backed by community servers. Both paths converge at the same profile UI.</li>
</ol>
<h3 id="profile-structure"><a class="header" href="#profile-structure">Profile Structure</a></h3>
<p>A player profile contains these sections, each with its own visibility controls:</p>
<p><strong>1. Identity Core</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Field</th><th>Description</th><th>Source</th><th>Max Size</th></tr>
</thead>
<tbody>
<tr><td>Display Name</td><td>Primary visible name</td><td>Player-set, locally stored</td><td>32 chars</td></tr>
<tr><td>Avatar</td><td>Profile image</td><td>Pre-built gallery or custom upload</td><td>128Ã—128 PNG, max 64 KB</td></tr>
<tr><td>Banner</td><td>Profile background image</td><td>Pre-built gallery or custom upload</td><td>600Ã—200 PNG, max 128 KB</td></tr>
<tr><td>Bio</td><td>Short self-description</td><td>Player-written</td><td>500 chars</td></tr>
<tr><td>Player Title</td><td>Earned or selected title (e.g., â€œIron Commanderâ€, â€œMammoth Enthusiastâ€)</td><td>Achievement reward or community grant</td><td>48 chars</td></tr>
<tr><td>Faction Crest</td><td>Preferred faction emblem (displayed on profile card)</td><td>Player-selected from game module factions</td><td>Enum per game module</td></tr>
</tbody>
</table>
</div>
<p><strong>Display names</strong> are not globally unique. Uniqueness is per-community (the community server enforces its own name policy). In a lobby, players are identified by <code>display_name + community_badge</code> or <code>display_name + player_key_prefix</code> when no community is shared. This matches how Discord handles names post-2023 (display names are cosmetic, uniqueness is contextual).</p>
<p><strong>Avatar system:</strong></p>
<ul>
<li><strong>Pre-built gallery:</strong> Ships with ~60 avatars extracted from C&amp;C unit portraits, faction emblems, and structure icons (using game assets the player already owns â€” loaded by <code>ra-formats</code>, not distributed by IC). Each game module contributes its own set.</li>
<li><strong>Custom upload:</strong> Players can set any 128Ã—128 PNG image (max 64 KB) as their avatar. The image is stored in the local profile. When joining a lobby, only the SHA-256 hash is transmitted (32 bytes). Other clients fetch the actual image on demand from the player (via the relay, same channel as P2P resource sharing from D052). Fetched avatars are cached locally.</li>
<li><strong>Content moderation:</strong> Custom avatars are not moderated by IC (no central server to moderate). Community servers can optionally enforce â€œgallery-only avatarsâ€ as a room policy. Players can report abusive avatars to community moderators via the same mechanism used for reporting cheaters (D052 revocation).</li>
<li><strong>Hash-based deduplication:</strong> Two players using the same custom avatar send the same hash. The image is fetched once and shared from cache. This also means pre-built gallery avatars never need network transfer â€” both clients have them locally.</li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct PlayerAvatar {
    pub source: AvatarSource,
    pub hash: [u8; 32],          // SHA-256 of the PNG data
}

pub enum AvatarSource {
    Gallery { module: GameModuleId, index: u16 },  // Pre-built
    Custom,                                          // Player-uploaded PNG
}
<span class="boring">}</span></code></pre>
<p><strong>2. Achievement Showcase</strong></p>
<p>Players can <strong>pin up to 6 achievements</strong> to their profile from their D036 achievement collection. Pinned achievements appear prominently on the profile card and in lobby hover tooltips.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜… Achievements (3 pinned / 47 total)                 â”‚
â”‚  ğŸ† Iron Curtain           Survived 100 Ion Cannons  â”‚
â”‚  ğŸ–ï¸ Desert Fox             Win 50 Desert maps        â”‚
â”‚  âš¡ Blitz Commander         Win under 5 minutes       â”‚
â”‚                                                      â”‚
â”‚  [View All Achievements â†’]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ul>
<li>Pinned achievements are verified: each has a backing SCR from the relevant community. Viewers can inspect the credential (signed by community X, earned on date Y).</li>
<li>Achievement rarity is shown when viewing the full achievement list: â€œEarned by 12% of players on this community.â€</li>
<li>Mod-defined achievements (D036) appear in the profile just like built-in ones â€” theyâ€™re all SCRs.</li>
</ul>
<p><strong>3. Statistics Card</strong></p>
<p>A summary of the playerâ€™s competitive record, sourced from verified SCRs (D052). Statistics are <strong>per-community, per-game-module</strong> â€” a player might be 1800 in RA1 on Official IC but 1400 in TD on Clan Wolfpack.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Statistics â€” Official IC Community (RA1)          â”‚
â”‚                                                      â”‚
â”‚  Rank:      â˜… Colonel I                                 â”‚
â”‚  Rating:    1971 Â± 45 (Glicko-2)     Peak: 2023     â”‚
â”‚  Season:    S3 2028  |  Peak Rank: Brigadier III    â”‚
â”‚  Matches:   342 played  |  W: 198  L: 131  D: 13    â”‚
â”‚  Win Rate:  57.9%                                    â”‚
â”‚  Streak:    W4 (current)  |  Best: W11               â”‚
â”‚  Playtime:  ~412 hours                               â”‚
â”‚  Faction:   67% Soviet  |  28% Allied  |  5% Random  â”‚
â”‚                                                      â”‚
â”‚  [Match History â†’]  [Rating Graph â†’]                 â”‚
â”‚  [Switch Community â–¾]  [Switch Game Module â–¾]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ul>
<li><strong>Rank tier badge (D055):</strong> Resolved from the game moduleâ€™s <code>ranked-tiers.yaml</code> configuration. Shows current tier + division and peak tier this season. Icon and color from the tier definition.</li>
<li><strong>Rating graph:</strong> Visual chart showing rating over time (last 50 matches). Rendered client-side from match SCR timestamps and rating deltas.</li>
<li><strong>Faction distribution:</strong> Calculated from match SCRs. Displayed as a simple bar or pie.</li>
<li><strong>Playtime:</strong> Estimated from match durations in local match history. Approximate â€” not a verified claim.</li>
<li><strong>Win streak:</strong> Current and best, calculated client-side from match SCRs.</li>
<li>All numbers come from signed credential records. If a player presents a 1800 rating badge, the viewerâ€™s client cryptographically verifies it against the communityâ€™s public key. <strong>Fake ratings are mathematically impossible.</strong></li>
<li><strong>Verification badge:</strong> Each stat line shows which community signed it and whether the viewerâ€™s client successfully verified the signature. A âœ… means â€œsignature valid, community key recognized.â€ A âš ï¸ means â€œsignature valid, but community key not in your trusted list.â€ A âŒ means â€œsignature verification failed â€” possible tampering.â€ This is visible in the detailed stats view, not the compact tooltip (to avoid visual clutter).</li>
<li><strong>Inspect credential:</strong> Any SCR-backed number in the profile is clickable. Clicking opens a verification detail panel showing: signing community name + public key fingerprint, SCR sequence number, signature timestamp, raw signed payload (hex-encoded), and verification result. This is the blockchain-style â€œprove itâ€ button â€” except itâ€™s just Ed25519 signatures, no blockchain needed.</li>
</ul>
<p><strong>4. Match History</strong></p>
<p>Scrollable list of recent matches, each showing:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Field</th><th>Source</th></tr>
</thead>
<tbody>
<tr><td>Date &amp; time</td><td>Match SCR timestamp</td></tr>
<tr><td>Map name</td><td>Match SCR metadata</td></tr>
<tr><td>Players</td><td>Match SCR participant list</td></tr>
<tr><td>Result (Win/Loss/Draw)</td><td>Match SCR outcome</td></tr>
<tr><td>Rating change (+/- delta)</td><td>Computed from consecutive rating SCRs</td></tr>
<tr><td>Replay link</td><td>Local replay file if available</td></tr>
</tbody>
</table>
</div>
<p>Match history is stored locally (from the playerâ€™s credential SQLite file). Community servers do not host full match histories â€” they only issue rating/match SCRs. This is consistent with the local-first principle.</p>
<p><strong>5. Friends &amp; Social</strong></p>
<p>IC supports two complementary friend systems:</p>
<ul>
<li><strong>Platform friends (Steam, GOG, etc.):</strong> Retrieved via <code>PlatformServices::friends_list()</code>. These are the playerâ€™s existing social graph â€” no IC-specific action needed. Platform friends appear in the in-game friends list automatically. Presence information (online, in-game, in-lobby) is synced bidirectionally with the platform.</li>
<li><strong>IC friends (community-based):</strong> Players can add friends within a community by mutual friend request. Stored in the local credential file as a bidirectional relationship. Friend list is per-community (friend on Official IC â‰  friend on Clan Wolfpack), but the UI merges all community friends into one unified list with community labels.</li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Stored in local SQLite â€” not a signed credential.
/// Friendships are social bookmarks, not reputation data.
pub struct FriendEntry {
    pub player_key: [u8; 32],
    pub display_name: String,         // cached, may be stale
    pub community: CommunityId,       // where the friendship was made
    pub added_at: u64,
    pub notes: Option&lt;String&gt;,        // private label (e.g., "met in tournament")
}
<span class="boring">}</span></code></pre>
<p><strong>Friends list UI:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¥ Friends (8 online / 23 total)                     â”‚
â”‚                                                      â”‚
â”‚  ğŸŸ¢ alice          In Lobby â€” Desert Arena    [Join] â”‚
â”‚  ğŸŸ¢ cmdrzod        In Game â€” RA1 1v1          [Spec] â”‚
â”‚  ğŸŸ¡ bob            Away (15m)                        â”‚
â”‚  ğŸŸ¢ carol          Online â€” Main Menu         [Inv]  â”‚
â”‚  â”€â”€â”€ Offline â”€â”€â”€                                     â”‚
â”‚  âš« dave           Last seen: 2 days ago             â”‚
â”‚  âš« eve            Last seen: 1 week ago             â”‚
â”‚                                                      â”‚
â”‚  [Add Friend]  [Pending (2)]  [Blocked (1)]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ul>
<li><strong>Presence states:</strong> Online, In Game, In Lobby, Away, Invisible, Offline. Synced through the community server (lightweight heartbeat), or through <code>PlatformServices::set_presence()</code> on Steam/GOG/etc.</li>
<li><strong>Join/Spectate/Invite:</strong> One-click actions from the friends list. â€œJoinâ€ puts you in their lobby. â€œSpecâ€ joins as spectator if the match is in progress and allows it. â€œInviteâ€ sends a lobby invite.</li>
<li><strong>Friend requests:</strong> Mutual-consent only. Player A sends request, Player B accepts or declines. No one-sided â€œfollowingâ€ (this prevents stalking).</li>
<li><strong>Block list:</strong> Blocked players are hidden from the friends list, their chat messages are filtered client-side (see Lobby Communication in D052), and they cannot send friend requests. Blocks are local-only â€” the blocked player is not notified.</li>
<li><strong>Notes:</strong> Private per-friend notes visible only to you. Useful for remembering context (â€œgreat teammateâ€, â€œmet at tournamentâ€).</li>
</ul>
<p><strong>6. Community Memberships</strong></p>
<p>Players can be members of multiple communities (D052). The profile displays which communities they belong to, with verification badges:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›ï¸ Communities                                       â”‚
â”‚                                                      â”‚
â”‚  âœ… Official IC Community     Member since 2027-01   â”‚
â”‚     Rating: 1823 (RA1)  |  342 matches               â”‚
â”‚  âœ… Clan Wolfpack             Member since 2027-03   â”‚
â”‚     Rating: 1456 (TD)   |  87 matches                â”‚
â”‚  âœ… RA Competitive League     Member since 2027-06   â”‚
â”‚     Tournament rank: #12                              â”‚
â”‚                                                      â”‚
â”‚  [Join Community...]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>Each community membership is backed by a signed credential â€” the âœ… badge means the viewerâ€™s client verified the SCR signature against the communityâ€™s public key. This is ICâ€™s differentiator: <strong>community memberships are cryptographically proven, not self-claimed.</strong> When viewing another playerâ€™s profile, you can see exactly which communities vouch for them and their verified standing in each.</p>
<p><strong>Signed Profile Summary (â€œproof sheetâ€)</strong></p>
<p>When viewing another playerâ€™s full profile, a <strong>Verification Summary</strong> panel shows every community that has signed data for this player, what theyâ€™ve signed, and whether the signatures check out:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ Profile Verification Summary                                 â”‚
â”‚                                                                  â”‚
â”‚  Community                Signed Data             Status         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚  Official IC Community    Rating (1823, RA1)      âœ… Verified    â”‚
â”‚                           342 matches             âœ… Verified    â”‚
â”‚                           23 achievements         âœ… Verified    â”‚
â”‚                           Member since 2027-01    âœ… Verified    â”‚
â”‚  Clan Wolfpack            Rating (1456, TD)       âœ… Verified    â”‚
â”‚                           87 matches              âœ… Verified    â”‚
â”‚                           Member since 2027-03    âœ… Verified    â”‚
â”‚  RA Competitive League    Tournament rank #12     âš ï¸ Untrusted   â”‚
â”‚                           Member since 2027-06    âš ï¸ Untrusted   â”‚
â”‚                                                                  â”‚
â”‚  âœ… = Signature verified, community in your trust list           â”‚
â”‚  âš ï¸ = Signature valid, community NOT in your trust list          â”‚
â”‚  âŒ = Signature verification failed (possible tampering)         â”‚
â”‚                                                                  â”‚
â”‚  [Manage Trusted Communities...]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>This panel answers the question: <strong>â€œCan I trust what this playerâ€™s profile claims?â€</strong> The answer is always cryptographically grounded â€” not trust-me-bro, not server-side-only, but locally verified Ed25519 signatures against community public keys the viewer explicitly trusts.</p>
<p><strong>How verification works (viewer-side flow):</strong></p>
<ol>
<li>Player B presents profile data to Player A.</li>
<li>Each SCR-backed field includes the raw SCR (payload + signature + community public key).</li>
<li>Player Aâ€™s client verifies: <code>Ed25519::verify(community_public_key, payload, signature)</code>.</li>
<li>Player Aâ€™s client checks: is <code>community_public_key</code> in my <code>trusted_communities</code> table?</li>
<li>If yes â†’ âœ… Verified. If signature valid but community not trusted â†’ âš ï¸ Untrusted. If signature invalid â†’ âŒ Failed.</li>
<li>All unsigned fields (bio, avatar, display name) are displayed as player-claimed â€” no verification badge.</li>
</ol>
<p>This means <strong>every number in the Statistics Card and every badge in Community Memberships is independently verifiable by any viewer</strong> without contacting any server. The verification is offline-capable â€” if a player has the communityâ€™s public key cached, they can verify another playerâ€™s profile on a plane with no internet.</p>
<p><strong>7. Workshop Creator Profile</strong></p>
<p>For players who publish mods, maps, or assets to the Workshop (D030/D050), the profile shows a creator section:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ Workshop Creator                                  â”‚
â”‚                                                      â”‚
â”‚  Published: 12 resources  |  Total downloads: 8,420  â”‚
â”‚  â˜… Featured: alice/hd-sprites (4,200 downloads)      â”‚
â”‚  Latest: alice/desert-nights (uploaded 3 days ago)   â”‚
â”‚                                                      â”‚
â”‚  [View All Publications â†’]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>This section appears only for players who have published at least one Workshop resource. Download counts and publication metadata come from the Workshop registry index (D030). Creator tips (D035) link from here.</p>
<p><strong>8. Custom Profile Elements</strong></p>
<p>Optional fields that add personality without cluttering the default view:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Element</th><th>Description</th><th>Source</th></tr>
</thead>
<tbody>
<tr><td>Favorite Quote</td><td>One-liner (e.g., â€œKirov reporting!â€)</td><td>Player-written, 100 chars max</td></tr>
<tr><td>Favorite Unit</td><td>Displayed with unit portrait from game assets</td><td>Player-selected per game module</td></tr>
<tr><td>Replay Highlight</td><td>Link to one pinned replay</td><td>Local replay file</td></tr>
<tr><td>Social Links</td><td>External URLs (Twitch, YouTube, etc.)</td><td>Player-set, max 3 links</td></tr>
<tr><td>Country Flag</td><td>Optional nationality display</td><td>Player-selected from ISO 3166 list</td></tr>
</tbody>
</table>
</div>
<p>These fields are optional and hidden by default. Players who want a minimal profile show only the identity core and statistics. Players who want a rich social presence can fill in everything.</p>
<h3 id="profile-viewing-contexts"><a class="header" href="#profile-viewing-contexts">Profile Viewing Contexts</a></h3>
<p>The profile appears in different contexts with different levels of detail:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Context</th><th>Whatâ€™s shown</th></tr>
</thead>
<tbody>
<tr><td><strong>Lobby player list</strong></td><td>Avatar (32Ã—32), display name, rating badge, voice status, ready state</td></tr>
<tr><td><strong>Lobby hover tooltip</strong></td><td>Avatar (64Ã—64), display name, bio (first line), top 3 pinned achievements, rating, win rate</td></tr>
<tr><td><strong>Profile card</strong> (click player name)</td><td>Full profile: all sections respecting the viewed playerâ€™s privacy settings</td></tr>
<tr><td><strong>Game browser</strong> (room list)</td><td>Host avatar + name, host rating badge</td></tr>
<tr><td><strong>In-game sidebar</strong></td><td>Player color, display name, faction crest</td></tr>
<tr><td><strong>Post-game scoreboard</strong></td><td>Avatar, display name, rating change (+/-), match stats</td></tr>
<tr><td><strong>Friends list</strong></td><td>Avatar, display name, presence state, community label</td></tr>
</tbody>
</table>
</div>
<h3 id="privacy-controls"><a class="header" href="#privacy-controls">Privacy Controls</a></h3>
<p>Every profile section has a visibility setting:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Visibility Level</th><th>Who can see it</th></tr>
</thead>
<tbody>
<tr><td><strong>Public</strong></td><td>Anyone who encounters your profile (lobby, game browser, post-game)</td></tr>
<tr><td><strong>Friends</strong></td><td>Only players on your friends list</td></tr>
<tr><td><strong>Community</strong></td><td>Only players who share at least one community membership with you</td></tr>
<tr><td><strong>Private</strong></td><td>Only you</td></tr>
</tbody>
</table>
</div>
<p>Defaults:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Section</th><th>Default Visibility</th></tr>
</thead>
<tbody>
<tr><td>Display Name</td><td>Public</td></tr>
<tr><td>Avatar</td><td>Public</td></tr>
<tr><td>Bio</td><td>Public</td></tr>
<tr><td>Player Title</td><td>Public</td></tr>
<tr><td>Faction Crest</td><td>Public</td></tr>
<tr><td>Achievement Showcase</td><td>Public</td></tr>
<tr><td>Statistics Card</td><td>Public</td></tr>
<tr><td>Match History</td><td>Friends</td></tr>
<tr><td>Friends List</td><td>Friends</td></tr>
<tr><td>Community Memberships</td><td>Public</td></tr>
<tr><td>Workshop Creator</td><td>Public</td></tr>
<tr><td>Custom Elements</td><td>Friends</td></tr>
<tr><td>Behavioral Profile (D042)</td><td><strong>Private (immutable â€” never exposed)</strong></td></tr>
</tbody>
</table>
</div>
<p>The behavioral profile from D042 (<code>PlayerStyleProfile</code>) is <strong>categorically excluded</strong> from the player profile. Itâ€™s local analytics data for AI training and self-improvement â€” not social data. This is a hard privacy boundary.</p>
<h3 id="profile-storage"><a class="header" href="#profile-storage">Profile Storage</a></h3>
<p>Local profile data is stored in the playerâ€™s SQLite database (D034):</p>
<pre><code class="language-sql">-- Core profile (locally authoritative)
CREATE TABLE profile (
    player_key      BLOB PRIMARY KEY,  -- own Ed25519 public key
    display_name    TEXT NOT NULL,
    bio             TEXT,
    title           TEXT,
    country_code    TEXT,              -- ISO 3166 alpha-2, nullable
    favorite_quote  TEXT,
    favorite_unit   TEXT,              -- "module:unit_id" format
    created_at      INTEGER NOT NULL,
    updated_at      INTEGER NOT NULL
);

-- Avatar and banner images (stored as blobs)
CREATE TABLE profile_images (
    image_hash      TEXT PRIMARY KEY,  -- SHA-256 hex
    image_type      TEXT NOT NULL,     -- 'avatar' or 'banner'
    image_data      BLOB NOT NULL,     -- PNG bytes
    width           INTEGER NOT NULL,
    height          INTEGER NOT NULL
);

-- Profile references (avatar, banner, highlight replay)
CREATE TABLE profile_refs (
    ref_type        TEXT PRIMARY KEY,  -- 'avatar', 'banner', 'highlight_replay'
    ref_value       TEXT NOT NULL      -- image_hash, or replay file path
);

-- Pinned achievements (up to 6)
CREATE TABLE pinned_achievements (
    slot            INTEGER PRIMARY KEY CHECK (slot BETWEEN 1 AND 6),
    achievement_id  TEXT NOT NULL,     -- references achievements table (D036)
    community_id    BLOB,             -- which community signed it (nullable for local)
    pinned_at       INTEGER NOT NULL
);

-- Friends list
CREATE TABLE friends (
    player_key      BLOB NOT NULL,
    community_id    BLOB NOT NULL,     -- community where friendship was established
    display_name    TEXT,              -- cached name (may be stale)
    notes           TEXT,
    added_at        INTEGER NOT NULL,
    PRIMARY KEY (player_key, community_id)
);

-- Block list
CREATE TABLE blocked_players (
    player_key      BLOB PRIMARY KEY,
    reason          TEXT,
    blocked_at      INTEGER NOT NULL
);

-- Privacy settings
CREATE TABLE privacy_settings (
    section         TEXT PRIMARY KEY,  -- 'bio', 'stats', 'match_history', etc.
    visibility      TEXT NOT NULL      -- 'public', 'friends', 'community', 'private'
);

-- Social links (max 3)
CREATE TABLE social_links (
    slot            INTEGER PRIMARY KEY CHECK (slot BETWEEN 1 AND 3),
    label           TEXT NOT NULL,     -- 'Twitch', 'YouTube', custom
    url             TEXT NOT NULL
);

-- Cached profiles of other players (fetched on encounter)
CREATE TABLE cached_profiles (
    player_key      BLOB PRIMARY KEY,
    display_name    TEXT,
    avatar_hash     TEXT,
    bio             TEXT,
    title           TEXT,
    last_seen       INTEGER,          -- timestamp of last encounter
    fetched_at      INTEGER NOT NULL
);

-- Trusted communities (for profile verification and matchmaking filtering)
CREATE TABLE trusted_communities (
    community_key   BLOB PRIMARY KEY,  -- Ed25519 public key of the community
    community_name  TEXT,              -- cached display name
    community_url   TEXT,              -- cached URL
    auto_trusted    INTEGER NOT NULL DEFAULT 0,  -- 1 if trusted because you're a member
    trusted_at      INTEGER NOT NULL
);

-- Cached community public keys (learned from encounters, not yet trusted)
CREATE TABLE known_communities (
    community_key   BLOB PRIMARY KEY,
    community_name  TEXT,
    community_url   TEXT,
    first_seen      INTEGER NOT NULL,  -- when we first encountered this key
    last_seen       INTEGER NOT NULL
);
</code></pre>
<p><strong>Cache eviction:</strong> Cached profiles of other players are evicted LRU after 1000 entries or 30 days since last encounter. Avatar images in <code>profile_images</code> are evicted if theyâ€™re not referenced by own profile or any cached profile.</p>
<h3 id="profile-synchronization"><a class="header" href="#profile-synchronization">Profile Synchronization</a></h3>
<p>Profiles are <strong>not centrally hosted</strong>. Each player owns their profile data locally. When a player enters a lobby or is viewed by another player, profile data is exchanged peer-to-peer (via the relay, same as resource sharing in D052).</p>
<p><strong>Flow when Player A views Player Bâ€™s profile:</strong></p>
<ol>
<li>Player Aâ€™s client checks <code>cached_profiles</code> for Player Bâ€™s key.</li>
<li>If cache miss or stale (&gt;24 hours), request profile from Player B via relay.</li>
<li>Player Bâ€™s client responds with profile data (respecting Bâ€™s privacy settings â€” only fields visible to Aâ€™s access level are included).</li>
<li>Player Aâ€™s client verifies any SCR-backed fields (ratings, achievements, community memberships) against known community public keys.</li>
<li>Player Aâ€™s client caches the profile.</li>
<li>If Player Bâ€™s avatar hash is unknown, Player A requests the avatar image. Cached locally after fetch.</li>
</ol>
<p><strong>Bandwidth:</strong> A full profile response is ~2 KB (excluding avatar image). Avatar image is max 64 KB, fetched once and cached. For a typical lobby of 8 players, initial profile loading is ~16 KB text + up to 512 KB avatars â€” negligible, and avatars are fetched only once per unique player.</p>
<h3 id="trusted-communities--trust-based-filtering"><a class="header" href="#trusted-communities--trust-based-filtering">Trusted Communities &amp; Trust-Based Filtering</a></h3>
<p>Players can configure a list of <strong>trusted communities</strong> â€” the communities whose signed credentials they consider authoritative. This is the trust anchor for everything in the profile system.</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-toml"># settings.toml â€” communities section
[[communities.joined]]
name = "Official IC Community"
url = "https://official.ironcurtain.gg"
public_key = "ed25519:abc123..."   # cached on first join

[[communities.joined]]
name = "Clan Wolfpack"
url = "https://wolfpack.example.com"
public_key = "ed25519:def456..."

[communities]
# Communities whose signed credentials you trust for profile verification
# and matchmaking filtering. You don't need to be a member to trust a community.
trusted = [
    "ed25519:abc123...",    # Official IC Community
    "ed25519:def456...",    # Clan Wolfpack
    "ed25519:789ghi...",    # EU Competitive League (not a member, but trust their ratings)
]
</code></pre>
<p>Joined communities are automatically trusted (you trust the community you chose to join). Players can also trust communities they havenâ€™t joined â€” e.g., â€œIâ€™m not a member of the EU Competitive League, but I trust their ratings as legitimate.â€ Trust is granted by public key, so it survives community renames and URL changes.</p>
<p><strong>Trust levels displayed in profiles:</strong></p>
<p>When viewing another playerâ€™s profile, stats from trusted vs. untrusted communities are visually distinct:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Badge</th><th>Meaning</th><th>Display</th></tr>
</thead>
<tbody>
<tr><td>âœ…</td><td>Signature valid + community in your trust list</td><td>Full color, prominent</td></tr>
<tr><td>âš ï¸</td><td>Signature valid + community NOT in your trust list</td><td>Dimmed, italic, â€œUntrusted communityâ€ tooltip</td></tr>
<tr><td>âŒ</td><td>Signature verification failed</td><td>Red, strikethrough, â€œVerification failedâ€ warning</td></tr>
<tr><td>â€”</td><td>No signed data (player-claimed)</td><td>Gray, no badge</td></tr>
</tbody>
</table>
</div>
<p>This lets players immediately distinguish between â€œ1800 rated on a community I trustâ€ and â€œ1800 rated on some random community Iâ€™ve never heard of.â€ The profile doesnâ€™t hide untrusted data â€” it shows it clearly labeled so the viewer can make their own judgment.</p>
<p><strong>Trust-based matchmaking and lobby filtering:</strong></p>
<p>Players can require that opponents have verified credentials from their trusted communities. This is configured per-queue and per-room:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Matchmaking preferences â€” sent to the community server when queuing.
pub struct MatchmakingPreferences {
    pub game_module: GameModuleId,
    pub rating_range: Option&lt;(i32, i32)&gt;,             // min/max rating
    pub require_trusted_profile: TrustRequirement,     // NEW
}

pub enum TrustRequirement {
    /// Match with anyone â€” no credential check. Default for casual.
    None,
    /// Opponent must have a verified profile from any community
    /// the matchmaking server itself trusts (server-side check).
    AnyCommunityVerified,
    /// Opponent must have a verified profile from at least one of
    /// these specific communities (by public key). Client sends
    /// the list; server filters accordingly.
    SpecificCommunities(Vec&lt;CommunityPublicKey&gt;),
}
<span class="boring">}</span></code></pre>
<p><strong>How it works in practice:</strong></p>
<ul>
<li><strong>Casual play (default):</strong> <code>TrustRequirement::None</code>. Anyone can join. Profile badges appear but arenâ€™t gatekeeping. Maximum player pool, minimum friction.</li>
<li><strong>â€œVerified onlyâ€ mode:</strong> <code>TrustRequirement::AnyCommunityVerified</code>. The matchmaking server checks that the opponent has at least one valid SCR from a community the <em>server</em> trusts. This filters out completely anonymous players without requiring specific community membership. Good for semi-competitive play.</li>
<li><strong>â€œTrusted communityâ€ mode:</strong> <code>TrustRequirement::SpecificCommunities([official_ic_key, wolfpack_key])</code>. The server matches you only with players who have valid SCRs from at least one of those specific communities. This is the strongest filter â€” effectively â€œI only play with people vouched for by communities I trust.â€</li>
</ul>
<p><strong>Room-level trust requirements:</strong></p>
<p>Room hosts can set a trust requirement when creating a room:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Room Settings                                        â”‚
â”‚                                                      â”‚
â”‚  Trust Requirement: [Verified Only â–¾]                â”‚
â”‚    â—‹ Anyone can join (no verification)               â”‚
â”‚    â— Verified profile required                       â”‚
â”‚    â—‹ Specific communities only:                      â”‚
â”‚      â˜‘ Official IC Community                         â”‚
â”‚      â˜‘ Clan Wolfpack                                 â”‚
â”‚      â˜ EU Competitive League                         â”‚
â”‚                                                      â”‚
â”‚  [Create Room]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>When a player tries to join a room with a trust requirement they donâ€™t meet, they see a clear rejection: â€œThis room requires a verified profile from: Official IC Community or Clan Wolfpack. [Join Official IC Communityâ€¦] [Join Clan Wolfpackâ€¦]â€</p>
<p><strong>Game browser filtering:</strong></p>
<p>The game browser (Tier 3 in D052) gains a trust filter column:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Game Browser                                              [Refresh]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Room     â”‚ Host â”‚ Players â”‚ Map    â”‚ Ping â”‚ Trust         â”‚ Mods        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ranked   â”‚ cmdr â”‚ 1/2     â”‚ Arena  â”‚ 23ms â”‚ âœ… Official   â”‚ none        â”‚
â”‚ HD Game  â”‚ aliceâ”‚ 3/4     â”‚ Europe â”‚ 45ms â”‚ âš ï¸ Any verifiedâ”‚ hd-pack 2.1 â”‚
â”‚ Open     â”‚ bob  â”‚ 2/6     â”‚ Desert â”‚ 67ms â”‚ ğŸ”“ Anyone     â”‚ none        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  Filter: [â˜‘ Show only rooms I can join]  [â˜‘ Show trusted communities]   â”‚
</code></pre>
<p>The <code>Show only rooms I can join</code> filter hides rooms whose trust requirements you donâ€™t meet â€” so you donâ€™t see rooms youâ€™ll be rejected from. The <code>Show trusted communities</code> filter shows only rooms hosted on communities in your trust list.</p>
<p><strong>Why this matters:</strong></p>
<p>This solves the smurf/alt-account problem that plagues every competitive game. A player canâ€™t create a fresh anonymous account and grief ranked lobbies â€” the room requires verified credentials from a trusted community, which means they need a real history of matches. It also solves the fake-rating problem: you canâ€™t claim to be 1800 unless a community you trust has signed an SCR proving it.</p>
<p>But itâ€™s <strong>not authoritarian</strong>. Players who want casual, open, unverified games can play freely. Trust requirements are opt-in per-room and per-matchmaking-queue. The default is open. The tools are there for communities that want stronger verification â€” theyâ€™re not forced on anyone.</p>
<p><strong>Anti-abuse considerations:</strong></p>
<ul>
<li><strong>Community collusion:</strong> A bad actor could create a community, sign fake credentials, and present them. But no one else would trust that communityâ€™s key. Trust is explicitly granted by each player. This is a feature, not a bug â€” itâ€™s exactly how PGP/GPG web-of-trust works, minus the key-signing parties.</li>
<li><strong>Community ban evasion:</strong> If a player is banned from a community (D052 revocation), their SCRs from that community become unverifiable. They canâ€™t present banned credentials. Theyâ€™d need to join a different community and rebuild reputation from scratch.</li>
<li><strong>Privacy:</strong> The trust requirement reveals which communities a player is a member of (since they must present SCRs). Players uncomfortable with this can stick to <code>TrustRequirement::None</code> rooms. The privacy controls from D053 still apply â€” you choose which community memberships are visible on your profile, but if a room <em>requires</em> membership proof, you must present it to join.</li>
</ul>
<h3 id="relationship-to-existing-decisions-1"><a class="header" href="#relationship-to-existing-decisions-1">Relationship to Existing Decisions</a></h3>
<ul>
<li><strong>D034 (SQLite):</strong> Profile storage is SQLite. Cached profiles, friends, block lists â€” all local SQLite tables.</li>
<li><strong>D036 (Achievements):</strong> Pinned achievements on the profile reference D036 achievement records. Achievement verification uses D052 SCRs.</li>
<li><strong>D042 (Behavioral Profiles):</strong> Categorically separate. D042 is local AI training data. D053 is social-facing identity. They never merge. This is a hard privacy boundary.</li>
<li><strong>D046 (Premium Content):</strong> Cosmetic purchases (if any) are displayed in the profile (e.g., custom profile borders, title unlocks). But the core profile is always free and full-featured.</li>
<li><strong>D050 (Workshop):</strong> Workshop creator statistics feed the creator profile section.</li>
<li><strong>D052 (Community Servers &amp; SCR):</strong> The verification backbone. Every reputation claim in the profile (rating, achievements, community membership) is backed by a signed credential. D053 is the user-facing layer; D052 is the cryptographic foundation. Trusted Communities (D053) determine which SCR issuers the player considers authoritative â€” this feeds into profile display, lobby filtering, and matchmaking preferences.</li>
</ul>
<h3 id="alternatives-considered-3"><a class="header" href="#alternatives-considered-3">Alternatives Considered</a></h3>
<ul>
<li><strong>Central profile server</strong> (rejected â€” contradicts federation model, creates single point of failure, requires infrastructure IC doesnâ€™t want to operate)</li>
<li><strong>Blockchain-based identity</strong> (rejected â€” massively overcomplicated, no user benefit over Ed25519 SCR, environmental concerns)</li>
<li><strong>Rich profile customization (themes, animations, music)</strong> (deferred â€” too much scope for initial implementation. May be added as Workshop cosmetic packs in Phase 6+)</li>
<li><strong>Full social network features (posts, feeds, groups)</strong> (rejected â€” out of scope. IC is a game, not a social network. Communities, friends, and profiles are sufficient. Players who want social features use Discord)</li>
<li><strong>Mandatory real name / identity verification</strong> (rejected â€” privacy violation, hostile to the gaming communityâ€™s norms, not ICâ€™s business)</li>
</ul>
<h3 id="phase-1"><a class="header" href="#phase-1">Phase</a></h3>
<ul>
<li><strong>Phase 3:</strong> Basic profile (display name, avatar, bio, local storage, lobby display). Friends list (platform-backed via <code>PlatformServices</code>).</li>
<li><strong>Phase 5:</strong> Community-backed profiles (SCR-verified ratings, achievements, memberships). IC friends (community-based mutual friend requests). Presence system. Profile cards in lobby. Trusted communities configuration. Trust-based matchmaking filtering. Profile verification UI (signed proof sheet). Game browser trust filters.</li>
<li><strong>Phase 6a:</strong> Workshop creator profiles. Full achievement showcase. Custom profile elements. Privacy controls UI. Profile viewing in game browser. Cross-community trust discovery.</li>
</ul>
<hr>
<hr>
<h2 id="d061-player-data-backup--portability"><a class="header" href="#d061-player-data-backup--portability">D061: Player Data Backup &amp; Portability</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th></th></tr>
</thead>
<tbody>
<tr><td><strong>Status</strong></td><td>Accepted</td></tr>
<tr><td><strong>Driver</strong></td><td>Players need to back up, restore, and migrate their game data â€” saves, replays, profiles, screenshots, statistics â€” across machines and over time</td></tr>
<tr><td><strong>Depends on</strong></td><td>D034 (SQLite), D053 (Player Profile), D052 (Community Servers &amp; SCR), D036 (Achievements), D010 (Snapshottable Sim)</td></tr>
</tbody>
</table>
</div>
<h3 id="problem-1"><a class="header" href="#problem-1">Problem</a></h3>
<p>Every game that stores player data eventually faces the same question: â€œHow do I move my stuff to a new computer?â€ The answer ranges from terrible (hunt for hidden AppData folders, hope you got the right files) to opaque (proprietary cloud sync that works until it doesnâ€™t). ICâ€™s local-first architecture (D034, D053) means all player data already lives on the playerâ€™s machine â€” which is both the opportunity and the responsibility. If everything is local, losing that data means losing everything: campaign progress, competitive history, replay collection, social connections.</p>
<p>The design must satisfy three requirements:</p>
<ol>
<li><strong>Backup:</strong> A player can create a complete, restorable snapshot of all their IC data.</li>
<li><strong>Portability:</strong> A player can move their data to another machine or a fresh install and resume exactly where they left off.</li>
<li><strong>Data export:</strong> A player can extract their data in standard, human-readable formats (GDPR Article 20 compliance, and just good practice).</li>
</ol>
<h3 id="design-principles-1"><a class="header" href="#design-principles-1">Design Principles</a></h3>
<ol>
<li><strong>â€œJust copy the folderâ€ must work.</strong> The data directory is self-contained. No registry entries, no hidden temp folders, no external database connections. A manual copy of <code>&lt;data_dir&gt;/</code> is a valid (if crude) backup.</li>
<li><strong>Standard formats only.</strong> ZIP for archives, SQLite for databases, PNG for images, YAML/JSON for configuration. No proprietary backup format. A player should be able to inspect their own data with standard tools (DB Browser for SQLite, any image viewer, any text editor).</li>
<li><strong>No IC-hosted cloud.</strong> IC does not operate cloud storage. Cloud sync is opt-in through existing platform services (Steam Cloud, GOG Galaxy). This avoids infrastructure cost, liability, and the temptation to make player data hostage to a service.</li>
<li><strong>SCRs are inherently portable.</strong> Signed Credential Records (D052) are self-verifying â€” they carry the community public key, payload, and Ed25519 signature. A playerâ€™s verified ratings, achievements, and community memberships work on any IC install without re-earning or re-validating. This is ICâ€™s unique advantage over every competitor.</li>
<li><strong>Backup is a first-class CLI feature.</strong> Not buried in a settings menu, not a third-party tool. <code>ic backup create</code> is a documented, supported command.</li>
</ol>
<h3 id="data-directory-layout"><a class="header" href="#data-directory-layout">Data Directory Layout</a></h3>
<p>All player data lives under a single, stable, documented directory. The layout is defined at Phase 0 (directory structure), stabilized by Phase 2 (save/replay formats finalized), and fully populated by Phase 5 (multiplayer profile data).</p>
<pre><code>&lt;data_dir&gt;/
â”œâ”€â”€ config.toml                         # Engine + game settings (D033 toggles, keybinds, render quality)
â”œâ”€â”€ profile.db                          # Player identity, friends, blocks, privacy settings (D053)
â”œâ”€â”€ achievements.db                     # Achievement collection (D036)
â”œâ”€â”€ gameplay.db                         # Event log, replay catalog, save game index, map catalog, asset index (D034)
â”œâ”€â”€ telemetry.db                        # Unified telemetry events (D031) â€” pruned at 100 MB
â”œâ”€â”€ keys/                               # Player Ed25519 keypair (D052) â€” THE critical file
â”‚   â””â”€â”€ identity.key                    # Private key â€” recoverable via mnemonic seed phrase
â”œâ”€â”€ communities/                        # Per-community credential stores (D052)
â”‚   â”œâ”€â”€ official-ic.db                  # SCRs: ratings, match results, achievements
â”‚   â””â”€â”€ clan-wolfpack.db
â”œâ”€â”€ saves/                              # Save game files (.icsave)
â”‚   â”œâ”€â”€ campaign-allied-mission5.icsave
â”‚   â”œâ”€â”€ autosave-001.icsave
â”‚   â”œâ”€â”€ autosave-002.icsave
â”‚   â””â”€â”€ autosave-003.icsave            # Rotating 3-slot autosave
â”œâ”€â”€ replays/                            # Replay files (.icrep)
â”‚   â””â”€â”€ 2027-03-15-ranked-1v1.icrep
â”œâ”€â”€ screenshots/                        # Screenshot images (PNG with metadata)
â”‚   â””â”€â”€ 2027-03-15-154532.png
â”œâ”€â”€ workshop/                           # Downloaded Workshop content (D030)
â”‚   â”œâ”€â”€ cache.db                        # Workshop metadata cache (D034)
â”‚   â”œâ”€â”€ blobs/                          # Content-addressed blob store (D049, Phase 6a)
â”‚   â””â”€â”€ packages/                       # Per-package manifests (references into blobs/)
â”œâ”€â”€ mods/                               # Locally installed mods
â”œâ”€â”€ maps/                               # Locally installed maps
â”œâ”€â”€ logs/                               # Engine log files (rotated)
â””â”€â”€ backups/                            # Created by `ic backup create`
    â””â”€â”€ ic-backup-2027-03-15.zip
</code></pre>
<p><strong>Platform-specific <code>&lt;data_dir&gt;</code> resolution:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Platform</th><th>Default Location</th></tr>
</thead>
<tbody>
<tr><td>Windows</td><td><code>%APPDATA%\IronCurtain\</code></td></tr>
<tr><td>macOS</td><td><code>~/Library/Application Support/IronCurtain/</code></td></tr>
<tr><td>Linux</td><td><code>$XDG_DATA_HOME/iron-curtain/</code> (default: <code>~/.local/share/iron-curtain/</code>)</td></tr>
<tr><td>Steam Deck</td><td>Same as Linux</td></tr>
<tr><td>Browser (WASM)</td><td>OPFS virtual filesystem (see <code>05-FORMATS.md</code> Â§ Browser Storage)</td></tr>
<tr><td>Mobile</td><td>App sandbox (platform-managed)</td></tr>
</tbody>
</table>
</div>
<p><strong>Override:</strong> <code>IC_DATA_DIR</code> environment variable or <code>--data-dir</code> CLI flag overrides the default. Useful for portable installs (USB drive), multi-account testing, or custom backup scripts.</p>
<h3 id="backup-system-ic-backup-cli"><a class="header" href="#backup-system-ic-backup-cli">Backup System: <code>ic backup</code> CLI</a></h3>
<p>The <code>ic backup</code> CLI provides safe, consistent backups. Following the Fossilize-inspired CLI philosophy (D020 â€” each subcommand does one focused thing well):</p>
<pre><code>ic backup create                              # Full backup â†’ &lt;data_dir&gt;/backups/ic-backup-&lt;date&gt;.zip
ic backup create --output ~/my-backup.zip     # Custom output path
ic backup create --exclude replays,workshop   # Smaller backup â€” skip large data
ic backup create --only keys,profile,saves    # Targeted backup â€” critical data only
ic backup restore ic-backup-2027-03-15.zip    # Restore from backup (prompts on conflict)
ic backup restore backup.zip --overwrite      # Restore without prompting
ic backup list                                # List available backups with size and date
ic backup verify ic-backup-2027-03-15.zip     # Verify archive integrity without restoring
</code></pre>
<p><strong>How <code>ic backup create</code> works:</strong></p>
<ol>
<li><strong>SQLite databases:</strong> Each <code>.db</code> file is backed up using <code>VACUUM INTO '&lt;temp&gt;.db'</code> â€” this creates a consistent, compacted copy without requiring the database to be closed. WAL checkpoints are folded in. No risk of copying a half-written WAL file.</li>
<li><strong>Binary files:</strong> <code>.icsave</code>, <code>.icrep</code>, <code>.icpkg</code> files are copied as-is (theyâ€™re self-contained).</li>
<li><strong>Image files:</strong> PNG screenshots are copied as-is.</li>
<li><strong>Config files:</strong> <code>config.toml</code> and other TOML configuration files are copied as-is.</li>
<li><strong>Key files:</strong> <code>keys/identity.key</code> is included (the playerâ€™s private key â€” also recoverable via mnemonic seed phrase, but a full backup preserves everything).</li>
<li><strong>Package:</strong> Everything is bundled into a ZIP archive with the original directory structure preserved. No compression on already-compressed files (<code>.icsave</code>, <code>.icrep</code> are LZ4-compressed internally).</li>
</ol>
<p><strong>Backup categories for <code>--exclude</code> and <code>--only</code>:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Category</th><th>Contents</th><th>Typical Size</th><th>Critical?</th></tr>
</thead>
<tbody>
<tr><td><code>keys</code></td><td><code>keys/identity.key</code></td><td>&lt; 1 KB</td><td><strong>Yes</strong> â€” recoverable via mnemonic seed phrase</td></tr>
<tr><td><code>profile</code></td><td><code>profile.db</code></td><td>&lt; 1 MB</td><td><strong>Yes</strong> â€” friends, settings, avatar</td></tr>
<tr><td><code>communities</code></td><td><code>communities/*.db</code></td><td>1â€“10 MB</td><td><strong>Yes</strong> â€” ratings, match history (SCRs)</td></tr>
<tr><td><code>achievements</code></td><td><code>achievements.db</code></td><td>&lt; 1 MB</td><td><strong>Yes</strong> â€” SCR-backed achievement proofs</td></tr>
<tr><td><code>config</code></td><td><code>config.toml</code></td><td>&lt; 100 KB</td><td>Medium â€” preferences, easily recreated</td></tr>
<tr><td><code>saves</code></td><td><code>saves/*.icsave</code></td><td>10â€“100 MB</td><td>High â€” campaign progress, in-progress games</td></tr>
<tr><td><code>replays</code></td><td><code>replays/*.icrep</code></td><td>100 MB â€“ 10 GB</td><td>Low â€” sentimental, not functional</td></tr>
<tr><td><code>screenshots</code></td><td><code>screenshots/*.png</code></td><td>10 MB â€“ 5 GB</td><td>Low â€” sentimental, not functional</td></tr>
<tr><td><code>workshop</code></td><td><code>workshop/</code> (cache + packages)</td><td>100 MB â€“ 50 GB</td><td>None â€” re-downloadable</td></tr>
<tr><td><code>gameplay</code></td><td><code>gameplay.db</code></td><td>10â€“100 MB</td><td>Medium â€” event log, catalogs (rebuildable)</td></tr>
<tr><td><code>mods</code></td><td><code>mods/</code></td><td>Variable</td><td>Low â€” re-downloadable or re-installable</td></tr>
<tr><td><code>maps</code></td><td><code>maps/</code></td><td>Variable</td><td>Low â€” re-downloadable</td></tr>
</tbody>
</table>
</div>
<p><strong>Default <code>ic backup create</code></strong> includes: <code>keys</code>, <code>profile</code>, <code>communities</code>, <code>achievements</code>, <code>config</code>, <code>saves</code>, <code>replays</code>, <code>screenshots</code>, <code>gameplay</code>. Excludes <code>workshop</code>, <code>mods</code>, <code>maps</code> (re-downloadable). Total size for a typical player: 200 MB â€“ 2 GB.</p>
<h3 id="profile-export-json-data-portability"><a class="header" href="#profile-export-json-data-portability">Profile Export: JSON Data Portability</a></h3>
<p>For GDPR Article 20 compliance and general good practice, IC provides a machine-readable profile export:</p>
<pre><code>ic profile export                             # â†’ &lt;data_dir&gt;/exports/profile-export-&lt;date&gt;.json
ic profile export --format json               # Explicit format (JSON is default)
</code></pre>
<p><strong>Export contents:</strong></p>
<pre><code class="language-json">{
  "export_version": "1.0",
  "exported_at": "2027-03-15T14:30:00Z",
  "engine_version": "0.5.0",
  "identity": {
    "display_name": "CommanderZod",
    "public_key": "ed25519:abc123...",
    "bio": "Tank rush enthusiast since 1996",
    "title": "Iron Commander",
    "country": "DE",
    "created_at": "2027-01-15T10:00:00Z"
  },
  "communities": [
    {
      "name": "Official IC Community",
      "public_key": "ed25519:def456...",
      "joined_at": "2027-01-15",
      "rating": { "game_module": "ra1", "value": 1823, "rd": 45 },
      "matches_played": 342,
      "achievements": 23,
      "credentials": [
        {
          "type": "rating",
          "payload_hex": "...",
          "signature_hex": "...",
          "note": "Self-verifying â€” import on any IC install"
        }
      ]
    }
  ],
  "friends": [
    { "display_name": "alice", "community": "Official IC Community", "added_at": "2027-02-01" }
  ],
  "statistics_summary": {
    "total_matches": 429,
    "total_playtime_hours": 412,
    "win_rate": 0.579,
    "faction_distribution": { "soviet": 0.67, "allied": 0.28, "random": 0.05 }
  },
  "saves_count": 12,
  "replays_count": 287,
  "screenshots_count": 45
}
</code></pre>
<p>The key feature: <strong>SCRs are included in the export and are self-verifying.</strong> A player can import their profile JSON on a new machine, and their ratings and achievements are cryptographically proven without contacting any server. No other game offers this.</p>
<h3 id="platform-cloud-sync-optional"><a class="header" href="#platform-cloud-sync-optional">Platform Cloud Sync (Optional)</a></h3>
<p>For players who use Steam, GOG Galaxy, or other platforms with cloud save support, IC can optionally sync critical data via the <code>PlatformServices</code> trait:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Extension to PlatformServices (D053) for cloud backup.
pub trait PlatformCloudSync {
    /// Upload a small file to platform cloud storage.
    fn cloud_save(&amp;self, key: &amp;str, data: &amp;[u8]) -&gt; Result&lt;()&gt;;
    /// Download a file from platform cloud storage.
    fn cloud_load(&amp;self, key: &amp;str) -&gt; Result&lt;Option&lt;Vec&lt;u8&gt;&gt;&gt;;
    /// List available cloud files.
    fn cloud_list(&amp;self) -&gt; Result&lt;Vec&lt;CloudEntry&gt;&gt;;
    /// Available cloud storage quota (bytes).
    fn cloud_quota(&amp;self) -&gt; Result&lt;CloudQuota&gt;;
}

pub struct CloudQuota {
    pub used: u64,
    pub total: u64,  // e.g., Steam Cloud: ~1 GB per game
}
<span class="boring">}</span></code></pre>
<p><strong>What syncs:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Data</th><th>Sync?</th><th>Rationale</th></tr>
</thead>
<tbody>
<tr><td><code>keys/identity.key</code></td><td><strong>Yes</strong></td><td>Critical â€” also recoverable via mnemonic seed phrase, but cloud sync is simpler</td></tr>
<tr><td><code>profile.db</code></td><td><strong>Yes</strong></td><td>Small, essential</td></tr>
<tr><td><code>communities/*.db</code></td><td><strong>Yes</strong></td><td>Small, contains verified reputation (SCRs)</td></tr>
<tr><td><code>achievements.db</code></td><td><strong>Yes</strong></td><td>Small, contains achievement proofs</td></tr>
<tr><td><code>config.toml</code></td><td><strong>Yes</strong></td><td>Small, preserves preferences across machines</td></tr>
<tr><td>Latest autosave</td><td><strong>Yes</strong></td><td>Resume campaign on another machine (one <code>.icsave</code> only)</td></tr>
<tr><td><code>saves/*.icsave</code></td><td>No</td><td>Too large for cloud quotas (user manages manually)</td></tr>
<tr><td><code>replays/*.icrep</code></td><td>No</td><td>Too large, not critical</td></tr>
<tr><td><code>screenshots/*.png</code></td><td>No</td><td>Too large, not critical</td></tr>
<tr><td><code>workshop/</code></td><td>No</td><td>Re-downloadable</td></tr>
</tbody>
</table>
</div>
<p><strong>Total cloud footprint:</strong> ~5â€“20 MB. Well within Steam Cloudâ€™s ~1 GB per-game quota.</p>
<p><strong>Sync triggers:</strong> Cloud sync happens at: game launch (download), game exit (upload), and after completing a match/mission (upload changed community DBs). Never during gameplay â€” no sync I/O on the hot path.</p>
<h3 id="screenshots"><a class="header" href="#screenshots">Screenshots</a></h3>
<p>Screenshots are standard PNG files with embedded metadata in the PNG <code>tEXt</code> chunks:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Key</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><code>IC:EngineVersion</code></td><td><code>"0.5.0"</code></td></tr>
<tr><td><code>IC:GameModule</code></td><td><code>"ra1"</code></td></tr>
<tr><td><code>IC:MapName</code></td><td><code>"Arena"</code></td></tr>
<tr><td><code>IC:Timestamp</code></td><td><code>"2027-03-15T15:45:32Z"</code></td></tr>
<tr><td><code>IC:Players</code></td><td><code>"CommanderZod (Soviet) vs alice (Allied)"</code></td></tr>
<tr><td><code>IC:GameTick</code></td><td><code>"18432"</code></td></tr>
<tr><td><code>IC:ReplayFile</code></td><td><code>"2027-03-15-ranked-1v1.icrep"</code> (if applicable)</td></tr>
</tbody>
</table>
</div>
<p>Standard PNG viewers ignore these chunks; ICâ€™s screenshot browser reads them for filtering and organization. The screenshot hotkey (mapped in <code>config.toml</code>) captures the current frame, embeds metadata, and saves to <code>screenshots/</code> with a timestamped filename.</p>
<h3 id="mnemonic-seed-recovery"><a class="header" href="#mnemonic-seed-recovery">Mnemonic Seed Recovery</a></h3>
<p>The Ed25519 private key in <code>keys/identity.key</code> is the playerâ€™s cryptographic identity. If lost without backup, ratings, achievements, and community memberships are gone. Cloud sync and auto-snapshots mitigate this, but both require the original machine to have been configured correctly. A player who never enabled cloud sync and whose hard drive dies loses everything.</p>
<p><strong>Mnemonic seed phrases</strong> solve this with zero infrastructure. Inspired by BIP-39 (Bitcoin Improvement Proposal 39), the pattern derives a cryptographic keypair deterministically from a human-readable word sequence. The player writes the words on paper. On any machine, entering those words regenerates the identical keypair. The cheapest, most resilient â€œcloud backupâ€ is a piece of paper in a drawer.</p>
<h4 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h4>
<ol>
<li><strong>Key generation:</strong> When IC creates a new identity, it generates 256 bits of entropy from the OS CSPRNG (<code>getrandom</code>).</li>
<li><strong>Mnemonic encoding:</strong> The entropy maps to a 24-word phrase from the BIP-39 English wordlist (2048 words, 11 bits per word, 24 Ã— 11 = 264 bits â€” 256 bits entropy + 8-bit checksum). The wordlist is curated for unambiguous reading: no similar-looking words, no offensive words, sorted alphabetically. Example: <code>abandon ability able about above absent absorb abstract absurd abuse access accident</code>.</li>
<li><strong>Key derivation:</strong> The mnemonic phrase is run through PBKDF2-HMAC-SHA512 (2048 rounds, per BIP-39 spec) with an optional passphrase as salt (default: empty string). The 512-bit output is truncated to 32 bytes and used as the Ed25519 private key seed.</li>
<li><strong>Deterministic output:</strong> Same 24 words + same passphrase â†’ identical Ed25519 keypair on any platform. The derivation uses only standardized primitives (PBKDF2, HMAC, SHA-512, Ed25519) â€” no IC-specific code in the critical path.</li>
</ol>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Derives an Ed25519 keypair from a BIP-39 mnemonic phrase.
///
/// The derivation is deterministic: same words + same passphrase
/// always produce the same keypair on every platform.
pub fn keypair_from_mnemonic(
    words: &amp;[&amp;str; 24],
    passphrase: &amp;str,
) -&gt; Result&lt;Ed25519Keypair, MnemonicError&gt; {
    let entropy = mnemonic_to_entropy(words)?;  // validate checksum
    let salt = format!("mnemonic{}", passphrase);
    let mut seed = [0u8; 64];
    pbkdf2_hmac_sha512(
        &amp;entropy_to_seed_input(words),
        salt.as_bytes(),
        2048,
        &amp;mut seed,
    );
    let signing_key = Ed25519SigningKey::from_bytes(&amp;seed[..32])?;
    Ok(Ed25519Keypair {
        signing_key,
        verifying_key: signing_key.verifying_key(),
    })
}
<span class="boring">}</span></code></pre>
<h4 id="optional-passphrase-advanced"><a class="header" href="#optional-passphrase-advanced">Optional Passphrase (Advanced)</a></h4>
<p>The mnemonic can optionally be combined with a user-chosen passphrase during key derivation. This provides two-factor recovery: the 24 words (something you wrote down) + the passphrase (something you remember). Different passphrases produce different keypairs from the same words â€” useful for advanced users who want plausible deniability or multiple identities from one seed. The default is no passphrase (empty string). The UI does not promote this feature â€” itâ€™s accessible via CLI and the advanced section of the recovery flow.</p>
<h4 id="cli-commands"><a class="header" href="#cli-commands">CLI Commands</a></h4>
<pre><code>ic identity seed show          # Display the 24-word mnemonic for the current identity
                               # Requires interactive confirmation ("This is your recovery phrase.
                               # Anyone with these words can become you. Write them down and
                               # store them somewhere safe.")
ic identity seed verify        # Enter 24 words to verify they match the current identity
ic identity recover            # Enter 24 words (+ optional passphrase) to regenerate keypair
                               # If identity.key already exists, prompts for confirmation
                               # before overwriting
ic identity recover --passphrase  # Prompt for passphrase in addition to mnemonic
</code></pre>
<h4 id="security-properties"><a class="header" href="#security-properties">Security Properties</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Property</th><th>Detail</th></tr>
</thead>
<tbody>
<tr><td><strong>Entropy</strong></td><td>256 bits from OS CSPRNG â€” same as generating a key directly. The mnemonic is an encoding, not a weakening.</td></tr>
<tr><td><strong>Brute-force resistance</strong></td><td>2Â²âµâ¶ possible mnemonics. Infeasible to enumerate.</td></tr>
<tr><td><strong>Checksum</strong></td><td>Last 8 bits are SHA-256 checksum of the entropy. Catches typos during recovery (1 word wrong â†’ checksum fails).</td></tr>
<tr><td><strong>Offline</strong></td><td>No network, no server, no cloud. The 24 words ARE the identity.</td></tr>
<tr><td><strong>Standard</strong></td><td>BIP-39 is used by every major cryptocurrency wallet. Millions of users have successfully recovered keys from mnemonic phrases. Battle-tested.</td></tr>
<tr><td><strong>Platform-independent</strong></td><td>Same words produce the same key on Windows, macOS, Linux, WASM, mobile. The derivation uses only standardized cryptographic primitives.</td></tr>
</tbody>
</table>
</div>
<h4 id="what-the-mnemonic-does-not-replace"><a class="header" href="#what-the-mnemonic-does-not-replace">What the Mnemonic Does NOT Replace</a></h4>
<ul>
<li><strong>Cloud sync</strong> â€” still the best option for seamless multi-device use. The mnemonic is the disaster recovery layer beneath cloud sync.</li>
<li><strong>Regular backups</strong> â€” the mnemonic recovers the <em>identity</em> (keypair). It does not recover save files, replays, screenshots, or settings. A full backup preserves everything.</li>
<li><strong>Community server records</strong> â€” after mnemonic recovery, the playerâ€™s keypair is restored, but community servers still hold the match history and SCRs. No re-earning needed â€” the recovered keypair matches the old public key, so existing SCRs validate automatically.</li>
</ul>
<h4 id="precedent"><a class="header" href="#precedent">Precedent</a></h4>
<p>The BIP-39 mnemonic pattern has been used since 2013 by Bitcoin, Ethereum, and every major cryptocurrency wallet. Ledger, Trezor, MetaMask, and Phantom all use 24-word recovery phrases as the standard key backup mechanism. The pattern has survived a decade of adversarial conditions (billions of dollars at stake) and is understood by millions of non-technical users. IC adapts the encoding and derivation steps verbatim â€” the only IC-specific part is using the derived key for Ed25519 identity rather than cryptocurrency transactions.</p>
<h3 id="player-experience"><a class="header" href="#player-experience">Player Experience</a></h3>
<p>The mechanical design above (CLI, formats, directory layout) is the foundation. This section defines what the <em>player</em> actually sees and feels. The guiding principle: <strong>players should never lose data without trying.</strong> The system works in layers:</p>
<ol>
<li><strong>Invisible layer (always-on):</strong> Cloud sync for critical data, automatic daily snapshots</li>
<li><strong>Gentle nudge layer:</strong> Milestone-based reminders, status indicators in settings</li>
<li><strong>Explicit action layer:</strong> In-game Data &amp; Backup panel, CLI for power users</li>
<li><strong>Emergency layer:</strong> Disaster recovery, identity re-creation guidance</li>
</ol>
<h4 id="first-launch--new-player"><a class="header" href="#first-launch--new-player">First Launch â€” New Player</a></h4>
<p>Integrates with D032â€™s â€œDay-one nostalgia choice.â€ After the player picks their experience profile (Classic/Remastered/Modern), two additional steps:</p>
<p><strong>Step 1 â€” Identity creation + recovery phrase:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     WELCOME TO IRON CURTAIN                 â”‚
â”‚                                                             â”‚
â”‚  Your player identity has been created.                     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CommanderZod                                         â”‚  â”‚
â”‚  â”‚  ID: ed25519:7f3a...b2c1                              â”‚  â”‚
â”‚  â”‚  Created: 2027-03-15                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Your recovery phrase â€” write these 24 words down and       â”‚
â”‚  store them somewhere safe. They can restore your           â”‚
â”‚  identity on any machine.                                   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. abandon     7. absorb    13. acid     19. across  â”‚  â”‚
â”‚  â”‚  2. ability     8. abstract  14. acoustic  20. act    â”‚  â”‚
â”‚  â”‚  3. able        9. absurd    15. acquire  21. action  â”‚  â”‚
â”‚  â”‚  4. about      10. abuse     16. adapt    22. actor   â”‚  â”‚
â”‚  â”‚  5. above      11. access    17. add      23. actress â”‚  â”‚
â”‚  â”‚  6. absent     12. accident  18. addict   24. actual  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  [I've written them down]            [Skip â€” I'll do later] â”‚
â”‚                                                             â”‚
â”‚  You can view this phrase anytime: Settings â†’ Data &amp; Backup â”‚
â”‚  or run `ic identity seed show` from the command line.      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Step 2 â€” Cloud sync offer:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PROTECT YOUR DATA                       â”‚
â”‚                                                             â”‚
â”‚  Your recovery phrase protects your identity. Cloud sync    â”‚
â”‚  also protects your settings, ratings, and progress.        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â˜  Enable Cloud Sync                               â”‚    â”‚
â”‚  â”‚    Automatically backs up your profile,             â”‚    â”‚
â”‚  â”‚    ratings, and settings via Steam Cloud.           â”‚    â”‚
â”‚  â”‚    [Enable]                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  [Continue]                     [Skip â€” I'll set up later]  â”‚
â”‚                                                             â”‚
â”‚  You can always manage backups in Settings â†’ Data &amp; Backup  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Rules:</strong></p>
<ul>
<li>Identity creation is automatic â€” no sign-up, no email, no password</li>
<li>The recovery phrase is shown once during first launch, then always accessible via Settings or CLI</li>
<li>Cloud sync is offered but not required â€” â€œContinueâ€ without enabling works fine</li>
<li>Skipping the recovery phrase is allowed (no forced engagement) â€” the first milestone nudge will remind</li>
<li>If no platform cloud is available (non-Steam/non-GOG install), Step 2 instead shows: â€œWe recommend creating a backup after your first few games. IC will remind you.â€</li>
<li>The entire flow is skippable â€” no forced engagement</li>
</ul>
<h4 id="first-launch--existing-player-on-new-machine"><a class="header" href="#first-launch--existing-player-on-new-machine">First Launch â€” Existing Player on New Machine</a></h4>
<p>This is the critical UX flow. Detection logic on first launch:</p>
<pre><code>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ First launch â”‚
                    â”‚  detected    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Platform     â”‚  Yes   â”‚ Offer automatic  â”‚
                    â”‚ cloud data   â”œâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ cloud restore    â”‚
                    â”‚ available?   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ No
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Show restore â”‚
                    â”‚ options      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Cloud restore path (automatic detection):</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EXISTING PLAYER DETECTED                    â”‚
â”‚                                                             â”‚
â”‚  Found data from your other machine:                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CommanderZod                                         â”‚  â”‚
â”‚  â”‚  Rating: 1823 (Private First Class)                   â”‚  â”‚
â”‚  â”‚  342 matches played Â· 23 achievements                 â”‚  â”‚
â”‚  â”‚  Last played: March 14, 2027 on DESKTOP-HOME          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  [Restore my data]              [Start fresh instead]       â”‚
â”‚                                                             â”‚
â”‚  Restores: identity, ratings, achievements, settings,       â”‚
â”‚  friends list, and latest campaign autosave.                â”‚
â”‚  Replays, screenshots, and full saves require a backup      â”‚
â”‚  file or manual folder copy.                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Manual restore path (no cloud data):</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     WELCOME TO IRON CURTAIN                 â”‚
â”‚                                                             â”‚
â”‚  Played before? Restore your data:                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ”‘  Recover from recovery phrase                   â”‚    â”‚
â”‚  â”‚      Enter your 24-word phrase to restore identity  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“  Restore from backup file                       â”‚    â”‚
â”‚  â”‚      Browse for a .zip backup created by IC         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“‚  Copy from existing data folder                 â”‚    â”‚
â”‚  â”‚      Point to a copied &lt;data_dir&gt; from your old PC  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  [Start fresh â€” create new identity]                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Mnemonic recovery flow (from â€œRecover from recovery phraseâ€):</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RECOVER YOUR IDENTITY                      â”‚
â”‚                                                             â”‚
â”‚  Enter your 24-word recovery phrase:                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. [________]   7. [________]  13. [________]       â”‚  â”‚
â”‚  â”‚  2. [________]   8. [________]  14. [________]       â”‚  â”‚
â”‚  â”‚  3. [________]   9. [________]  15. [________]       â”‚  â”‚
â”‚  â”‚  4. [________]  10. [________]  16. [________]       â”‚  â”‚
â”‚  â”‚  5. [________]  11. [________]  17. [________]       â”‚  â”‚
â”‚  â”‚  6. [________]  12. [________]  18. [________]       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  19. [________]  21. [________]  23. [________]      â”‚  â”‚
â”‚  â”‚  20. [________]  22. [________]  24. [________]      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  [Advanced: I used a passphrase]                            â”‚
â”‚                                                             â”‚
â”‚  [Recover]                                       [Back]     â”‚
â”‚                                                             â”‚
â”‚  Autocomplete suggests words as you type. Only BIP-39       â”‚
â”‚  wordlist entries are accepted.                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>On successful recovery, the flow shows the restored identity (display name, public key fingerprint) and continues to the normal first-launch experience. Community servers recognize the recovered identity by its public key â€” existing SCRs validate automatically.</p>
<p><strong>Note:</strong> Mnemonic recovery restores the <em>identity only</em> (keypair). Save files, replays, screenshots, and settings are not recovered by the phrase â€” those require a full backup or folder copy. The restore options panel makes this clear: â€œRecover from recovery phraseâ€ is listed alongside â€œRestore from backup fileâ€ because they solve different problems. A player who has both a phrase and a backup should use the backup (it includes everything); a player who only has the phrase gets their identity back and can re-earn or re-download the rest.</p>
<p><strong>Restore progress (both paths):</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RESTORING YOUR DATA                     â”‚
â”‚                                                             â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  68%                          â”‚
â”‚                                                             â”‚
â”‚  âœ“ Identity key                                             â”‚
â”‚  âœ“ Profile &amp; friends                                        â”‚
â”‚  âœ“ Community ratings (3 communities, 12 SCRs verified)      â”‚
â”‚  âœ“ Achievements (23 achievement proofs verified)            â”‚
â”‚  â— Save games (4 of 12)...                                  â”‚
â”‚  â—‹ Replays                                                  â”‚
â”‚  â—‹ Screenshots                                              â”‚
â”‚  â—‹ Settings                                                 â”‚
â”‚                                                             â”‚
â”‚  SCR verification: all credentials cryptographically valid  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>Key UX detail: <strong>SCRs are verified during restore and the player sees it.</strong> The progress screen shows credentials being cryptographically validated. This is a trust-building moment â€” â€œyour reputation is portable and provableâ€ becomes tangible.</p>
<h4 id="automatic-behaviors-no-player-interaction-required"><a class="header" href="#automatic-behaviors-no-player-interaction-required">Automatic Behaviors (No Player Interaction Required)</a></h4>
<p>Most players never open a settings screen for backup. These behaviors protect them silently:</p>
<p><strong>Auto cloud sync (if enabled):</strong></p>
<ul>
<li><strong>On game exit:</strong> Upload changed <code>profile.db</code>, <code>communities/*.db</code>, <code>achievements.db</code>, <code>config.toml</code>, <code>keys/identity.key</code>, latest autosave. Silent â€” no UI prompt.</li>
<li><strong>On game launch:</strong> Download cloud data, merge if needed (last-write-wins for simple files; SCR merge for community DBs â€” SCRs are append-only with timestamps, so merge is deterministic).</li>
<li><strong>After completing a match:</strong> Upload updated community DB (new match result / rating change). Background, non-blocking.</li>
</ul>
<p><strong>Automatic daily snapshots (always-on, even without cloud):</strong></p>
<ul>
<li>On first launch of the day, the engine writes a lightweight â€œcritical data snapshotâ€ to <code>&lt;data_dir&gt;/backups/auto-critical-N.zip</code> containing only <code>keys/</code>, <code>profile.db</code>, <code>communities/*.db</code>, <code>achievements.db</code>, <code>config.toml</code> (~5 MB total).</li>
<li>Rotating 3-day retention: <code>auto-critical-1.zip</code>, <code>auto-critical-2.zip</code>, <code>auto-critical-3.zip</code>. Oldest overwritten.</li>
<li>No user interaction, no prompt, no notification. Background I/O during asset loading â€” invisible.</li>
<li>Even players who never touch backup settings have 3 rolling days of critical data protection.</li>
</ul>
<p><strong>Post-milestone nudges (main menu toasts):</strong></p>
<p>After significant events, a non-intrusive toast appears on the main menu â€” same system as D030â€™s Workshop cleanup toasts:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Trigger</th><th>Toast (cloud sync active)</th><th>Toast (no cloud sync)</th></tr>
</thead>
<tbody>
<tr><td>First ranked match</td><td><code>Your competitive career has begun! Your rating is backed up automatically.</code></td><td><code>Your competitive career has begun! Protect your rating: [Back up now]  [Dismiss]</code></td></tr>
<tr><td>First campaign mission</td><td><code>Campaign progress saved.</code> (no toast â€” autosave handles it)</td><td><code>Campaign progress saved. [Create backup]  [Dismiss]</code></td></tr>
<tr><td>New ranked tier reached</td><td><code>Congratulations â€” Private First Class!</code></td><td><code>Congratulations â€” Private First Class! [Back up now]  [Dismiss]</code></td></tr>
<tr><td>30 days without full backup (no cloud)</td><td>â€”</td><td><code>It's been a month since your last backup. Your data folder is 1.4 GB. [Back up now]  [Remind me later]</code></td></tr>
</tbody>
</table>
</div>
<p><strong>Nudge rules:</strong></p>
<ul>
<li><strong>Never during gameplay.</strong> Only on main menu or post-game screen.</li>
<li><strong>Maximum one nudge per session.</strong> If multiple triggers fire, highest-priority wins.</li>
<li><strong>Dismissable and respectful.</strong> â€œRemind me laterâ€ delays by 7 days. Three consecutive dismissals for the same nudge type = never show that nudge again.</li>
<li><strong>No nudges if cloud sync is active and healthy.</strong> The player is already protected.</li>
<li><strong>No nudges for the first 3 game sessions.</strong> Let players enjoy the game before talking about data management.</li>
</ul>
<h4 id="settings--data--backup-panel"><a class="header" href="#settings--data--backup-panel">Settings â†’ Data &amp; Backup Panel</a></h4>
<p>In-game UI for players who want to manage their data visually. Accessible from Main Menu â†’ Settings â†’ Data &amp; Backup. This is the GUI equivalent of the <code>ic backup</code> CLI â€” same operations, visual interface.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Settings &gt; Data &amp; Backup                                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ DATA HEALTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Identity key          âœ“ Backed up (Steam Cloud)           â”‚  â”‚
â”‚  â”‚  Profile &amp; ratings     âœ“ Synced 2 hours ago                â”‚  â”‚
â”‚  â”‚  Achievements          âœ“ Synced 2 hours ago                â”‚  â”‚
â”‚  â”‚  Campaign progress     âœ“ Latest autosave synced            â”‚  â”‚
â”‚  â”‚  Last full backup      March 10, 2027 (5 days ago)         â”‚  â”‚
â”‚  â”‚  Data folder size      1.4 GB                              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ BACKUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [Create full backup]     Saves everything to a .zip file  â”‚  â”‚
â”‚  â”‚  [Create critical only]   Keys, profile, ratings (&lt; 5 MB)  â”‚  â”‚
â”‚  â”‚  [Restore from backup]    Load a .zip backup file          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Saved backups:                                            â”‚  â”‚
â”‚  â”‚    ic-backup-2027-03-10.zip     1.2 GB    [Open] [Delete]  â”‚  â”‚
â”‚  â”‚    ic-backup-2027-02-15.zip     980 MB    [Open] [Delete]  â”‚  â”‚
â”‚  â”‚    auto-critical-1.zip          4.8 MB    (today)          â”‚  â”‚
â”‚  â”‚    auto-critical-2.zip          4.7 MB    (yesterday)      â”‚  â”‚
â”‚  â”‚    auto-critical-3.zip          4.7 MB    (2 days ago)     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ CLOUD SYNC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Status: Active (Steam Cloud)                              â”‚  â”‚
â”‚  â”‚  Last sync: March 15, 2027 14:32                           â”‚  â”‚
â”‚  â”‚  Cloud usage: 12 MB / 1 GB                                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [Sync now]  [Disable cloud sync]                          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€ EXPORT &amp; PORTABILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [Export profile (JSON)]   Machine-readable data export    â”‚  â”‚
â”‚  â”‚  [Open data folder]        Browse files directly           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>When cloud sync is not available</strong> (non-Steam/non-GOG install), the Cloud Sync section shows:</p>
<pre><code>â”‚  â”Œâ”€ CLOUD SYNC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Status: Not available                                     â”‚  â”‚
â”‚  â”‚  Cloud sync requires Steam or GOG Galaxy.                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Your data is protected by automatic daily snapshots.      â”‚  â”‚
â”‚  â”‚  We recommend creating a full backup periodically.         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
</code></pre>
<p>And Data Health adjusts severity indicators:</p>
<pre><code>â”‚  â”‚  Identity key          âš  Local only â€” not cloud-backed     â”‚  â”‚
â”‚  â”‚  Profile &amp; ratings     âš  Local only                        â”‚  â”‚
â”‚  â”‚  Last full backup      Never                               â”‚  â”‚
â”‚  â”‚  Last auto-snapshot    Today (keys + profile + ratings)    â”‚  â”‚
</code></pre>
<p>The âš  indicator is yellow, not red â€” itâ€™s a recommendation, not an error. â€œLocal onlyâ€ is a valid state, not a broken state.</p>
<p><strong>â€œCreate full backupâ€ flow:</strong> Clicking the button opens a save-file dialog (pre-filled with <code>ic-backup-&lt;date&gt;.zip</code>). A progress bar shows backup creation. On completion: <code>Backup created: ic-backup-2027-03-15.zip (1.2 GB)</code> with [Open folder] button. The same categories as <code>ic backup create --exclude</code> are exposed via checkboxes in an â€œAdvancedâ€ expander (collapsed by default).</p>
<p><strong>â€œRestore from backupâ€ flow:</strong> Opens a file browser filtered to <code>.zip</code> files. After selection, shows the restore progress screen (see â€œFirst Launch â€” Existing Playerâ€ above). If existing data conflicts with backup data, prompts: <code>Your current data differs from the backup. [Overwrite with backup]  [Cancel]</code>.</p>
<h4 id="screenshot-gallery"><a class="header" href="#screenshot-gallery">Screenshot Gallery</a></h4>
<p>The screenshot browser (Phase 3) uses PNG <code>tEXt</code> metadata to organize screenshots into a browsable gallery. Accessible from Main Menu â†’ Screenshots:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Screenshots                                        [Take now âŒ‚] â”‚
â”‚                                                                  â”‚
â”‚  Filter: [All maps â–¾]  [All modes â–¾]  [Date range â–¾]  [Searchâ€¦] â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚ â”‚
â”‚  â”‚  (thumb)   â”‚  â”‚  (thumb)   â”‚  â”‚  (thumb)   â”‚  â”‚  (thumb)   â”‚ â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Arena      â”‚  â”‚ Fjord      â”‚  â”‚ Arena      â”‚  â”‚ Red Pass   â”‚ â”‚
â”‚  â”‚ 1v1 Ranked â”‚  â”‚ 2v2 Team   â”‚  â”‚ Skirmish   â”‚  â”‚ Campaign   â”‚ â”‚
â”‚  â”‚ Mar 15     â”‚  â”‚ Mar 14     â”‚  â”‚ Mar 12     â”‚  â”‚ Mar 10     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Selected: Arena â€” 1v1 Ranked â€” Mar 15, 2027 15:45               â”‚
â”‚  CommanderZod (Soviet) vs alice (Allied) Â· Tick 18432            â”‚
â”‚  [Watch replay]  [Open file]  [Copy to clipboard]  [Delete]      â”‚
â”‚                                                                  â”‚
â”‚  Total: 45 screenshots (128 MB)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>Key feature: <strong>â€œWatch replayâ€ links directly to the replay file</strong> via the <code>IC:ReplayFile</code> metadata. Screenshots become bookmarks into match history. A screenshot gallery doubles as a game history browser.</p>
<p>Filters use metadata: map name, game module, date, player names. Sorting by date (default), map, or file size.</p>
<h4 id="identity-loss--disaster-recovery"><a class="header" href="#identity-loss--disaster-recovery">Identity Loss â€” Disaster Recovery</a></h4>
<p>If a player loses their machine with no backup and no cloud sync, the outcome depends on whether they saved their recovery phrase:</p>
<p><strong>Recoverable via mnemonic seed phrase:</strong></p>
<ul>
<li>Ed25519 private key (the identity itself) â€” enter 24 words on any machine to regenerate the identical keypair</li>
<li>Community recognition â€” recovered key matches the old public key, so existing SCRs validate automatically</li>
<li>Ratings and match history â€” community servers recognize the recovered identity without admin intervention</li>
</ul>
<p><strong>Not recoverable via mnemonic (requires backup or re-creation):</strong></p>
<ul>
<li>Campaign save files, replay files, screenshots</li>
<li>Local settings and preferences</li>
<li>Achievement proofs signed by the old key (can be re-earned; or restored from backup if available)</li>
</ul>
<p><strong>Re-downloadable:</strong></p>
<ul>
<li>Workshop content (mods, maps, resource packs)</li>
</ul>
<p><strong>Partially recoverable via community (if mnemonic was also lost):</strong></p>
<ul>
<li><strong>Ratings and match history.</strong> Community servers retain match records. A player creates a new identity, and a community admin can associate the new identity with the old record via a verified identity transfer (community-specific policy, not IC-mandated). The old SCRs prove the old identity held those ratings.</li>
<li><strong>Friends.</strong> Friends with the player in their list can re-add the new identity.</li>
</ul>
<p><strong>Recovery hierarchy (best to worst):</strong></p>
<ol>
<li><strong>Full backup</strong> â€” everything restored, including saves, replays, screenshots</li>
<li><strong>Cloud sync</strong> â€” identity, profile, ratings, settings, latest autosave restored</li>
<li><strong>Mnemonic seed phrase</strong> â€” identity restored; saves, replays, settings lost</li>
<li><strong>Nothing saved</strong> â€” fresh identity; community admin can transfer old records</li>
</ol>
<p><strong>UX for total loss (no phrase, no backup, no cloud):</strong> No special â€œrecovery wizard.â€ The player creates a fresh identity. The first-launch flow on the new identity presents the recovery phrase prominently. The system prevents the same mistake twice.</p>
<h4 id="console-commands-d058"><a class="header" href="#console-commands-d058">Console Commands (D058)</a></h4>
<p>All Data &amp; Backup panel operations have console equivalents:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Command</th><th>Effect</th></tr>
</thead>
<tbody>
<tr><td><code>/backup create</code></td><td>Create full backup (interactive â€” shows progress)</td></tr>
<tr><td><code>/backup create --critical</code></td><td>Create critical-only backup</td></tr>
<tr><td><code>/backup restore &lt;path&gt;</code></td><td>Restore from backup file</td></tr>
<tr><td><code>/backup list</code></td><td>List saved backups</td></tr>
<tr><td><code>/backup verify &lt;path&gt;</code></td><td>Verify archive integrity</td></tr>
<tr><td><code>/profile export</code></td><td>Export profile to JSON</td></tr>
<tr><td><code>/identity seed show</code></td><td>Display 24-word recovery phrase (requires confirmation)</td></tr>
<tr><td><code>/identity seed verify</code></td><td>Enter 24 words to verify they match current identity</td></tr>
<tr><td><code>/identity recover</code></td><td>Enter 24 words to regenerate keypair (overwrites if exists)</td></tr>
<tr><td><code>/data health</code></td><td>Show data health summary (identity, sync status, backup age)</td></tr>
<tr><td><code>/data folder</code></td><td>Open data folder in system file manager</td></tr>
<tr><td><code>/cloud sync</code></td><td>Trigger immediate cloud sync</td></tr>
<tr><td><code>/cloud status</code></td><td>Show cloud sync status and quota</td></tr>
</tbody>
</table>
</div>
<h3 id="alternatives-considered-4"><a class="header" href="#alternatives-considered-4">Alternatives Considered</a></h3>
<ul>
<li><strong>Proprietary backup format with encryption</strong> (rejected â€” contradicts â€œstandard formats onlyâ€ principle; a ZIP file can be encrypted separately with standard tools if the player wants encryption)</li>
<li><strong>IC-hosted cloud backup service</strong> (rejected â€” creates infrastructure liability, ongoing cost, and makes player data dependent on ICâ€™s servers surviving; violates local-first philosophy)</li>
<li><strong>Database-level replication</strong> (rejected â€” over-engineered for the use case; SQLite <code>VACUUM INTO</code> is simpler, safer, and produces a self-contained file)</li>
<li><strong>Steam Cloud as primary backup</strong> (rejected â€” platform-specific, limited quota, opaque sync behavior; IC supports it as an <em>option</em>, not a requirement)</li>
<li><strong>Incremental backup</strong> (deferred â€” full backup via <code>VACUUM INTO</code> is sufficient for player-scale data; incremental adds complexity with minimal benefit unless someone has 50+ GB of replays)</li>
<li><strong>Forced backup before first ranked match</strong> (rejected â€” punishes players to solve a problem most wonâ€™t have; auto-snapshots protect critical data without friction)</li>
<li><strong>Scary â€œBACK UP YOUR KEY OR ELSEâ€ warnings</strong> (rejected â€” fear-based UX is hostile; the recovery phrase provides a genuine safety net, making fear unnecessary; factual presentation of options replaces warnings)</li>
<li><strong>12-word mnemonic phrase</strong> (rejected â€” 12 words = 128 bits of entropy; sufficient for most uses but 24 words = 256 bits matches Ed25519â€™s full key strength; the BIP-39 ecosystem standardized on 24 words for high-security applications; the marginal cost of 12 extra words is negligible for a one-time operation)</li>
<li><strong>Custom IC wordlist</strong> (rejected â€” BIP-39â€™s English wordlist is battle-tested, curated for unambiguous reading, and familiar to millions of cryptocurrency users; a custom list would need the same curation effort with no benefit)</li>
</ul>
<h3 id="integration-with-existing-decisions"><a class="header" href="#integration-with-existing-decisions">Integration with Existing Decisions</a></h3>
<ul>
<li><strong>D010 (Snapshottable Sim):</strong> Save files are sim snapshots â€” the backup system treats them as opaque binary files. No special handling needed beyond file copy.</li>
<li><strong>D020 (Mod SDK &amp; CLI):</strong> The <code>ic backup</code> and <code>ic profile export</code> commands join the <code>ic</code> CLI family alongside <code>ic mod</code>, <code>ic replay</code>, <code>ic campaign</code>.</li>
<li><strong>D030 (Workshop):</strong> Post-milestone nudge toasts use the same toast system as Workshop cleanup prompts â€” consistent notification UX.</li>
<li><strong>D032 (UI Themes):</strong> First-launch identity creation integrates as the final step after theme selection. The Data &amp; Backup panel is theme-aware.</li>
<li><strong>D034 (SQLite):</strong> SQLite is the backbone of player data storage. <code>VACUUM INTO</code> is the safe backup primitive â€” it handles WAL mode correctly and produces a compacted single-file copy.</li>
<li><strong>D052 (Community Servers &amp; SCR):</strong> SCRs are the portable reputation unit. The backup system preserves them; the export system includes them. Because SCRs are cryptographically signed, theyâ€™re self-verifying on import â€” no server round-trip needed. Restore progress screen visibly verifies SCRs.</li>
<li><strong>D053 (Player Profile):</strong> The profile export is D053â€™s data portability implementation. All locally-authoritative profile fields export to JSON; all SCR-backed fields export with full credential data.</li>
<li><strong>D036 (Achievements):</strong> Achievement proofs are SCRs stored in <code>achievements.db</code>. Backup preserves them; export includes them in the JSON.</li>
<li><strong>D058 (Console):</strong> All backup/export operations have <code>/backup</code> and <code>/profile</code> console command equivalents.</li>
</ul>
<h3 id="phase-2"><a class="header" href="#phase-2">Phase</a></h3>
<ul>
<li><strong>Phase 0:</strong> Define and document the <code>&lt;data_dir&gt;</code> directory layout (this decision). Add <code>IC_DATA_DIR</code> / <code>--data-dir</code> override support.</li>
<li><strong>Phase 2:</strong> <code>ic backup create/restore</code> CLI ships alongside the save/load system. Screenshot capture with PNG metadata. Automatic daily critical snapshots (3-day rotating <code>auto-critical-N.zip</code>). Mnemonic seed generation integrated into identity creation â€” <code>ic identity seed show</code>, <code>ic identity seed verify</code>, <code>ic identity recover</code> CLI commands.</li>
<li><strong>Phase 3:</strong> Screenshot browser UI with metadata filtering and replay linking. Data &amp; Backup settings panel (including â€œView recovery phraseâ€ button). Post-milestone nudge toasts (first nudge reminds about recovery phrase if not yet confirmed). First-launch identity creation with recovery phrase display + cloud sync offer. Mnemonic recovery option in first-launch restore flow.</li>
<li><strong>Phase 5:</strong> <code>ic profile export</code> ships alongside multiplayer launch (GDPR compliance). Platform cloud sync via <code>PlatformServices</code> trait (Steam Cloud, GOG Galaxy). <code>ic backup verify</code> for archive integrity checking. First-launch restore flow (cloud detection + manual restore + mnemonic recovery). Console commands (<code>/backup</code>, <code>/profile</code>, <code>/identity</code>, <code>/data</code>, <code>/cloud</code>).</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../decisions/09d-gameplay.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../decisions/09f-tools.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../decisions/09d-gameplay.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../decisions/09f-tools.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
