<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Performance Philosophy - Iron Curtain — Design Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Design docs for a Rust-native Red Alert RTS engine">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-05559aa2.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-b2bf7f58.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Iron Curtain — Design Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/DK26/iron-curtain-design-docs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/DK26/iron-curtain-design-docs/edit/main/src/10-PERFORMANCE.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="10--performance-philosophy--strategy"><a class="header" href="#10--performance-philosophy--strategy">10 — Performance Philosophy &amp; Strategy</a></h1>
<h2 id="core-principle-efficiency-not-brute-force"><a class="header" href="#core-principle-efficiency-not-brute-force">Core Principle: Efficiency, Not Brute Force</a></h2>
<p><strong>Performance goal: a 2012 laptop with 2 cores and 4GB RAM runs a 500-unit battle smoothly. A modern machine handles 3000 units without sweating.</strong></p>
<p>We don’t achieve this by throwing threads at the problem. We achieve it by wasting almost nothing — like Datadog Vector’s pipeline or Tokio’s runtime. Every cycle does useful work. Every byte of memory is intentional. Multi-core is a bonus that emerges naturally, not a crutch the engine depends on.</p>
<p>This is a first-class project goal and a primary differentiator over OpenRA.</p>
<h2 id="the-efficiency-pyramid"><a class="header" href="#the-efficiency-pyramid">The Efficiency Pyramid</a></h2>
<p>Ordered by impact. Each layer works on a single core. Only the top layer requires multiple cores.</p>
<pre><code>                    ┌──────────────┐
                    │ Work-stealing │  Bonus: scales to N cores
                    │ (rayon/Bevy)  │  (automatic, zero config)
                  ┌─┴──────────────┴─┐
                  │  Zero-allocation  │  No heap churn in hot paths
                  │  hot paths        │  (scratch buffers, reuse)
                ┌─┴──────────────────┴─┐
                │  Amortized work       │  Spread cost across ticks
                │  (staggered updates)  │  (1/4 of units per tick)
              ┌─┴──────────────────────┴─┐
              │  Simulation LOD           │  Skip work that doesn't
              │  (adaptive detail)        │  affect the outcome
            ┌─┴──────────────────────────┴─┐
            │  Cache-friendly ECS layout    │  Data access patterns
            │  (hot/warm/cold separation)   │  that respect the hardware
          ┌─┴──────────────────────────────┴─┐
          │  Algorithmic efficiency            │  Better algorithms beat
          │  (O(n) beats O(n²) on any CPU)    │  more cores every time
          └────────────────────────────────────┘
              ▲ MOST IMPACT — start here
</code></pre>
<h2 id="layer-1-algorithmic-efficiency"><a class="header" href="#layer-1-algorithmic-efficiency">Layer 1: Algorithmic Efficiency</a></h2>
<p>Better algorithms on one core beat bad algorithms on eight cores. This is where 90% of the performance comes from.</p>
<h3 id="pathfinding-multi-layer-hybrid-replaces-per-unit-a-ra1-pathfinder-implementation"><a class="header" href="#pathfinding-multi-layer-hybrid-replaces-per-unit-a-ra1-pathfinder-implementation">Pathfinding: Multi-Layer Hybrid Replaces Per-Unit A* (RA1 <code>Pathfinder</code> Implementation)</a></h3>
<p>The RA1 game module implements the <code>Pathfinder</code> trait with <code>IcPathfinder</code> — a multi-layer hybrid combining JPS, flow field tiles, and local avoidance (see <code>research/pathfinding-ic-default-design.md</code>). The gains come from multiple layers:</p>
<p><em><em>JPS vs. A</em> (small groups, &lt;8 units):</em>* JPS (Jump Point Search) prunes symmetric paths that A* explores redundantly. On uniform-cost grids (typical of open terrain in RA), JPS explores 10–100× fewer nodes than A*.</p>
<p><em><em>Flow field tiles vs. per-unit A</em> (mass movement, ≥8 units sharing destination):</em>* When 50 units move to the same area, OpenRA computes 50 separate A* paths.</p>
<pre><code>OpenRA (per-unit A*):
  50 units × ~200 nodes explored × ~10 ops/node = ~100,000 operations

Flow field tile:
  1 field × ~2000 cells × ~5 ops/cell              = ~10,000 operations
  50 units × 1 lookup each                          =       50 operations
  Total                                             = ~10,050 operations

10x reduction. No threading involved.
</code></pre>
<p>The 51st unit ordered to the same area costs zero — the field already exists. Flow field tiles amortize across all units sharing a destination. The adaptive threshold (configurable, default 8 units) ensures flow fields are only computed when the amortization benefit exceeds the generation cost.</p>
<p><strong>Hierarchical sector graph:</strong> O(1) reachability check (flood-fill domain IDs) eliminates pathfinding for unreachable destinations entirely. Coarse sector-level routing reduces the search space for detailed pathfinding.</p>
<h3 id="spatial-indexing-grid-hash-replaces-brute-force-range-checks-ra1-spatialindex-implementation"><a class="header" href="#spatial-indexing-grid-hash-replaces-brute-force-range-checks-ra1-spatialindex-implementation">Spatial Indexing: Grid Hash Replaces Brute-Force Range Checks (RA1 <code>SpatialIndex</code> Implementation)</a></h3>
<p>“Which enemies are in range of this turret?”</p>
<pre><code>Brute force: 1000 units × 1000 units = 1,000,000 distance checks/tick
Spatial hash: 1000 units × ~8 nearby   =     8,000 distance checks/tick

125x reduction. No threading involved.
</code></pre>
<p>A spatial hash divides the world into buckets. Each entity registers in its bucket. Range queries only check nearby buckets. O(1) lookup per bucket, O(k) per query where k is the number of nearby entities (typically &lt; 20). The bucket size is a tunable parameter independent of any game grid — the same spatial hash structure works for grid-based and continuous-space games.</p>
<h3 id="hierarchical-pathfinding-coarse-then-fine"><a class="header" href="#hierarchical-pathfinding-coarse-then-fine">Hierarchical Pathfinding: Coarse Then Fine</a></h3>
<p><code>IcPathfinder</code>’s Layer 2 breaks the map into ~32×32 cell sectors. Path between sectors first (few nodes, fast), then path within the current sector only. Most of the map is never pathfinded at all. Units approaching a new sector compute the next fine-grained path just before entering. Combined with JPS (Layer 3), this reduces pathfinding cost by orders of magnitude compared to flat A*.</p>
<h2 id="layer-2-cache-friendly-data-layout"><a class="header" href="#layer-2-cache-friendly-data-layout">Layer 2: Cache-Friendly Data Layout</a></h2>
<h3 id="ecs-archetype-storage-bevy-provides-this"><a class="header" href="#ecs-archetype-storage-bevy-provides-this">ECS Archetype Storage (Bevy provides this)</a></h3>
<pre><code>OOP (cache-hostile, typical C# pattern):
  Unit objects on heap: [pos, health, vel, name, sprite, audio, ...]
  Iterating 1000 positions touches 1000 scattered memory locations
  Cache miss rate: high — each unit object spans multiple cache lines

ECS archetype storage (cache-friendly):
  Positions:  [p0, p1, p2, ... p999]   ← 8KB contiguous, fits in L1 cache
  Healths:    [h0, h1, h2, ... h999]   ← 4KB contiguous, fits in L1 cache
  Movement system reads positions sequentially → perfect cache utilization
</code></pre>
<p>1000 units × 8-byte positions = 8KB. L1 cache on any CPU since ~2008 is at least 32KB. The entire position array fits in L1. Movement for 1000 units runs from the fastest memory on the chip.</p>
<h3 id="hot--warm--cold-separation"><a class="header" href="#hot--warm--cold-separation">Hot / Warm / Cold Separation</a></h3>
<pre><code>HOT (every tick, must be contiguous):
  Position (8B), Velocity (8B), Health (4B), SimLOD (1B), FogVisible (1B)
  → ~22 bytes per entity × 1000 = 22KB — fits in L1

WARM (some ticks, when relevant):
  Armament (16B), PathState (32B), BuildQueue (24B), HarvesterCargo (8B)
  → Separate archetype arrays, pulled into cache only when needed

COLD (rarely accessed, lives in Resources):
  UnitDef (name, icon, prereqs), SpriteSheet refs, AudioClip refs
  → Loaded once, referenced by ID, never iterated in hot loops
</code></pre>
<p>Design components to be small. A Position is 2 integers, not a struct with name, description, and sprite reference. The movement system pulls only positions and velocities — 16 bytes per entity, 16KB for 1000 units, pure L1.</p>
<h2 id="layer-3-simulation-lod-adaptive-detail"><a class="header" href="#layer-3-simulation-lod-adaptive-detail">Layer 3: Simulation LOD (Adaptive Detail)</a></h2>
<p>Not all units need full processing every tick. A harvester driving across an empty map with no enemies nearby doesn’t need per-tick pathfinding, collision detection, or animation state updates.</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub enum SimLOD {
    /// Full processing: pathfinding, collision, precise targeting
    Full,
    /// Reduced: simplified pathing, broadphase collision only
    Reduced,
    /// Minimal: advance along pre-computed path, check arrival
    Minimal,
}

fn assign_sim_lod(
    unit_pos: WorldPos,
    in_combat: bool,
    near_enemy: bool,
    near_friendly_base: bool,  // deterministic — same on all clients
) -&gt; SimLOD {
    if in_combat || near_enemy { SimLOD::Full }
    else if near_friendly_base { SimLOD::Reduced }
    else { SimLOD::Minimal }
}
<span class="boring">}</span></code></pre>
<p><strong>Determinism requirement:</strong> LOD assignment must be based on game state (not camera position), so all clients assign the same LOD. “Near enemy” and “near base” are deterministic queries.</p>
<p><strong>Impact:</strong> In a typical game, only 20-30% of units are in active combat at any moment. The other 70-80% use Reduced or Minimal processing. Effective per-tick cost drops proportionally.</p>
<h2 id="layer-4-amortized-work-staggered-updates"><a class="header" href="#layer-4-amortized-work-staggered-updates">Layer 4: Amortized Work (Staggered Updates)</a></h2>
<p>Expensive systems don’t need to process all entities every tick. Spread the cost evenly.</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn pathfinding_system(
    tick: Res&lt;CurrentTick&gt;,
    query: Query&lt;(Entity, &amp;Position, &amp;MoveTarget, &amp;SimLOD), With&lt;NeedsPath&gt;&gt;,
    nav: Res&lt;NavMesh&gt;,
) {
    let group = tick.0 % 4;  // 4 groups, each updated every 4 ticks
    
    for (entity, pos, target, lod) in &amp;query {
        let should_update = match lod {
            SimLOD::Full    =&gt; entity.index() % 4 == group,    // every 4 ticks
            SimLOD::Reduced =&gt; entity.index() % 8 == (group * 2) % 8,  // every 8 ticks
            SimLOD::Minimal =&gt; false,  // never replan, just follow existing path
        };
        
        if should_update {
            recompute_path(entity, pos, target, &amp;nav);
        }
    }
}
<span class="boring">}</span></code></pre>
<p><strong>Result:</strong> Pathfinding cost per tick drops 75% for Full-LOD units, 87.5% for Reduced, 100% for Minimal. Combined with SimLOD, a 1000-unit game might recompute ~50 paths per tick instead of 1000.</p>
<h3 id="stagger-schedule"><a class="header" href="#stagger-schedule">Stagger Schedule</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>System</th><th>Full LOD</th><th>Reduced LOD</th><th>Minimal LOD</th></tr>
</thead>
<tbody>
<tr><td>Pathfinding replan</td><td>Every 4 ticks</td><td>Every 8 ticks</td><td>Never (follow path)</td></tr>
<tr><td>Fog visibility</td><td>Every tick</td><td>Every 2 ticks</td><td>Every 4 ticks</td></tr>
<tr><td>AI re-evaluation</td><td>Every 2 ticks</td><td>Every 4 ticks</td><td>Every 8 ticks</td></tr>
<tr><td>Collision detection</td><td>Every tick</td><td>Every 2 ticks</td><td>Broadphase only</td></tr>
</tbody>
</table>
</div>
<p><strong>Determinism preserved:</strong> The stagger schedule is based on entity ID and tick number — deterministic on all clients.</p>
<h3 id="ai-computation-budget"><a class="header" href="#ai-computation-budget">AI Computation Budget</a></h3>
<p>AI runs on the same stagger/amortization principles as the rest of the sim. The default <code>PersonalityDrivenAi</code> (D043) uses a priority-based manager hierarchy where each manager runs on its own tick-gated schedule — cheap decisions run often, expensive decisions run rarely (pattern used by EA Generals, 0 A.D. Petra, and MicroRTS). Full architectural detail in D043 (<code>decisions/09d-gameplay.md</code>); survey analysis in <code>research/rts-ai-implementation-survey.md</code>.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>AI Component</th><th>Frequency</th><th>Target Time</th><th>Approach</th></tr>
</thead>
<tbody>
<tr><td>Harvester assignment</td><td>Every 4 ticks</td><td>&lt; 0.1ms</td><td>Nearest-resource lookup</td></tr>
<tr><td>Defense response</td><td>Every tick (reactive)</td><td>&lt; 0.1ms</td><td>Event-driven, not polling</td></tr>
<tr><td>Unit production</td><td>Every 8 ticks</td><td>&lt; 0.2ms</td><td>Priority queue evaluation</td></tr>
<tr><td>Building placement</td><td>On demand</td><td>&lt; 1.0ms</td><td>Influence map lookup</td></tr>
<tr><td>Attack planning</td><td>Every 30 ticks</td><td>&lt; 2.0ms</td><td>Composition check + timing</td></tr>
<tr><td>Strategic reassessment</td><td>Every 60 ticks</td><td>&lt; 5.0ms</td><td>Full state evaluation</td></tr>
<tr><td><strong>Total per tick (amortized)</strong></td><td></td><td><strong>&lt; 0.5ms</strong></td><td><strong>Budget for 500 units</strong></td></tr>
</tbody>
</table>
</div>
<p>All AI working memory (influence maps, squad rosters, composition tallies, priority queues) is pre-allocated in <code>AiScratch</code> — analogous to <code>TickScratch</code> (Layer 5). Zero per-tick heap allocation. Influence maps are fixed-size arrays, cleared and rebuilt on their evaluation schedule. The <code>AiStrategy::tick_budget_hint()</code> method (D041) provides a hard microsecond cap — if the budget is exhausted mid-evaluation, the AI returns partial results and uses cached plans from the previous complete evaluation.</p>
<h2 id="layer-5-zero-allocation-hot-paths"><a class="header" href="#layer-5-zero-allocation-hot-paths">Layer 5: Zero-Allocation Hot Paths</a></h2>
<p>Heap allocation is expensive: the allocator touches cold memory, fragments the heap, and (in C#) creates GC pressure. Rust eliminates GC, but allocation itself still costs cache misses.</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Pre-allocated scratch space reused every tick.
/// Initialized once at game start, never reallocated.
/// Pathfinder and SpatialIndex implementations maintain their own scratch buffers
/// internally — pathfinding scratch is not in this struct.
pub struct TickScratch {
    damage_events: Vec&lt;DamageEvent&gt;,       // capacity: 4096
    spatial_results: Vec&lt;EntityId&gt;,        // capacity: 2048 (reused by SpatialIndex queries)
    visibility_dirty: Vec&lt;EntityId&gt;,       // capacity: 1024 (entities needing fog update)
    validated_orders: Vec&lt;ValidatedOrder&gt;,  // capacity: 256
    combat_pairs: Vec&lt;(Entity, Entity)&gt;,   // capacity: 2048
}

impl TickScratch {
    fn reset(&amp;mut self) {
        // .clear() sets length to 0 but keeps allocated memory
        // Zero bytes allocated on heap during the hot loop
        self.damage_events.clear();
        self.spatial_results.clear();
        self.visibility_dirty.clear();
        self.validated_orders.clear();
        self.combat_pairs.clear();
    }
}
<span class="boring">}</span></code></pre>
<p><strong>Per-tick allocation target: zero bytes.</strong> All temporary data goes into pre-allocated scratch buffers. <code>clear()</code> resets without deallocating. The hot loop touches only warm memory.</p>
<p>This is a fundamental advantage of Rust over C# for games. Idiomatic C# allocates many small objects per tick (iterators, LINQ results, temporary collections, event args), each of which contributes to GC pressure. Our engine targets zero per-tick allocations.</p>
<h3 id="string-interning-compile-time-resolution-for-runtime-strings"><a class="header" href="#string-interning-compile-time-resolution-for-runtime-strings">String Interning (Compile-Time Resolution for Runtime Strings)</a></h3>
<p>IC is string-heavy by design — YAML keys, trait names, mod identifiers, weapon names, locomotor types, condition names, asset paths, Workshop package IDs. Comparing these strings at runtime (byte-by-byte, potentially cache-cold) in every tick is wasteful when the set of valid strings is known at load time.</p>
<p><strong>String interning</strong> resolves all YAML/mod strings to integer IDs once during loading. All runtime comparisons use the integer — a single CPU instruction instead of a variable-length byte scan.</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Interned string handle — 4 bytes, Copy, Eq is a single integer comparison.
/// Stable across save/load (the intern table is part of snapshot state, D010).
#[derive(Clone, Copy, PartialEq, Eq, Hash, Serialize, Deserialize)]
pub struct InternedId(u32);

/// String intern table — built during YAML rule loading, immutable during gameplay.
/// Part of the sim snapshot for deterministic save/resume.
pub struct StringInterner {
    id_to_string: Vec&lt;String&gt;,                  // index → string (display, debug, serialization)
    string_to_id: HashMap&lt;String, InternedId&gt;,  // string → index (used at load time only)
}

impl StringInterner {
    /// Resolve a string to its interned ID. Called during YAML loading — never in hot paths.
    pub fn intern(&amp;mut self, s: &amp;str) -&gt; InternedId {
        if let Some(&amp;id) = self.string_to_id.get(s) {
            return id;
        }
        let id = InternedId(self.id_to_string.len() as u32);
        self.id_to_string.push(s.to_owned());
        self.string_to_id.insert(s.to_owned(), id);
        id
    }

    /// Look up the original string for display/debug. Not used in hot paths.
    pub fn resolve(&amp;self, id: InternedId) -&gt; &amp;str {
        &amp;self.id_to_string[id.0 as usize]
    }
}
<span class="boring">}</span></code></pre>
<p><strong>Where interning eliminates runtime string work:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>System</th><th>Without interning</th><th>With interning</th></tr>
</thead>
<tbody>
<tr><td>Condition checks (D028)</td><td>String compare per condition per unit per tick</td><td><code>InternedId</code> == <code>InternedId</code> (1 instruction)</td></tr>
<tr><td>Trait alias resolution (D023/D027)</td><td>HashMap lookup by string at rule evaluation</td><td>Pre-resolved at load time to canonical <code>InternedId</code></td></tr>
<tr><td>WASM mod API boundary</td><td>String marshaling across host/guest (allocation + copy)</td><td><code>u32</code> type IDs — already designed this way in <code>04-MODDING.md</code></td></tr>
<tr><td>Mod stacking namespace (D062)</td><td>String-keyed path lookups in the virtual namespace</td><td><code>InternedId</code>-keyed flat table</td></tr>
<tr><td>Versus table keys</td><td>Armor/weapon type strings per damage calculation</td><td><code>InternedId</code> indices into flat <code>[i32; N]</code> array (already done for <code>VersusTable</code>)</td></tr>
<tr><td>Notification dedup</td><td>String comparison for cooldown checks</td><td><code>InternedId</code> comparison</td></tr>
</tbody>
</table>
</div>
<p><strong>Interning generalizes the <code>VersusTable</code> principle.</strong> The <code>VersusTable</code> flat array (documented above in Layer 2) already converts armor/weapon type enums to integer indices for O(1) lookup. String interning extends this approach to <em>every</em> string-keyed system — conditions, traits, mod paths, asset names — without requiring hardcoded enums. The <code>VersusTable</code> uses compile-time enum indices; <code>StringInterner</code> provides the same benefit for data-driven strings loaded from YAML.</p>
<p><strong>What NOT to intern:</strong> Player-facing display strings (chat messages, player names, localization text). These are genuinely dynamic and not used in hot-path comparisons. Interning targets the <em>engine vocabulary</em> — the fixed set of identifiers that YAML rules, conditions, and mod APIs reference repeatedly.</p>
<p><strong>Snapshot integration (D010):</strong> The <code>StringInterner</code> is part of the sim snapshot. When saving/loading, the intern table serializes alongside game state, ensuring that <code>InternedId</code> values remain stable across save/resume. Replays record the intern table at keyframes. This is the same approach Factorio uses for its prototype string IDs — resolved once during data loading, stable for the session lifetime.</p>
<h2 id="layer-6-work-stealing-parallelism-bonus-scaling"><a class="header" href="#layer-6-work-stealing-parallelism-bonus-scaling">Layer 6: Work-Stealing Parallelism (Bonus Scaling)</a></h2>
<p>After layers 1-5, the engine is already fast on a single core. Parallelism scales it further on better hardware.</p>
<h3 id="how-bevy--rayon-work-stealing-operates"><a class="header" href="#how-bevy--rayon-work-stealing-operates">How Bevy + rayon Work-Stealing Operates</a></h3>
<p>Rayon (used internally by Bevy) creates exactly one thread per CPU core. No more, no less. Work is distributed via lock-free work-stealing queues:</p>
<pre><code>2-core laptop:
  Thread 0: [pathfind units 0-499]
  Thread 1: [pathfind units 500-999]
  → Both busy, no waste

8-core desktop:
  Thread 0: [pathfind units 0-124]
  Thread 1: [pathfind units 125-249]
  ...
  Thread 7: [pathfind units 875-999]
  → All busy, 4x faster than laptop

16-core workstation:
  → Same code, 16 threads, even faster
  → No configuration change
</code></pre>
<p>No thread is ever idle if work exists. No thread is ever created or destroyed during gameplay. This is the Tokio/Vector model applied to CPU-bound game logic.</p>
<h3 id="where-parallelism-actually-helps"><a class="header" href="#where-parallelism-actually-helps">Where Parallelism Actually Helps</a></h3>
<p>Only systems where per-entity work is independent and costly:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// YES — pathfinding is expensive and independent per unit
fn pathfinding_system(query: Query&lt;...&gt;, nav: Res&lt;NavMesh&gt;) {
    let results: Vec&lt;_&gt; = query.par_iter()
        .filter(|(_, _, _, lod)| lod.should_update_path(tick))
        .map(|(entity, pos, target, _)| {
            (entity, nav.find_path(pos, &amp;target.dest))
        })
        .collect();
    
    // Sort for determinism, then apply sequentially
    apply_sorted(results);
}

// NO — movement is cheap per unit, parallelism overhead not worth it
fn movement_system(mut query: Query&lt;(&amp;mut Position, &amp;Velocity)&gt;) {
    // Just iterate. Adding and subtracting integers.
    // Parallelism overhead would exceed the computation itself.
    for (mut pos, vel) in &amp;mut query {
        pos.x += vel.dx;
        pos.y += vel.dy;
    }
}
<span class="boring">}</span></code></pre>
<p><strong>Rule of thumb:</strong> Only parallelize systems where per-entity work exceeds ~1 microsecond. Simple arithmetic on components is faster to iterate sequentially than to distribute.</p>
<h2 id="performance-targets"><a class="header" href="#performance-targets">Performance Targets</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Metric</th><th>Weak Machine (2 core, 4GB)</th><th>Mid Machine (8 core, 16GB)</th><th>Strong Machine (16 core, 32GB)</th><th>Mobile (phone/tablet)</th><th>Browser (WASM)</th></tr>
</thead>
<tbody>
<tr><td>Smooth battle size</td><td>500 units</td><td>2000 units</td><td>3000+ units</td><td>200 units</td><td>300 units</td></tr>
<tr><td>Tick time budget</td><td>66ms (15 tps)</td><td>66ms (15 tps)</td><td>33ms (30 tps)</td><td>66ms (15 tps)</td><td>66ms (15 tps)</td></tr>
<tr><td>Actual tick time (target)</td><td>&lt; 40ms</td><td>&lt; 10ms</td><td>&lt; 5ms</td><td>&lt; 50ms</td><td>&lt; 40ms</td></tr>
<tr><td>Render framerate</td><td>60fps</td><td>144fps</td><td>240fps</td><td>30fps</td><td>60fps</td></tr>
<tr><td>RAM usage (1000 units)</td><td>&lt; 150MB</td><td>&lt; 200MB</td><td>&lt; 200MB</td><td>&lt; 100MB</td><td>&lt; 100MB</td></tr>
<tr><td>Startup to menu</td><td>&lt; 3 seconds</td><td>&lt; 1 second</td><td>&lt; 1 second</td><td>&lt; 5 seconds</td><td>&lt; 8 seconds (incl. download)</td></tr>
<tr><td>Per-tick heap allocation</td><td>0 bytes</td><td>0 bytes</td><td>0 bytes</td><td>0 bytes</td><td>0 bytes</td></tr>
</tbody>
</table>
</div>
<h2 id="performance-vs-c-rts-engines-projected"><a class="header" href="#performance-vs-c-rts-engines-projected">Performance vs. C# RTS Engines (Projected)</a></h2>
<p><em>These are projected comparisons based on architectural analysis, not benchmarks. C# numbers are estimates for a typical C#/.NET single-threaded game loop with GC.</em></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>What</th><th>Typical C# RTS (e.g., OpenRA)</th><th>Our Engine</th><th>Why</th></tr>
</thead>
<tbody>
<tr><td>500 unit tick</td><td>Estimated 30-60ms (single thread + GC spikes)</td><td>~8ms (algorithmic + cache)</td><td>Flowfields, spatial hash, ECS layout</td></tr>
<tr><td>Memory per unit</td><td>Estimated ~2-4KB (C# objects + GC metadata)</td><td>~200-400 bytes (ECS packed)</td><td>No GC metadata, no vtable, no boxing</td></tr>
<tr><td>GC pause</td><td>5-50ms unpredictable spikes (C# characteristic)</td><td>0ms (doesn’t exist)</td><td>Rust ownership + zero-alloc hot paths</td></tr>
<tr><td>Pathfinding 50 units</td><td>50 × A* = ~2ms</td><td>1 flowfield + 50 lookups = ~0.1ms</td><td>Algorithm change, not hardware change</td></tr>
<tr><td>Memory fragmentation</td><td>Increases over game duration</td><td>Stable (pre-allocated pools)</td><td>Scratch buffers, no per-tick allocation</td></tr>
<tr><td>2-core scaling</td><td>1x (single-threaded, verified for OpenRA)</td><td>~1.5x (work-stealing helps where applicable)</td><td>rayon adaptive</td></tr>
<tr><td>8-core scaling</td><td>1x (single-threaded, verified for OpenRA)</td><td>~3-5x (diminishing returns on game logic)</td><td>rayon work-stealing</td></tr>
</tbody>
</table>
</div>
<h2 id="input-responsiveness-vs-openra"><a class="header" href="#input-responsiveness-vs-openra">Input Responsiveness vs. OpenRA</a></h2>
<p>Beyond raw sim performance, input responsiveness is where players <em>feel</em> the difference. OpenRA’s TCP lockstep model (verified: single-threaded game loop, static <code>OrderLatency</code>, all clients wait for slowest) freezes all players to wait for the slowest connection. Our relay model never stalls — late orders are dropped, not waited for.</p>
<p><em>OpenRA numbers below are estimates based on architectural analysis of their source code, not benchmarks.</em></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Factor</th><th>OpenRA (estimated)</th><th>Iron Curtain</th><th>Why Faster</th></tr>
</thead>
<tbody>
<tr><td>Waiting for slowest client</td><td>Yes — everyone freezes</td><td>No — relay drops late orders</td><td>Relay owns the clock</td></tr>
<tr><td>Order batching interval</td><td>Every N frames (configurable)</td><td>Every tick</td><td>Higher tick rate makes N=1 viable</td></tr>
<tr><td>Tick processing time</td><td>Estimated 30-60ms</td><td>~8ms</td><td>Algorithmic efficiency</td></tr>
<tr><td>Achievable tick rate</td><td>~15 tps</td><td>30+ tps</td><td>4x shorter lockstep window</td></tr>
<tr><td>GC pauses during tick</td><td>5-50ms (C# characteristic)</td><td>0ms</td><td>Rust, zero-allocation</td></tr>
<tr><td>Visual feedback on click</td><td>Waits for confirmation</td><td>Immediate (cosmetic)</td><td>Render-side prediction, no sim dependency</td></tr>
<tr><td>Single-player order delay</td><td>~66ms (1 projected frame)</td><td>~33ms (next tick at 30 tps)</td><td><code>LocalNetwork</code> = zero scheduling delay</td></tr>
<tr><td>Worst-case MP click-to-move</td><td>Estimated 200-400ms</td><td>80-120ms (relay deadline)</td><td>Fixed deadline, no hostage-taking</td></tr>
</tbody>
</table>
</div>
<p><strong>Combined effect:</strong> A single-player click-to-move that takes ~200ms in OpenRA (order latency + tick time + potential GC jank) should take ~33ms in Iron Curtain — imperceptible to human reaction time. Multiplayer improves from “at the mercy of the worst connection” to a fixed, predictable deadline.</p>
<p>See <code>03-NETCODE.md</code> § “Why It Feels Faster Than OpenRA” for the full architectural analysis, including visual prediction and single-player zero-delay.</p>
<h2 id="gpu--hardware-compatibility-bevywgpu-constraints"><a class="header" href="#gpu--hardware-compatibility-bevywgpu-constraints">GPU &amp; Hardware Compatibility (Bevy/wgpu Constraints)</a></h2>
<p>Bevy renders via <code>wgpu</code>, which translates to native GPU APIs. This creates a <strong>hardware floor</strong> that interacts with our “2012 laptop” performance target.</p>
<h3 id="wgpu-backend-matrix"><a class="header" href="#wgpu-backend-matrix">wgpu Backend Matrix</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Backend</th><th>Min API Version</th><th>Typical GPU Era</th><th>wgpu Support Level</th></tr>
</thead>
<tbody>
<tr><td>Vulkan</td><td>1.0+</td><td>2016+ (discrete), 2014+ (integrated Haswell)</td><td>First-class</td></tr>
<tr><td>DX12</td><td>Windows 10</td><td>2015+</td><td>First-class</td></tr>
<tr><td>Metal</td><td>macOS 10.14</td><td>2018+ Macs</td><td>First-class</td></tr>
<tr><td>OpenGL</td><td>GL 3.3+ / ES 3.0+</td><td>2010+</td><td><strong>Downlevel / best-effort</strong></td></tr>
<tr><td>WebGPU</td><td>Modern browsers</td><td>2023+</td><td>First-class</td></tr>
<tr><td>WebGL2</td><td>ES 3.0 equiv</td><td>Most browsers</td><td><strong>Downlevel, severe limits</strong></td></tr>
</tbody>
</table>
</div>
<h3 id="the-2012-laptop-problem"><a class="header" href="#the-2012-laptop-problem">The 2012 Laptop Problem</a></h3>
<p>A typical 2012 laptop has an <strong>Intel HD 4000</strong> (Ivy Bridge). This GPU supports OpenGL 4.0 but <strong>has no Vulkan driver</strong>. It falls back to wgpu’s GL 3.3 backend, which is downlevel — meaning reduced resource limits:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Resource</th><th>Vulkan/DX12 (WebGPU defaults)</th><th>GL 3.3 Downlevel</th><th>WebGL2</th></tr>
</thead>
<tbody>
<tr><td>Max texture dimension</td><td>8192×8192</td><td><strong>2048×2048</strong></td><td><strong>2048×2048</strong></td></tr>
<tr><td>Storage buffers per stage</td><td>8</td><td><strong>4</strong></td><td><strong>0</strong></td></tr>
<tr><td>Uniform buffer size</td><td>64 KiB</td><td><strong>16 KiB</strong></td><td><strong>16 KiB</strong></td></tr>
<tr><td>Compute shaders</td><td>Yes</td><td>GL 4.3+ only</td><td><strong>None</strong></td></tr>
<tr><td>Color attachments</td><td>8</td><td><strong>4</strong></td><td><strong>4</strong></td></tr>
<tr><td>Storage textures</td><td>4</td><td>4</td><td><strong>0</strong></td></tr>
</tbody>
</table>
</div>
<h3 id="impact-on-our-feature-plans"><a class="header" href="#impact-on-our-feature-plans">Impact on Our Feature Plans</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Problem on Downlevel Hardware</th><th>Severity</th><th>Mitigation</th></tr>
</thead>
<tbody>
<tr><td>GPU particle weather</td><td>Compute shaders needed; HD 4000 has GL 4.0, compute needs 4.3</td><td>High</td><td>CPU particle fallback (Tier 0)</td></tr>
<tr><td>Shader terrain blending (D022)</td><td>Complex fragment shaders + texture arrays hit uniform/sampler limits</td><td>Medium</td><td>Palette tinting fallback (zero extra resources)</td></tr>
<tr><td>Post-processing chain</td><td>Bloom, color grading, SSR need MRT + decent fill rate</td><td>Medium</td><td>Disable post-FX on Tier 0</td></tr>
<tr><td>Dynamic lighting</td><td>Multiple render targets, shadow maps</td><td>Medium</td><td>Static baked lighting on Tier 0</td></tr>
<tr><td>HD sprite sheets</td><td>2048px max texture on downlevel</td><td>Low</td><td>Split sprite sheets at asset build time</td></tr>
<tr><td>WebGL2/WASM visuals</td><td>Zero compute, zero storage buffers, no GPU particles</td><td>High</td><td>Target WebGPU-only for browser (or accept limits)</td></tr>
<tr><td>Simulation / ECS</td><td><strong>No impact</strong> — pure CPU, no GPU dependency</td><td>None</td><td>—</td></tr>
<tr><td>Audio / Networking / Modding</td><td><strong>No impact</strong> — none touch the GPU</td><td>None</td><td>—</td></tr>
</tbody>
</table>
</div>
<p><strong>Key insight:</strong> The “2012 laptop” target is achievable for the <strong>simulation</strong> (500 units, &lt; 40ms tick) because the sim is pure CPU. The <strong>rendering</strong> must degrade gracefully — reduced visual effects, not broken gameplay.</p>
<h3 id="render-quality-tiers"><a class="header" href="#render-quality-tiers">Render Quality Tiers</a></h3>
<p><code>ic-render</code> queries device capabilities at startup via wgpu’s adapter limits and selects a render tier stored in the <code>RenderSettings</code> resource. All tiers produce an identical, playable game — they differ only in visual richness.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tier</th><th>Name</th><th>Target Hardware</th><th>GPU Particles</th><th>Post-FX</th><th>Weather Visuals</th><th>Dynamic Lighting</th><th>Texture Limits</th></tr>
</thead>
<tbody>
<tr><td>0</td><td><strong>Baseline</strong></td><td>GL 3.3 (Intel HD 4000), WebGL2</td><td>CPU fallback</td><td>None</td><td>Palette tinting</td><td>None (baked)</td><td>2048×2048 max</td></tr>
<tr><td>1</td><td><strong>Standard</strong></td><td>Vulkan/DX12 basic (Intel HD 5000+, GTX 600+)</td><td>GPU compute</td><td>Basic (bloom)</td><td>Overlay sprites</td><td>Point lights</td><td>8192×8192</td></tr>
<tr><td>2</td><td><strong>Enhanced</strong></td><td>Vulkan/DX12 capable (GTX 900+, RX 400+)</td><td>GPU compute</td><td>Full chain</td><td>Shader blending</td><td>Full + shadows</td><td>8192×8192</td></tr>
<tr><td>3</td><td><strong>Ultra</strong></td><td>High-end desktop</td><td>GPU compute</td><td>Full + SSR</td><td>Shader + accumulation</td><td>Dynamic + cascade shadows</td><td>16384×16384</td></tr>
</tbody>
</table>
</div>
<p><strong>Tier selection is automatic but overridable.</strong> Detected at startup from <code>wgpu::Adapter::limits()</code> and <code>wgpu::Adapter::features()</code>. Players can force a lower tier in settings. Mods can ship tier-specific assets.</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// ic-render: runtime render configuration
pub struct RenderSettings {
    pub tier: RenderTier,           // Auto-detected or user-forced
    pub fps_cap: u32,               // 30, 60, 144, 240, uncapped
    pub resolution_scale: f32,      // 0.5 - 2.0 (render resolution vs display)
    pub particle_density: f32,      // 0.0 - 1.0 (scales particle count)
    pub post_fx_enabled: bool,      // Master toggle for all post-processing
    pub weather_visual_mode: WeatherVisualMode,  // PaletteTint, Overlay, ShaderBlend
    pub sprite_sheet_max: u32,      // Derived from adapter texture limits
}

pub enum RenderTier {
    Baseline,   // Tier 0: GL 3.3 / WebGL2 — functional but plain
    Standard,   // Tier 1: Basic Vulkan/DX12 — GPU particles, basic post-FX
    Enhanced,   // Tier 2: Capable GPU — full visual pipeline
    Ultra,      // Tier 3: High-end — everything maxed
}
<span class="boring">}</span></code></pre>
<h3 id="mitigation-strategies"><a class="header" href="#mitigation-strategies">Mitigation Strategies</a></h3>
<ol>
<li>
<p><strong>CPU particle fallback:</strong> Bevy supports CPU-side particle emission. Lower particle count but functional. Weather rain/snow works on Tier 0 — just fewer particles.</p>
</li>
<li>
<p><strong>Sprite sheet splitting:</strong> The asset pipeline (Phase 0, <code>ra-formats</code>) splits large sprite sheets into 2048×2048 chunks at build time when targeting downlevel. Zero runtime cost — the splitting is a bake step.</p>
</li>
<li>
<p><strong>WebGPU-first browser strategy:</strong> WebGPU is supported in Chrome, Edge, and Firefox (2023+). Rather than maintaining a severely limited WebGL2 fallback, target WebGPU for the browser build (Phase 7) and document WebGL2 as best-effort.</p>
</li>
<li>
<p><strong>Graceful detection, not crashes:</strong> If the GPU doesn’t meet even Tier 0 requirements, show a clear error message with hardware info and suggest driver updates. Never crash with a raw wgpu error.</p>
</li>
<li>
<p><strong>Shader complexity budget:</strong> All shaders must compile on GL 3.3 (or have a GL 3.3 variant). Complex shaders (terrain blending, weather) provide simplified fallback paths via <code>#ifdef</code> or shader permutations.</p>
</li>
</ol>
<h3 id="hardware-floor-summary"><a class="header" href="#hardware-floor-summary">Hardware Floor Summary</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Concern</th><th>Our Minimum</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td>GPU API</td><td>OpenGL 3.3 (fallback) / Vulkan 1.0 (preferred)</td><td>wgpu auto-selects best available backend</td></tr>
<tr><td>GPU memory</td><td>256 MB</td><td>Classic RA sprites are tiny; HD sprites need more</td></tr>
<tr><td>OS</td><td>Windows 7 SP1+ / macOS 10.14+ / Linux (X11/Wayland)</td><td>DX12 requires Windows 10; GL 3.3 works on 7</td></tr>
<tr><td>CPU</td><td>2 cores, SSE2</td><td>Sim runs fine; Bevy itself needs ~2 threads minimum</td></tr>
<tr><td>RAM</td><td>4 GB</td><td>Engine targets &lt; 150 MB for 1000 units</td></tr>
<tr><td>Disk</td><td>~500 MB</td><td>Engine + classic assets; HD assets add ~1-2 GB</td></tr>
</tbody>
</table>
</div>
<p><strong>Bottom line:</strong> Bevy/wgpu will run on 2012 hardware, but <strong>visual features must tier down automatically.</strong> The sim is completely unaffected. The architecture already has <code>RenderSettings</code> — we formalize it into the tier system above.</p>
<hr>
<h2 id="profiling--regression-strategy"><a class="header" href="#profiling--regression-strategy">Profiling &amp; Regression Strategy</a></h2>
<h3 id="automated-benchmarks-ci"><a class="header" href="#automated-benchmarks-ci">Automated Benchmarks (CI)</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[bench] fn bench_tick_100_units()  { tick_bench(100); }
#[bench] fn bench_tick_500_units()  { tick_bench(500); }
#[bench] fn bench_tick_1000_units() { tick_bench(1000); }
#[bench] fn bench_tick_2000_units() { tick_bench(2000); }

#[bench] fn bench_flowfield_generation() { ... }
#[bench] fn bench_spatial_query_1000() { ... }
#[bench] fn bench_fog_recalc_full_map() { ... }

#[bench] fn bench_snapshot_1000_units() { ... }
#[bench] fn bench_restore_1000_units() { ... }
<span class="boring">}</span></code></pre>
<h3 id="regression-rule"><a class="header" href="#regression-rule">Regression Rule</a></h3>
<p>CI fails if any benchmark regresses &gt; 10% from the rolling average. Performance is a ratchet — it only goes up.</p>
<h3 id="engine-telemetry-d031"><a class="header" href="#engine-telemetry-d031">Engine Telemetry (D031)</a></h3>
<p>Per-system tick timing from the benchmark suite can be exported as OTEL metrics for deeper analysis when the <code>telemetry</code> feature flag is enabled. This bridges offline benchmarks with live system inspection:</p>
<ul>
<li>Per-system execution time histograms (<code>sim.system.&lt;name&gt;_us</code>)</li>
<li>Entity count gauges, pathfinding cache hit rates, memory usage</li>
<li>Gameplay event stream for AI training data collection</li>
<li>Debug overlay (via <code>bevy_egui</code>) reads live telemetry for real-time profiling during development</li>
</ul>
<p>Telemetry is zero-cost when disabled (compile-time feature gate). Release builds intended for players ship without it. Tournament servers, AI training, and development builds enable it. See <code>decisions/09e-community.md</code> § D031 for full design.</p>
<h3 id="profile-before-parallelize"><a class="header" href="#profile-before-parallelize">Profile Before Parallelize</a></h3>
<p>Never add <code>par_iter()</code> without profiling first. Measure single-threaded. If a system takes &gt; 1ms, consider parallelizing. If it takes &lt; 0.1ms, sequential is faster (avoids coordination overhead).</p>
<p><strong>Recommended profiling tool:</strong> Embark Studios’ <strong>puffin</strong> (1,674★, MIT/Apache-2.0) — a frame-based instrumentation profiler built for game loops. Puffin’s thread-local profiling streams have ~1ns overhead when disabled (atomic bool check, no allocation), making it safe to leave instrumentation in release builds. Key features validated by production use at Embark: frame-scoped profiling (maps directly to IC’s sim tick loop), remote TCP streaming for profiling headless servers (relay server profiling without local UI), and the <code>puffin_egui</code> viewer for real-time flame graphs in development builds via <code>bevy_egui</code>. IC’s <code>telemetry</code> feature flag (D031) should gate puffin’s collection, maintaining zero-cost when disabled. See <code>research/embark-studios-rust-gamedev-analysis.md</code> § puffin.</p>
<h2 id="delta-encoding--change-tracking-performance"><a class="header" href="#delta-encoding--change-tracking-performance">Delta Encoding &amp; Change Tracking Performance</a></h2>
<p>Snapshots (D010) are the foundation of save games, replays, desync debugging, and reconnection. Full snapshots of 1000 units are ~200-400KB (ECS-packed). At 15 tps, saving full snapshots every tick would cost ~3-6 MB/s — wasteful when most fields don’t change most ticks.</p>
<h3 id="property-level-delta-encoding"><a class="header" href="#property-level-delta-encoding">Property-Level Delta Encoding</a></h3>
<p>Instead of snapshotting entire components, track which specific fields changed (see <code>02-ARCHITECTURE.md</code> § “State Recording &amp; Replay Infrastructure” for the <code>#[derive(TrackChanges)]</code> macro and <code>ChangeMask</code> bitfield). Delta snapshots record only changed fields:</p>
<pre><code>Full snapshot:  1000 units × ~300 bytes     = 300 KB
Delta snapshot: 1000 units × ~30 bytes avg  =  30 KB  (10x reduction)
</code></pre>
<p>This pattern is validated by Source Engine’s <code>CNetworkVar</code> system (see <code>research/valve-github-analysis.md</code> § 2.2), which tracks per-field dirty flags and transmits only changed properties. The Source Engine achieves 10-20x bandwidth reduction through this approach — IC targets a similar ratio.</p>
<h3 id="sprop_changes_often-priority-encoding"><a class="header" href="#sprop_changes_often-priority-encoding">SPROP_CHANGES_OFTEN Priority Encoding</a></h3>
<p>Source Engine annotates frequently-changing properties with <code>SPROP_CHANGES_OFTEN</code>, which moves them to the front of the encoding order. The encoder checks these fields first, improving branch prediction and cache locality during delta computation:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Fields annotated with #[changes_often] are checked first during delta computation.
/// This improves branch prediction (frequently-dirty fields are checked early) and
/// cache locality (hot fields are contiguous in the diff buffer).
///
/// Typical priority ordering for a unit component:
///   1. Position, Velocity        — change nearly every tick (movement)  
///   2. Health, Facing            — change during combat
///   3. Owner, UnitType, Armor    — rarely change (cold)
<span class="boring">}</span></code></pre>
<p>The encoder iterates priority groups in order: changes-often fields first, then remaining fields. For a 1000-unit game where ~200 units are moving, the encoder finds the first dirty field within 1-2 checks for moving units (position is priority 0) and within 0 checks for stationary units (nothing dirty). Without priority ordering, the encoder would scan all fields equally, hitting cold fields first and wasting branch predictor entries.</p>
<h3 id="entity-baselines-from-quake-3"><a class="header" href="#entity-baselines-from-quake-3">Entity Baselines (from Quake 3)</a></h3>
<p>Quake 3’s networking introduced <strong>entity baselines</strong> — a default state for each entity type that serves as the base for delta encoding (see <code>research/quake3-netcode-analysis.md</code>). Instead of encoding deltas against the previous snapshot (which requires both sender and receiver to track full state history), deltas are encoded against a well-known baseline that both sides already have. This eliminates the need to retransmit reference frames on packet loss.</p>
<p>IC applies this concept to snapshot deltas:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Per-archetype baseline state. Registered at game module initialization.
/// All delta encoding uses baseline as the reference when no prior
/// snapshot is available (e.g., reconnection, first snapshot after load).
pub struct EntityBaseline {
    pub archetype: ArchetypeLabel,
    pub default_components: Vec&lt;u8&gt;,  // Serialized default state for this archetype
}

/// When computing a delta:
/// 1. If previous snapshot exists → delta against previous (normal case)
/// 2. If no previous snapshot → delta against baseline
///    Much smaller than a full snapshot because most fields
///    (owner, unit_type, armor, max_health) match the baseline.
<span class="boring">}</span></code></pre>
<p><strong>Why baselines matter for reconnection:</strong> When a reconnecting client receives a snapshot, it has no previous state to delta against. Without baselines, the server must send a full uncompressed snapshot (~300KB for 1000 units). With baselines, the server sends deltas against the baseline — only fields that differ from the archetype’s default state (position, health, facing, orders). For a 1000-unit game, ~60% of fields match the baseline, reducing the reconnection snapshot to ~120KB.</p>
<p><strong>Baseline registration:</strong> Each game module registers baselines for its archetypes during initialization (e.g., “Allied Rifle Infantry” has default health=50, armor=None, speed=4). The baseline is frozen at game start — it never changes during play. Both sides (sender and receiver) derive the same baseline from the same game module data.</p>
<h3 id="performance-impact-by-use-case"><a class="header" href="#performance-impact-by-use-case">Performance Impact by Use Case</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Use Case</th><th>Full Snapshot</th><th>Delta Snapshot</th><th>Improvement</th></tr>
</thead>
<tbody>
<tr><td>Autosave (every 30s)</td><td>300 KB per save</td><td>~30 KB per save</td><td>10x smaller</td></tr>
<tr><td>Replay recording</td><td>4.5 MB/s</td><td>~450 KB/s</td><td>10x less IO</td></tr>
<tr><td>Reconnection transfer</td><td>300 KB burst</td><td>30 KB + deltas</td><td>Faster join</td></tr>
<tr><td>Desync diagnosis</td><td>Full state dump</td><td>Field-level diff</td><td>Pinpoints exact divergence</td></tr>
</tbody>
</table>
</div>
<h3 id="benchmarks"><a class="header" href="#benchmarks">Benchmarks</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[bench] fn bench_delta_snapshot_1000_units()  { delta_bench(1000); }
#[bench] fn bench_delta_apply_1000_units()     { apply_delta_bench(1000); }
#[bench] fn bench_change_tracking_overhead()   { tracking_overhead_bench(); }
<span class="boring">}</span></code></pre>
<p>The change tracking overhead (maintaining <code>ChangeMask</code> bitfields via setter functions) is measured separately. Target: &lt; 1% overhead on the movement system compared to direct field writes. The <code>#[derive(TrackChanges)]</code> macro generates setter functions that flip a bit — a single OR instruction per field write.</p>
<h2 id="decision-record"><a class="header" href="#decision-record">Decision Record</a></h2>
<h3 id="d015-performance--efficiency-first-not-thread-first"><a class="header" href="#d015-performance--efficiency-first-not-thread-first">D015: Performance — Efficiency-First, Not Thread-First</a></h3>
<p><strong>Decision:</strong> Performance is achieved through algorithmic efficiency, cache-friendly data layout, adaptive workload, zero allocation, and amortized computation. Multi-core scaling is a bonus layer on top, not the foundation.</p>
<p><strong>Principle:</strong> The engine must run a 500-unit battle smoothly on a 2-core, 4GB machine from 2012. Multi-core machines get higher unit counts as a natural consequence of the work-stealing scheduler.</p>
<p><strong>Inspired by:</strong> Datadog Vector’s pipeline efficiency, Tokio’s work-stealing runtime, axum’s zero-overhead request handling. These systems are fast because they waste nothing, not because they use more hardware.</p>
<h3 id="memory-allocator-selection"><a class="header" href="#memory-allocator-selection">Memory Allocator Selection</a></h3>
<p>The default Rust allocator (<code>System</code> — usually glibc <code>malloc</code> on Linux, MSVC allocator on Windows) is not optimized for game workloads with many small, short-lived allocations (pathfinding nodes, order processing, per-tick temporaries). Embark Studios’ experience across multiple production Rust game projects shows measurable gains from specialized allocators. IC should benchmark with <strong>jemalloc</strong> (<code>tikv-jemallocator</code>) and <strong>mimalloc</strong> (<code>mimalloc-rs</code>) early in Phase 2 — Quilkin offers both as feature flags, confirming the pattern. This fits the efficiency pyramid: better algorithms first (levels 1-4), then allocator tuning (level 5) before reaching for parallelism (level 6). See <code>research/embark-studios-rust-gamedev-analysis.md</code> § Theme 6.</p>
<p><strong>Anti-pattern:</strong> “Just parallelize it” as the answer to performance questions. Parallelism without algorithmic efficiency is like adding lanes to a highway with broken traffic lights.</p>
<h2 id="cross-document-performance-invariants"><a class="header" href="#cross-document-performance-invariants">Cross-Document Performance Invariants</a></h2>
<p>The following performance patterns are established across the design docs. They are not optional — violating them is a bug.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Pattern</th><th>Location</th><th>Rationale</th></tr>
</thead>
<tbody>
<tr><td><code>TickOrders::chronological()</code> uses scratch buffer</td><td><code>03-NETCODE.md</code></td><td>Zero per-tick heap allocation — reusable <code>Vec&lt;&amp;TimestampedOrder&gt;</code> instead of <code>.clone()</code></td></tr>
<tr><td><code>VersusTable</code> is a flat <code>[i32; COUNT]</code> array</td><td><code>02-ARCHITECTURE.md</code></td><td>O(1) combat damage lookup — no HashMap overhead in <code>projectile_system()</code> hot path</td></tr>
<tr><td><code>NotificationCooldowns</code> is a flat array</td><td><code>02-ARCHITECTURE.md</code></td><td>Same pattern — fixed enum → flat array</td></tr>
<tr><td>WASM AI API uses <code>u32</code> type IDs, not <code>String</code></td><td><code>04-MODDING.md</code></td><td>No per-tick String allocation across WASM boundary; string table queried once at game start</td></tr>
<tr><td>Replay keyframes every 300 ticks (mandatory)</td><td><code>05-FORMATS.md</code></td><td>Sub-second seeking without re-simulating from tick 0</td></tr>
<tr><td><code>gameplay_events</code> denormalized indexed columns</td><td><code>decisions/09e-community.md</code> D034</td><td>Avoids <code>json_extract()</code> scans during <code>PlayerStyleProfile</code> aggregation (D042)</td></tr>
<tr><td>All SQLite writes on dedicated I/O thread</td><td><code>decisions/09e-community.md</code> D031</td><td>Ring buffer → batch transaction; game loop thread never touches SQLite</td></tr>
<tr><td>I/O ring buffer ≥1024 entries</td><td><code>decisions/09e-community.md</code> D031</td><td>Absorbs 500 ms HDD checkpoint stall at 600 events/s peak with 3.4× headroom</td></tr>
<tr><td>WAL checkpoint suppressed during gameplay (HDD)</td><td><code>decisions/09e-community.md</code> D034</td><td>Random I/O checkpoint on spinning disk takes 200–500 ms; defer to safe points</td></tr>
<tr><td>Autosave fsync on I/O thread, never game thread</td><td><code>decisions/09a-foundation.md</code> D010</td><td>HDD fsync takes 50–200 ms; game thread only produces DeltaSnapshot bytes</td></tr>
<tr><td>Replay keyframe: snapshot on game thread, LZ4+I/O on background</td><td><code>05-FORMATS.md</code></td><td>~1 ms game thread cost every 300 ticks; compression + write async</td></tr>
<tr><td>Weather quadrant rotation (1/4 map per tick)</td><td><code>decisions/09c-modding.md</code> D022</td><td>Sim-only amortization — no camera dependency in deterministic sim</td></tr>
<tr><td><code>gameplay.db</code> mmap capped at 64 MB</td><td><code>decisions/09e-community.md</code> D034</td><td>1.6% of 4 GB min-spec RAM; scaled up on systems with ≥8 GB</td></tr>
<tr><td>WASM pathfinder fuel exhaustion → continue heading</td><td><code>04-MODDING.md</code> D045</td><td>Zero-cost fallback prevents unit freezing without breaking determinism</td></tr>
<tr><td><code>StringInterner</code> resolves YAML strings to <code>InternedId</code> at load</td><td><code>10-PERFORMANCE.md</code></td><td>Condition checks, trait aliases, mod paths — integer compare instead of string compare</td></tr>
<tr><td><code>DoubleBuffered&lt;T&gt;</code> for fog, influence maps, global modifiers</td><td><code>02-ARCHITECTURE.md</code></td><td>Tick-consistent reads — all systems see same fog/modifier state within a tick</td></tr>
<tr><td>Connection lifecycle uses type state (<code>Connection&lt;S&gt;</code>)</td><td><code>03-NETCODE.md</code></td><td>Compile-time prevention of invalid state transitions — zero runtime cost via <code>PhantomData</code></td></tr>
<tr><td>Camera zoom/pan interpolation once per frame, not per entity</td><td><code>02-ARCHITECTURE.md</code></td><td>Frame-rate-independent exponential lerp on <code>GameCamera</code> resource — <code>powf()</code> once per frame</td></tr>
</tbody>
</table>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="decisions/09g-interaction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="11-OPENRA-FEATURES.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="decisions/09g-interaction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="11-OPENRA-FEATURES.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
