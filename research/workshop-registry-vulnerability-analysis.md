# Workshop & Registry Vulnerability Analysis

> **Research objective:** Catalog real-world vulnerabilities in package registries, game mod platforms, P2P distribution systems, and git-hosted indexes. Map each vulnerability class to Iron Curtain's Workshop (D030/D049/D050), netcode (D006/D007), and modding (D003/D004/D005) designs. Identify gaps and propose mitigations.
>
> **Methodology:** Analysis of documented incidents (npm, PyPI, crates.io, RubyGems, CurseForge/Modrinth, Steam Workshop, NexusMods), academic literature (Bryant & Saiedian 2021, OWASP SCVS), and security advisories. Cross-referenced against IC's existing security design (18 vulnerabilities in `06-SECURITY.md`, 21 in `research/rts-netcode-security-vulnerabilities.md`).

---

## 1. Package Registry & Mod Platform Vulnerabilities

These attacks target the **trust relationship** between a registry/platform and its users. Every system that distributes community-created content faces them.

### WREG-001: Typosquatting & Name Confusion

**What it is:** Attacker registers a package with a name confusingly similar to a popular one. Users install the malicious package by mistake.

**Real-world incidents:**
- **npm `crossenv`** (2017) — typosquat of `cross-env`. Harvested npm tokens from CI environments. 700+ downloads before removal.
- **PyPI `python3-dateutil`** (2019) — typosquat of `python-dateutil`. Contained credential-stealing code.
- **crates.io `rustdecimal`** (2022) — typosquat of `rust_decimal` (underscore vs no separator). Downloaded ~500 times. Exfiltrated environment variables to attacker-controlled server.
- **RubyGems `atlas_client`** (2019) — typosquat of legitimate gem. Part of a campaign targeting 700+ gem names.
- **PyPI mass campaign** (2023–2024) — thousands of typosquat packages uploaded in waves, often auto-generated.

**Common confusion patterns:** hyphen/underscore swap (`my-lib` vs `my_lib`), letter substitution (`l`/`1`/`I`, `O`/`0`), added/removed prefix/suffix (`lib-foo` vs `foo`), doubled letters, common misspellings.

**IC Workshop status:** **NOT ADDRESSED.** D030 defines publisher namespaces and reputation, but no name similarity detection or typosquat prevention at publish time.

**Proposed mitigation:**
- **Publisher-scoped naming:** All packages use `publisher/package` format. Typosquatting `alice/tanks` requires spoofing the `alice` publisher identity — which requires compromising auth, not just picking a similar name. This is the strongest structural defense.
- **Name similarity check at publish time:** Levenshtein distance + common substitution patterns checked against existing package names within the same namespace category. Flag for manual review if edit distance ≤ 2 from an existing package with >100 downloads. Automated rejection for exact homoglyph substitution.
- **CI check in git-index:** Workshop-index CI rejects new package manifests whose names are flagged by the similarity checker.

**Severity for IC:** MEDIUM. Smaller ecosystem than npm reduces volume, but publisher-scoped naming largely eliminates this class.

---

### WREG-002: Dependency Confusion / Namespace Collision

**What it is:** Attacker publishes a public package with the same name as a private/internal dependency. Build systems that check public registries first pull the malicious public version instead of the intended private one.

**Real-world incidents:**
- **Alex Birsan's research** (2021) — demonstrated dependency confusion against 35+ companies including Apple, Microsoft, PayPal, Tesla, Uber. npm, PyPI, and RubyGems all vulnerable. $130,000+ in bug bounties collected.
- **npm internal namespace squatting** (ongoing) — organizations that don't reserve their namespace prefixes on public npm face this permanently.

**IC Workshop status:** **PARTIALLY ADDRESSED.** D050's federation model (multiple sources via `sources.yaml`) creates this risk. A package `core/utils` could exist on both a local source and the official server with different content.

**Proposed mitigation:**
- **Explicit source priority** (already designed in `sources.yaml`). Good — but needs to be the documented default resolution behavior, not just an option.
- **Fully-qualified identifiers in lockfiles:** `ic.lock` must record `source:publisher/package@version`, not just `publisher/package@version`. Resolution uses exact source match first, then falls back to priority order.
- **Shadow package warnings:** If a dependency resolves to a different source than where it was originally installed from (lockfile mismatch), warn the user with a clear message: "Package X resolved from SOURCE_A but lockfile pins SOURCE_B."
- **Reserved namespace prefixes:** Allow publishers to reserve namespace prefixes on official sources. `ic-core/*` packages can only be published by the IC team.

**Severity for IC:** MEDIUM-HIGH during federation phases (Phase 5+). LOW during git-index-only phase (single source).

---

### WREG-003: Manifest Confusion / Metadata Mismatch

**What it is:** The metadata visible in the registry (used for auditing and display) doesn't match the actual package contents. Auditors see a clean package; installers get malicious code.

**Real-world incidents:**
- **npm manifest confusion** (2023) — JFrog discovered 800+ packages where npm registry metadata diverged from the actual `package.json` inside the tarball. 18 packages actively exploited this to hide malicious dependencies. Root cause: npm's publish API accepted manifest metadata separately from the tarball and never cross-verified them.

**IC Workshop status:** **GAP.** The git-index stores a manifest per package. The `.icpkg` file contains its own `manifest.yaml`. The relationship between these two is not explicitly defined. If they can diverge, an attacker could submit a clean manifest to the git-index while the actual `.icpkg` contains a different manifest with malicious dependencies or files.

**Proposed mitigation:**
- **Canonical manifest is inside the `.icpkg`.** The git-index entry is a summary derived from it, not a replacement.
- **Git-index CI validation must:** (a) download the `.icpkg` from the declared URL, (b) extract `manifest.yaml` from inside the archive, (c) compute `manifest_hash = SHA-256(manifest.yaml)`, (d) verify it matches the `manifest_hash` field in the git-index entry, (e) reject if they diverge.
- **New field: `manifest_hash`** in the git-index entry — SHA-256 of the `manifest.yaml` file itself (in addition to the full-package SHA-256). This lets clients verify manifest integrity independently of full package integrity.
- **Client-side verification:** After extracting `.icpkg`, verify that `manifest.yaml` matches the index's `manifest_hash` before processing any mod content.

**Severity for IC:** HIGH. This is a concrete gap that could allow malicious content to bypass index-level auditing.

---

### WREG-004: Account Takeover & Compromised Maintainer

**What it is:** Attacker gains control of a legitimate author's account (via credential theft, phishing, token leakage, or social engineering) and pushes malicious updates to trusted packages.

**Real-world incidents:**
- **`event-stream` / npm** (2018) — Attacker social-engineered a burned-out maintainer into transferring ownership of a package with 1.5M weekly downloads. Injected cryptocurrency-stealing code targeting `copay-dash` wallet.
- **`ua-parser-js` / npm** (2021) — Compromised library (8M weekly downloads) had cryptominer and credential stealer injected. Author's npm account was compromised.
- **fractureiser / CurseForge** (June 2023) — Stolen CurseForge/Bukkit author tokens used to inject malware into popular Minecraft mods. Multi-stage payload: Stage 0 (Java mod) → Stage 1 (downloaded jar) → Stage 2 (native DLL) → Stage 3 (credential theft, browser data exfiltration, clipboard hijacking, Discord token theft). Affected dozens of mods across CurseForge and Bukkit/dev with millions of combined downloads.
- **`eslint-scope` / npm** (2018) — Compromised maintainer token used to publish malicious version that stole npm tokens from other developers' machines.
- **`rest-client` / RubyGems** (2019) — Compromised account pushed version with backdoor code.
- **Garry's Mod Glue Library** (2024) — Supply chain attack via compromised Steam Workshop mod.

**IC Workshop status:** **ADDRESSED** via Vulnerability 18 in `06-SECURITY.md` (fractureiser-inspired 5-layer defense). 2FA (Phase 5), scoped API tokens, namespace transfer requires moderator approval, update anomaly detection, `ic.lock` pinning, security advisory system.

**Remaining gaps:**
- **Session token rotation:** No mention of periodic token rotation or short-lived tokens. Stolen long-lived tokens remain valid indefinitely.
- **Phishing-resistant auth:** WebAuthn/passkeys listed but not required. TOTP is phishable (real-time phishing proxies can intercept TOTP codes).
- **Key compromise recovery:** What happens when a publisher's Ed25519 signing key is compromised? No key revocation or rotation protocol documented.

**Proposed enhancements:**
- **Short-lived API tokens** with configurable expiry (default 90 days). Refresh flow for CI/CD.
- **WebAuthn strongly recommended** for publishers with >1000 total downloads. Phase 6a+.
- **Key revocation protocol:** Publisher generates new keypair, signs the revocation of the old key with the new key, submits to registry. All packages signed with the revoked key are flagged for re-verification. Emergency revocation requires moderator approval + identity verification.

**Severity for IC:** MEDIUM. Core defenses exist. Enhancements address edge cases.

---

### WREG-005: Protestware / Intentional Maintainer Sabotage

**What it is:** A legitimate package maintainer deliberately introduces harmful code into their own package — not compromised, but malicious by choice.

**Real-world incidents:**
- **`colors.js` + `faker.js`** (January 2022) — Maintainer Marak Squires introduced infinite loop printing garbled text. Affected thousands of projects including `aws-cdk`. Motivated by frustration with unpaid open-source labor.
- **`node-ipc` / `peacenotwar`** (March 2022) — Maintainer added code that deleted files on machines with Russian or Belarusian IP addresses. Disguised as a "peace" message. Affected `vue-cli` users.
- **Chef Sugar** (2019) — Maintainer deleted all gems after dispute with ChefCorp.

**IC Workshop status:** **PARTIALLY ADDRESSED.** Anomaly detection catches size changes and new capability requests. WASM capability sandbox limits blast radius. But:
- YAML mods can change game balance maliciously (make ally units suicidal, zero all damage) — annoying but not dangerous.
- Lua mods operate within execution limits but could make a map unplayable.
- The social/political dimension (maintainer acting out of ideology) is impossible to prevent technically.

**Proposed mitigation:**
- **Version rollback in client:** `ic mod rollback <package> <version>` instantly restores previous version from local cache. Already partially designed via `ic.lock`.
- **"Trusted versions" concept:** Community can flag specific versions as trusted. Even if maintainer publishes a sabotaged update, users on the trusted version are safe.
- **Update velocity limits:** Max 3 publishes per package per 24 hours (prevents rapid-fire sabotage-then-fix-then-sabotage cycles).
- Accept that this is fundamentally a social problem. The sandbox architecture limits the blast radius.

**Severity for IC:** LOW-MEDIUM. Mod sandbox (especially WASM capability model) limits damage far more than typical package registries (where packages run arbitrary code during install).

---

### WREG-006: Star-Jacking & Reputation Gaming

**What it is:** Attacker inflates package credibility through fake reviews, manipulated download counts, or linking to popular source repositories they don't own.

**Real-world incidents:**
- **npm star-jacking** (2023) — Packages pointed `repository` field to popular GitHub repos they didn't own, inheriting star counts in npm's UI.
- **PyPI download inflation** (ongoing) — Automated downloads from CI pipelines inflate counts.
- **Steam Workshop** (ongoing) — Bot networks upvote malicious Workshop items.
- **Google Play Store** (ongoing) — Fake review farms are a $1B+ industry.

**IC Workshop status:** **NOT ADDRESSED.** D030 has a reputation system (download count, average rating, dependency count, publish consistency, community reports) but no anti-gaming measures.

**Proposed mitigation:**
- **Workshop-native metrics only:** Don't import or display external metrics (GitHub stars, external download counts).
- **Rate-limited reviews:** One review per account per package. Accounts must be >7 days old with at least one game played to review.
- **Download deduplication:** Count unique authenticated users, not raw download events. Anonymous downloads counted by IP with dedup window.
- **Sockpuppet detection:** Burst of positive reviews from new accounts → flag for moderator review. Weight reviews by reviewer account age and activity.
- **Source repo verification (optional):** If package links to a repo, verify publisher has push access or contributor status. Display verification badge.

**Severity for IC:** MEDIUM. Reputation gaming is predictable in any community platform.

---

### WREG-007: Abandoned Package Takeover

**What it is:** A popular package is abandoned by its maintainer. The platform transfers ownership to a new maintainer who then injects malicious code into a trusted package.

**Real-world incidents:**
- **`event-stream`** (2018, overlaps WREG-004) — original maintainer willingly transferred ownership to unkn attacker who requested it.
- **PyPI namespace expiry** — abandoned packages' names become available for registration by anyone.
- **RubyGems** — multiple cases of abandoned gems being re-registered.

**IC Workshop status:** **NOT ADDRESSED.** Namespace transfer requires moderator approval (good), but no explicit policy for abandoned packages.

**Proposed mitigation:**
- **Abandonment criteria:** Package considered abandoned after 18+ months of inactivity AND no response to 3 maintainer contact attempts over 90 days.
- **Transfer process:** (a) Community nominates new maintainer, (b) moderator approval required, (c) 30-day public notice period before transfer, (d) original author retains ability to reclaim within 6 months of transfer.
- **Archive-first default:** Instead of transferring, abandoned packages are first archived — still installable but marked "unmaintained" with a banner. Transfer only if a credible new maintainer requests it.
- **Published version immutability survives transfer.** New maintainer can publish new versions but cannot modify existing ones.

**Severity for IC:** LOW-MEDIUM. Smaller ecosystem, moderator gate on transfers.

---

### WREG-008: Silent Version Mutation

**What it is:** Author re-publishes the same version number with different content. Users who install "the same version" get different code depending on when they installed.

**Real-world incidents:**
- **npm pre-2022:** Versions could be overwritten within 24 hours of publishing.
- **`left-pad` aftermath** (2016) — Exposed that npm had no immutability guarantees. Led to `npm unpublish` restrictions.
- **PyPI:** Versions can be yanked but not replaced. However, yanking leaves a gap that could be filled.

**IC Workshop status:** **IMPLICITLY ADDRESSED** via SHA-256 in `ic.lock`, but **NOT EXPLICITLY ENFORCED** as a policy. Can a publisher overwrite version 1.0.0 with different content?

**Proposed mitigation:**
- **Explicit immutability rule:** Once version X.Y.Z is published, it CANNOT be modified or overwritten. The SHA-256 hash recorded at publish time is permanent.
- **Yanking ≠ deletion:** Yanked versions are hidden from new installs but remain downloadable for existing lockfiles. Their SHA-256 remains valid.
- **Git-index enforcement:** CI rejects PRs that modify existing version manifests. Only additions of new versions allowed.

**Severity for IC:** LOW if immutability is enforced. HIGH if not — hence the need for explicit policy.

---

## 2. Git-Hosted Index Vulnerabilities

These target IC's Phase 0–3 Workshop bootstrapping mechanism (D049): a `workshop-index` GitHub repository where package manifests are contributed via pull request.

### WIDX-001: Index Poisoning via Cross-Scope PR

**What it is:** Attacker submits a pull request that modifies other packages' manifests — changing SHA-256 hashes to point downloads to malicious versions, or modifying dependency declarations.

**IC status:** **GAP.** CI validates manifest format and checks SHA-256 against download URL. But no enforcement that a PR only modifies files within the submitter's own package scope.

**Proposed mitigation:**
- **Path-scoped PR validation:** CI must reject PRs that modify files outside the submitter's package directory. If PR adds `packages/alice/tanks/1.0.0.yaml`, it may ONLY modify files under `packages/alice/`. Any modification to other paths → automatic CI failure.
- **Consolidated index is CI-generated.** Never hand-edited. Per-package manifests are the source of truth; `index.yaml` is deterministically rebuilt from them.
- **CODEOWNERS file:** Maps package paths to GitHub usernames. `packages/alice/** @alice-github`. GitHub enforces review requirements.
- **Two-maintainer rule for popular packages:** Packages with >500 downloads require approval from both the package author AND a workshop maintainer for manifest changes.

**Severity for IC:** HIGH. Without scope validation, a single malicious PR could redirect downloads for any package.

---

### WIDX-002: CI/CD Pipeline Compromise

**What it is:** Attacker compromises the GitHub Actions workflow that validates workshop-index PRs. Modified CI passes malicious manifests that should be rejected.

**Real-world incidents:**
- **Codecov bash uploader** (2021) — Compromised build tool exfiltrated environment variables (including CI tokens) from 29,000+ customers over 2 months.
- **GitHub Actions `tj-actions/changed-files`** (March 2024) — Popular Action compromised to inject malicious code across 23,000+ repositories.
- **GitHub Actions `reviewdog/action-setup`** (2024) — Compromised to leak secrets.

**IC status:** **NOT ADDRESSED.** CI validation is mentioned in D049 but CI security itself is not designed.

**Proposed mitigation:**
- **Pin Actions to commit SHAs:** Never reference Actions by tag (tags are mutable). Use `actions/checkout@<SHA>`.
- **Minimal permissions:** `GITHUB_TOKEN` with read-only permissions where possible. Explicit `permissions:` block in workflow.
- **No secrets in validation workflow.** The PR validation pipeline should need zero secrets — it only reads the PR diff, downloads a package from a public URL, and verifies hashes.
- **Signed index:** Generate the consolidated `index.yaml`, sign it with a dedicated Ed25519 key stored outside GitHub (e.g., hardware security module or separate signing service). Clients verify the signature. Even if CI is compromised, the attacker can't produce a valid signature.
- **Reproducible index builds:** Given the per-package manifests, `index.yaml` must be deterministically derivable. Any contributor can verify the build locally.

**Severity for IC:** MEDIUM-HIGH. CI compromise is an industry-wide risk. Signed index is the strongest defense.

---

### WIDX-003: Repository Takeover

**What it is:** Attacker gains control of the `workshop-index` GitHub repository (via compromised maintainer account, social engineering, or GitHub vulnerability). Can replace entire index.

**IC status:** **NOT ADDRESSED.**

**Proposed mitigation:**
- **Index signing** (same as WIDX-002 mitigation). Client verifies index signature with a key distributed with the game binary. Repository compromise without the signing key produces unsigned (rejected) indexes.
- **Multi-maintainer requirement.** Repository must have ≥3 maintainers. Admin operations require 2+ approvals.
- **Client-side TOFU:** Trust-On-First-Use for index signing keys. Alert user if the signing key changes unexpectedly.
- **Branch protection:** Require signed commits on main, no force-push, require PR reviews, no single-person merge.

**Severity for IC:** MEDIUM. Mitigated by index signing + client verification.

---

## 3. BitTorrent / P2P Distribution Vulnerabilities

These target IC's P2P package distribution layer (D049).

### BP2P-001: Piece Poisoning

**What it is:** Malicious peer sends corrupted data pieces. Receiver wastes bandwidth re-downloading.

**IC status:** **ADDRESSED.** BitTorrent piece-level SHA-1 hashing + full-package SHA-256 verification. Bad peers blacklisted via peer scoring (EWMA with statistical outlier detection).

**Residual risk:** Minimal. Double verification (piece hash + package hash) catches all corrupted data.

---

### BP2P-002: Eclipse Attack

**What it is:** Attacker surrounds a target peer with malicious nodes in DHT, isolating it from legitimate peers. Can selectively withhold content or serve manipulated data.

**Real-world research:** Documented in academic literature (Heilman et al. 2015 for Bitcoin; applicable to any DHT-based system).

**IC status:** **PARTIALLY ADDRESSED.** IC uses tracker-based peer discovery (not pure DHT), which significantly reduces eclipse risk. SHA-256 verification catches any tampered content even if eclipsed.

**Proposed mitigation:**
- **Tracker-centric by default.** Document that IC's P2P uses tracker for peer discovery, not DHT. DHT is optional and disabled by default.
- **Multi-tracker redundancy.** If one tracker is compromised, client falls through to other trackers or HTTP fallback.
- No additional design changes needed — tracker architecture + SHA-256 is sufficient.

**Residual risk:** LOW.

---

### BP2P-003: Sybil Attack on Peer Scoring

**What it is:** Attacker controls many peers (Sybil identities) to manipulate the reputation system. Build positive reputation through initial honest behavior, then pivot to attacks.

**IC status:** **PARTIALLY ADDRESSED.** EWMA peer scoring with statistical outlier detection exists. But no explicit Sybil resistance.

**Proposed mitigation:**
- **Subnet-level deduplication:** Maximum N peers per /24 subnet (default 3). Prevents one attacker with many IPs in the same range from dominating a swarm.
- **Prefer peers from diverse ASNs** in peer selection. Simple heuristic: spread across at least 3 different autonomous systems when possible.
- Accept that SHA-256 integrity limits Sybil damage — peers can waste bandwidth but cannot serve corrupt data without detection.

**Residual risk:** LOW. Sybil attacks can cause delays but not content corruption.

---

### BP2P-004: WebTorrent Signaling Server as Single Point of Failure

**What it is:** WebTorrent (used for browser P2P) requires a WebRTC signaling server for peer discovery and ICE negotiation. If this server is compromised or unavailable, browser-to-browser P2P fails entirely.

**IC status:** **NOT EXPLICITLY ADDRESSED.** D049 mentions WebTorrent but doesn't discuss signaling server reliability or security.

**Proposed mitigation:**
- **HTTP download as mandatory fallback.** If WebTorrent signaling fails, client falls back to direct HTTP download. This must be documented as a requirement, not an optional behavior.
- **Multiple signaling servers.** Client maintains a list of signaling servers; fails over on timeout.
- **Signaling server integrity:** Signaling servers only facilitate WebRTC negotiation — they never see package content. Even a compromised signaling server can only redirect peers, not serve tampered data (SHA-256 verification catches that).

**Residual risk:** LOW (with HTTP fallback). Availability risk only, not integrity risk.

---

### BP2P-005: Tracker Key Compromise

**What it is:** IC uses a private tracker (access controlled via URL token or auth). If the tracker's authentication mechanism is compromised, unauthorized peers can join swarms — potentially flooding swarms with junk data or monitoring download activity.

**IC status:** **NOT EXPLICITLY ADDRESSED.**

**Proposed mitigation:**
- **Tracker token rotation:** Tokens tied to client version or time window. Rotate periodically (e.g., every release cycle).
- **Tracker authentication:** Client authenticates to tracker using Workshop credentials (if authenticated download) or a per-session token. Not a static URL secret.
- **Damage is limited:** Even unauthorized peers can't serve corrupt data (SHA-256). They can only waste bandwidth or observe swarm participants' IPs (same as any multiplayer game).

**Residual risk:** LOW. Integrity unaffected.

---

## 4. Netcode Vulnerabilities (Gaps in Existing Coverage)

IC's netcode security is the most thoroughly documented area (18 vulnerabilities in `06-SECURITY.md`, 21 in the research doc). These are additional considerations.

### NNET-001: Relay Server Connection Exhaustion

**What it is:** Attacker opens many connections to the relay server, exhausting its connection pool and preventing legitimate players from connecting.

**IC status:** **PARTIALLY ADDRESSED.** Half-open connection defense exists (from Minetest). Rate limiting exists. But no explicit maximum connection count or per-IP connection cap documented for the relay itself.

**Proposed mitigation (for `03-NETCODE.md` relay deployment section):**
- **Max total connections per relay:** configurable, default 1000.
- **Max connections per IP:** configurable, default 5.
- **New connection rate per IP:** max 10/sec.
- **Memory budget per connection:** bounded, connection torn down if exceeded.
- **Idle connection timeout:** connections with no game activity for >60 seconds are closed.

**Residual risk:** LOW after mitigation.

---

### NNET-002: Desync-as-Denial-of-Service

**What it is:** A player with a modified client intentionally causes desyncs to disrupt games. Since desync detection requires investigation time, repeated desyncs can effectively DoS a match.

**IC status:** **PARTIALLY ADDRESSED.** Per-tick state hashing detects desyncs. `DesyncReport` attributes hashes per player. But no automated response to repeat offenders.

**Proposed mitigation:**
- **Per-player desync scoring:** Track which player's hash diverges. If the same player causes desyncs in 3+ games within a time window, flag their account.
- **Automatic disconnect for consistent divergence:** If one player repeatedly produces a different hash than all other players in the same game, disconnect that player (not the game).
- **Desync strike system:** Parallel to lag switch strikes. Repeated desync offenses → temporary matchmaking ban.

**Residual risk:** LOW after mitigation.

---

### NNET-003: Key Management Lifecycle

**What it is:** Ed25519 keys are used extensively (order signing, replay signing, match certification, package signing). What happens when keys are compromised, need rotation, or expire?

**IC status:** **GAP.** Ed25519 signing is well-designed, but no key lifecycle management (revocation, rotation, expiry) is documented.

**Proposed mitigation:**
- **Ephemeral session keys (already designed):** Game sessions use ephemeral keypairs exchanged during lobby. Good — compromise of one session key doesn't affect others.
- **Publisher signing keys:** Need a revocation mechanism. Publisher generates new keypair, signs revocation of old key, submits to registry. Packages signed with revoked keys flagged.
- **Relay server keys:** Rotated per deployment. Old keys expire after configurable grace period.
- **Key expiry:** All long-lived keys should have an expiry date. Client warns when verifying content signed with an expired key.

**Residual risk:** LOW after lifecycle design.

---

## 5. Cross-Cutting Vulnerability Classes

### XCUT-001: WASM Mod Inter-Module Communication

**What it is:** If multiple WASM mods run simultaneously, one mod could attempt to communicate with another to bypass sandbox restrictions (e.g., one mod has network access advertised as a weather API; another uses it as a data exfiltration channel).

**IC status:** **NOT ADDRESSED.** WASM mods are sandboxed individually, but mod-to-mod IPC isn't discussed.

**Proposed mitigation:**
- **Explicit mod isolation:** Each WASM module runs in its own sandbox instance. No shared memory between modules. All inter-mod communication goes through the engine's API (which is capability-controlled).
- **No cross-mod capability delegation:** Mod A cannot call Mod B's capabilities. The engine mediates all cross-mod interactions.
- This is likely already implied by the wasmtime sandbox architecture, but should be documented explicitly.

**Residual risk:** MINIMAL with proper sandboxing.

---

### XCUT-002: Timing Side Channels in Sandboxed Mods

**What it is:** A WASM mod could measure execution time of its own tick to infer fogged information. Example: pathfinding queries take longer when many (fogged) enemy units block paths; combat resolution takes longer with more (fogged) nearby units.

**IC status:** **NOT ADDRESSED.** Highly theoretical.

**Assessment:**
- This is an extremely low-priority risk. The attacker would need to: (a) write a sophisticated mod, (b) get players to install it, (c) extract meaningful intelligence from timing noise.
- Academic interest only. No game has ever mitigated this.
- **Recommendation:** Document as known theoretical risk. No design changes needed. If it ever becomes practical, constant-time tick padding could be added.

**Residual risk:** NEGLIGIBLE.

---

## 6. Gap Summary & Priority Matrix

### New vulnerabilities to add to Security Design (`06-SECURITY.md`)

| ID | Vulnerability | Severity | IC Coverage | Action |
| --- | --- | --- | --- | --- |
| WREG-001 | Typosquatting | MEDIUM | NOT addressed | Add publisher-scoped naming + similarity detection |
| WREG-002 | Dependency confusion | MEDIUM-HIGH | PARTIALLY | Add source pinning in lockfiles + shadow warnings |
| WREG-003 | Manifest confusion | HIGH | GAP | Add manifest_hash + canonical-inside-package rule |
| WREG-004 | Account takeover | MEDIUM | ADDRESSED (enhance) | Add short-lived tokens + key revocation protocol |
| WREG-005 | Protestware | LOW-MEDIUM | PARTIALLY | Add update velocity limits + version rollback |
| WREG-006 | Star-jacking/gaming | MEDIUM | NOT addressed | Add anti-gaming measures for reputation system |
| WREG-007 | Abandoned package takeover | LOW-MEDIUM | NOT addressed | Add abandonment policy + archive-first default |
| WREG-008 | Version mutation | LOW-HIGH | IMPLICIT | Make immutability an explicit enforced rule |
| WIDX-001 | Index poisoning via PR | HIGH | GAP | Add path-scoped PR validation + CODEOWNERS |
| WIDX-002 | CI/CD pipeline compromise | MEDIUM-HIGH | NOT addressed | Add signed index + pinned Actions + minimal permissions |
| WIDX-003 | Repository takeover | MEDIUM | NOT addressed | Add index signing + multi-maintainer + branch protection |
| BP2P-004 | WebTorrent SPOF | LOW | NOT explicit | Document HTTP fallback as mandatory |
| BP2P-005 | Tracker key compromise | LOW | NOT explicit | Add token rotation |
| NNET-001 | Relay connection exhaustion | MEDIUM | PARTIALLY | Add explicit connection limits |
| NNET-002 | Desync-as-DoS | LOW-MEDIUM | PARTIALLY | Add per-player desync scoring |
| NNET-003 | Key management lifecycle | MEDIUM | GAP | Add revocation + rotation + expiry protocol |
| XCUT-001 | WASM inter-mod IPC | LOW | NOT explicit | Document explicit mod isolation |

### Highest-priority design changes

1. **Manifest confusion defense** (WREG-003): `manifest_hash` field, canonical-inside-package rule, CI and client verification.
2. **Git-index PR scope validation** (WIDX-001): Path-scoped CI checks, CODEOWNERS, CI-generated consolidated index.
3. **Index signing** (WIDX-002/003): Ed25519-signed `index.yaml`, client verifies signature. Strongest single defense for the git-hosted index.
4. **Source pinning in lockfiles** (WREG-002): `ic.lock` includes source identifier per dependency.
5. **Publisher-scoped naming** (WREG-001): `publisher/package` format as the naming standard. Eliminates most typosquatting.
6. **Version immutability enforcement** (WREG-008): Explicit policy + CI enforcement.
7. **Key revocation protocol** (NNET-003): For publisher signing keys and relay keys.

### Items that need no design changes (already sufficiently mitigated)

- Piece poisoning (BP2P-001) — SHA-256 double verification
- Eclipse attacks (BP2P-002) — tracker-centric + SHA-256
- IP exposure (BP2P-004 in existing D049) — accepted trade-off with HTTP fallback
- Bandwidth drain (existing D049) — rate-limited seeding
- WASM timing side channels (XCUT-002) — theoretical, negligible risk
- All 18 existing Vulnerability entries in `06-SECURITY.md` — no changes needed
- All 21 VULN entries in the netcode research — covered by existing design

---

## 7. Reference Material

### Real-World Incidents Catalog

| Incident | Year | Platform | Attack Type | Impact |
| --- | --- | --- | --- | --- |
| npm `crossenv` | 2017 | npm | Typosquatting | Token theft, 700+ downloads |
| npm `event-stream` | 2018 | npm | Account takeover | Crypto wallet theft, 1.5M weekly downloads |
| npm `eslint-scope` | 2018 | npm | Compromised token | npm token theft |
| RubyGems `atlas_client` | 2019 | RubyGems | Typosquatting | Part of 700+ name campaign |
| RubyGems `rest-client` | 2019 | RubyGems | Account takeover | Backdoor |
| PyPI `python3-dateutil` | 2019 | PyPI | Typosquatting | Credential theft |
| Alex Birsan dependency confusion | 2021 | npm/PyPI/Gems | Dependency confusion | 35+ companies hit |
| npm `ua-parser-js` | 2021 | npm | Account takeover | Cryptominer, 8M weekly downloads |
| Codecov bash uploader | 2021 | CI/CD | Pipeline compromise | 29,000+ customers affected |
| `colors.js` / `faker.js` | 2022 | npm | Protestware | Infinite loop, thousands of projects |
| `node-ipc` / `peacenotwar` | 2022 | npm | Protestware | File deletion by geolocation |
| crates.io `rustdecimal` | 2022 | crates.io | Typosquatting | Env var exfiltration, ~500 downloads |
| npm manifest confusion | 2023 | npm | Metadata mismatch | 800+ packages with discrepancies |
| fractureiser | 2023 | CurseForge/Bukkit | Stolen tokens | Multi-stage malware, credential theft |
| GH Actions `tj-actions` | 2024 | GitHub Actions | CI compromise | 23,000+ repos affected |
| Garry's Mod Glue Library | 2024 | Steam Workshop | Supply chain | Compromised mod |

### Standards & Frameworks

- **OWASP SCVS** (Software Component Verification Standard) — Framework for supply chain risk reduction
- **SLSA** (Supply-chain Levels for Software Artifacts) — Build provenance framework (Google)
- **Sigstore** — Transparent signing and verification for supply chain security
- **in-toto** — Software supply chain integrity framework (NYU, NJIT)
- **Bryant & Saiedian** (2021) — "A Survey of Real-Time Strategy Game AI Techniques" with attack taxonomy relevant to game security
- **NIST SSDF** (Secure Software Development Framework) — SP 800-218

### Lessons Learned Across All Incidents

1. **SHA-256 integrity is the foundation.** Every single download-time attack (piece poisoning, CDN tampering, mirror drift, manifest confusion) is defeated by content-addressable integrity verification. IC's existing SHA-256 design is correct and essential.

2. **Authentication is the weakest link.** The majority of high-impact incidents (event-stream, ua-parser-js, fractureiser, eslint-scope) were account takeovers. 2FA is necessary but not sufficient — token hygiene, short-lived credentials, and revocation protocols matter.

3. **CI/CD is the new attack surface.** Multiple 2023–2024 incidents targeted build pipelines, not packages directly. Any system that trusts CI output must verify CI integrity.

4. **Immutability prevents entire vulnerability classes.** If published versions cannot be modified, silent mutation, version confusion, and many takeover impacts are eliminated.

5. **Sandboxing limits blast radius.** IC's WASM capability sandbox means that even a fully compromised mod can only do what its declared capabilities allow. This is fundamentally stronger than npm/PyPI where packages execute arbitrary code during installation.

6. **Federation increases attack surface.** Every additional source is an additional trust boundary. Source pinning and shadow detection are essential when multiple sources exist.

7. **Community size is a defense.** Many attacks succeed because of massive ecosystems (npm: 2M+ packages). IC's Workshop will be orders of magnitude smaller, making manual review more feasible and automated attacks less profitable.
